var O=Object.defineProperty,W=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var I=(c,t,a)=>t in c?O(c,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[t]=a,j=(c,t)=>{for(var a in t||(t={}))J.call(t,a)&&I(c,a,t[a]);if(V)for(var a of V(t))K.call(t,a)&&I(c,a,t[a]);return c},A=(c,t)=>W(c,X(t));import Q from"./PostHead.f9e2f632.js";import{d as R,l as Y,m as Z,r as B,p as ee,e as n,f as s,i as D,q as te,g as C,s as se,F as M,j as E,o,x as ae,y as ne,n as U,t as $,z as oe}from"./vendor-vue.23bd1770.js";import{F as G}from"./fuse-js.6ab03eb8.js";const ce={class:"m-4 flex flex-col gap-6"},re={class:"flex flex-wrap gap-x-5 gap-y-2"},ie={role:"search",class:"max-w-100 flex grow items-center gap-2"},le=s("label",{class:"flex items-center",for:"__search_keywords"},[s("span",{class:"i-mdi-magnify text-xl"}),s("span",{class:"sr-only"},"搜索关键词")],-1),de=s("a",{class:"flex items-center text-link",href:"https://fusejs.io/examples.html#extended-search"}," 高级搜索语法 ",-1),me={class:"flex items-center gap-1"},he=s("label",{for:"__search_showmore"},"显示匹配程度较低的结果",-1),ue={key:0,class:"standard-card"},fe=["title"],pe={class:"mb-3 mt-6 max-h-72 overflow-auto whitespace-pre-wrap"},_e=["title"],ye={key:1,class:"standard-card"},xe=s("p",{class:"my-3"}," （匹配程度低，结果已隐藏） ",-1),ve=[xe],ge={key:1,class:"standard-card"},ke=s("p",{class:"my-3"}," 没有检索到任何结果 😢 要不试试缩短或者更换关键词？ ",-1),we=[ke],ze={key:2,class:"standard-card"},Me=s("p",{class:"my-3"}," 请输入关键词进行搜索 ",-1),be=[Me],qe=R({__name:"FuseSearch",props:{data:null,meta:null},setup(c){const t=c,a={includeScore:!0,ignoreLocation:!0,useExtendedSearch:!0,fieldNormWeight:.2},H=new G(t.data,A(j({},a),{threshold:.4,includeMatches:!0,keys:[{name:"title",weight:2},"content","tags"]})),v=Y("history"),p=Z(()=>{var m;return(m=Array.isArray(v.q)?v.q.join(" "):v.q)==null?void 0:m.trim()}),S={miss:"未匹配",fuzzy:"模糊匹配",exact:"精确匹配",ellipsis:"省略"},T={miss:"text-footer",ellipsis:"text-footer",fuzzy:"fuzzy-matched",exact:"exact-matched"},g=50;function q(m){var e;if(p.value===void 0)return"fuzzy";const _=(e=new G([m],a).search(p.value)[0])==null?void 0:e.score;return _!==void 0&&_<.002?"exact":"fuzzy"}function N(){return p.value?H.search(p.value,{limit:20}).map(m=>{var F;const{refIndex:h,score:_}=m,e=t.meta[h];if(!e)return{};let w=[{type:"miss",content:e.frontmatter.title}],i=[{type:"miss",content:""}],y=!1;return(F=m.matches)==null||F.forEach(u=>{if(u.key==="tags"){y=!0;return}const{value:f}=u;if(!f)return;let z=u.indices.filter(([r,x])=>q(f.slice(r,x+1))==="exact");z.length===0&&(z=u.indices.slice()),z.sort((r,x)=>r[0]-x[0]);let l=[];const L=z[0];if(!L)return;let d=u.key==="title"?0:Math.max(0,L[0]-g);z.forEach(([r,x])=>{r-d>g*3?(l.push({type:"miss",content:f.slice(d,d+g)}),l.push({type:"ellipsis",content:`

……

`}),l.push({type:"miss",content:f.slice(r-g,r)})):l.push({type:"miss",content:f.slice(d,r)});const P=f.slice(Math.max(d,r),x+1);l.push({type:q(P),content:P}),d=Math.max(d,x+1)}),l.push({type:"miss",content:f.slice(d,u.key==="title"?f.length:d+g)}),l=l.filter(({content:r})=>r),u.key==="title"?w=l:u.key==="content"&&(i=l)}),{meta:e,titleParts:w,contentParts:i,refIndex:h,tagMatched:y,score:_}}):null}const k=B(N());ee(p,()=>{k.value=N()},{debounce:300});const b=B(!1);return(m,h)=>{const _=Q;return o(),n("div",ce,[s("div",re,[s("form",ie,[le,D(s("input",{id:"__search_keywords","onUpdate:modelValue":h[0]||(h[0]=e=>C(v).q=e),class:"w-full rd-1 bg-card p-1",type:"search",placeholder:"关键词"},null,512),[[te,C(v).q]])]),de,s("div",me,[D(s("input",{id:"__search_showmore","onUpdate:modelValue":h[1]||(h[1]=e=>b.value=e),type:"checkbox"},null,512),[[se,b.value]]),he])]),k.value&&k.value.length?(o(!0),n(M,{key:0},E(k.value,e=>{var w;return o(),n(M,{key:`${C(p)}-${e.refIndex}`},[e.meta?(o(),n(M,{key:0},[((w=e.score)!=null?w:1)<.1||b.value?(o(),n("div",ue,[ae(_,{"title-link":"",href:e.meta.href,filename:e.meta.filename,frontmatter:e.meta.frontmatter,"tag-matched":e.tagMatched},{title:ne(()=>[(o(!0),n(M,null,E(e.titleParts,(i,y)=>(o(),n("span",{key:y,class:U(T[i.type]),title:S[i.type]},$(i.content),11,fe))),128))]),_:2},1032,["href","filename","frontmatter","tag-matched"]),s("pre",pe,[(o(!0),n(M,null,E(e.contentParts,(i,y)=>(o(),n("span",{key:y,class:U(T[i.type]),title:S[i.type]},$(i.content),11,_e))),128))])])):(o(),n("div",ye,ve))],64)):oe("v-if",!0)],64)}),128)):k.value?(o(),n("div",ge,we)):(o(),n("div",ze,be))])}}});export{qe as _};
