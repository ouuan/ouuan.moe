<!DOCTYPE html><html lang="zh-CN"><head>
    <meta charset="UTF-8">
<title>æœç´¢ - ouuan's blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ouuan å†™ä¸œè¥¿çš„åœ°æ–¹ï¼Œæ¶µç›–äº† Web å¼€å‘ã€è®¡ç®—æœºç³»ç»Ÿã€Linux ä½¿ç”¨ã€å¤§å­¦å­¦ä¹ ç”Ÿæ´»ç­‰å¤šä¸ªä¸»é¢˜ã€‚">
<meta property="og:url" content="https://ouuan.moe/search">
<meta property="og:site_name" content="ouuan's blog">
<meta property="og:title" content="æœç´¢ Â· ouuan's blog">
<meta property="og:description" content="ouuan å†™ä¸œè¥¿çš„åœ°æ–¹ï¼Œæ¶µç›–äº† Web å¼€å‘ã€è®¡ç®—æœºç³»ç»Ÿã€Linux ä½¿ç”¨ã€å¤§å­¦å­¦ä¹ ç”Ÿæ´»ç­‰å¤šä¸ªä¸»é¢˜ã€‚">
<meta property="twitter:domain" content="ouuan.moe">
<meta property="twitter:title" content="æœç´¢ Â· ouuan's blog">
<meta property="twitter:description" content="ouuan å†™ä¸œè¥¿çš„åœ°æ–¹ï¼Œæ¶µç›–äº† Web å¼€å‘ã€è®¡ç®—æœºç³»ç»Ÿã€Linux ä½¿ç”¨ã€å¤§å­¦å­¦ä¹ ç”Ÿæ´»ç­‰å¤šä¸ªä¸»é¢˜ã€‚">
<meta property="twitter:url" content="https://ouuan.moe/search">
<style>html:not(.dark):not(.light) { visibility: hidden; } body { visibility: hidden; }</style>
<script>(() => { let dark; try { const theme = localStorage && localStorage.getItem('vueuse-color-scheme'); if (theme === 'dark') dark = true; else if (theme === 'light') dark = false; else dark = window.matchMedia('(prefers-color-scheme: dark)').matches; } catch (e) { dark = false; } document.documentElement.classList.add(dark ? 'dark' : 'light'); })()</script>
<noscript><style>@media (prefers-color-scheme: light) { :root:not(.dark):not(.light) { color-scheme: light; --text-color: #232637; --bg-color: #DEE6EE; --card-color: #EFF3F7; --link-color: #1E66B8; --hover-color: #2E80DD; --active-color: #164C89; --bghover-color: #D6E0EA; --popup-color: #F7F9FB; --footer-color: #5F627B; --area-color: #E1E2E8; --nested-color: #F0F0F3; } } @media (prefers-color-scheme: dark) { :root:not(.dark):not(.light) { color-scheme: dark; --text-color: #E6EDF2; --bg-color: #0D0E15; --card-color: #1F2130; --link-color: #8BB8EC; --hover-color: #A2C6F0; --active-color: #74AAE8; --bghover-color: #353853; --popup-color: #2C2F45; --footer-color: #9699AE; --area-color: #2F313D; --nested-color: #3C3E4E; } } html { visibility:visible !important; }</style></noscript>
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="canonical" href="https://ouuan.moe/search">
<link rel="alternate" type="application/rss+xml" href="/feed.xml" title="RSS Feed - ouuan's blog">
<link rel="alternate" type="application/atom+xml" href="/feed.atom" title="Atom Feed - ouuan's blog">
<link rel="alternate" type="application/json" href="/feed.json" title="JSON Feed - ouuan's blog">
<link rel="dns-prefetch" href="https://plausible.ouuan.moe">
<link rel="preconnect" href="https://blog-visitor-count.ouuan.moe">
<link rel="stylesheet" href="/vendors/katex/katex.css">
<link rel="sitemap" href="https://ouuan.moe/sitemap.xml">
<meta name="author" content="ouuan">
<meta name="twitter:creator" content="@ouuan">
<meta name="twitter:card" content="summary">
<meta property="og:image" content="https://ouuan.moe/android-chrome-512x512.png">
<meta property="generator" content="Ã®les">
<meta name="robots" content="noindex">
    <link rel="stylesheet" href="/assets/style-43808b30.css">
    
  <link rel="modulepreload" href="/assets/iles.711ac573.js" crossorigin=""><link rel="modulepreload" href="/assets/vendor-vue.d1fa473f.js" crossorigin=""><link rel="modulepreload" href="/assets/vite.5ce4fca4.js" crossorigin=""><link rel="modulepreload" href="/assets/SearchBar.3220cffa.js" crossorigin=""><link rel="modulepreload" href="/assets/FuseSearch.df903300.js" crossorigin=""><link rel="modulepreload" href="/assets/PostHead.373ff709.js" crossorigin=""><link rel="modulepreload" href="/assets/VisitorCount.068d91fc.js" crossorigin=""><link rel="modulepreload" href="/assets/site.b21fb919.js" crossorigin=""><link rel="modulepreload" href="/assets/fuse-js.6ab03eb8.js" crossorigin=""><style>@font-face { font-family: "Noto Serif SC Web Font"; font-weight: 400; font-style: normal; font-display: swap; src: url('/assets/fonts/NotoSerifSC-Regular.common.621bd5ce.woff2') format('woff2'), url('/assets/fonts/NotoSerifSC-Regular.common.6bdfb02c.woff') format('woff'); unicode-range: U+0-ff1f; }</style><link rel="preload" href="/assets/fonts/NotoSerifSC-Regular.common.621bd5ce.woff2" as="font" type="font/woff2" crossorigin=""></head>
  <body itemscope="" itemtype="https://schema.org/SearchResultsPage">
    <div id="app"><header class="bg-card shadow print:hidden" itemprop="hasPart" itemscope="" itemtype="https://schema.org/WPHeader"><div class="flex flex-wrap justify-center whitespace-nowrap px-4 page-container sm:flex-nowrap"><div class="flex basis-full items-stretch justify-center sm:mr-3 sm:basis-auto"><a class="flex items-center p-3 text-xl font-serif bghover" href="/"><span>ouuan<span class="mojikumi-narrow-left">â€™</span>s blog</span></a></div><nav class="flex"><ul class="flex"><li class="flex flex-1 items-stretch justify-center"><a class="flex items-center p-3 bghover" href="/"><span>é¦–é¡µ</span></a></li><li class="flex flex-1 items-stretch justify-center"><a class="flex items-center p-3 bghover" href="/posts"><span>æ–‡ç« </span></a></li><li class="flex flex-1 items-stretch justify-center"><a class="flex items-center p-3 bghover" href="/tags"><span>æ ‡ç­¾</span></a></li><li class="flex flex-1 items-stretch justify-center"><a class="flex items-center p-3 bghover" href="/about"><span>å…³äº</span></a></li></ul></nav><div class="sm:basis-full"></div><ul class="flex"><li class="flex"><ile-root id="ile-1"><div class="flex items-stretch lg:hidden"><a class="flex items-center p-2 bghover" href="/search" title="å…¨ç«™æœç´¢"><span class="i-mdi-magnify text-xl"></span></a></div><form role="search" class="hidden items-stretch justify-center lg:flex"><div class="flex items-center"><input value="" class="w-48 rd-full bg-area px-3 py-1" type="search" placeholder="å…³é”®è¯" aria-label="å…¨ç«™æœç´¢"></div><a class="flex items-center p-2 bghover" href="/search?q=" title="å…¨ç«™æœç´¢"><span class="i-mdi-magnify text-xl"></span></a></form></ile-root><script></script><script type="module" async="">import{h as r,c as a}from"/assets/iles.711ac573.js";import{_ as m}from"/assets/SearchBar.3220cffa.js";import"/assets/vendor-vue.d1fa473f.js";import"/assets/vite.5ce4fca4.js";r(a,m,"ile-1",{},{});
</script></li><li class="flex items-stretch"><a class="flex items-center p-2 bghover" href="/feed.xml" title="RSS è®¢é˜…"><span class="i-mdi-rss text-xl"></span></a></li><li class="flex"><ile-root id="ile-2"><div class="relative flex items-stretch"><button title="æš—è‰²æ¨¡å¼è®¾ç½®" class="flex items-center p-2 bghover" aria-haspopup="menu" aria-controls="__theme-switcher" aria-expanded="false"><span class="i-mdi-theme-light-dark text-xl"></span></button><ul style="display:none;" id="__theme-switcher" class="absolute right-0 top-full z-20 whitespace-nowrap rd-1 bg-popup shadow-md" role="menu" aria-label="æš—è‰²æ¨¡å¼é€‰é¡¹"><li class="bghover" role="menuitemradio" aria-checked="true"><button class="flex items-center p-1 text-hover"><span class="i-mdi-cellphone md:i-mdi-tablet lg:i-mdi-monitor mr-1"></span><span>è·Ÿéšç³»ç»Ÿ</span></button></li><li class="bghover" role="menuitemradio" aria-checked="false"><button class="flex items-center p-1"><span class="i-mdi-white-balance-sunny mr-1"></span><span>æ€»æ˜¯äº®è‰²</span></button></li><li class="bghover" role="menuitemradio" aria-checked="false"><button class="flex items-center p-1"><span class="i-mdi-weather-night mr-1"></span><span>æ€»æ˜¯æš—è‰²</span></button></li></ul></div></ile-root><script></script><script type="module" async="">var p=(o,a)=>()=>(a||o((a={exports:{}}).exports,a),a.exports);var r=(o,a,_)=>new Promise((c,n)=>{var f=t=>{try{e(_.next(t))}catch(i){n(i)}},l=t=>{try{e(_.throw(t))}catch(i){n(i)}},e=t=>t.done?c(t.value):Promise.resolve(t.value).then(f,l);e((_=_.apply(o,a)).next())});import{_ as d}from"/assets/vite.5ce4fca4.js";import{a as s}from"/assets/iles.711ac573.js";import"/assets/vendor-vue.d1fa473f.js";var E=p(m=>{const u=()=>r(m,null,function*(){return(yield d(()=>import("/assets/iles.711ac573.js").then(o=>o.v),["assets/iles.711ac573.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).default}),v=()=>r(m,null,function*(){return(yield d(()=>import("/assets/ThemeSwitcher.968a4b0c.js"),["assets/ThemeSwitcher.968a4b0c.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js","assets/useTheme.f81efb80.js"])).default});s(u,v,"ile-2",{},{})});export default E();
</script></li></ul></div></header><main class="min-h-100vh py-6 page-container" itemprop="mainContentOfPage" itemscope="" itemtype="https://schema.org/WebPageElement"><ile-root id="ile-7"><div class="m-4 flex flex-col gap-6"><div class="flex flex-wrap gap-x-5 gap-y-2"><form role="search" class="max-w-100 flex grow items-center gap-2"><label class="flex items-center" for="__search_keywords"><span class="i-mdi-magnify text-xl"></span><span class="sr-only">æœç´¢å…³é”®è¯</span></label><input id="__search_keywords" class="w-full rd-1 bg-card p-1" type="search" placeholder="å…³é”®è¯"></form><a class="flex items-center text-link" href="https://fusejs.io/examples.html#extended-search"> é«˜çº§æœç´¢è¯­æ³• </a><div class="flex items-center gap-1"><input id="__search_showmore" type="checkbox"><label for="__search_showmore">æ˜¾ç¤ºåŒ¹é…ç¨‹åº¦è¾ƒä½çš„ç»“æœ</label></div></div><div class="standard-card"><p class="my-3"> è¯·è¾“å…¥å…³é”®è¯è¿›è¡Œæœç´¢ </p></div></div></ile-root><script></script><script type="module" async="">import{h as H,c as B}from"/assets/iles.711ac573.js";import{_ as V}from"/assets/FuseSearch.df903300.js";import"/assets/vendor-vue.d1fa473f.js";import"/assets/vite.5ce4fca4.js";import"/assets/PostHead.373ff709.js";import"/assets/VisitorCount.068d91fc.js";import"/assets/site.b21fb919.js";import"/assets/fuse-js.6ab03eb8.js";H(B,V,"ile-7",function(n,e,t,a,i,o,u,s,r,c,l,m,d,p,F,g,b,h,f,v,C,y,x,w,E,S,k,P,D,A,T,_,L,$,I,N,M,R,z,j,O,q,U,G,X){return{data:[{title:l,tags:"",content:`## å…³äºæˆ‘

ä½ å¥½ï¼Œæˆ‘æ˜¯ ouuanï¼Œ Iâ€™m from China. ä¸‹é¢æ˜¯å…³äºæˆ‘çš„ä¸€äº›ä¿¡æ¯ã€‚

---

-   ç¥–ç±æ˜¯ & å‡ºç”Ÿäºæ±Ÿè¥¿ï¼Œä½†ä¸åˆ°ä¸€å²å°±æ¥åˆ°äº†æ­¦æ±‰ã€‚
-   æ›¾ç»æ˜¯ä¸€åç°å½¹çš„ OIerã€‚
-   ç°åœ¨æ˜¯ä½äº THU çš„ä¸€åæœ¬ç§‘ç”Ÿï¼Œç­ä¸Šåªæœ‰ä¸¤ä½åŒå­¦ä¸ï¼ˆæ›¾ç»ï¼‰æ˜¯ OIer ~~ï¼Œä½†å­¦çš„éƒ½æ˜¯æ•°å­¦~~ï¼ŒåŸ¹å…»æ–¹æ¡ˆé‡Œæ—¢æœ‰å¤§é‡æ•°å­¦ç³»æ ¸å¿ƒè¯¾ï¼Œåˆæœ‰å¤§é‡è´µç³»æ ¸å¿ƒè¯¾ ~~ï¼Œä½†æˆ‘çš„æ•°åˆ†å¯èƒ½è¿˜æ²¡æœ‰ä¸Šå¾® A çš„äººå­¦çš„å¥½~~ã€‚
-   å¦‚æœä½ æœ‰å¹¸ (?) éœ€è¦åœ¨çº¿ä¸‹ä½œä¸ºèµ›åšæœ‹å‹ç§°å‘¼æˆ‘ï¼Œå‡ºäºé¡ºå£çš„è€ƒè™‘ (?)ï¼Œå¯ä»¥å«æˆ‘â€œæ¬§å…ƒâ€ï¼ˆ~~ä¸ºä»€ä¹ˆæ˜¯ yuan ä¸æ˜¯ wan å‘¢ï¼Œå› ä¸ºä»å‡ºå¤„æ¥è¯´æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯ ouÃ¼anï¼ˆ~~ï¼Œä½†å¦‚æœä½ ä¸ä»‹æ„æ‹—å£çš„è¯ (?)ï¼Œä¹Ÿå¯ä»¥è¯»æˆ O-U-U-A-Nï¼Œ~~ç”šè‡³ Ã³u yÇ” Ã¡n~~ï¼ˆ
-   å› ä¸ºæ„Ÿè§‰æŒ‚å‹é“¾ä¼šä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™åº”è¯¥å°†å‹é“¾ç§»é™¤ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡æŒ‚å‹é“¾ï¼ˆï¼›ä½†æ˜¯è¿™ä¸ªé“¾æ¥æˆ‘ä¼šåŠªåŠ›è®©å®ƒæ°¸è¿œä¸è¢«ç§»é™¤çš„ï¼š[ã€å§‘å¦„è¨€ä¹‹å§‘å¦„å¬ä¹‹ã€](https://chiyuru.github.io/)ã€‚

---

-   ä» 2020 å¹´åˆå¼€å§‹ä½¿ç”¨ Linux ä½œä¸ºä¸»åŠ›æ“ä½œç³»ç»Ÿï¼Œç°åœ¨æ˜¯ [Arch Linux](https://wiki.archlinux.org/title/Arch_Linux) / [i3-wm](https://i3wm.org/) / [Neovim](https://neovim.io/) / [nnn](https://github.com/jarun/nnn) / [yadm](https://github.com/TheLocehiliosan/yadm) ç­‰è½¯ä»¶/é¡¹ç›®çš„ç”¨æˆ·ã€‚
-   GitHub: [ouuan](https://github.com/ouuan)ï¼Œå‚ä¸ç»´æŠ¤/å¼€å‘äº†ä¸€äº›æˆ–ä¸å¤§æˆ–å¾ˆå°çš„é¡¹ç›®ï¼Œä¾‹å¦‚ [CP Editor](https://github.com/cpeditor/cpeditor), [OI Wiki](https://github.com/OI-wiki/OI-wiki), [pacwatch](https://github.com/ouuan/pacwatch) ç­‰ã€‚
-   å†™äº†ä¸€ä¸ªä»£ç è¯­æ³•æ ‘çŒœè°œæ¸¸æˆ [Codle](https://codle.ouuan.moe/)ï¼Œå¯æ˜¯æ²¡å¤šå°‘äººç©ï¼ˆ

---

-   æœ€å–œæ¬¢çš„ç•ªå‰§ï¼ˆä»¥åŠåŸä½œæ¼«ç”»ï¼‰ç›®å‰æ˜¯ [3æœˆã®ãƒ©ã‚¤ã‚ªãƒ³](https://bgm.tv/subject/147068)ï¼Œæ›¾ç»æ˜¯ [CLANNAD](https://bgm.tv/subject/51)ã€‚
-   å¤´åƒæ˜¯ https://www.pixiv.net/artworks/61603233 ã€‚
-   [ã€ŠæœˆãŒãã‚Œã„ã€‹](https://bgm.tv/subject/207573)[ã€Šè’ã¶ã‚‹å­£ç¯€ã®ä¹™å¥³ã©ã‚‚ã‚ˆã€‚ã€‹](https://bgm.tv/subject/268070)[ã€Šé¢¨ãŒå¼·ãå¹ã„ã¦ã„ã‚‹ã€‹](https://bgm.tv/subject/248154)[ã€ŠBEASTARSã€‹](https://bgm.tv/subject/273843)[ã€Šãƒ”ãƒ³ãƒãƒ³ã€‹](https://bgm.tv/subject/93739)[ã€ŠSHIROBAKOã€‹](https://bgm.tv/subject/110467)[ã€Šã‚¦ãƒå¨˜ ãƒ—ãƒªãƒ†ã‚£ãƒ¼ãƒ€ãƒ¼ãƒ“ãƒ¼ Season 2ã€‹](https://bgm.tv/subject/315574)è¿™å‡ éƒ¨ç•ªä¹Ÿå¾ˆæ£’ã€‚
-   åœ¨ [<span class="text-muse">Î¼'s Final LoveLive!</span>](https://zh.moegirl.org.cn/Î¼'s_Final_LoveLive!_~Î¼'sic_Forever~) çš„ä¸¤ä¸ªæœˆå‰è¢«åŒå­¦å®‰åˆ©ç”±åŠ¨ç”»å…¥å‘ [<span class="text-muse">LL</span>](https://zh.moegirl.org.cn/LoveLive!)ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘çš„å…¥å®…ç•ªã€‚ä¹‹åæœ‰ç©è¿‡ä¸€æ®µæ—¶é—´ [sif](https://zh.moegirl.org.cn/zh-cn/LoveLive!å­¦å›­å¶åƒç¥­)ï¼Œä½†ç¼ªçš„ä¸‰æ¬¡å…ƒæ´»åŠ¨ï¼ˆå¹¿æ’­ç”Ÿæ”¾ live ä¹‹ç±»ï¼‰éƒ½çœ‹çš„å¾ˆå°‘ï¼Œåé¢ä¹Ÿé€æ¸æ·¡å‘ï¼Œç›´åˆ°æ˜Ÿå›¢ã€‚[<span class="text-liella">æ˜Ÿ</span>](https://zh.moegirl.org.cn/LoveLive!Superstar!!) æ˜¯åœ¨ä¸€æœŸåŠ¨ç”»ç»“æŸåå¼€å§‹çœ‹çš„ï¼›[<span class="text-nijigasaki">è™¹</span>](https://zh.moegirl.org.cn/LoveLive!è™¹å’²å­¦å›­å­¦å›­å¶åƒåŒå¥½ä¼š) æ˜¯äºŒæœŸåŠ¨ç”»æ”¾é€ä¸­å¼€å§‹çœ‹çš„ï¼›[<span class="text-aqours">æ°´</span>](https://zh.moegirl.org.cn/LoveLive!Sunshine!!) æ²¡å¤ªå…³æ³¨ï¼ŒåŠ¨ç”»åªè¿½åˆ°ä¸€æœŸçš„ä¸€åŠï¼Œä½†å¼€å§‹çœ‹è™¹æ˜Ÿåä¹Ÿå¤šå°‘çœ‹äº†ä¸€ç‚¹åˆ‡ç‰‡ï¼›éŸ³ä¹å‰§å’Œè²å®Œå…¨æ²¡å»äº†è§£ï¼Œæ„Ÿè§‰ç°åœ¨è™¹æ˜Ÿå°±å·²ç»æ¨ä¸åŠ¨äº†ï¼Œæ²¡æ³•åŠ æ¨ã€‚ä¸»æ¨å¤§æ¦‚æ˜¯ [<span class="text-kanon">sayu</span>/<span class="text-kanon">åˆ</span>](https://zh.moegirl.org.cn/ä¼Šè¾¾å°ç™¾åˆ)[<span class="contrast-keke-link">é²¤</span>](https://zh.moegirl.org.cn/Liyuu)/[<span class="text-mia">ç§€é…±</span>](https://zh.moegirl.org.cn/å†…ç”°ç§€)/[<span class="text-emma">éº»åœ†</span>](https://zh.moegirl.org.cn/æŒ‡å‡ºæ¯¬äºš)ã€‚ä½†ç°åœ¨å…¶å®å·²ç»åˆæ·¡å‘äº†ï¼Œæœ€è¿‘éƒ½çœ‹å¾—æ¯”è¾ƒå°‘ã€‚
-   [ã€Šç½—å°é»‘æˆ˜è®°ã€‹](https://bgm.tv/subject/13603) æ˜¯é™¤äº†åŠ¨ç”»ç”µå½±ä»¥åŠå°æ—¶å€™çœ‹çš„åŠ¨ç”»ç‰‡ï¼Œå”¯ä¸€ä¸€éƒ¨è¾ƒä¸ºå®Œæ•´åœ°çœ‹è¿‡çš„å›½æ¼«ã€‚
-   æœ‰åœ¨ç”¨ [bangumi](https://bgm.tv/user/ouuan)ï¼Œä½†æ˜¯ç”¨çš„è¾ƒæ™šï¼Œæ‰€ä»¥ï¼ˆæ—©æœŸçš„ï¼‰æ—¶é—´èƒ¶å›Šä¼šæ¯”è¾ƒä¹±ï¼Œæ—©æœŸçœ‹çš„ç•ªçš„è¯„åˆ†å¤§æ¦‚ä¹Ÿæ¯”è¾ƒä¹±æ¥ï¼ˆ~~è¯´çš„å¥½åƒæœ€è¿‘çœ‹çš„ç•ªè¯„åˆ†å°±æœ‰å¤šæ­£ç¡®ä¸€æ ·~~ï¼‰ã€‚
-   å¬çš„æœ€å¤šçš„æ˜¯æ—¥è¯­æ­Œï¼Œç›®å‰[æ­Œå•](https://music.163.com/#/playlist?id=5091819419)çš„å‰å…­åæœ‰ä¸‰é¦–[åŒ¹è€æ¿](https://space.bilibili.com/203655966/)çš„æ­Œå’Œä¸‰é¦–[èŠ±è­œ](https://space.bilibili.com/488970166/)çš„æ­Œã€‚

    P.S. æ„Ÿè§‰æ‰¾ä¸åˆ°ä¸€ä¸ªæ»¡æ„çš„æ­Œå•ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œä»¥è‡³äºæ‡’å¾—æ›´æ–°æ­Œå•ã€‚æƒ³ä»¥åè‡ªå·±å†™ä¸€ä¸ªã€‚
-   å¤§æ¦‚æ˜¯ä¸€å[è½´èŠ¯](https://space.bilibili.com/61639371)ã€‚åªä¸è¿‡çœ‹ [v](https://zh.moegirl.org.cn/è™šæ‹ŸUPä¸») çœ‹çš„å¤šçš„è¿˜æ˜¯ 2020 å¹´ï¼Œæ›¾ç»è¿˜çœ‹è¿‡å¾ˆå¤šå…¶ä»– vï¼Œç°åœ¨çœ‹å¾—å°‘äº†ã€‚
-   å¶å°”ï¼ˆ~~æ›¾ç»~~ï¼‰ä¼š[åœ¨ b ç«™ä¸Šå‘ä¸€äº›è§†é¢‘](https://space.bilibili.com/11067182)ã€‚æ„Ÿè§‰é™¤äº† [av65924361](https://www.bilibili.com/video/av65924361) å’Œ [av79877987](https://www.bilibili.com/video/av79877987) åŸºæœ¬ä¸Šéƒ½æ˜¯åˆ’æ°´æˆ–è€…é»‘å†å²ï¼ˆ
-   ä¸å–œæ¬¢ BV å·ï¼Œæ‰€ä»¥å†™äº†ä¸ª [bv2av](https://greasyfork.org/zh-CN/scripts/398535-bv2av) çš„ userscriptã€‚

---

-   ~~åœ¨[åå…­å‹äººæ ¼æµ‹è¯•](https://www.16personalities.com/ch/)ä¸­ç¨³å®šè·å¾—[â€œé€»è¾‘å­¦å®¶â€äººæ ¼ (INTP)](https://www.16personalities.com/ch/intp-äººæ ¼) çš„æµ‹è¯•ç»“æœï¼ˆæœ‰æ—¶ä¼šåœ¨ INTP-A å’Œ INTP-T ä¹‹é—´æ‘‡æ‘†ï¼‰~~ æœ€æ–°æµ‹è¯•ç»“æœè¿˜æ˜¯ INTPï¼Œä½†é™¤äº† I æ˜¯ 90%ï¼Œå…¶ä»–å‡ é¡¹éƒ½ä¸åˆ° 55%ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ IXXX äº†ï¼ˆ
-   ä¸æ“…è¨€è¾ï¼Œä¸ä¼šäº¤é™…ã€‚å¸¸æœ‰è¯­å‡ºå†’çŠ¯çš„æ—¶å€™ã€‚è™½å¸Œæœ›å–„è‰¯å¾…äººï¼Œä½†ä¸ä¼šä¸ºäººå¤„äº‹ã€‚([origin](http://web.archive.org/web/20210123202817/https://blog.yuuta.moe/about/))
-   æˆ‘ç›¸ä¿¡äººä¸äººä¹‹é—´çš„è¯¯è§£è¿œå¤šäºåˆ†æ­§ã€‚
-   > ã€Œæ²¡æœ‰äººæ˜¯æ€ªç‰©ã€ã€Œç†è§£ä¸ç­‰äºèµåŒã€  

    å¼•è‡ªã€Šã€ˆå’Œé™Œç”Ÿäººè¯´è¯ã€‰ï¼šè¶Šæ±¹æ¶Œï¼Œè¶Šå¹³é™ã€‹ï¼ŒVista çœ‹å¤©ä¸‹ 2021.12.18
    ï¼ˆå…¶å®åº”è¯¥æ˜¯â€œè¶Šå¹³é™ï¼Œè¶Šæ±¹æ¶Œâ€ï¼›åŸæ ‡é¢˜å¦‚æ­¤ï¼‰
-   é«˜ä¸‰çš„æ—¶å€™åŒå­¦å¸¦äº†å¾ˆå¤šã€ŠVista çœ‹å¤©ä¸‹ã€‹åˆ°ç­ä¸Šä¾›å¤§å®¶å€Ÿé˜…ï¼Œå°±åˆ©ç”¨æ™šè‡ªä¹ å’Œè€ƒå‰â€œå¤ä¹ â€çœ‹äº†å¾ˆå¤šï¼›é«˜ä¸­æ¯•ä¸šåè‡ªå·±è®¢é˜…äº†ç”µå­ç‰ˆçš„çœ‹å¤©ä¸‹ï¼Œç°åœ¨ä¹Ÿä¸€ç›´åœ¨çœ‹ï¼Œå¯ä»¥è¯´æ˜¯é™¤äº†ç¤¾äº¤åª’ä½“å¤–çš„ä¸»è¦ä¿¡æ¯æ¥æºã€‚
-   å¹»æƒ³æœ‰ä¸€å¤©ç”¨æˆ·ä¸ºå¼€æº/[è‡ªç”±è½¯ä»¶](https://www.gnu.org/philosophy/free-sw.html)ä»˜è´¹èƒ½æˆä¸ºå¸¸æ€ï¼Œå°±åƒè§‚ä¼—ä¸ºèƒ½å…è´¹çœ‹çš„ç›´æ’­æ‰“èµæˆä¸ºå¸¸æ€ä¸€æ ·ã€‚ç°åœ¨è¶Šæ¥è¶Šè§‰å¾—è¿™åªèƒ½æ˜¯ä¸ªå¹»æƒ³ï¼Œè€Œä¸”æˆ–è®¸ä¼šæœ‰æ¯”ç”¨æˆ·ä¸æ„¿ä»˜è´¹æ›´å¤§çš„é˜»ç¢ã€‚

---

-   GPG key: [\`863A0F9FA8127FA4\`](https://github.com/ouuan.gpg)

---

## å…³äºæœ¬åšå®¢

è¿™æ˜¯æˆ‘ç»§åšå®¢å›­ã€hexo-theme-nextã€hugo-theme-even åçš„ç¬¬å››ä»£åšå®¢ã€‚åšå®¢å›­å’Œ Hexo çš„æ–‡ç« å·²å…¨éƒ¨ç§»è‡³ Hugo åšå®¢ï¼Œä½† Hugo åšå®¢çš„æ–‡ç« ï¼ˆä»¥ OI ç›¸å…³å†…å®¹ä¸ºä¸»ï¼‰å°†ä¸ä¼šç§»è‡³æœ¬åšå®¢ï¼Œå¯åœ¨ [åŸ Hugo åšå®¢](https://ouuan.github.io/) æŸ¥çœ‹ã€‚

æœ¬åšå®¢ç”± ouuan è‡ªå·±è®¾è®¡ã€åˆ¶ä½œï¼Œä¸»è¦åŸºäº [Ã®les](https://github.com/ElMassimo/iles)ï¼ˆ[Vue](https://vuejs.org/)ã€[Vite](https://vitejs.dev/)ï¼‰å’Œ [UnoCSS](https://github.com/unocss/unocss)ã€‚è®¾è®¡æœ‰åœ¨ä¸€å®šç¨‹åº¦ä¸Šå€Ÿé‰´ [hugo-theme-even](https://github.com/olOwOlo/hugo-theme-even)ã€[hexo-theme-next](https://github.com/next-theme/hexo-theme-next)ã€[Sukka's Blog](https://blog.skk.moe/)ã€GitHub çš„ Markdown æ˜¾ç¤ºï¼Œä½†å¤§éƒ¨åˆ†æ˜¯åŸåˆ›è®¾è®¡ï¼Œä¸”å€Ÿé‰´éƒ¨åˆ†çš„ä»£ç åŸºæœ¬éƒ½æ˜¯è‡ªå·±å†™çš„ã€‚

åšå®¢æ­£æ–‡éƒ¨åˆ†ä½¿ç”¨çš„å­—ä½“æ˜¯ [æ€æºå®‹ä½“](https://github.com/adobe-fonts/source-han-serif)ï¼Œå¼•ç”¨å—éƒ¨åˆ†ä½¿ç”¨çš„æ˜¯ [<span class="font-kai">éœé¹œæ–‡æ¥·</span>](https://github.com/lxgw/LxgwWenKai)ï¼ŒäºŒè€…å‡ä»¥ OFL æˆæƒã€‚web font çš„åˆ’åˆ†ã€ç”Ÿæˆå¯ä»¥å‚è€ƒ[ã€Šå¦ä¸€ç§å¾ˆæ–°çš„ä¸­æ–‡å­—ä½“ç½‘é¡µåµŒå…¥æ–¹æ¡ˆã€‹](/post/2023/01/glyph-segregator)ï¼Œå…¶ä»–æ’ç‰ˆä¼˜åŒ–ï¼ˆåŒ…æ‹¬æ ‡ç‚¹æŒ¤å‹çš„å®ç°ï¼‰è¯¦è§[ã€Šä¸€äº›åšå®¢æ’ç‰ˆä¼˜åŒ–å° trickã€‹](/post/2023/02/typography-tricks)ã€‚

ä»£ç é«˜äº®ä½¿ç”¨çš„æ˜¯ [Shiki](https://github.com/shikijs/shiki/)ï¼Œä¸»é¢˜æ˜¯ [Night Owl](https://github.com/sdras/night-owl-vscode-theme)ï¼ˆé€‰äº†ä¸€ä¸ªç”¨çš„äººè¾ƒå¤šï¼Œæœ‰æš—è‰²å’Œäº®è‰²ï¼Œé…è‰²æ•´ä½“åè“ã€å’Œåšå®¢ä¸»é¢˜æ¯”è¾ƒè´´åˆçš„ï¼›æˆ‘è‡ªå·±çš„ neovim è¿˜æ˜¯ç”¨çš„ [gruvbox](https://github.com/ellisonleao/gruvbox.nvim)ï¼‰ã€‚[remark](https://github.com/remarkjs/remark) æ’ä»¶å’Œ Vue component æ˜¯è‡ªå·±å†™çš„ï¼Œå¯ä»¥å‚è€ƒ [remarkShiki.ts](https://github.com/ouuan/iles-blog/blob/master/src/remark/remarkShiki.ts)ã€[CodeBlock.vue](https://github.com/ouuan/iles-blog/blob/master/src/components/CodeBlock.vue)ã€[CopyButton.vue](https://github.com/ouuan/iles-blog/blob/master/src/components/CopyButton.vue)ï¼ˆå¦‚æœç”¨çš„ä¸æ˜¯ iles å¤§æ¦‚ä¸èƒ½ç›´æ¥ç…§æŠ„ï¼‰ã€‚

å¯ä»¥åœ¨éµå¾ª [AGPL v3](https://github.com/ouuan/iles-blog/blob/master/LICENSE)ï¼ˆæˆ–å…¶æ›´æ–°çš„ç‰ˆæœ¬ï¼‰çš„æ¡ä»¶ä¸‹å‚è€ƒ/ä½¿ç”¨ [æœ¬åšå®¢ä»£ç ](https://github.com/ouuan/iles-blog) çš„ **ç‰‡æ®µ**ï¼Œä½†è¯· **å°½é‡ä¸è¦** ç›´æ¥åœ¨æ•´ä¸ªä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œå› ä¸ºå¹¶æ²¡æœ‰æŒ‰ç…§äººäººå¯ä»¥æ‹¿æ¥ç”¨çš„æ¨¡æ¿è¿›è¡Œè®¾è®¡ï¼Œå¾ˆå¤šåœ°æ–¹ä¼šç¡¬ç¼–ç ä¸€äº›ä¸œè¥¿ï¼Œä¿®æ”¹æ¯”è¾ƒå›°éš¾ï¼Œå¦‚æœæˆ‘è¿™é‡Œæœ‰æ›´æ–°è¦åŒæ­¥ä¹Ÿå¾ˆéº»çƒ¦ï¼Œä¹Ÿå¯èƒ½åœ¨æŸäº›ç³»ç»Ÿç¯å¢ƒæ— æ³•æ­£å¸¸æ„å»ºä¹‹ç±»çš„ã€‚å¦‚æœçœŸçš„ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿéœ€è¦éµå¾ª [AGPL v3](https://github.com/ouuan/iles-blog/blob/master/LICENSE)ï¼Œå¹¶ä¸”è¯·åŠ¡å¿…å°å¿ƒï¼Œä¸€åˆ‡åæœè‡ªè´Ÿã€‚

æœ¬åšå®¢ä½¿ç”¨ ouuan è‡ªè¡Œæ­å»ºçš„ [Plausible Analytics](https://plausible.io/) å®ä¾‹è¿›è¡Œè®¿é—®é‡ç»Ÿè®¡ï¼Œä¸ä½¿ç”¨ Cookies ä¸”æ»¡è¶³ GDPR ç­‰æ¡ä¾‹è¦æ±‚ã€‚ä½¿ç”¨ [giscus](https://giscus.app/) æä¾›è¯„è®ºæœåŠ¡ï¼Œå‘è¡¨è¯„è®ºéœ€è¦ç™»å½• GitHub å¸å·ï¼Œé™¤äº†å‘è¡¨è¯„è®ºä¹Ÿå¯ä»¥ç»™æ–‡ç« ç‚¹èµ/ç‚¹è¸©ã€‚ç½‘ç«™æ‰˜ç®¡äº [Cloudflare Pages](https://pages.cloudflare.com/)ã€‚

<Card type="info" fold title="RSS è®¢é˜…">

<Card type="question" fold title="ä»€ä¹ˆæ˜¯ RSSï¼Ÿ">

-   [é«˜æ•ˆè·å–ä¿¡æ¯ï¼Œä½ éœ€è¦è¿™ä»½ RSS å…¥é—¨æŒ‡å— - å°‘æ•°æ´¾](https://sspai.com/post/56391)
-   [æˆ‘æœ‰ç‰¹åˆ«çš„ RSS ä½¿ç”¨æŠ€å·§ | Hi, DIYgod](https://diygod.me/ohmyrss/)
-   [RSS - Wikipedia](https://en.wikipedia.org/wiki/RSS)

</Card>

-   ä¸€äº› RSS é˜…è¯»å™¨ï¼š
    <div class="inline-img mb-2">
    -   [![Follow on Inoreader](https://shields.ouuan.moe/static/v1?label=Inoreader&message=follow&style=social&logo=data:image/webp;base64,UklGRlICAABXRUJQVlA4IEYCAADwDQCdASpIAEgAPpFCmkolo6Ihp7gKGLASCWYA05nA/qumqeI8zavP3naz1m+oDbAc9Hpne9AL91aqgA91zGCWx8nzKx0FkaT+q4k67MyE2/hZym+6Qlfro/6nbI7vMhtFzlbdteFFMPzGJSH6DzATVS/YBx+Pv1gA/tYx/G8ZLrdlf+Ur43bsXBh+7KArqPth0CslagD4VKOmauUvNe1dhwxpfrDwqRKvSQEviUNf9AoDJ89/8dEHpu/J/vIsQVr8/SLJPEy8MGcw3ZV+gyLplT/tqzDYluRQ9IQKj9PPk/ExqxMI98/ACDXEYrdimUzsiz7qxRCKQ81JCgKiZTVeMiujTknatA6miOW2wTG1KSEoCa+6eyuzyo1puxJMM8ZbYt3aayIQAQ1DhjYxtMb/RD1SZZtmsBl9puxniEDqgnw2hIPekG5SatAlFeiJJw6A5B+dDCTeP+0Tir6PRDuQVXCzNBmtLFHXyBO/YYYsVq8ifCYlqn5bFEyJ4NHidwPWyf4NmVmquIwYbyxd/253wVwQQQig9oO9zHFMW8erqf9qk9N7V0yU5VOEHYGqmcWVB1cvOQuvja7SX3aoiGVMMsEelV0sH0USncQ7lx9aI6DTfLjQJyQ3Hl91g6JEcEjv4TCh0KewAnNpCM4PuEvn1kWgGusR2kcUUDZxn+pJLv8XJUbA2PkZ3O2e6eySmglzu8+ytxDe+TzGrAGF/SCcLth5IuX4eeBVDVjn0TqDEjOncMk0AIzNDD8Wdw/1aAAB4oAAAAA=)](https://www.inoreader.com/feed/https%3A%2F%2Fouuan.moe%2Ffeed.xml)
    -   [![Follow on Feedly](https://shields.ouuan.moe/static/v1?label=Feedly&message=follow&style=social&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTExLjU1LjY1MmEyLjE3NCAyLjE3NCAwIDAgMC0zLjEwNSAwTC42NCA4LjZhMi4yNzQgMi4yNzQgMCAwIDAgMCAzLjE2M2w1LjU3IDUuNjczYy4zODguMzQzLjg5NC41NTMgMS40NS41NTNoNC42NzdhMi4xOCAyLjE4IDAgMCAwIDEuNTYtLjY1OWw1LjQ2Mi01LjU2MmEyLjI3MiAyLjI3MiAwIDAgMCAwLTMuMTYzTDExLjU1MS42NTJ6bS0uMjE2IDE0LjUxOGwtLjc4Ljc5MmEuMzEuMzEgMCAwIDEtLjIyMy4wOTVoLS42NjdhLjMxMy4zMTMgMCAwIDEtLjIwNi0uMDhsLS43OTUtLjgwOGEuMzI1LjMyNSAwIDAgMSAwLS40NTJsMS4xMTQtMS4xMzRhLjMwOS4zMDkgMCAwIDEgLjQ0MyAwbDEuMTE0IDEuMTM1YS4zMjQuMzI0IDAgMCAxIDAgLjQ1MnptMC00Ljc1OWwtMy4xMTUgMy4xNzNhLjMxMi4zMTIgMCAwIDEtLjIyMy4wOTNINy4zM2EuMzEzLjMxMyAwIDAgMS0uMjA4LS4wNzhsLS43OTMtLjgwOGEuMzI2LjMyNiAwIDAgMSAwLS40NTNsMy40NDktMy41MTJhLjMxLjMxIDAgMCAxIC40NDMgMGwxLjExNCAxLjEzNWEuMzIyLjMyMiAwIDAgMSAwIC40NXptMC00Ljc1NmwtNS40NSA1LjU1YS4zMS4zMSAwIDAgMS0uMjI0LjA5NGgtLjY2N2EuMzExLjMxMSAwIDAgMS0uMjA3LS4wNzhsLS43OTQtLjgxYS4zMjMuMzIzIDAgMCAxIDAtLjQ1bDUuNzg1LTUuODkyYS4zMS4zMSAwIDAgMSAuNDQzIDBsMS4xMTQgMS4xMzRhLjMyNC4zMjQgMCAwIDEgMCAuNDUyeiIgZmlsbD0iIzJBQjE0QyIvPjwvc3ZnPg==)](https://feedly.com/i/subscription/feed%2Fhttps%3A%2F%2Fouuan.moe%2Ffeed.xml)
    -   [![Follow on follow.it](https://shields.ouuan.moe/static/v1?label=follow.it&message=follow&style=social&logo=data:image/webp;base64,UklGRtABAABXRUJQVlA4IMQBAAAQDgCdASpkAGQAPpFGnkqlpCMhp9aocLASCUASsGppds4Y7itw+9LtpfMBz//pVdQBvNb5erWMAKna+qj/c5jfNiyUrDFqi3eD6AyfUe6ISt9zmrlUv2UAjxTG+eKE7qwoJNK39PMAcA69EnBUL63cyqTxw+B6YhgAAP7E7/m0mB7/+fmfzv87bYAa20JIb/DcScQ/QlgNi1R1d5K3VmoCDeADr6/SZMY4nBAdm0CaZ2RpgiVkoynHcHSonLrL/PnqPiR3/roVeiudb9EaMEQ/p3uAQRL25vUE9YaeovyxgRWMK+sTdmazKTpHlERAxIvOpyWnv3md3AXnpxETXCkcXS5IqWNh/+qsybjBIt9SS8eaCh1cPh/I7u3oCgzciiwhUCke8PuElhuW7eM5tgCiULVgkIo2ewuVHLZcUBPd7XVNU7QfwXwFAWPx7EesLRyGgVZat672D6n79nFnjydEgAjPgFSGGgdZKy+a9DxKClQ6UtEep9nj5APCAaqS7lTJNx63XEWvY5/qQCSaRUPTHdgmpJVAEK/963VJXfgPGJzy5dDei7IkCP9WAA5IfaQ7jHVP4fUCd6v2Jj7x7kMWAAAAAA==)](https://follow.it/ouuan)
    -   [![Follow on Feeds Pub](https://shields.ouuan.moe/static/v1?label=Feeds%20Pub&message=follow&style=social&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEUAAABFCAYAAAAcjSspAAAACXBIWXMAAAInAAACJwG+ElQIAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAASkSURBVHgB7Ztdcts2EMf/oDyeNO5MnBOUN4hzAtNvrZ0H8QSimwPEPoHlE9g5gZkTSJ46mU77YPYEVd/6yN5AnWkzrVNxuxAhN3UA0YL46eA3Y30AkDT8c7FY7MKAw+FwlIfAAyAafe2rl/w8m8bhjxOsQedEiUbBNrAVeQLPCBTwJfiaYROiWRiH36ewYAMdIBfiUV+I3oDfBrKN5j3Ge7rDYy/4eQ8WtFoUOS08zxsQiSN+u73ap7EDS1opCosR8J0+4ZcBEWyZwpJWiRKN9tnsxRnUFFkHIjqFJa1wtNJneN7WCVvFEexgqyD+E1MBkWaUXcbhuxiWNC7Ky8sXrzKiIVbzGVO2hDeANwb+mMRhYj1VdDQmytw6xJcXvKz2V/hYwk73NA6vElRII6Io3zHCPNgqhK1CvGaLOC/bIkzU7mij0TccbwgZQxRNl9rFWFCrpby8PBhkhLhoHPsLFuP9sG4xFtQmioo9rguGcXgujqv2GUX0UAMyMmVBpA8xThllHYdx+MOvaJhafIqyEN/Qzb7DY+v4LkZLqFwUFYf4hm4Zb+yxIGtt9cumUp+ipo3RSliQ5xx5tkoQiYdK8QIYBcFxGwWRVCoKxyMnhi4Ozd+eo6VUJopKEfq6PqKbQ7SYCh3txs4iP3aHqRCbZ4fjA16eSS3RIp0/CkyyjH4BssQ2lVgGFYqS7Rj8uBQiyF/e9vvygf0MB3iyrYdvxwdxRrPTJsSpZPrkq47YxRqwjUW8cv0sN4+omdJFkXGJvBiUkD1jtlnc649KGLVQ2vTJ8yOPzzhQi1AuPN08mZGzzcqtTCmWIgURYuuaICJUAFvLADWydkS7EAT3LClwFPsT3wuOUbIU2OTUwI20BOl85WrEuRYM9J/782lnkkwq4XxvZ8h3/auL/tXY0D0+HO/v6qp+vc3HT7BG2WIV1po+vDJEFhl4P6/4mRDaC5/dfHiKmlhLlCVhvIw5ONtOqb73i0DXGo36UiyD1X1IURPWokgrgXn3+5r3NlHuPzQ/anCcPe8fk0NN60xNWouyxEr4At6pKSUS3QBepYK7U0jGIqr+oxmPBDViJYqKMn1dH+dYP9rsbUqHqrvD84rgf993m3fR+xoSb1AjVktyNDo44qXzTNM1uei/ff7/sfvnbFWvdN8jRG4ZBacKEv5OqyMVtlgtyewTdkmzAybKNHc045ikpxWFxRiiAKJZ7WkGq+lDt1v+u/Q+yaTJXW5e1LL4nXl2rjO7ZFMi+m/DCrEx5IcUq/zCvGbcTHbOUhTh61pNB/DicMxZ+5n0CynuQW4hV0M0xMqiqABLx9I4Ip9Gsz1ejsdLhiV5hr/Z/K2Fo/1r21BYLAyulH8Io9GLgB2wLLQ/ExzWZ5T9Js+aNF0uXdDI8S518Qlaio1P8Q3tKR4IFRfDuokTRYONKKmh3ccDwVmKBieKBieKBgtRHpmCtKLTjp1hZVHkPsbQ9fmK8jlgK4rWWpaXLrqDbT5FK4oqWHUeN300OFE0OFE02KYjU13r7Ob973gA2GXziY5xZwXKE83N/NdF2VifT8mPXHlHXAN6knEFry2pRIfD4XA4usm//qauBcoh1b8AAAAASUVORK5CYII=)](https://feeds.pub/feed/https%3A%2F%2Fouuan.moe%2Ffeed.xml)
    </div>
-   æœ€æ–°æ–‡ç« : [RSS è®¢é˜…](https://ouuan.moe/feed.xml) / [Atom è®¢é˜…](https://ouuan.moe/feed.atom) / [JSON è®¢é˜…](https://ouuan.moe/feed.json)
-   æŸä¸ª tag çš„æœ€æ–°æ–‡ç« : åœ¨ tag URL çš„åé¢åŠ ä¸Š \`/feed.xml\`/\`.atom\`/\`.json\`ï¼Œä¾‹å¦‚ [csapp æ ‡ç­¾çš„ RSS è®¢é˜…](https://ouuan.moe/tag/csapp/feed.xml)

Tips: å¯ä»¥ä½¿ç”¨ [RSSHub Radar](https://github.com/DIYgod/RSSHub-Radar) ç­‰æ’ä»¶è‡ªåŠ¨å‘ç°è¿™äº›è®¢é˜…ã€‚

</Card>

## å…³äºæˆ‘åœ¨ä¸€äº›å…¶ä»–åœ°æ–¹çš„ profile

> å¦‚æœå¥‡è¿¹æœ‰é¢œè‰²çš„è¯ï¼Œé‚£ä¹ˆå…¶ä¸­ä¹‹ä¸€å¿…æ˜¯<span class="text-honoka">æ©™è‰²</span>çš„å§ã€‚

è¿™æ˜¯ [æˆ‘åœ¨ b ç«™ä¸Š](https://space.bilibili.com/11067182) çš„ä¸ªæ€§ç­¾åï¼Œåº”è¯¥æ˜¯ 16 æˆ– 17 å¹´å°±å¼€å§‹åœ¨ç”¨äº†ã€‚[å‡ºè‡ª Snow Halation](https://zh.moegirl.org.cn/å¦‚æœå¥‡è¿¹æœ‰é¢œè‰²ï¼Œé‚£ä¸€å®šæ˜¯æ©™è‰²) ä½†æŠŠâ€œé‚£â€æ”¹æˆäº†â€œå…¶ä¸­ä¹‹ä¸€â€ã€‚
[åœ¨æ´›è°·ä¸Š](https://www.luogu.com.cn/user/49742)ï¼Œå› ä¸ºå½“æ—¶æ´›è°·æ¢äº†æ–° UI åä¸ªäººç©ºé—´å’Œ b ç«™é•¿å¾—æœ‰ç‚¹åƒï¼Œæˆ‘å°±ç‰¹æ„ç”¨å¤´å›¾å’Œä¸ªæ€§ç­¾åæ¨¡ä»¿äº† b ç«™ä¸ªäººç©ºé—´ã€‚

> ã“ã®é“è¡Œãã®æœ€å¾ŒãŒ å¤©å›½ã‹ ãã“ã‚‰ã˜ã‚ƒã‚ãªã„ã¨ã—ã¦ã‚‚  
> è¿™æ¡è·¯çš„å°½å¤´ä¼šæ˜¯å¤©å›½å— å°±ç®—ä¸æ˜¯ä¹Ÿæ²¡æœ‰å…³ç³»
>
> ãŸã ã®å›ã¨ç¬‘ã£ã¦ç«‹ã£ã¦ã„ãŸã„ã‚ˆ  
> å•çº¯çš„æƒ³å’Œä½ ç›¸è§†è€Œç¬‘å¹¶è‚©è€Œç«‹
>
> èª‡ã‚‰ã—ã•ã¨ã‹ é¡˜ã„ã¨ã‹ å¸Œæœ›ã¨ã‹  
> æˆ‘çš„éª„å‚² æ„¿æœ› å¸Œæœ›
>
> ã‚‚ã£ã¨ ãšã£ã¨ æŒã¡åˆã‚ã›ã¨ãã‚ˆ  
> æ„¿èƒ½æ°¸ä¹…åœ°ä¼´æˆ‘åŒè¡Œ

è¿™æ˜¯ [3 ç‹® OP2](https://music.163.com/#/song?id=456185218) çš„ä¸€æ®µæ­Œè¯ï¼Œæˆ‘æŠŠå®ƒè®¾ä¸ºäº†ä¸€äº›åœ°æ–¹çš„ä¸ªäººç©ºé—´å¤´å›¾ã€‚

> ç”Ÿãæ–¹ã¯ ç„¡é™ã«ã‚ã‚‹ã€‚  
> ç”Ÿæ´»çš„æ–¹æ³•æœ‰æ— é™ç§ã€‚

è¿™æ˜¯ [No.1](https://music.163.com/#/song?id=1416874718) çš„ä¸€å¥æ­Œè¯ï¼Œæ˜¯æˆ‘ç°åœ¨çš„ QQ ä¸ªæ€§ç­¾åã€‚
`},{title:m,tags:"busuanzi live2d JavaScript Web é—®é¢˜è§£å†³è®°å½•",content:`æ˜¨å¤©åœ¨ä¸€ä½ç½‘å‹çš„ Hexo åšå®¢é‡åˆ°äº†å¾ˆè¯¡å¼‚çš„ busuanzi è®¿é—®é‡ç»Ÿè®¡ä¸æ˜¾ç¤ºé—®é¢˜ï¼Œç»è¿‡ä¸€ç•ªç ”ç©¶å‘ç°æ˜¯ busuanzi ä»£ç çš„ä¸€å¤„é—®é¢˜å’Œ live2d æ’ä»¶çš„ä¸€å¤„é—®é¢˜å‡‘åœ¨ä¸€èµ·å¯¼è‡´çš„ã€‚

ä»Šå¤©åœ¨å†™åšå®¢ä¹‹å‰å…ˆæœäº†ä¸€ä¸‹ â€œbusuanzi live2dâ€ï¼Œå‘ç°æœå‡ºæ¥ä¸€å †ç»“æœï¼Œæˆ‘è¿˜ä»¥ä¸ºæˆ‘ç™½ç ”ç©¶äº†..ç»“æœç‚¹è¿›å»ä¸€çœ‹ï¼Œç¬¬ä¸€é¡µç»“æœé‡Œæ²¡æœ‰ä¸€ä¸ªæŒ‡å‡ºäº†é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼Œè€Œä¸”ä¿®å¤æ–¹æ³•åŸºæœ¬ä¸Šéƒ½æ˜¯åˆ  feature æˆ–è€…æ¢ç»„ä»¶ï¼Œä½†å®é™…ä¸Šåªè¦çŸ¥é“é—®é¢˜çš„æ ¹æœ¬åŸå› å°±å¯ä»¥åœ¨ä¸å¦¨ç¢æ­£å¸¸åŠŸèƒ½è¿ä½œçš„å‰æä¸‹è¿›è¡Œä¿®å¤ã€‚æ‰€ä»¥æ˜¨å¤©æ™šä¸Šæ²¡ç™½å¿™æ´»ï¼Œæˆ‘è¿™ç¯‡åšå®¢è¿˜æ˜¯è¦å†™çš„ã€‚



å½“ç„¶ï¼Œæˆ‘åªçœ‹äº†ç¬¬ä¸€é¡µæœç´¢ç»“æœï¼Œå¯èƒ½æœ‰æ›´æ·±å…¥ç ”ç©¶çš„æ–‡ç« è¢«æœç´¢å¼•æ“åŸ‹æ²¡äº†ï¼Œæˆ‘è¿™ç¯‡æ–‡ç« è¯´ä¸å®šä¹Ÿä¸ä¼šè¢«æœåˆ°ï¼Œåªä¸è¿‡æ—¢ç„¶ç¬¬ä¸€é¡µæ²¡æœ‰ï¼Œå°±è®©æˆ‘ä¹Ÿæ¥æˆä¸ºè¢«æœç´¢å¼•æ“åŸ‹æ²¡çš„ä¸€å‘˜ï¼Œè¿™æ ·çš„è¯è¯´ä¸å®šè¢«æœåˆ°çš„å¯èƒ½æ€§å°±å¢åŠ äº†ï¼ˆ

## é—®é¢˜æè¿°

åœ¨ä¸€ä¸ªåŒæ—¶å¯ç”¨äº† busuanzi è®¿é—®é‡ç»Ÿè®¡å’Œ live2d æ’ä»¶çš„ Hexo åšå®¢é‡Œï¼Œè®¿é—®æˆ–åˆ·æ–°åšå®¢æ—¶æœ‰å¤§æ¦‚ç‡ busuanzi ä¼šè¢«éšè—ã€‚

è¢«éšè—çš„å…·ä½“è¡¨ç°ä¸ºï¼Œåˆ·æ–°çš„ç¬é—´ id ä¸º \`busuanzi_container_*\` çš„å®¹å™¨æ˜¯æ˜¾ç¤ºçš„ï¼Œç„¶åå®¹å™¨çš„æ ·å¼å¾ˆå¿«è¢«è®¾ä¸º \`display: none\`ã€‚

æŸ¥çœ‹ F12 çš„ Networkï¼Œbusuanzi ç›¸å…³è¯·æ±‚æ­£å¸¸è¿”å›ï¼›console ä¸­æ²¡æœ‰æŠ¥é”™ã€‚

## é—®é¢˜å®šä½

æ³¨ï¼šè¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä¹Ÿèµ°äº†ä¸€äº›å¼¯è·¯ï¼Œå°±ä¸å†™å‡ºæ¥äº†ã€‚

### è®¾ç½® \`display: none\` çš„å®šä½

æŸ¥çœ‹ [busuanzi.pure.mini.js](https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js)ï¼Œå‘ç° \`display: none\` åœ¨ \`hides\` å‡½æ•°ä¸­è¢«è®¾ç½®ï¼š

\`\`\`javascript
hides: function() {
  this.bszs.map(function(a) {
    var b = document.getElementById("busuanzi_container_" + a);
    b && (b.style.display = "none")
  })
},
\`\`\`

è€Œ hides å‡½æ•°ä»…åœ¨ä¸€å¤„è¢«è°ƒç”¨ï¼š

\`\`\`javascript
try {
  a(b), scriptTag.parentElement.removeChild(scriptTag)
} catch (c) {
  bszTag.hides()
}
\`\`\`

æ‰€ä»¥æ˜¯åœ¨ \`a(b), scriptTag.parentElement.removeChild(scriptTag)\` æŠ›å‡ºå¼‚å¸¸æ—¶å®¹å™¨è¢«éšè—ã€‚

### å¼‚å¸¸åŸå› çš„å®šä½

ç”±äºåœ¨å…¶å®ƒåœ°æ–¹çš„ busuanzi ä¸ä¼šå‡ºç°è¿™ä¸€é—®é¢˜ï¼Œè€Œé—®é¢˜çš„åŸå› è¿˜å®Œå…¨ä¸æ¸…æ¥šï¼Œä¸ºäº†å°½å¯èƒ½è¿˜åŸåŸå§‹ç¯å¢ƒä»¥å¤ç°é—®é¢˜ï¼Œæˆ‘é€‰æ‹©äº†ä½¿ç”¨ [Firefox çš„ Header Editor æ’ä»¶](https://addons.mozilla.org/zh-CN/firefox/addon/header-editor/) ç›´æ¥åœ¨åŸåšå®¢è¿›è¡Œæµ‹è¯•ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯åœ¨æœ¬åœ°å¤åˆ¶ä¸€ä»½ busuanzi çš„ä»£ç ï¼Œç„¶åè·‘ä¸€ä¸ª http serverï¼Œåœ¨ Header Editor é‡ŒæŠŠ busuanzi ä»£ç çš„è¯·æ±‚é‡å®šå‘åˆ°æœ¬åœ°çš„ http serverã€‚

é¦–å…ˆï¼Œåœ¨ \`catch\` ä¸­æ·»åŠ  \`console.error(c)\`ï¼Œå¾—åˆ°é”™è¯¯å†…å®¹ \`TypeError: scriptTag.parentElement is null\`ã€‚

æŸ¥çœ‹ä»£ç ä¸­ \`scriptTag\` ç›¸å…³çš„éƒ¨åˆ†ï¼š

\`\`\`javascript
scriptTag = document.createElement("SCRIPT"), scriptTag.type = "text/javascript", scriptTag.defer = !0, scriptTag.src = a, scriptTag.referrerPolicy = "no-referrer-when-downgrade", document.getElementsByTagName("HEAD")[0].appendChild(scriptTag)
\`\`\`

æ‰€ä»¥ï¼Œå†åœ¨ \`catch\` ä¸­æ·»åŠ  \`s = document.querySelector("[src*=BusuanziCallback]"); console.log(s.parentElement);\`ï¼Œå‘ç° \`s.parentElement\` ä¸æ˜¯ \`null\`ã€‚

å†æ·»åŠ  \`console.log(s === scriptTag)\`ï¼Œå‘ç°ç»“æœæ˜¯ \`s\` å’Œ \`scriptTag\` ä¸åŒï¼Œæ‰€ä»¥åŸå› åœ¨äºæ­¤æ—¶çš„ \`scriptTag\` å˜é‡å·²ç»ä¸æŒ‡å‘ DOM ä¸­çš„è¿™ä¸ªå…ƒç´ äº†ã€‚

### å®šä½åˆ° live2d æ’ä»¶

æ­¤æ—¶æˆ‘åŸæœ¬æ˜¯æ²¡æœ‰ä»»ä½•å¤´ç»ªçš„ï¼Œä½†æˆ‘å‘ç°ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡åˆ·æ–°é¡µé¢éƒ½ä¼šè§¦å‘è¿™ä¸€é—®é¢˜ï¼Œæ‰€ä»¥æ²¡æœ‰è§¦å‘é—®é¢˜æ—¶å’Œè§¦å‘é—®é¢˜æ—¶çš„å·®åˆ«å°±æˆäº†é—®é¢˜çš„çªç ´å£ã€‚

ç»è¿‡å¤šæ¬¡åˆ·æ–°ï¼Œæˆ‘å‘ç°ï¼Œæœ‰ä¸€ä¸² console è¾“å‡ºï¼Œåœ¨å‡ºç°é—®é¢˜æ—¶æ€»ä½äºæˆ‘åœ¨ \`catch\` ä¸­æ·»åŠ çš„è°ƒè¯•ä¿¡æ¯ä¹‹å‰ï¼Œè€Œåœ¨æ²¡å‡ºç°é—®é¢˜æ—¶åˆ™ä½äºè°ƒè¯•ä¿¡æ¯ä¹‹åï¼š

\`\`\`
Live2D 2.1.00_1 live2d.core.js:5925:16
profile : Desktop live2d.core.js:5913:16
  [PROFILE_NAME] = Desktop live2d.core.js:5918:20
  [USE_ADJUST_TRANSLATION] = false live2d.core.js:5918:20
  [USE_CACHED_POLYGON_IMAGE] = false live2d.core.js:5918:20
  [EXPAND_W] = 2
\`\`\`

å¤šäºäº† live2d çš„è¿™ä¸²è¾“å‡ºï¼Œæˆ‘å¾—ä»¥å°†é—®é¢˜å®šä½åˆ° live2d æ’ä»¶ä¸Šã€‚

å®é™…ä¸Šï¼Œå¦‚æœæ²¡æœ‰è¿™äº› console è¾“å‡ºï¼Œä¹Ÿå¯ä»¥é€šè¿‡ \`<head>\` ä¸­ \`L2Dwidget.0.min.js\` å’Œ \`busuanzi?jsonpCallback=BusuanziCallback\` ä¸¤ä¸ª \`<script>\` çš„ç›¸å¯¹ä½ç½®å‘ç°é—®é¢˜ï¼Œåªä¸è¿‡è¿™æ ·çš„è¯å°±æ›´éšè”½æ›´éš¾å‘ç°äº†ã€‚

### åœ¨ live2d æ’ä»¶ä¸­å®šä½é—®é¢˜

åœ¨ \`L2Dwidget.min.js\` çš„ç¬¬ä¸€è¡Œæœ‰æºç åœ°å€ä»¥åŠæ—¶é—´ï¼š\`/*! https://github.com/xiazeyu/live2d-widget.js built@2019-4-6 09:38:17 */\`

å› ä¸ºæ³¨é‡Šä¸­ç»™å‡ºçš„æ—¶é—´ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œå…ˆæŸ¥çœ‹ git log å¹¶ checkout åˆ°ç›¸åº”æ—¶é—´çš„ç‰ˆæœ¬ã€‚

æ—¢ç„¶é—®é¢˜åœ¨äº \`<script>\` å…ƒç´ è¢«é‡æ–°åˆ›å»ºè€Œå¯¼è‡´åŸå˜é‡ä¸æŒ‡å‘ DOM ä¸­å…ƒç´ ï¼Œå°±åœ¨ä»£ç ä¸­ grep \`head\`ï¼Œç„¶åå‘ç° [é—®é¢˜ä»£ç ](https://github.com/xiazeyu/live2d-widget.js/blob/fa8f2d831a1a9e96cd85bd1ef593a3336aeac720/src/dialog/index.js#L4-L38)ï¼š\`document.head.innerHTML += â€¦â€¦\`

è‡³æ­¤ï¼Œé—®é¢˜åŸå› å·²å‘ç°ï¼Œå°±æ˜¯ live2d æ’ä»¶é€šè¿‡ä¿®æ”¹ \`document.head.innerHTML\` æ¥æ·»åŠ æ ·å¼ï¼Œå¯¼è‡´ busuanzi çš„ \`scriptTag\` å˜é‡æŒ‡å‘çš„ä¸å†æ˜¯ DOM ä¸­çš„ \`<script>\` å…ƒç´ ã€‚

å®é™…ä¸Šï¼Œlive2d æ’ä»¶çš„è¿™ä¸€é—®é¢˜ [å·²ç»ä¿®å¤](https://github.com/xiazeyu/live2d-widget.js/pull/61)ï¼Œä½†éœ€è¦ä½¿ç”¨æ–°ç‰ˆæ‰è¡Œã€‚

## è§£å†³æ–¹æ³•

### ä¿®æ”¹ busuanzi çš„è§£å†³æ–¹æ³•

å› ä¸º busuanzi çš„ä»£ç è¾ƒçŸ­ï¼Œè€Œä¸”æœ¬æ¥å°±æ˜¯ç”¨çš„å¤–éƒ¨çš„ä»£ç ï¼Œæ”¹èµ·æ¥æ¯”è¾ƒå®¹æ˜“ã€‚

æŠŠ \`scriptTag.parentElement.removeChild(scriptTag)\` ä¿®æ”¹ä¸º \`s=document.querySelector('[src*=BusuanziCallback]'),s.parentElement.removeChild(s)\` å³å¯ã€‚å¯ä»¥æŠŠä¿®æ”¹åçš„é™æ€æ–‡ä»¶æ”¾åœ¨åšå®¢é‡Œï¼Œç„¶åä¿®æ”¹ busuanzi \`<script>\` çš„ \`src\`ã€‚

<Card title="ç›¸å…³ä»£ç " fold>

ä¿®æ”¹åçš„ busuanzi ä»£ç ï¼ˆè¿˜åœ¨ \`catch\` é‡ŒåŠ äº†ä¸ª \`console.error\`ï¼‰ï¼š

\`\`\`javascript
var bszCaller,bszTag;!function(){var c,d,e,a=!1,b=[];ready=function(c){return a||"interactive"===document.readyState||"complete"===document.readyState?c.call(document):b.push(function(){return c.call(this)}),this},d=function(){for(var a=0,c=b.length;c>a;a++)b[a].apply(document);b=[]},e=function(){a||(a=!0,d.call(window),document.removeEventListener?document.removeEventListener("DOMContentLoaded",e,!1):document.attachEvent&&(document.detachEvent("onreadystatechange",e),window==window.top&&(clearInterval(c),c=null)))},document.addEventListener?document.addEventListener("DOMContentLoaded",e,!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){/loaded|complete/.test(document.readyState)&&e()}),window==window.top&&(c=setInterval(function(){try{a||document.documentElement.doScroll("left")}catch(b){return}e()},5)))}(),bszCaller={fetch:function(a,b){var c="BusuanziCallback_"+Math.floor(1099511627776*Math.random());window[c]=this.evalCall(b),a=a.replace("=BusuanziCallback","="+c),scriptTag=document.createElement("SCRIPT"),scriptTag.type="text/javascript",scriptTag.defer=!0,scriptTag.src=a,scriptTag.referrerPolicy="no-referrer-when-downgrade",document.getElementsByTagName("HEAD")[0].appendChild(scriptTag)},evalCall:function(a){return function(b){ready(function(){try{a(b),s=document.querySelector('[src*=BusuanziCallback]'),s.parentElement.removeChild(s)}catch(c){console.error(c),bszTag.hides()}})}}},bszCaller.fetch("//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback",function(a){bszTag.texts(a),bszTag.shows()}),bszTag={bszs:["site_pv","page_pv","site_uv"],texts:function(a){this.bszs.map(function(b){var c=document.getElementById("busuanzi_value_"+b);c&&(c.innerHTML=a[b])})},hides:function(){this.bszs.map(function(a){var b=document.getElementById("busuanzi_container_"+a);b&&(b.style.display="none")})},shows:function(){this.bszs.map(function(a){var b=document.getElementById("busuanzi_container_"+a);b&&(b.style.display="inline")})}};
\`\`\`

ç„¶åå°†

\`\`\`html
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"><\/script>
\`\`\`

ä¿®æ”¹ä¸ºï¼ˆå¦‚æœä¸Šé¢çš„ä»£ç æ”¾åœ¨äº†åšå®¢çš„ \`/js/busuanzi.pure.mini.js\`ï¼‰

\`\`\`html
<script async src="/js/busuanzi.pure.mini.js"><\/script>
\`\`\`

</Card>

ç½‘ä¸Šæœåˆ°çš„å¾ˆå¤šè§£å†³åŠæ³•æ˜¯æŠŠ \`id="busuanzi_container_*"\` åˆ æ‰ï¼Œè¿™æ ·å½“ç„¶å°±ä¸ä¼šè¢«éšè—äº†ï¼Œåªä¸è¿‡è¿™ä¸ªéšè—æœ¬æ„æ˜¯åœ¨å‡ºé”™æ—¶ä¸æŠŠé”™è¯¯æˆ–è€…æ— æ„ä¹‰çš„å†…å®¹æ˜¾ç¤ºç»™è®¿å®¢ï¼Œä¿ç•™è¿™ä¸€è¡Œä¸ºè¿˜æ˜¯æŒºå¥½çš„ã€‚

### ä¿®æ”¹ live2d çš„è§£å†³æ–¹æ³•

æ€»ä¹‹ï¼Œå°±æ˜¯æŠŠ \`innerHTML +=\` æ¢æˆ \`createElement\` å’Œ \`appendChild\`ï¼ŒæŒ‰ [xiazeyu/live2d-widget.js#61](https://github.com/xiazeyu/live2d-widget.js/pull/61/files#diff-61426849230d9976d234f7c4ca195c623d9bb05a91d76b7ae51501e394f81860L10-R43) æ”¹å°±è¡Œã€‚

live2d çš„ä»£ç è¿˜æ˜¯æŒºé•¿çš„ï¼Œç›´æ¥ä¿®æ”¹ minify åçš„ä»£ç ä¸å¤ªå¥½ã€‚å¦‚æœæ˜¯ hexo æ’ä»¶çš„è¯ï¼Œè¦ä¿®æ”¹åº”è¯¥ä¹Ÿè›®éº»çƒ¦çš„ã€‚æ€»ä¹‹ï¼Œå¦‚æœä½ çŸ¥é“æ€ä¹ˆæ”¹æ¯”è¾ƒå¥½çš„è¯å¯ä»¥æ”¹ï¼Œä¸ç„¶çš„è¯è¿˜æ˜¯æ¨èæ”¹ busuanziã€‚

## é—®é¢˜å¯ç¤º

### ä¸è¦ä¿®æ”¹åŸ DOM ä¸­çš„ innerHTML

ç›´æ¥ä¿®æ”¹ DOM å…ƒç´ çš„ innerHTML ä¼šè®©å…¶ä¸­çš„å…ƒç´ éƒ½é‡æ–°æ¸²æŸ“ï¼ˆåŠ è½½ï¼Ÿåˆ›å»ºï¼Ÿï¼‰ï¼Œä¸ä»…æŒ‡å‘å…¶ä¸­å…ƒç´ çš„å˜é‡ä¼šå¤±æ•ˆï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ç”»é¢é—ªçƒç­‰é—®é¢˜ï¼ˆä¾‹å¦‚å¯¼è‡´ live2d-widget ä¿®å¤è¿™ä¸€é—®é¢˜çš„ä¸æ˜¯ busuanzi å¤±æ•ˆè€Œæ˜¯ [CSS é—ªçƒ](https://github.com/EYHN/hexo-helper-live2d/issues/149)ï¼‰ã€‚

æ‰€ä»¥ï¼Œå¦‚æœæ˜¯æ·»åŠ  DOM å…ƒç´ ï¼Œåº”å½“é¿å…ä¿®æ”¹ \`innerHTML\`ï¼Œè€Œåº”å½“ä½¿ç”¨ [\`document.createElement\`](https://developer.mozilla.org/en-US/docs/Web/API/Document/createElement) å’Œ [\`Node.appendChild()\`](https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild) ä»¥åŠ \`removeChild\`ã€\`replaceChild\`ã€\`insertBefore\` ç­‰ APIã€‚

### ä¸è¦ä¾èµ–äºæŒ‡å‘ DOM å…ƒç´ çš„å˜é‡é•¿æ—¶é—´ä¸æ”¹å˜

å¦‚æœ DOM å› å„ç§åŸå› éƒ¨åˆ†é‡å»ºï¼ŒæŒ‡å‘ DOM å…ƒç´ çš„å˜é‡å¾ˆå¯èƒ½ä¸å†æŒ‡å‘å½“å‰ DOM ä¸­çš„å…ƒç´ ã€‚æ‰€ä»¥ï¼Œæœ€å¥½ä¸è¦åœ¨è¿‡äº†ä¸€æ®µæ—¶é—´åï¼ˆä¾‹å¦‚åœ¨ callback ä¸­ï¼‰å†æ¬¡ä½¿ç”¨æŒ‡å‘ DOM å…ƒç´ çš„å˜é‡ï¼Œè€Œåº”å½“å†æ¬¡è·å–è¿™ä¸€å…ƒç´ ã€‚

### ä¸è¦ silently fail

åœ¨å¤„ç†å¼‚å¸¸ï¼Œå°¤å…¶æ˜¯æœªçŸ¥çš„å¼‚å¸¸æ—¶ï¼Œå³ä½¿ä¸ throw å‡ºå»ï¼Œä¹Ÿæœ€å¥½ç”¨ \`console.error\` ç­‰æ–¹æ³•è®°å½•ä¸‹æ¥ã€‚è®°å½•åœ¨ console ä¸­çš„é”™è¯¯ä¿¡æ¯å¹¶ä¸ä¼šæ˜¾ç¤ºç»™æ™®é€šç”¨æˆ·ï¼Œä½†å¯ä»¥ç»™å¯»æ‰¾é—®é¢˜æ‰€åœ¨çš„ç”¨æˆ·æä¾›å®è´µçš„æç¤ºä¿¡æ¯ã€‚

### ä½¿ç”¨ Header Editor åœ¨å¯¹åŸç¯å¢ƒæœ€å°ä¿®æ”¹çš„æƒ…å†µä¸‹è¿›è¡Œè°ƒè¯•

è¿™æ¬¡ä½¿ç”¨ Header Editor è°ƒè¯•è¿˜æ˜¯æˆ‘ä¸´æ—¶æƒ³åˆ°çš„ï¼ˆ~~çŸ¥é“æœ‰è¿™ä¹ˆä¸ªæ’ä»¶è¿˜æ˜¯ä»¥å‰ç”¨ [mahjong-helper](https://github.com/EndlessCheng/mahjong-helper)ï¼Œå½“ç„¶ç°åœ¨å·²ç»æ²¡åœ¨ç”¨äº†~~ï¼‰ã€‚ä¸€å¼€å§‹è¿˜ç”¨ pastebin ä¸Šä¼ ä»£ç ï¼Œæ•ˆç‡æä½ï¼Œåæ¥æ‰æƒ³èµ·æ¥æœ¬åœ°è·‘ä¸ª http server å°±å¯ä»¥äº†..ç”¨è¿™ä¸ªæ’ä»¶æ¥è°ƒè¯•è¿˜æ˜¯æŒºæ–¹ä¾¿çš„ã€‚

### ç•™å¿ƒä¾èµ–ç‰ˆæœ¬

ä¸€å¼€å§‹æˆ‘è¿˜åœ¨ GitHub ä¸Šæœåˆ°ä¸€ä¸ª [busuanzi.pure.js](https://github.com/JoeyBling/busuanzi.pure.js)ï¼Œè°ƒäº†ä¸€ä¼šå„¿æ‰å‘ç°è¿™ä¸ªä»£ç å’Œ https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js ä¸ä¸€æ ·..

live2d çš„ç‰ˆæœ¬ä¹Ÿè¦æ³¨æ„å¼€å¤´åŒ…å«æ—¶é—´çš„æ³¨é‡Šï¼Œå› ä¸ºæœ€æ–°ç‰ˆæœ¬å·²ç»æŠŠé—®é¢˜ä¿®å¤äº†ã€‚
`},{title:d,tags:"Rust å­¦ä¹ è®°å½•",content:`æ—©å°±æƒ³å­¦ Rust äº†ï¼Œä½†ä¸€ç›´å’•ç€ã€‚è¿™æ¬¡å°å­¦æœŸçš„ç¨‹è®¾è®­ç»ƒå¼€äº† Rust è¯¾å ‚ï¼Œå°±æ¯«ä¸çŠ¹è±«åœ°é€‰äº†ï¼Œä¹Ÿä»¥æ­¤ä¸ºå¥‘æœºå­¦äº† Rustã€‚

è¿™ç¯‡å°±æ˜¯ç®€å•è®°å½•ä¸€ä¸‹å¤§ä½“ä¸Šçš„å­¦ä¹ è¿‡ç¨‹ï¼Œå¦‚æœæœ‰ä»€ä¹ˆå¿ƒå¾—ä½“ä¼šã€ç»éªŒåˆ†äº«ä¹‹ç±»åº”è¯¥ä¼šå¼€æ–°çš„æ–‡ç« ã€‚

é¡ºä¾¿ä¹Ÿç®—æ˜¯ç¨‹è®¾è®­ç»ƒçš„æ¸¸è®°äº†ï¼ˆâ€œæ¸¸è®°â€è¿™ä¸ªè¯æ¥æºäº OI æ—¶æœŸçš„ä¹ æƒ¯ï¼‰ã€‚



## åˆå­¦ â€”â€” The Rust Programming Language

ä¸åŒäº Pythonã€JavaScriptï¼Œè¿™æ¬¡å­¦ Rust æ›´åƒæ˜¯å½“åˆå­¦ C++ï¼Œä¸æ˜¯å…ˆé­”æ”¹ä»£ç ã€ç”¨å•¥æœå•¥ã€StackOverflowï¼Œè€Œæ˜¯åœ¨è¿˜æ²¡æ€ä¹ˆæ¥è§¦è¿‡æ—¶å°±ç›´æ¥çœ‹ä¹¦ã€‚

è™½ç„¶æ²¡æœ‰ç»†çœ‹ä¸­æ–‡ç¿»è¯‘çš„è´¨é‡å¦‚ä½•ï¼Œä½†è‡³å°‘æœ¯è¯­æ˜¯ä¸å¥½ç¿»è¯‘çš„ï¼Œå°±ç›´æ¥çœ‹äº†è‹±æ–‡ç‰ˆçš„ [The Rust Programming Language](https://doc.rust-lang.org/book/)ã€‚

è¿™æœ¬ä¹¦çœ‹ä¸‹æ¥ç»™æˆ‘çš„æ„Ÿè§‰æ˜¯ï¼Œå¾ˆå¤šåœ°æ–¹æ²¡æœ‰æŒ‰çŸ¥è¯†ç‚¹ä¾èµ–å…³ç³»çš„æ‹“æ‰‘æ’åºæ¥è®²ï¼Œè€Œä¼¼ä¹æ˜¯ä»¥æŸç§ç”±æµ…å…¥æ·±çš„é¡ºåºæ¥çš„ï¼Œå¾ˆå¤šåé¢æ‰å­¦åˆ°çš„æ¦‚å¿µåœ¨å‰æ–‡å°±å‡ºç°ï¼Œè€Œå‰é¢å­¦çš„æ¦‚å¿µçš„å®Œå…¨ä¸éœ€è¦åé¢çŸ¥è¯†çš„æ‰©å±•åˆåœ¨åé¢æ‰è¡¥å……ï¼Œè¿˜æœ‰ä¸€äº›é›¶ç¢çš„çŸ¥è¯†æ˜¯åœ¨ project chapter è®²çš„ã€‚

åæ­£ï¼Œæ¯å¤©çœ‹ä¸¤ä¸‰ç« ï¼Œ~~è¿˜èƒ½æœ‰ä¸å°‘æ—¶é—´æ‘¸é±¼ï¼Œæ‘¸ä¸ª~~ ä¸€ä¸¤å‘¨å°±çœ‹å¾—å·®ä¸å¤šäº†ï¼ˆ

## åˆæ­¥ç»ƒä¹  â€”â€” æ´›è°·

çœ‹ä¹¦çš„åŒæ—¶åœ¨ [æ´›è°·](https://www.luogu.com.cn/) ä¸Šéšä¾¿æŒ‘äº†ç‚¹å…¥é—¨é¢˜å’Œæ¿å­é¢˜å†™ã€‚åªä¸è¿‡ä¸€å¼€å§‹æ²¡å­¦ io ä¹‹ç±»çš„ï¼Œä¼šå†å¤šè¯­æ³•ä¹Ÿåšä¸åŠ¨é¢˜ï¼Œ~~ä½†å¹¸å¥½æœ‰ GitHub Copilot~~ã€‚

åœ¨è¿™æ”¾ä¸ªè¯»å…¥çš„ä¾‹å­ï¼š

\`\`\`
6 0
1 1 4 5 1 4
\`\`\`

\`\`\`rust
fn main() {
    let stdin = std::io::stdin();
    let mut input = String::new();

    stdin.read_line(&mut input).unwrap();
    let mut parts = input.split_whitespace();
    let n = parts.next().unwrap().parse::<u32>().unwrap();
    assert_eq!(n, 6);
    let m = parts.next().unwrap().parse::<u32>().unwrap();
    assert_eq!(m, 0);

    input.clear();
    stdin.read_line(&mut input).unwrap();
    let a = input
        .split_whitespace()
        .map(|x| x.parse::<i32>().unwrap())
        .collect::<Vec<_>>();
    assert_eq!(a, vec![1, 1, 4, 5, 1, 4]);
}
\`\`\`

## å¤ä¹  â€”â€” A half-hour to learn Rust

ä¹‹å‰åœ¨ Hacker News ä¸Šçœ‹åˆ°äº† [A half-hour to learn Rust](https://fasterthanli.me/articles/a-half-hour-to-learn-rust) è¿™ç¯‡æ–‡ç« ã€‚å¦‚æœçœŸçš„æ˜¯çœ‹è¿™ä¸ªä¸œè¥¿æ¥å­¦ Rustï¼Œä¸è¯´èƒ½ä¸èƒ½å­¦ä¼šï¼Œè‚¯å®šæ˜¯å­¦ä¸æ‰å®çš„ã€‚ä½†æ˜¯ï¼Œçœ‹å®Œä¹¦ä¹‹åå¾ˆå¤šè¯­æ³•ä¹Ÿå¿˜äº†ï¼Œçœ‹è¿™ä¸ªç”¨æ¥å¤ä¹ è¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚ï¼ˆå¦å¤–ï¼Œæˆ‘æ„Ÿè§‰è¿™ä¸ªçš„é¡ºåºè²Œä¼¼æ¯”ä¹¦æ›´æœ‰æ¡ç†ä¸€äº›ï¼Œè™½ç„¶åˆå­¦ä¸ä¸€å®šå‹å¥½ ğŸ¤”ï¼‰

## æ·±å…¥äº†è§£ â€”â€” The Rust Standard Library

å…¶å®çœ‹ä¹¦çš„æ—¶å€™å°±æ„Ÿè§‰åˆ°äº†ï¼Œå¾ˆå¤šæ—¶å€™ä¸æ‡‚ä¸€æ®µä»£ç ä¸æ˜¯ä¸æ‡‚è¯­æ³•ï¼Œè€Œæ˜¯ä¸æ‡‚ [æ ‡å‡†åº“](https://doc.rust-lang.org/stable/std/) çš„å®ç°ï¼Œè€ŒæŠŠ API ç†è§£æˆäº†æ²¡å­¦è¿‡çš„è¯­æ³•ã€‚äº†è§£æ ‡å‡†åº“ï¼Œä¸ä»…æ˜¯æå‡ç¼–ç å’Œè¿è¡Œçš„æ•ˆç‡ï¼Œä¹Ÿæ˜¯èƒ½å¤Ÿçœ‹æ‡‚å¾ˆå¤šåŸºç¡€ä»£ç çš„å…³é”®ã€‚

çœ‹æ–‡æ¡£çš„æ—¶å€™å‘ç°ï¼Œä¸ä»…æ˜¯å­¦åˆ°äº†å¾ˆå¤šæœ‰ç”¨çš„ methodsï¼Œä¹Ÿå­¦åˆ°äº†å¾ˆå¤šå…¶å®ƒä¸œè¥¿ã€‚æ¯”å¦‚è¯´ï¼š

-   ä¸€èˆ¬æ¥è¯´éƒ½å¯ä»¥ç”¨ [\`std::cmp::max\`](https://doc.rust-lang.org/stable/std/cmp/fn.max.html) æ¥å– maxï¼Œä½† [\`f32\` ä¸“é—¨æœ‰ä¸€ä¸ª \`pub fn max(self, other: f32) -> f32\`](https://doc.rust-lang.org/stable/std/primitive.f32.html#method.max)ï¼Œè¿™æ˜¯å› ä¸ºæµ®ç‚¹æ•°æœ‰ NaN è¿™ä¸ªç‰¹æ®Šæƒ…å†µå¯¼è‡´ \`f32\` æ²¡æœ‰ impl [\`Ord\`](https://doc.rust-lang.org/stable/std/cmp/trait.Ord.html)ï¼Œè€Œ \`std::cmp::max\` éœ€è¦ \`Ord\`
-   ä¹¦é‡Œè²Œä¼¼æ²¡è®²åˆ°çš„ [keyword \`ref\`](https://doc.rust-lang.org/stable/std/keyword.ref.html)ï¼ˆä»¥åŠåœ¨ pattern matching ä¸­å’Œ \`&\` çš„åŒºåˆ«ï¼‰
-   å¼•ç”¨ä¹‹é—´è¿›è¡Œæ¯”è¾ƒæ—¶ä¼šè‡ªåŠ¨è½¬æˆæŒ‡å‘çš„å€¼ï¼Œå³å®é™…è¿›è¡Œæ¯”è¾ƒçš„æ˜¯æŒ‡å‘çš„å€¼ï¼ˆå¯ä»¥é€šè¿‡ [\`std::ptr::eq\`](https://doc.rust-lang.org/stable/std/ptr/fn.eq.html) æ¥æ¯”è¾ƒåœ°å€ï¼‰
-   ä»æ ‡å‡†åº“çš„ API è®¾è®¡èƒ½é¢†ä¼šåˆ°å¾ˆå¤š trait å’Œ generic çš„ç”¨æ³•ï¼Œä½“ä¼šåˆ°å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·çš„å¼ºå¤§
-   [\`Iterator\` è‡ªåŠ¨æœ‰ \`IntoIterator\`](https://doc.rust-lang.org/std/iter/index.html#for-loops-and-intoiterator)ï¼Œæ‰€ä»¥ç”¨ \`IntoIterator\` ä»£æ›¿ \`Iterator\` ä½œä¸º trait bound å¯ä»¥è®©å‡½æ•°æ›´çµæ´»
-   â€¦â€¦

ç®€å•çœ‹ä¸€çœ‹å°±èƒ½çŸ¥é“ the book é‡Œæ¶‰åŠåˆ°çš„çœŸçš„åªæ˜¯å†°å±±ä¸€è§’ï¼Œå­¦ Rust æ ‡å‡†åº“çš„æ„ä¹‰ä¼šæ¯”å­¦ C++ çš„ STL å¤§å¾—å¤šï¼ˆä¸ªäººæ„Ÿè§‰ï¼‰ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘ C++ æ°´å¹³å¤ªä½ / æ²¡è®¤çœŸå­¦ STL ğŸ˜¢ï¼‰ï¼ˆæˆ–è€… Primer Plus è®²çš„å…¨ä¸€äº›ï¼‰ã€‚

## ä¸Šè¯¾

### Class 1

å› ä¸ºè‡ªå­¦è¿‡äº†ï¼Œæ‰€ä»¥ä¸Šè¯¾å°±åŸºæœ¬ä¸Šæ˜¯æŠŠè€å¸ˆçš„å£°éŸ³å½“ä½œ bgm å¶å°”å¬ä¸€ä¸‹ï¼Œç„¶åç»§ç»­çœ‹æ ‡å‡†åº“æ–‡æ¡£ï¼ˆ

ä¸Šè¯¾çš„æ—¶å€™è€å¸ˆæåˆ° Rust ç¼–è¯‘å™¨å¯ä»¥æç¤ºå¦‚ä½•ä¿®æ”¹ï¼Œäºæ˜¯æˆ‘é¡ºåŠ¿åœ¨è¯¾ç¨‹ç¾¤é‡Œå‘äº†ä¸ª [rust ç¨‹åºå‘˜ç°çŠ¶](https://twitter.com/st1page/status/1477168761744805891) çš„æˆªå›¾ï¼ˆ

![rustç¨‹åºå‘˜ç°çŠ¶](rust-programmers-be-like.jpg)

è¯¾åæŠŠ OJ ä¸Šçš„ä½œä¸šé€Ÿé€šåå‘ç°æ¦œä¸æ˜¯å…¬å¼€çš„ ğŸ˜¢

åæ¥è¿˜å‘ç°è‡ªå·±ä¸€é“é¢˜å†™äº†ä¸ª \`collect\` å¾—åˆ°çš„ \`Vec\` åªç”¨åœ¨ä¸€ä¸ª \`for\` é‡Œï¼ˆå°±æ˜¯è¯´å¯ä»¥ç›´æ¥æŠŠè¿­ä»£å™¨ç”¨åœ¨ \`for\` ä¸ç”¨å…ˆ \`collect\`ï¼‰ğŸ˜µ æƒ³æ”¹è¿‡æ¥ï¼Œä½†è™½ç„¶æ²¡æœ‰å…¬å¼€æ¦œï¼Œè¿˜æ˜¯ä¸æƒ³æ‰¿å—å¯èƒ½çš„ç½šæ—¶ï¼ˆ

### Class 2

ç¬¬äºŒèŠ‚è¯¾å‰åå…±ä¸€å¤©å¤šçš„æ—¶é—´ï¼Œå†™äº† 16h å·¦å³ï¼ŒæŠŠ Wordle å¤§ä½œä¸šçš„åŸºç¡€åŠŸèƒ½å†™å®Œäº†ã€‚ï¼ˆ~~æœ¬æ¥ä»¥ä¸º Wordle æŒºå¥½å†™çš„ï¼Œæ²¡æƒ³åˆ°éœ€æ±‚è¿™ä¹ˆå¤šï¼Œéœ€æ±‚æ–‡æ¡£æ¨¡ç³Šä¸æ¸…çš„åœ°æ–¹è¿˜æœ‰çš„è¦é—®æœ‰çš„è¦è‡ªå·±è®¾è®¡ã€‚~~ï¼‰

æ„Ÿè§‰è¯¾ä¸Šè®²çš„åˆå¿«ï¼Œå¤§ä½œä¸šéœ€è¦çš„çŸ¥è¯†åˆæ²¡è®²å…¨ï¼Œå¾ˆéš¾æƒ³è±¡å¦‚æœä¸è‡ªå­¦è¯¥æ€ä¹ˆåº”å¯¹è¿™ä¸ªè¯¾ï¼ˆ

### Class 3

ä¿®äº†ä¸€äº›æ–‡æ¡£è¯´æ˜ä¸æ¸…å¯¼è‡´çš„ bugï¼Œç„¶åç ”ç©¶äº†ä¸€ä¸‹æ‰©å±•åŠŸèƒ½æ€ä¹ˆå†™ã€‚

ä¸çŸ¥é“ä¸ºä»€ä¹ˆæŠŠå•è¯æŒ‰ä¿¡æ¯ç†µæ’åºå†™äº†åŠå¤©ï¼Œæ˜æ˜æŒºç®€å•çš„ã€‚å¯èƒ½æ˜¯å¬ç€è€å¸ˆè®²è¯¾æ²¡æ³•ä¸“å¿ƒæƒ³ç®—æ³•ã€‚

åæ¥è¯•ç€ç”¨ [rayon](https://docs.rs/rayon/latest/rayon/) æŠŠä¿¡æ¯ç†µè®¡ç®—å¹¶è¡ŒåŒ–äº†ï¼Œåœ¨æˆ‘æœ¬æœºé™¤äº†ç¬¬ä¸€æ¬¡çŒœæµ‹åŸºæœ¬ä¸Šéƒ½èƒ½ç§’å‡ºç»“æœï¼Œæ„Ÿè§‰å¾ˆçˆ½ ~~ï¼Œç”šè‡³ç©äº†åŠå¤©æ„ä¹‰ä¸æ˜çš„ç…§ç€æç¤ºè¾“å…¥~~ã€‚

å†åæ¥å‘ç°ç”¨ release æ¨¡å¼ç¼–è¯‘çš„ä¼˜åŒ–æ¯”å¹¶è¡Œè¿˜å¤§ ğŸŒš

### ç¬¬ä¸€æ¬¡å¤§ä½œä¸šéªŒæ”¶

éªŒæ”¶åœ¨ THUWC å»è¿‡çš„ä¸œä¸»æ¥¼ï¼Œä½†ä¸Šå¤§å­¦åè¿˜æ˜¯ç¬¬ä¸€æ¬¡å»ï¼Œç»“æœèµ°é”™äº†ï¼Œè¿Ÿåˆ°äº† 5min ğŸ˜µ ç„¶åéå¸¸æ…Œå¼ åœ°å±•ç¤ºæé«˜åŠŸèƒ½ï¼Œéƒ½æ²¡å¤ªæ¼”ç¤ºå…¨ï¼Œ~~æ„Ÿè§‰ç™½å†™äº†~~ï¼ˆ

### Class 4~8

ç•¥ï¼ˆ

### ç¬¬äºŒæ¬¡å¤§ä½œä¸šéªŒæ”¶

è¿™æ¬¡çœŸçš„æœ‰æ¯” pretests å¼ºå¾ˆå¤šçš„ system test äº†ï¼Œè¿˜å¥½æ²¡ FSTï¼ˆåŠ©æ•™ï¼šè¿™ä¸ªç‚¹ä½ ä¸ºä»€ä¹ˆèƒ½è¿‡å•Šï¼ˆx

å¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªè¯¾ä¸æ˜¯å­¦å‰ç«¯çš„ï¼Œè€Œä¸”åŠ©æ•™åªç®€å•çœ‹äº†ä¸€ä¸‹ç•Œé¢æ¼”ç¤ºæ²¡çœ‹ä»£ç ï¼Œæ§½ç‚¹å¾ˆå¤šçš„å‰ç«¯è¢«å¤¸äº†å¾ˆç§‘å­¦ï¼ˆ

å¯èƒ½æ˜¯å› ä¸ºè¿™ä¸ªè¯¾ä¸æ˜¯å­¦æ•°æ®åº“çš„ï¼Œè€Œä¸”å¬è¯´æœ‰å…¶ä»–åŒå­¦æ•°æ®åº“é‡Œå…¨æ˜¯ JSONï¼Œæ™®æ™®é€šé€šçš„å»ºè¡¨è¢«å¤¸äº†å¾ˆç§‘å­¦ï¼ˆ

### å…³äºè¯¾ä¸Šçš„ä¸€äº›ç¿»è¯‘

ä¸ºä»€ä¹ˆä»€ä¹ˆéƒ½è¦ç¿»è¯‘å‡ºæ¥å•Šï¼ˆè™½ç„¶å¦‚æœè‹±è¯­æ¯è¯­çš„è¯çœ‹åŸæ–‡åº”è¯¥ä¹Ÿå¾ˆå°¬ ğŸ¤£

![trait: ç‰¹å‹ï¼›panic: ææ…Œï¼›poisoned: ä¸­æ¯’ï¼›crate: ç®±ï¼›library crate: åº“ç®±](rust-translations.jpg)

## Async Rust

å…ˆæ˜¯çœ‹äº† [Asynchronous Programming in Rust](https://rust-lang.github.io/async-book/)ï¼Œæ„Ÿè§‰çœ‹å¾—ä¸€çŸ¥åŠè§£çš„ï¼ˆå°¤å…¶æ˜¯ \`Pin\`ï¼‰ï¼Œå¥½åƒå¤§æ¦‚çŸ¥é“ \`Future\` åœ¨å¹²ä»€ä¹ˆåˆä¸å®Œå…¨çŸ¥é“ï¼ˆ~~è€Œä¸”è¿™æœ¬ä¹¦å¥½å’•å•Šï¼Œ\`TODO\` çš„ç« èŠ‚åº”è¯¥æ˜¯æœ‰ç”Ÿä¹‹å¹´äº†~~

æ²¡çœ‹å®Œ async bookï¼Œç›´æ¥å»çœ‹ [Tokio Tutorial](https://tokio.rs/tokio/tutorial) å’Œ [Async programming in Rust with async-std](https://book.async.rs/) äº†ã€‚ä½œä¸º async runtime çš„æ•™ç¨‹ï¼Œå®ƒä»¬æ¶‰åŠåˆ°çš„å…·ä½“åŸç†å’Œå®ç°å°‘ä¸€äº›ï¼Œæ›´æ³¨é‡æ€ä¹ˆå®é™…ä½¿ç”¨ï¼Œè¯»èµ·æ¥ä¼šå®¹æ˜“ç†è§£ä¸€äº›ã€‚å› ä¸º Tokio æ›´ popularï¼Œä¸»è¦çœ‹çš„æ˜¯ Tokio çš„æ•™ç¨‹ã€‚

## æ•°æ®åº“: Diesel

æ„Ÿè§‰ [diesel çš„æ•™ç¨‹](https://diesel.rs/guides/) å†™çš„æŒºç®€ç•¥çš„ï¼Œä½†å¯¹ç€ examples ç¡¬æŸ¥æ–‡æ¡£ä¹Ÿå‹‰å¼ºèƒ½çœ‹æ‡‚åŸºæœ¬ç”¨æ³•ã€‚ORM çœ‹ç€å°±å¾ˆâ€œå®‰å…¨â€ï¼Œåªä¸è¿‡å®åœ¨æ˜¯å¤ªç±»å‹ä½“æ“äº†ï¼Œä¸ä»…æ–‡æ¡£æŸ¥èµ·æ¥æœ‰ç‚¹å°éº»çƒ¦ï¼Œä»£ç å¤ç”¨ä¹Ÿç»å¸¸å› ä¸ºç¹ççš„ trait bounds å†™ä¸å¤ªåŠ¨ï¼ˆä¹Ÿå¯èƒ½æ˜¯æˆ‘æ²¡å­¦ä¼šï¼‰ã€‚

[diesel-derive-enum](https://crates.io/crates/diesel-derive-enum) æ˜¯å¥½ç”¨çš„ã€‚

Sqlite çš„ \`RETURNING\` è¯­å¥éœ€è¦å¯ç”¨ \`returning_clauses_for_sqlite_3_35\` feature flagï¼ˆå¹¶ä¸”éœ€è¦è‡³å°‘ 3.35 ç‰ˆæœ¬çš„ Sqliteï¼‰ã€‚æ²¡å¯ç”¨çš„æ—¶å€™å¯¹ç€ä¸€å † trait bound ä¸æ»¡è¶³çš„é”™è¯¯ä¿¡æ¯ï¼ˆå°±å’Œ C++ æ¨¡æ¿æ„Ÿè§‰å·®ä¸å¤šäº†..ï¼‰æ ¹æœ¬å‘ç°ä¸äº†é”™è¯¯åŸå› ï¼Œè¿˜æ˜¯ç¿»æ–‡æ¡£ç¿»åŠå¤©å‘ç°çš„ã€‚

è¿˜é‡åˆ°ä¸€ä¸ª Sqlite é”æ­»çš„å‘ï¼Œé€šè¿‡ [ä½¿ç”¨ r2d2 è®¾å®š \`busy_timeout\`](https://stackoverflow.com/a/57717533) å¹¶ [ä½¿ç”¨ WAL mode ä»¥åŠ immediate transaction](https://github.com/the-lean-crate/criner/issues/1) ï¼ˆhopefullyï¼‰è§£å†³äº†ã€‚
`},{title:p,tags:"btrfs Arch Linux é—®é¢˜è§£å†³è®°å½•",content:`è®°å½•ä¸€ä¸‹ä¹‹å‰å›°æ‰°æˆ‘è¿‘ä¸€å¹´çš„ [Btrfs](https://wiki.archlinux.org/title/Btrfs) å¿«ç…§å¯¼è‡´çš„ç³»ç»Ÿæ— å“åº”é—®é¢˜ã€‚



## ç³»ç»Ÿæ— å“åº”çš„å…·ä½“è¡¨ç°

æ¯æ¬¡æ•´ç‚¹æ—¶æœ‰æ¦‚ç‡å‡ºç°ï¼Œåœ¨ä¸€åˆ†é’Ÿå·¦å³çš„æ—¶é—´å†…ï¼Œå’Œç£ç›˜å†™å…¥ç›¸å…³çš„æ“ä½œéƒ½ä¼šå¡æ­»ï¼Œä¾‹å¦‚ç›´æ¥å’Œæ–‡ä»¶æ“ä½œç›¸å…³çš„ä¿å­˜æ–‡ä»¶ï¼Œæˆ–è€…ä¼šå†™å…¥ \`~/.zsh_history\` çš„åœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤ï¼Œä»¥åŠæ‰“å¼€æ–°çš„ GUI åº”ç”¨ç­‰ç­‰ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ•´ä¸ªç³»ç»Ÿå®Œå…¨å¡æ­»ã€‚

å¦å¤–ï¼Œæˆ‘æœ‰è§‚å¯Ÿåˆ°ï¼Œåœ¨ç¬”è®°æœ¬ä¸ä½¿ç”¨å¤–æ¥ç”µæºæ—¶è¿™ä¸€é—®é¢˜è¡¨ç°åœ°æ›´ä¸ºä¸¥é‡ï¼Œå³æ›´å®¹æ˜“è¢«å¯Ÿè§‰åˆ°ã€æ¯æ¬¡å¡ä½çš„æ—¶é—´æ›´é•¿ã€‚

## æœ€åˆè§£å†³é—®é¢˜çš„å°è¯•

é‡åˆ°é—®é¢˜åä¸ä¹…ï¼Œæˆ‘å°±æ€€ç–‘ä¸Šäº†ä¸€äº›æ¯å°æ—¶è‡ªåŠ¨è¿è¡Œçš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬ [Timeshift](https://github.com/linuxmint/timeshift) çš„å¿«ç…§ä»¥åŠä¸€äº›è‡ªå·±å†™çš„ crontabã€‚

æœ€å€¼å¾—æ€€ç–‘çš„å°±æ˜¯ Timeshift çš„å¿«ç…§äº†ï¼Œç„¶è€Œï¼Œå½“æ—¶æˆ‘æ›¾ç»å°è¯•è¿‡æš‚æ—¶å…³é—­è‡ªåŠ¨å¿«ç…§ï¼Œä½†é—®é¢˜ä¼¼ä¹æ²¡æœ‰å¾—åˆ°è§£å†³ï¼Œå…·ä½“åŸå› å·²ä¸å¯è€ƒäº†ã€‚å½“æ—¶æˆ‘è¿˜åœ¨ä¸€ä¸ªç¾¤é‡Œæå‡ºäº†è¿™ä¸ªçŒœæƒ³ï¼Œç„¶åç¾¤å‹è¯´å¿«ç…§æ˜¯åŸå­çº§æ“ä½œï¼Œä¸åº”è¯¥å¡ä½ï¼Œæˆ‘æ„Ÿè§‰å¾ˆæœ‰é“ç†ï¼Œå°±åœ¨å¾ˆé•¿æ—¶é—´å†…æ²¡æœ‰æ€€ç–‘è‡ªåŠ¨å¿«ç…§çš„é—®é¢˜äº†ã€‚

åæ¥æˆ‘åˆå°è¯•ç€å…³é—­å„ç§ crontabï¼Œå½“ç„¶ä¹Ÿæ²¡æœ‰è§£å†³é—®é¢˜ã€‚

æœ‰æƒ³è¿‡åœ¨æ•´ç‚¹æ—¶ç”¨ \`htop\` æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ï¼Œä½†ç”±äºå¡ä½æ—¶è¿è¡Œä¸äº†å‘½ä»¤ï¼ˆå½“ç„¶å¯ä»¥å…³é—­ç»ˆç«¯çš„å†å²è®°å½•ï¼Œä½†å…³äº†ä¹Ÿä¸è§å¾—ä¸å¡ï¼Œè€Œä¸”æˆ‘æ‡’å•Šxï¼‰ï¼Œéœ€è¦æå‰æ‰“å¼€ \`htop\`ï¼Œè€Œä¸”ä¹Ÿä¸æ˜¯æ¯å°æ—¶éƒ½ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œçœ‹åˆ°äº†è¿›ç¨‹ä¿¡æ¯ä¹Ÿä¸ä¸€å®šèƒ½æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œæœ€åä¹Ÿæ²¡æœ‰æˆåŠŸã€‚

å½“æ—¶è‡ªç„¶ä¹Ÿå°è¯•è¿‡å„ç§æœç´¢ï¼Œè‡³äºä¸ºä»€ä¹ˆæ²¡æœ‰æœç´¢åˆ°æˆ–è€…æ³¨æ„åˆ° [Freeze issues with BTRFS and Timeshift](https://forum.manjaro.org/t/freeze-issues-with-btrfs-and-timeshift/22005) ä¹Ÿä¸å¯è€ƒäº†ï¼Œå¯èƒ½æ˜¯æœç´¢å…³é”®è¯ä¸å¯¹å§ï¼Œæ¯•ç«Ÿå½“æ—¶æˆ‘ä¸€å®šç¨‹åº¦ä¸Šæ’é™¤äº†å¯¹å¿«ç…§çš„æ€€ç–‘ã€‚

ç”±äºé—®é¢˜çš„ä¸¥é‡ç¨‹åº¦å’Œæ˜¯å¦å¤–æ¥ç”µæºæœ‰å…³ï¼Œæˆ‘ç”šè‡³ä¸€åº¦æ€€ç–‘è¿‡æ˜¯ç¡¬ä»¶é—®é¢˜ï¼Œæƒ³æ¢ç”µè„‘ï¼ˆ

## æœ€ç»ˆé—®é¢˜çš„è§£å†³

åœ¨è¢«è¿™ä¸€é—®é¢˜å›°æ‰°äº†å¤§åŠå¹´åï¼Œæˆ‘åˆå¿ä¸ä½æƒ³æœç´¢è§£å†³æ–¹æ³•ï¼Œè¿™ä¸€æ¬¡å¾ˆå¿«å°±æœåˆ°äº† [Freeze issues with BTRFS and Timeshift](https://forum.manjaro.org/t/freeze-issues-with-btrfs-and-timeshift/22005)ï¼Œç„¶åæŒ‰é‡Œé¢è¯´çš„ç¦ç”¨äº† quota: \`sudo btrfs quota disable /\`ã€‚

ä½†è¿‡äº†å‡ å¤©ï¼Œæˆ‘å‘ç°é—®é¢˜åˆå‡ºç°äº†ï¼Œä»¥ä¸ºè¿™ä¸ªæ–¹æ³•ä¸ç®¡ç”¨ã€‚

åæ¥åˆè¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘åˆå¿ä¸äº†äº†ï¼Œå†ä»”ç»†é˜…è¯»äº†ä¸€ä¸‹ï¼Œå‘ç°è¿™ä¸ª thread é‡Œæœ‰æåˆ° Timeshift ä¼šè‡ªåŠ¨æ‰“å¼€ quotaï¼Œè¦ä¿®æ”¹ Timeshift çš„è®¾ç½®æ‰è¡Œã€‚è‡³æ­¤ï¼Œé—®é¢˜è§£å†³ã€‚

<Card title="å…³äº Brtfs Quota">

[Btrfs quota](https://wiki.archlinux.org/title/Btrfs#Quota) ä¸»è¦ç”¨äºå¿«é€ŸæŸ¥çœ‹æ¯ä¸ª subvolume çš„ç£ç›˜ç”¨é‡ï¼ˆå¯ä»¥ç”¨ [btrfs-du](https://github.com/nachoparker/btrfs-du) æŸ¥çœ‹ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨çš„è¯ï¼Œæ¯æ¬¡æŸ¥çœ‹å°±éœ€è¦å‡ åç§’çš„æ—¶é—´æ¥é‡æ–°æ‰«æã€‚

ä½†æ˜¯ï¼Œè¿™ä¸€åŠŸèƒ½æœ‰å¾ˆå¤š [å·²çŸ¥é—®é¢˜](https://btrfs.wiki.kernel.org/index.php/Quota_support#Known_issues)ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬æœ¬æ–‡æè¿°çš„è¿™ä¸ªï¼‰ï¼Œæ‰€ä»¥ç›®å‰ä¸å»ºè®®å¯ç”¨ã€‚

</Card>

## åè®°: Timeshift å·²ä¿®å¤æ­¤é—®é¢˜

å®é™…ä¸Šï¼ŒTimeshift å·²åœ¨æˆ‘è‡ªå·±è§£å†³é—®é¢˜å‰ä¸ä¹…å°±ä¿®å¤äº†è¿™ä¸€é—®é¢˜: [Fix #865, #839, #680: Do not create or remove Qgroups when snapshots are created or removed](https://github.com/linuxmint/timeshift/commit/8d77b18fe7b725c11baefe721633561d755b3630)

è™½ç„¶ [Timeshift åœ¨ 5 æœˆ 29 æ—¥å°±å‘å¸ƒäº†ä¿®å¤](https://github.com/linuxmint/timeshift/releases/tag/v22.06.1)ï¼Œä½†æ˜¯ [archlinuxcn åœ¨ 7 æœˆ 1 æ—¥æ‰æ›´æ–°](https://github.com/archlinuxcn/repo/commits/master/archlinuxcn/timeshift)ï¼Œäºæ˜¯æˆ‘â€œæœ‰å¹¸â€åœ¨ Timeshift æ›´æ–°çš„å‰ä¸€å¤©è‡ªå·±è§£å†³äº†é—®é¢˜ ğŸ™ƒ...

![æ¶ˆæ¯è®°å½•ï¼Œå‘äº 6 æœˆ 30 æ—¥: å‰æ®µæ—¶é—´å¬è¯´å…³ quota å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†å…³äº†ä¹‹åè¿˜æ˜¯ç»å¸¸å¡ã€‚ä»Šå¤©æ‰å‘ç° timeshift é‡Œè®¾ç½®äº†å¼€ quotaï¼Œå¾—æŠŠ timeshift çš„è‡ªåŠ¨å¼€ quota å…³äº†æ‰è¡Œ ğŸŒš éœ€è¦è§‚å¯Ÿå‡ å¤©æ˜¯å¦è¿˜ä¼šæ•´ç‚¹å¡](btrfs-quota-timeshift-message-screenshot.png)

å…¶å®æˆ‘è¿˜æ˜¯å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™æƒ³çœ‹ä¸€çœ¼ Timeshift çš„ quota è®¾ç½®å‘ç°æ²¡æœ‰è¿™ä¸ªè®¾ç½®é¡¹äº†æ‰çŸ¥é“ Timeshift å·²ç»ä¿®äº†...
`},{title:F,tags:"CSS Web é—®é¢˜è§£å†³è®°å½•",content:`åŒæ—¶ä½¿ç”¨ \`display: none\` å’Œ \`loading="lazy"\` å¯èƒ½ä¼šè®©å†…å®¹æ°¸è¿œåŠ è½½ä¸å‡ºæ¥ã€‚

<p class="dark:hidden">![æˆªå›¾ï¼šè¯„è®ºåŠ è½½ä¸­](comments-loading-light.png)</p>
<p class="hidden dark:block">![æˆªå›¾ï¼šè¯„è®ºåŠ è½½ä¸­](comments-loading-dark.png)</p>



## é—®é¢˜èƒŒæ™¯

è™½ç„¶ [giscus](https://giscus.app/) è‡ªå¸¦ä¸€ä¸ªåŠ è½½é¡µé¢ï¼Œä½†é¦–å…ˆè¿™ä¸ªåŠ è½½é¡µé¢è‡ªèº«å°±æœ‰å¯èƒ½åŠ è½½å¾ˆä¹…æ‰æ˜¾ç¤ºï¼Œè€Œä¸”è¿™ä¸ªè‡ªå¸¦çš„åŠ è½½é¡µé¢æ²¡æœ‰ä»»ä½•æœ‰æ•ˆä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±å†™äº†ä¸€ä¸ªåŠ è½½é¡µé¢ï¼Œé™„ä¸Šäº† Discussions é“¾æ¥ã€‚

æˆ‘ä½¿ç”¨çš„æ˜¯ giscus çš„ [giscus-to-parent \`message\` events](https://github.com/giscus/giscus/blob/main/ADVANCED-USAGE.md#giscus-to-parent-message-events) åŠŸèƒ½æ¥æ£€æµ‹ giscus å·²åŠ è½½ï¼Œè€Œè¿™å’Œ giscus æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šæœ‰ä¸€å®šçš„æ—¶é—´é—´éš”ï¼Œæ‰€ä»¥åœ¨æ£€æµ‹åˆ°åŠ è½½å¥½ä¹‹å‰éœ€è¦å…ˆæŠŠ giscus éšè—èµ·æ¥ã€‚å› ä¸ºæ˜¯ç”¨çš„ Vueï¼Œå¾ˆè‡ªç„¶åœ°å°±æ˜¯ç”¨ \`v-show\` è®© giscus åŠ è½½å¥½å†æ˜¾ç¤ºã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæœ¬ç€â€œä¸ç”¨ç™½ä¸ç”¨â€çš„ç²¾ç¥ï¼Œæˆ‘è¿˜å¯ç”¨äº† giscus çš„ lazy loadï¼ˆæœ¬è´¨ä¸Šæ˜¯ \`<iframe>\` çš„ \`loading="lazy"\`ï¼‰ã€‚

å¹¶ä¸”ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ Firefoxï¼Œä¸Šè¿°é…ç½®åœ¨ Firefox ä¸Šæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

## é—®é¢˜çš„å‘ç°ä¸è§£å†³

ä¸€ä½ç¾¤å‹å‘Šè¯‰æˆ‘è¯„è®ºåŠ è½½ä¸å‡ºæ¥ï¼Œäºæ˜¯æˆ‘è¯•äº†ä¸€ä¸‹å„ä¸ªæµè§ˆå™¨ï¼Œåœ¨ç¬¬äºŒæ¬¡ï¼ˆä¸ºä»€ä¹ˆæ˜¯ç¬¬äºŒæ¬¡å‘¢ï¼Œä¸æ‡‚ï¼‰è¯• Chrome çš„æ—¶å€™å‘ç°æ²¡åŠ è½½å‡ºæ¥ã€‚

console æ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼›æŸ¥çœ‹ DOMï¼Œå‘ç° \`<iframe>\` é‡Œé¢æ˜¯ç©ºçš„ï¼Œå¹¸å¥½æˆ‘è¿˜è®°å¾—è‡ªå·±ç”¨äº† lazy loadï¼Œæ‰€ä»¥å¾ˆå¿«å°±æ˜ç™½äº†é—®é¢˜æ‰€åœ¨ï¼šChrome æ¯”è¾ƒâ€œèªæ˜â€ï¼Œçœ‹åˆ° \`display: none;\` å°±æ‡’äº†ï¼Œæ²¡åŠ è½½è¿™ä¸ª \`<iframe>\`ã€‚

æŠŠ \`v-show\` æ¢æˆ \`opacity-0 absolute\` å°±è§£å†³äº†é—®é¢˜ã€‚

ä½†æœ€åè¿˜æœ‰ç‚¹å°æ’æ›²ï¼Œå› ä¸ºè¿™ä¸ª \`opacity-0\` åœ¨ SSR çš„æ—¶å€™æ˜¯æ²¡æœ‰çš„ï¼Œæ²¡è¢« [UnoCSS](https://github.com/unocss/unocss) æ‰«æåˆ°ï¼Œå°±æŒ‚äº†ï¼Œæœ€åæ¢æˆäº† inline styleã€‚

## åè®°

è¿™ä»¶äº‹å‘Šè¯‰æˆ‘ä»¬ï¼Œ~~æœ‰å¥½çš„ç¾¤å‹~~åœ¨ä¸åŒæµè§ˆå™¨ä¸Šå¤šæµ‹è¯•å‡ éæ˜¯éå¸¸é‡è¦çš„ã€‚

~~è¿™ç‚¹äº‹å€¼å¾—å‘åšå®¢å—ï¼›å½“ç„¶æ˜¯åšå®¢å¤ªç©ºäº†éšä¾¿æ°´ä¸€ç¯‡~~

P.S. è™½ç„¶é—®é¢˜çš„è§£å†³å¾ˆç®€å•ï¼Œä½†è¿˜æ˜¯æµ…æœäº†ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆ best practiceã€‚å€’æ˜¯æ²¡æœåˆ°ä»€ä¹ˆæœ‰ç”¨çš„ï¼Œä½†æ˜¯æœåˆ°[ä¸€ä¸ªæœ‰è¶£çš„](https://developers.weixin.qq.com/community/develop/doc/0006ec11c48ec072b6e7b79975b000)ï¼ˆ

![è®ºå›æˆªå›¾ï¼šéº»çƒ¦æä¾›ä¸‹ä»£ç ç‰‡æ®µã€‚ä½ ä»¬å·²ç»æ˜¯æˆç†Ÿçš„å¼€å‘å›¢é˜Ÿäº†ï¼Œè¦å­¦ä¼šè‡ªå·±å¤ç°bugã€‚](reproduce-yourself.png)

## å†åè®°

å‘ç°åŠ è½½ä¸­çš„ \`<iframe>\` è™½ç„¶çœ‹ä¸è§ä½†ç‚¹çš„åˆ°..éœ€è¦åŠ ä¸€ä¸ª \`z-index: -1\`ã€‚

## å†åè®°çš„åè®°

è¿™ä¸ªä¸œè¥¿è™½ç„¶æ€ä¹ˆéƒ½çœ‹ä¸è§äº†ï¼Œä½†å®½åº¦ä¼šè®©æ•´ä¸ªé¡µé¢å‡ºç°æ°´å¹³æ»šåŠ¨æ¡ï¼Œæ‰€ä»¥è¦åŠ  \`width: 0; height: 0;\`ã€‚
`},{title:g,tags:"é€‰è¯¾ THU ç»éªŒåˆ†äº«",content:`è¿˜è®°å¾—åˆšå…¥å­¦çš„æ—¶å€™ï¼Œæˆ‘ä¸€å¼€å§‹å®Œå…¨æ²¡å¼„æ˜ç™½è¦æ€ä¹ˆé€‰è¯¾ï¼Œå½“æ—¶å°±æƒ³ç€å¼„æ˜ç™½äº†è¦å†™ä¸€ç¯‡é€‰è¯¾æŒ‡å—ã€‚

åæ¥ï¼Œæˆ‘å¼„æ˜ç™½ä¹‹åå‘ç°ä¸è®°å¾—è‡ªå·±ä»¥å‰ä¸ºä»€ä¹ˆä¸æ˜ç™½äº†ï¼Œå†™ä¸å‡ºæ¥äº†ï¼ˆ

å†åæ¥ï¼Œæˆ‘å‘ç°ä¸€äº›èº«è¾¹çš„åŒå­¦åˆ°äº†é€‰å¤§äºŒçš„è¯¾çš„æ—¶å€™è¿˜æ²¡å¼„æ˜ç™½é€‰è¯¾æµç¨‹ï¼ˆ

æ‰€ä»¥ï¼Œè™½ç„¶é€‰è¯¾æŒ‡å—æ˜¯å†™ä¸å‡ºæ¥äº†ï¼Œå§‘ä¸”æ˜¯åˆ—ä¸¾ä¸€äº›å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹ï¼Œä¾›å‚è€ƒã€‚



å› ä¸ºé€‰è¯¾ç›¸å…³é—®é¢˜é”™ç»¼å¤æ‚ï¼Œä¸‹é¢çš„å†…å®¹æŒ‰é¡ºåºé˜…è¯»å¯èƒ½ä¼šæœ‰å›°éš¾ï¼Œå› ä¸ºæœ‰åæ–‡æ‰ä»‹ç»çš„æ¦‚å¿µå‰æ–‡å·²ç»å‡ºç°çš„æƒ…å†µã€‚ï¼ˆè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘è¯´è¿™ç¯‡ä¸æ˜¯â€œæŒ‡å—â€è€Œæ˜¯â€œå¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹â€ï¼ˆ

<Card type="warn">

æœ¬æ–‡å†…å®¹ä»…ä¾›å‚è€ƒï¼Œå¯èƒ½å› ä¸ºè§„åˆ™å…·æœ‰æ—¶æ•ˆæ€§ã€ä¸åŒé™¢ç³»ä¹‹é—´å­˜åœ¨å·®åˆ«ã€ç¬”è€…çš„è®¤è¯†é”™è¯¯æˆ–ç¬”è¯¯è€Œä¸å®é™…é€‰è¯¾ä¸ç¬¦ï¼Œè¿˜è¯·ä»¥å®é™…çš„é€‰è¯¾è§„åˆ™ä¸ºå‡†ï¼Œå¿…è¦æ—¶å‘è€å¸ˆæˆ–è¾…å¯¼å‘˜å’¨è¯¢ã€‚

</Card>

å½“ç„¶å¦‚æœå‘ç°äº†ä»€ä¹ˆé”™è¯¯å¯ä»¥è¯„è®ºåŒºå‘Šè¯‰æˆ‘ã€‚

## é€‰è¯¾å…¥å£ â€”â€” åœ¨å“ªé€‰è¯¾å•Šï¼Œæˆ‘æ‰¾ä¸åˆ°

[ä¸­æ–‡é€‰è¯¾å…¥å£](https://zhjwxk.cic.tsinghua.edu.cn/xklogin.do)

åæ­£æˆ‘æ˜¯æ¯æ¬¡åœ¨åœ°å€æ è¾“å…¥ \`xk\`ï¼Œç„¶ååŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå†å²è®°å½•å°±æ˜¯é€‰è¯¾å…¥å£ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åœ¨ [academic](https://academic.tsinghua.edu.cn) ç™»å½•åç‚¹å‡» [â€œè¿›å…¥æœ¬ç§‘ç”Ÿé€‰è¯¾â€](https://zhjw.cic.tsinghua.edu.cn/xkBks.vxkBksXkbBs.do?m=main) è¿›å…¥ã€‚

å¦‚æœæ˜¯åœ¨æ ¡å¤–ï¼Œå°±è¦ç”¨ VPN è®¿é—®ï¼Œä¸€èˆ¬ä½¿ç”¨ [webvpn](https://webvpn.tsinghua.edu.cn/)ï¼Œç™»å½•è¿›å»åå°±ä¼šæœ‰é€‰è¯¾å…¥å£çš„é“¾æ¥ã€‚

åœ¨æŠ¢è¯¾åˆšå¼€å§‹ç­‰çƒ­é—¨æ—¶æ®µï¼Œé€‰è¯¾ç³»ç»Ÿä¸€èˆ¬ä¼šéå¸¸å¡ï¼Œæ®è¯´ä½¿ç”¨ [è‹±æ–‡é€‰è¯¾ç³»ç»Ÿ](https://zhjwxkyw.cic.tsinghua.edu.cn/xklogin.do) ä¼šä¸å¡ä¸€äº›ï¼Œä½†ä¸ç¡®å®šæ˜¯ä¸æ˜¯çœŸçš„ã€‚

## é€‰è¯¾æµç¨‹ â€”â€” ä»€ä¹ˆæ˜¯é¢„é€‰ã€æ­£é€‰ã€è¡¥é€€é€‰ï¼Ÿä»€ä¹ˆæ˜¯æŠ½ç­¾ã€æŠ¢è¯¾ï¼Ÿ

### é€‰è¯¾æµç¨‹

#### æ–°ç”Ÿé€‰è¯¾æµç¨‹

åˆšå…¥å­¦æ—¶çš„ç¬¬ä¸€æ¬¡é€‰è¯¾ä¸åé¢çš„é€‰è¯¾æ˜¯æœ‰ä¸€å®šå·®å¼‚çš„ï¼Œå¦‚æœä¸æ„è¯†åˆ°è¿™ä¸€ç‚¹ï¼Œçœ‹åˆ°ä¸€ä¸ªå¯¹æ­£å¸¸é€‰è¯¾æµç¨‹çš„æè¿°ï¼Œå‘ç°å’Œæ–°ç”Ÿé€‰è¯¾ä¸åŒï¼Œå°±å¯èƒ½è¢«ææ™•ã€‚

æ–°ç”Ÿé€‰è¯¾ä¸»è¦æœ‰è¿™äº›ç‰¹ç‚¹ï¼š

-   æ²¡æœ‰æ­£é€‰ç¯èŠ‚
-   ä¸åˆ†ä¸€äºŒä¸‰å¿—æ„¿
-   è€ç”Ÿå·²åœ¨ä¸Šå­¦æœŸæœ«å®Œæˆäº†é¢„é€‰å’Œæ­£é€‰ï¼Œè€Œæ–°ç”Ÿåœ¨å…¥å­¦æ—¶æ‰ä¼šè¿›è¡Œé¢„é€‰
-   ä¸€äº›è¯¾ç¨‹ä¼šåœ¨è€ç”Ÿé€‰è¯¾æ—¶ç»™æ–°ç”Ÿé¢„ç•™éƒ¨åˆ†è¯¾å®¹é‡ï¼ˆè‹¥æ–°ç”Ÿæ²¡é€‰æ»¡ï¼Œè€ç”Ÿå¯ä»¥åœ¨è¡¥é€€é€‰æ—¶å†æŠ¢è¯¾ï¼‰

#### æ­£å¸¸é€‰è¯¾æµç¨‹

åœ¨é€‰è¯¾ç³»ç»Ÿç‚¹å‡»â€œé€‰è¯¾æ—¶é—´å®‰æ’â€å°±èƒ½çœ‹åˆ°å½“å‰å­¦æœŸçš„å®Œæ•´é€‰è¯¾æ—¶é—´å®‰æ’ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œé€‰è¯¾çš„ä¸»ä½“æµç¨‹ä¸º: é¢„é€‰ â†’ æ­£é€‰ â†’ è¡¥é€€é€‰ç¬¬ä¸€é˜¶æ®µ â†’ è¡¥é€€é€‰ç¬¬äºŒé˜¶æ®µ & ç‰¹æ®ŠåŸå› è¡¥é€‰

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜ä¼šæœ‰äºŒçº§é€‰è¯¾ã€é‡ä¿®ä½“è‚²è¯¾åˆ†é¡¹ç­‰ç‰¹æ®Šç±»å‹é€‰è¯¾ï¼Œä»¥åŠè®° P/F å’Œé€€è¯¾ã€‚

<Card type="warn" title="è®°å¾—é€‰è¯¾ï¼">

~~ä½ åœ¨è¯´å•¥ï¼Ÿæˆ‘æ€ä¹ˆä¼šå¿˜è®°é€‰è¯¾ï¼Œä¸ä¼šæœ‰é€šçŸ¥å—~~

å¯èƒ½ä¼šå’Œä½ æƒ³è±¡ä¸­ä¸åŒï¼Œé€‰è¯¾ç»å¸¸æ˜¯æ²¡æœ‰é€šçŸ¥çš„ï¼Œæˆ–è€…ï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œä½ ä¸ä¸€å®šå…³æ³¨äº†å‘å¸ƒé€šçŸ¥çš„æ¸ é“ï¼Œä»¥åŠé€šçŸ¥å¯èƒ½å‘å¸ƒå¾—æ¯”é€‰è¯¾æ—¶é—´æ—©å¾ˆå¤šï¼Œç­‰åˆ°é€‰è¯¾æ—¶ä½ å¯èƒ½å·²ç»å¿˜äº†ã€‚

è¿æ°”å¥½æ—¶ï¼Œä½ å¯èƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œæˆ–è€…çœ‹åˆ°ç¾¤é‡Œæœ‰åŒå­¦åœ¨è®¨è®ºé€‰è¯¾ç›¸å…³çš„è¯é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ è¿æ°”ä¸å¤ªå¥½ï¼Œæˆ–è€…æ˜¯ä½ é‡åˆ°çš„æ˜¯ **äºŒçº§é€‰è¯¾ã€è¡¥é€€é€‰ã€è®° P/Fã€é€€è¯¾** ç­‰å¹¶éäººäººå…³æ³¨çš„é€‰è¯¾ç¯èŠ‚ï¼Œå¯èƒ½çœŸçš„æ²¡æœ‰ä»»ä½•äººä¼šæ¥é€šçŸ¥ä½ ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦åœ¨é€‰è¯¾æœŸé—´å…³æ³¨é€‰è¯¾æ—¶é—´å®‰æ’ï¼Œä¸è¦é”™è¿‡é€‰è¯¾ã€‚

</Card>

#### å¤å­£å­¦æœŸï¼ˆå°å­¦æœŸï¼‰é€‰è¯¾æµç¨‹

å¤å­£å­¦æœŸæ²¡æœ‰é¢„é€‰ä¹Ÿæ²¡æœ‰è¡¥é€€é€‰ï¼Œä¹Ÿå°±æ˜¯ä¸æŠ½ç­¾ç›´æ¥æŠ¢è¯¾ã€‚å…·ä½“å·®åˆ«è¯·åœ¨å¤å­£å­¦æœŸé€‰è¯¾æ—¶æŸ¥çœ‹é€‰è¯¾ç³»ç»Ÿä¸­çš„â€œé€‰è¯¾æ—¶é—´å®‰æ’â€ã€‚

### é€‰è¯¾ç¯èŠ‚

#### é¢„é€‰

æ‰€è°“çš„â€œæŠ½ç­¾â€ ~~â€œèµŒåœºâ€~~ æŒ‡çš„å°±æ˜¯é¢„é€‰äº†ã€‚

å¯¹äºæ¯ä¸ªè¯¾ï¼Œè‹¥é€‰è¯¾äººæ•°è¶…è¿‡è¯¾å®¹é‡ï¼Œå°±ä¼šåœ¨é¢„é€‰ç»“æŸåè¿›è¡ŒæŠ½ç­¾ï¼Œåœ¨é€‰äº†è¿™ä¸ªè¯¾çš„äººé‡ŒéšæœºæŠ½å–è¯¾å®¹é‡è¿™ä¹ˆå¤šçš„äººï¼Œä»–ä»¬å°±é€‰ä¸Šè¿™é—¨è¯¾äº†ï¼Œè€Œå…¶ä»–äººåˆ™æŒ‰éšæœºé¡ºåºåŠ å…¥ Waiting Listã€‚

ä½†æ˜¯ï¼Œè¿™é‡Œçš„â€œéšæœºâ€ä¸æ˜¯å®Œå…¨çš„éšæœºï¼Œè€Œæ˜¯æœ‰ä¼˜å…ˆçº§çš„ â€”â€” å…ˆçœ‹è¯¾ç¨‹å±æ€§ï¼Œå†çœ‹å¿—æ„¿ä¼˜å…ˆçº§ã€‚è¯¾ç¨‹å±æ€§åˆ†ä¸ºå¿…ä¿®ã€é™é€‰ã€ä»»é€‰ï¼Œé™¤æ–°ç”Ÿé€‰è¯¾å¤–å¿—æ„¿åˆ†ä¸ºä¸€äºŒä¸‰ä¸‰æ¡£ï¼Œæ»¡è¶³ç‰¹æ®Šæ¡ä»¶çš„è¯è¿˜å¯ä»¥åœ¨ä»»é€‰è¯¾ä¸­æ‹¿åˆ°â€œä¼˜å…ˆå¿—æ„¿â€ï¼Œæ€»çš„æ’åºå°±æ˜¯: å¿…ä¿®ä¸€å¿—æ„¿ > å¿…ä¿®äºŒå¿—æ„¿ > å¿…ä¿®ä¸‰å¿—æ„¿ > é™é€‰ä¸€å¿—æ„¿ > é™é€‰äºŒå¿—æ„¿ > é™é€‰ä¸‰å¿—æ„¿ > ä»»é€‰ä¼˜å…ˆå¿—æ„¿ > ä»»é€‰ä¸€å¿—æ„¿ > ä»»é€‰äºŒå¿—æ„¿ > ä»»é€‰ä¸‰å¿—æ„¿ã€‚

æŠ½ç­¾æ—¶ï¼Œä¼šå…ˆä¾æ¬¡è®©æ¯ä¸ªä¼˜å…ˆçº§çš„æ‰€æœ‰äººé€‰ä¸Šè¯¾ï¼Œå¦‚æœä¸€ä¸ªä¼˜å…ˆçº§çš„äººæ•°å¤§äºå½“å‰è¯¾ä½™é‡ï¼Œå°±ä¼šåœ¨è¿™ä¸€ä¼˜å…ˆçº§å†…éšæœºæŠ½å–è¯¾ä½™é‡è¿™ä¹ˆå¤šäººé€‰ä¸Šè¯¾ï¼Œè€Œæ²¡æœ‰æŠ½åˆ°çš„äººä»¥åŠæ›´ä½ä¼˜å…ˆçº§çš„äººåˆ™ä¼šè½é€‰ï¼Œå¹¶æŒ‰ä¼˜å…ˆçº§é¡ºåºåŠ å…¥ Waiting Listã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºä»¥ä¼˜å…ˆçº§ä¸ºç¬¬ä¸€å…³é”®å­—ã€éšæœºæ•°ä¸ºç¬¬äºŒå…³é”®å­—è¿›è¡Œæ’åºï¼Œç„¶åå–å‰è¯¾å®¹é‡è¿™ä¹ˆå¤šçš„äººé€‰ä¸Šè¯¾ï¼Œä½™ä¸‹çš„äººæŒ‰åŸåºåŠ å…¥ Waiting Listã€‚

<Card title="Waiting List é¡ºåºä¸å¿—æ„¿ä¼˜å…ˆçº§">
æœ‰ä¸€ä¸ªæµä¼ ç”šå¹¿çš„ä¼ è¨€ï¼Œæ˜¯ Waiting List é¡ºåºä¸å¿—æ„¿ä¼˜å…ˆçº§æ— å…³ã€‚è¿™ä¸ªä¼ è¨€èƒ½æµä¼ å¼€æ¥ï¼Œå¤§æ¦‚æ˜¯å› ä¸ºå®é™…æŠ½åˆ°çš„ WL ä½ç½®ä¸èƒ½ 100% è¯ä¼ªè¿™ä¸ªä¼ è¨€ï¼Œè€Œæ¯å­¦æœŸåˆåªæœ‰æœ€å¤šé‚£ä¹ˆå‡ é—¨è¯¾ä¼šè¿›å…¥ WLï¼Œä¹Ÿå¾ˆéš¾æ”¶é›†è¶³å¤Ÿå¤šçš„æ•°æ®ä»¥åœ¨å¤§æ¦‚ç‡ä¸Šè¯ä¼ªã€‚è€Œä¸€æ—¦æŠŠä¸­åˆ 12:00 çš„å¿—æ„¿å½“ä½œæœ€ç»ˆå¿—æ„¿ï¼ŒæŠŠæœ‰äººé€€å‡ºé˜Ÿåˆ—åçš„é˜Ÿåˆ—ä½ç½®å½“ä½œæŠ½åˆ°çš„é˜Ÿåˆ—ä½ç½®ï¼Œæˆ–è€…æ˜¯æ€ä¹ˆç®—é”™äº†ï¼Œå°±å¯èƒ½è¯¯ä»¥ä¸ºâ€œè¯å®â€äº†è¿™ä¸ªä¼ è¨€ã€‚

å®é™…ä¸Š [æœ¬ç§‘ç”Ÿé€‰è¯¾ç³»ç»ŸWaiting Listæ–¹æ¡ˆä»‹ç»](https://announce.cic.tsinghua.edu.cn/node/26766) å°±æ˜ç¡®è¯´äº†ï¼š

> æœªä¸­ç­¾çš„å­¦ç”Ÿï¼Œç³»ç»Ÿæ ¹æ®æŠ½ç­¾çº§åˆ«é¡ºåºè¿›å…¥è¯¥è¯¾ç¨‹çš„WLä¸­å€™é€‰ã€‚åŒä¸€çº§åˆ«çš„å­¦ç”Ÿéšæœºæ’åºã€‚

ä½†å¤§å®¶çœ‹èµ·æ¥éƒ½æ²¡æœ‰çœ‹åˆ°è¿™ä¸ªæ–¹æ¡ˆä»‹ç»ï¼Œéƒ½é å£å£ç›¸ä¼ æ¥äº†è§£é€‰è¯¾è§„åˆ™ï¼ˆ
</Card>

ä¸€äºŒä¸‰å¿—æ„¿æ˜¯é€‰è¯¾è€…è‡ªè¡Œé€‰æ‹©çš„ï¼Œ**æ¯ä¸ªè¯¾ç¨‹å±æ€§**éƒ½å¯ä»¥é€‰æ‹©è‡³å¤š 1 é—¨ä¸€å¿—æ„¿ã€è‡³å¤š 2 é—¨äºŒå¿—æ„¿ã€ä»»æ„é—¨ä¸‰å¿—æ„¿ï¼Œè€Œä¸åŒè¯¾ç¨‹å±æ€§çš„å¿—æ„¿ä¹‹é—´äº’ä¸å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…ä¿®ä¸€å¿—æ„¿å’Œä»»é€‰ä¸€å¿—æ„¿å¯ä»¥å„æœ‰ä¸€ä¸ªã€‚ä¼˜å…ˆå¿—æ„¿ä¸€èˆ¬æ˜¯ç»™ç›¸å…³é™¢ç³»/ä¸“ä¸šçš„å­¦ç”Ÿï¼Œéœ€è¦æ»¡è¶³çš„æ¡ä»¶ä¼šå†™åœ¨â€œé€‰è¯¾æ–‡å­—è¯´æ˜â€ä¸­ï¼Œä¾‹å¦‚ï¼Œè¯¾ç¨‹â€œè®¡ç®—æœºç§‘å­¦åŸºç¡€â€çš„é€‰è¯¾æ–‡å­—è¯´æ˜ä¸ºâ€œä¼˜å…ˆ:è®¡ç®—æœºç±»ã€ä¿¡æ¯ä¸è®¡ç®—ç§‘å­¦ä¸“ä¸šå­¦ç”Ÿé€‰è¯¾â€ã€‚

åœ¨é¢„é€‰æœŸé—´ï¼Œå¯ä»¥å¤šæ¬¡ä¿®æ”¹æ‰€é€‰çš„è¯¾ç¨‹æˆ–å¿—æ„¿ç­‰çº§ï¼Œä¹Ÿå¯ä»¥åœ¨ é€‰è¯¾æŸ¥è¯¢ â†’ å¿—æ„¿å¡«æŠ¥æƒ…å†µæŸ¥è¯¢ ä¸­æŸ¥åˆ°æ‰€æœ‰è¯¾çš„å¿—æ„¿å¡«æŠ¥æƒ…å†µã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªå¿—æ„¿å¡«æŠ¥æƒ…å†µå¹¶éå®æ—¶æ›´æ–°ï¼Œè€Œæ˜¯åªä¼šåœ¨æ¯å¤© 8ã€12ã€16ã€20 ç‚¹æ›´æ–°ï¼Œä¸”é¢„é€‰é˜¶æ®µçš„æœ€åä¸€æ¬¡æ›´æ–°ä¼šåœ¨é¢„é€‰ç»“æŸå‰å››å°æ—¶å·¦å³ï¼Œæ‰€ä»¥ï¼Œä½ æŸ¥åˆ°çš„å¿—æ„¿å¡«æŠ¥æƒ…å†µå¯èƒ½å’Œæœ€ç»ˆçš„çœŸå®æƒ…å†µå·®åˆ«æå¤§ã€‚å¦‚ä½•é€‰æ‹©å¡«æŠ¥å¿—æ„¿çš„æ—¶æœºã€å¦‚ä½•æ ¹æ®æƒ…æŠ¥è°ƒæ•´è‡ªå·±çš„å¿—æ„¿ç­‰çº§ã€æ•™å¸ˆä¹ƒè‡³è¯¾ç¨‹é€‰æ‹©ï¼Œéƒ½æ˜¯ä¸€åœºæƒŠå¿ƒåŠ¨é­„çš„åšå¼ˆ ~~ï¼Œè¿™ä¹Ÿæ˜¯é¢„é€‰è¢«ç§°ä½œâ€œèµŒåœºâ€çš„é‡è¦åŸå› ä¹‹ä¸€~~ã€‚ï¼ˆåšå¼ˆæœ‰é£é™©ï¼Œæ¨èåŒå­¦ä»¬å°½æ—©å¡«æŠ¥çœŸå®å¿—æ„¿ï¼Œç’æŠ¥å¿—æ„¿å¯èƒ½å®³äººå®³å·±ã€‚ï¼‰

æŠ½ç­¾ç»“æœä¸€èˆ¬åœ¨é¢„é€‰ç»“æŸåå¥½å‡ å¤©æ‰ä¼šå…¬å¸ƒï¼ˆå¯èƒ½æ˜¯è¦å®‰æ’æ•™å®¤ã€å¿…è¦æ—¶è°ƒæ•´è¯¾å®¹é‡ä¹‹ç±»çš„ï¼‰ã€‚

åœ¨æŠ½ç­¾å®Œæˆåï¼Œå¯ä»¥åœ¨é€‰è¯¾ç³»ç»Ÿçš„è¯¾è¡¨æŸ¥è¯¢ä¸­æŸ¥çœ‹æŠ½ç­¾æƒ…å†µï¼Œé€‰ä¸Šçš„è¯¾ä¼šå’Œé¢„é€‰æ—¶ä¸€æ ·æ˜¯ <span style="color:#855512;">æ£•è‰²</span> çš„ï¼Œè€Œæ‰äº†çš„è¯¾åˆ™ä¼šæ˜¾ç¤ºä¸ºâ€œå€™é€‰â€å¹¶ä¸”æ˜¯ <span style="color:#6684A5;">è“è‰²</span> çš„ã€‚

#### æ­£é€‰ã€è¡¥é€€é€‰ã€Waiting List

æ‰€è°“çš„â€œæŠ¢è¯¾â€ä¸»è¦æŒ‡çš„å°±æ˜¯æ­£é€‰ï¼Œä»¥åŠè¡¥é€€é€‰ã€‚

è¿™ä¸¤è€…åœ¨é€‰è¯¾æ“ä½œä¸ŠåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œæœ€å¤§çš„åŒºåˆ«å°±æ˜¯æ­£é€‰åœ¨ä¸Šå­¦æœŸæœ«ã€é¢„é€‰ç»“æŸåä¸ä¹…è¿›è¡Œï¼Œè€Œè¡¥é€€é€‰åœ¨æ–°å­¦æœŸå¼€å§‹ä¸Šè¯¾åè¿›è¡Œï¼Œæ–°ç”Ÿé€‰è¯¾åˆ™æ²¡æœ‰æ­£é€‰ç¯èŠ‚ã€‚

åœ¨è¿™ä¸€ç¯èŠ‚ä¸­ï¼Œé€‰è¯¾ä¸å†ä»¥æŠ½ç­¾è¿›è¡Œï¼Œè€Œæ˜¯å…ˆåˆ°å…ˆå¾—ã€‚

åœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œé™¤äº†é€‰è¯¾ï¼Œè¿˜å¯ä»¥é€€é€‰ã€‚è¿™é‡Œå°±æ¶‰åŠåˆ°äº† *Waiting List* çš„æ¦‚å¿µã€‚é¡¾åæ€ä¹‰ï¼ŒWaiting Listï¼ˆç®€ç§° WLï¼‰å°±æ˜¯æ’é˜Ÿç­‰å¾…è¯¾ç¨‹å‘ä½ç©ºå‡ºæ¥ï¼Œè€Œç©ºå‡ºå‘ä½ä¸€èˆ¬å°±æ˜¯æœ‰äººé€€é€‰äº†ï¼ˆä¹Ÿå¯èƒ½æ˜¯è¯¾ç¨‹æ‰©å®¹äº†ï¼‰ã€‚å½“å‡ºç°æ–°çš„è¯¾ä½™é‡æ—¶ï¼Œæ’åœ¨ WL æœ€å‰ç«¯çš„äººå°±ä¼šé€’è¡¥é€‰ä¸Šè¿™é—¨è¯¾ã€‚å¯ä»¥é€‰æ‹©é€€å‡º WLï¼Œè¿™ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯é€€é€‰çš„ä¸€ç§ã€‚

ç‰¹åˆ«åœ°ï¼Œè¡¥é€€é€‰åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä½äºä¸Šè¯¾ç¬¬ä¸€å‘¨å’Œä¸Šè¯¾ç¬¬äºŒå‘¨ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µä¸­åªèƒ½é€€é€‰ä¸èƒ½è¡¥é€‰ã€‚

<Card title="é€€å‡º WL">

æƒ³é€‰çš„è¯¾åªè¦è‹¦è‹¦ç­‰å¾…å°±å¯èƒ½æœ‰æœºä¼šé€‰ä¸Šï¼Œä¸ºä»€ä¹ˆè¦é€€å‡ºå‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼š

1.  åŒä¸€ä¸ªè¯¾ç¨‹å·çš„è¯¾åªèƒ½é€‰ä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œä½ é€‰äº† A è€å¸ˆçš„æ•°å­¦åˆ†æï¼Œä¸å¹¸è¿›å…¥ WLï¼Œåªæœ‰é€€å‡º WL æ‰èƒ½å†é€‰ B è€å¸ˆçš„æ•°å­¦åˆ†æã€‚

2.  WL ä¸­çš„è¯¾ç¨‹ä¸å—å­¦åˆ†é™åˆ¶ï¼Œä½†é€’è¡¥æ—¶å—å­¦åˆ†é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œä½ å·²ç»é€‰æ‹©äº† 24 å­¦åˆ†çš„è¯¾ç¨‹ï¼Œå­¦åˆ†é™åˆ¶ä¸º 26ï¼Œä½ è¿˜æœ‰ä¸¤é—¨ 2 å­¦åˆ†çš„è¯¾ç¨‹ A å’Œ B åœ¨ WL ä¸­ï¼Œä½ æ¯”èµ· B æ›´æƒ³é€‰ä¸Š Aï¼Œå¹¶ä¸”ä¸¤é—¨è¯¾éƒ½æ’åœ¨ WL å‰ç«¯ï¼Œæœ‰å¸Œæœ›æˆåŠŸé€’è¡¥ã€‚ç¬¬äºŒå¤©æ—©ä¸Šï¼Œä½ èµ·æ¥ä¸€çœ‹ï¼Œä¸¤é—¨è¯¾éƒ½é€’è¡¥äº†ï¼Œä½† B å…ˆé€’è¡¥ä¸Šï¼Œå æ»¡äº†å­¦åˆ†é™åˆ¶ï¼Œæ‰€ä»¥åé€’è¡¥çš„ A å°±ç›´æ¥é€€å‡ºäº† WLï¼Œå¦‚æœæƒ³é€‰å°±å¾—å†æ’åœ¨ WL å°¾éƒ¨äº†ã€‚

    é™¤äº†åˆ é™¤ä¸å¿…è¦çš„ WLï¼Œè‹¥å­¦åˆ†å¯èƒ½å—é™è€Œé€’è¡¥å¸Œæœ›å¤§ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åˆ é™¤å·²ç»é€‰ä¸Šçš„è¯¾æ¥ä¸º WL ä¸­çš„è¯¾ç•™å‡ºå­¦åˆ†ã€‚

å¦‚ä½•é€€å‡º WL ä¹Ÿæ˜¯å›°æ‰°å¾ˆå¤šåŒå­¦çš„ä¸€å¤§éš¾é¢˜ï¼ˆ~~é€‰è¯¾ç³»ç»Ÿçš„ UI æ˜¯è°è®¾è®¡çš„~~ï¼‰ã€‚åœ¨ é€‰è¯¾æŸ¥è¯¢ â†’ é˜Ÿåˆ—ç³»ç»ŸæŸ¥è¯¢ é‡Œæ˜¯åªèƒ½æŸ¥è¯¢é˜Ÿåˆ—ä¿¡æ¯ä¸èƒ½é€€å‡ºé˜Ÿåˆ—çš„ï¼Œè¦åœ¨ é€‰è¯¾æ“ä½œ â†’ ä¸€çº§é€‰è¯¾ â†’ é˜Ÿåˆ—ä¿¡æ¯ é‡Œé€€å‡ºã€‚ï¼ˆçŸ¥é“åœ¨å“ªé€€ WL å¯èƒ½è®©ä½ åœ¨æ–°ç”Ÿç¬¬ä¸€æ¬¡è¡¥é€€é€‰ä¸­æŠ¢å å…ˆæœºï¼ˆ~~ä¹Ÿå¯èƒ½ä¸æ­¢æ–°ç”Ÿé‚£ä¸€æ¬¡ï¼Œç›´åˆ°é€‰å¤§äºŒçš„è¯¾çš„æ—¶å€™æˆ‘å®¤å‹è¿˜åœ¨é—®æˆ‘æ€ä¹ˆé€€ WL~~

</Card>

#### äºŒçº§é€‰è¯¾

äºŒçº§é€‰è¯¾ä¹Ÿæ˜¯å…ˆåˆ°å…ˆå¾—ï¼Œä¸€èˆ¬æ˜¯ç”¨æ¥åšå®éªŒä¹‹ç±»çš„ï¼Œåœ¨è¯¾ç¨‹ä¿¡æ¯ä¸­ä¼šæ ‡æ˜ä¸€ä¸ªè¯¾æ˜¯å¦æœ‰äºŒçº§é€‰è¯¾ï¼Œä½†é€‰è¯¾å‰ä¸ä¸€å®šä¼šå‘Šè¯‰ä½ æœ‰å“ªäº›æ—¶é—´æ®µå¯ä»¥é€‰ï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦é¢„ç•™å‡ºä¸€äº›æ—¶é—´ç»™äºŒçº§è¯¾ï¼Œä¸èƒ½é€‰å¤ªæ»¡æˆ–è€…å¤ªåˆ†æ•£ä»¥è‡³äºæ²¡æœ‰å¤§æ®µçš„ç©ºä½™æ—¶é—´ï¼ˆä¾å…·ä½“è¯¾ç¨‹è€Œå®šï¼Œå¯ä»¥è€ƒè™‘å’¨è¯¢å­¦é•¿å­¦å§ï¼‰ã€‚

æ•°å­¦è¯¾çš„ä¹ é¢˜è¯¾ä¹Ÿå¯èƒ½ä¼šè¢«æ ‡æ³¨æˆæœ‰äºŒçº§é€‰è¯¾ï¼Œä½†æˆ‘ç›®å‰ä¸Šè¿‡çš„æ•°å­¦è¯¾éƒ½ä¸ä¼šçœŸçš„è¿›è¡ŒäºŒçº§é€‰è¯¾ï¼Œè€Œæ˜¯ä¼šå’ŒåŒå­¦ä»¬ä¸€èµ·åå•†å‡ºä¹ é¢˜è¯¾çš„æ—¶é—´ã€‚

#### ç‰¹æ®ŠåŸå› è¡¥é€‰ï¼ˆæ‰‹é€‰ï¼‰

ç‰¹æ®ŠåŸå› è¡¥é€‰ï¼Œä¹Ÿç§°æ‰‹é€‰ï¼ˆæ‰‹åŠ¨é€‰è¯¾ï¼‰ï¼Œæ˜¯ä¸€ç§æ— è§†å…¶ä½™é€‰è¯¾è§„åˆ™çš„å­˜åœ¨ï¼ˆä¸å—è¯¾ç¨‹å®¹é‡ã€é™¢ç³»ä¸“ä¸šé™åˆ¶ã€ç”šè‡³ä¸Šè¯¾æ—¶é—´å†²çªç­‰æ¡ä»¶åˆ¶çº¦ï¼‰ï¼Œåªè¦ä»»è¯¾æ•™å¸ˆå’Œå¼€è¯¾é™¢ç³»åŒæ„ï¼ˆ~~è¿™æ˜¯å¯ä»¥â€œåªè¦â€çš„å—~~ å¦‚æœè¯¾å®¹é‡æ»¡äº†ï¼Œå¯èƒ½éœ€è¦è¯´æ˜å…·ä½“åŸå› ï¼Œä½†å¦‚æœåªæ˜¯å—åˆ°ä¸“ä¸šé™åˆ¶ä¹‹ç±»çš„è€Œè¯¾å®¹é‡æ²¡æ»¡ï¼Œè¿˜æ˜¯å¾ˆå¯èƒ½ç”³è¯·é€šè¿‡çš„ï¼‰ï¼Œå°±èƒ½é€‰ä¸Šè¯¾ã€‚ç”³è¯·æµç¨‹è¯¦è§ [ç½‘ä¸Šç‰¹æ®ŠåŸå› è¡¥é€‰è¯¾ç”³è¯·ç³»ç»Ÿæ“ä½œè¯´æ˜ï¼ˆå­¦ç”Ÿç¯‡ï¼‰.docx](https://jwcbg.cic.tsinghua.edu.cn/download.jsp?attachSeq=2962)

ç”±äºæ‰‹é€‰ä¸€èˆ¬å®‰æ’åœ¨å¼€å­¦åç¬¬äºŒå‘¨ï¼Œæœ€å¥½æ˜¯é€šè¿‡æå‰å’Œè€å¸ˆå‘é‚®ä»¶ç­‰æ–¹å¼ç¡®å®šèƒ½å¦æ‰‹é€‰ä¸Šï¼Œä¹Ÿå¯ä»¥ä¸€å¹¶äº†è§£ä¸Šè¯¾åœ°ç‚¹ä»¥åŠå‘å¸ƒç»™é€‰ä¸Šè¯¾çš„åŒå­¦çš„ç›¸å…³é€šçŸ¥ã€‚

#### è®° P/F

è®° P/F å³æˆç»©ä»¥ P(ass) æˆ– F(ailure) è®°å½•ï¼Œä¸è®°å½•å…·ä½“ç­‰çº§ï¼Œåªè¦è¿‡äº†å°±éƒ½ä¸€æ ·ã€‚è®° P/F çš„è¯¾ä¸ä¼šæœ‰ç»©ç‚¹ï¼Œä¹Ÿä¸ä¼šè®¡å…¥ GPAã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªæœ‰ä»»é€‰è¯¾å¯ä»¥è®° P/Fï¼Œå¿…ä¿®å’Œé™é€‰è¯¾ä¸èƒ½è®°ï¼Œå¹¶ä¸”æ¯å­¦æœŸæœ€å¤šåªèƒ½é€‰æ‹©ä¸€é—¨è¯¾è®° P/Fã€‚å®é™…æ“ä½œä¸­ï¼Œå¦‚æœæƒ³è®° P/F çš„è¯¾å®Œå…¨æ˜¯è‡ªå·±æ„Ÿå…´è¶£è€Œé€‰çš„ã€ä¸åœ¨åŸ¹å…»æ–¹æ¡ˆä¸­ï¼Œåº”è¯¥å°±å¯ä»¥æ”¾å¿ƒè®° P/Fï¼›è€Œå¦‚æœåœ¨åŸ¹å…»æ–¹æ¡ˆä¸­çš„è¯ï¼Œæœ€å¥½å’¨è¯¢ä¸€ä¸‹ï¼ˆæ•™åŠ¡ï¼‰è€å¸ˆæˆ–è€…è¾…å¯¼å‘˜ï¼Œä»¥å…å¯¹åŸ¹å…»æ–¹æ¡ˆçš„å®Œæˆæˆ–è€…ä¿ç ”ç­‰é€ æˆå½±å“ã€‚

é™¤äº†åœ¨è®° P/F é˜¶æ®µåœ¨é€‰è¯¾ç³»ç»Ÿä¸­ä¸»åŠ¨è®° P/Fï¼Œæœ‰çš„è¯¾ç¨‹ï¼ˆä¸€èˆ¬æ˜¯é€šè¯†è¯¾ã€é€‰ä¿®è¯¾ï¼‰ä¼šè‡ªå¸¦ P/Fï¼Œå³æ— éœ€æ‰‹åŠ¨é€‰æ‹©å°±ä»¥ P/F è®°å½•æˆç»©ï¼Œè¿™æ ·çš„ P/F ä¸ä¼šå ç”¨æ¯å­¦æœŸä¸€é—¨è¯¾çš„åé¢ï¼Œä¹Ÿä¸ä¼šå¯¹åŸ¹å…»æ–¹æ¡ˆçš„å®Œæˆé€ æˆå½±å“ã€‚æœ‰çš„è¯¾ç¨‹ä¼šåœ¨è¯¾ç¨‹ä»‹ç»ä¸­è¯´æ˜æ˜¯å¦è‡ªå¸¦ P/Fï¼Œè€Œæœ‰çš„è¯¾å°±éœ€è¦å’¨è¯¢å­¦é•¿å­¦å§æˆ–è€…ç­‰å¼€è¯¾åæ‰çŸ¥é“äº†ã€‚

#### é€€è¯¾

æ¯å­¦æœŸä¼šæœ‰ä¸¤æ¬¡é€€è¯¾é˜¶æ®µï¼Œä¸€èˆ¬å®‰æ’åœ¨æœŸä¸­é™„è¿‘ä»¥åŠæœŸä¸­åä¸€ä¸ªæœˆå·¦å³ã€‚åœ¨é€€è¯¾é˜¶æ®µé€€è¯¾ï¼Œé™¤éé€€æ‰çš„æ˜¯è¿˜æ²¡å¼€è¯¾çš„è¯¾ç¨‹ï¼ˆä¸€èˆ¬æ˜¯åœ¨ç¬¬ä¸€æ¬¡é€€è¯¾æ—¶é€€æ‰åå…«å‘¨å¼€è¯¾çš„è¯¾ç¨‹ï¼‰ï¼Œä¼šåœ¨æˆç»©å•ä¸Šè®°ä¸€ä¸ª â€œWâ€ï¼ˆW ~~onderful~~ ithdrewï¼‰ã€‚è¿™ä¸ª â€œWâ€ è²Œä¼¼ä¸ä¼šæœ‰ä»€ä¹ˆå®é™…çš„å½±å“ï¼Œä½†æ€»ä¹‹ä¼šæ˜¾ç¤ºåœ¨ä½ çš„æˆç»©å•ä¸Šã€‚

å¤§å®¶ä¸€èˆ¬ä¼šå› ä¸ºå¯¹è¯¾ç¨‹ä¸æ„Ÿå…´è¶£ã€å¯¹è‡ªå·±å‰åŠå­¦æœŸçš„å­¦ä¹ æƒ…å†µä¸æ»¡æ„ <del>ã€å¯¹æœŸä¸­è€ƒè¯•çš„æˆç»©ä¸æ»¡æ„</del> ç­‰åŸå› è€Œé€‰æ‹©é€€è¯¾ã€‚é€€è¯¾æ˜¯ä¸€ä»¶éœ€è¦æ…é‡è€ƒè™‘çš„äº‹ï¼Œå¦‚æœé€€æ‰çš„æ˜¯æ¯”è¾ƒé‡è¦çš„è¯¾ï¼Œå°±è¦è€ƒè™‘åˆ°é‡ä¿®å¸¦æ¥çš„å„æ–¹é¢çš„å½±å“ã€‚

<Card type="info" title="ç¬¬äºŒæ¬¡é€€è¯¾">

è‡ª 2023-2024 ç§‹å­£å­¦æœŸèµ·ï¼Œä½äºæœŸä¸­åçš„ç¬¬äºŒæ¬¡é€€è¯¾åªèƒ½é€€åå…«å‘¨å¼€è®¾çš„è¯¾ç¨‹ã€‚

</Card>

<Card title="æˆ‘åˆ°åº•æ˜¯åœ¨é€€è¯¾ï¼Œé€€è¯¾ï¼Œè¿˜æ˜¯é€€è¯¾ ğŸ˜µ â€”â€” åˆ è¯¾ vs é€€é€‰ vs é€€è¯¾">

åœ¨é¢„é€‰ã€æ­£é€‰/è¡¥é€€é€‰ã€é€€è¯¾ä¸‰ä¸ªä¸åŒçš„é˜¶æ®µï¼Œéƒ½æœ‰ç±»ä¼¼â€œé€€è¯¾â€çš„æ“ä½œã€‚å…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ä¸‰ä¸ªé˜¶æ®µä¸­çš„â€œé€€è¯¾â€åˆ†åˆ«åº”å½“å«åšä»€ä¹ˆï¼Œè€Œåœ¨å®é™…äº¤è°ˆä¸­ï¼ŒåŒå­¦ä»¬å¯èƒ½ä¼šæŠŠè¿™ä¸‰ç§â€œé€€è¯¾â€æ··ä¸ºä¸€è°ˆã€‚

åœ¨é¢„é€‰é˜¶æ®µï¼Œåˆ é™¤ä¸€é—¨è¯¾æ˜¯ä¸ä¼šæœ‰ä»»ä½•è´Ÿé¢å½±å“çš„ï¼Œé€‰ä¸€é—¨è¯¾å†åˆ æ‰å’Œä»æ¥æ²¡é€‰è¿‡å®Œå…¨ä¸€æ ·ï¼Œåˆ æ‰å†é€‰å’Œä¸åˆ ä¹Ÿå®Œå…¨ä¸€æ ·ï¼ˆå½“ç„¶ï¼Œä½ ä¼šéœ€è¦å¤šæ“ä½œä¸¤æ¬¡ï¼Œè€Œä¸”åˆ«äººçœ‹åˆ°çš„å¿—æ„¿å¡«æŠ¥æƒ…å†µå¯èƒ½ä¼šä¸ä¸€æ ·ï¼‰ã€‚

åœ¨æ­£é€‰/è¡¥é€€é€‰é˜¶æ®µï¼Œå¦‚æœé€€é€‰ä¸€é—¨è¯¾ï¼Œç©ºå‡ºæ¥çš„ä½ç½®å°±éšæ—¶å¯èƒ½è¢«ä»–äººæŠ¢èµ°ï¼Œä½†æˆç»©å•ä¸Šä¸ä¼šæœ‰ â€œWâ€ã€‚

åœ¨é€€è¯¾é˜¶æ®µé€€è¯¾ï¼Œå°±æ˜¯çœŸæ­£çš„é€€è¯¾äº†ï¼Œæ²¡æœ‰å†é€‰è¯¾çš„æœºä¼šï¼Œå¹¶ä¸”æˆç»©å•ä¸Šä¹Ÿä¼šæœ‰ä¸€ä¸ª â€œWâ€ã€‚

</Card>

## è¯¾ç¨‹ä¿¡æ¯ä¸é€‰è¯¾æ“ä½œ â€”â€” æ€ä¹ˆæ‰¾ä¸åˆ°è¦é€‰çš„è¯¾ï¼Ÿæ€ä¹ˆçŸ¥é“è¯¾åœ¨å“ªä¸Šå‘¢ï¼Ÿ

### åˆ‡æ¢å­¦æœŸ

é€‰è¯¾ç³»ç»Ÿçš„å·¦ä¸Šè§’ä¼šæœ‰ä¸€ä¸ªå­¦æœŸï¼Œé€‰è¯¾å‰éœ€è¦å…ˆç¡®è®¤æ²¡æœ‰é€‰é”™å­¦æœŸã€‚

### æŸ¥çœ‹è¯¾ç¨‹ä¿¡æ¯

åœ¨é€‰è¯¾ç³»ç»Ÿçš„ å¼€è¯¾ä¿¡æ¯ â†’ ä¸€çº§è¯¾å¼€è¯¾ä¿¡æ¯ ä¸­å¯ä»¥æ‰¾åˆ°å½“å‰å­¦æœŸæ‰€æœ‰è¯¾ç¨‹çš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨è¿™æœç´¢ä½ æƒ³ä¸Šçš„é€šè¯†é€‰ä¿®è¯¾æœ‰æ²¡æœ‰å¼€è¯¾ï¼ŒæŸ¥çœ‹è¯¾ç¨‹ç®€ä»‹ã€ä¸Šè¯¾æ—¶é—´ã€é€‰è¯¾è¦æ±‚ï¼ŒæŸ¥çœ‹æ•™å¸ˆä¿¡æ¯ï¼ˆåŒ…æ‹¬é‚®ç®±ï¼‰ã€‚

### é€‰è¯¾æ“ä½œä¸è¯¾ç¨‹å±æ€§

åœ¨ é€‰è¯¾æ“ä½œ â†’ ä¸€çº§é€‰è¯¾ ä¸­ï¼Œé¦–å…ˆçœ‹åˆ°çš„ä¼šæ˜¯å½“å‰å­¦æœŸçš„å¿…ä¿®è¯¾ã€‚å¦‚æœåœ¨å¿…ä¿®è¯¾å’Œé™é€‰è¯¾ï¼ˆä»¥åŠä½“è‚²è¯¾ï¼‰ä¸­éƒ½æ²¡æœ‰çœ‹åˆ°æƒ³æŠ¥çš„è¯¾ï¼Œå°±è¦åœ¨ä»»é€‰è¯¾ä¸­æ‰‹åŠ¨æœç´¢ã€‚

~~è¿™ä¸æ˜¯åºŸè¯å—~~ ä½†æ˜¯ï¼Œè¿™é‡Œçš„è¯¾ç¨‹å±æ€§å¯èƒ½å’Œä½ æƒ³åƒä¸­ä¸ä¸€æ ·ï¼Œå› ä¸ºåŒä¸€ä¸ªè¯¾ç¨‹åœ¨ä¸åŒåœ°æ–¹ä¼šæœ‰ä¸åŒçš„å±æ€§ï¼š

-   åœ¨åŸ¹å…»æ–¹æ¡ˆä¸­ä¼šæœ‰è¯¾ç¨‹å±æ€§ï¼Œä½ è®¤ä¸ºçš„è¯¾ç¨‹è¯¥æœ‰çš„å±æ€§å¾ˆå¯èƒ½å°±æ˜¯åŸ¹å…»æ–¹æ¡ˆä¸­çš„è¯¾ç¨‹å±æ€§ã€‚
-   é€‰è¯¾ç³»ç»Ÿä¸­çš„è¯¾ç¨‹å±æ€§å–å†³äºå½“å‰å­¦æœŸçš„æŒ‡å¯¼æ€§æ•™å­¦è®¡åˆ’ï¼Œæ‰€ä»¥ä¸‹å­¦æœŸçš„å¿…ä¿®è¯¾å¾ˆå¯èƒ½æ˜¯å½“å‰å­¦æœŸçš„ä»»é€‰è¯¾ã€‚ç‰¹åˆ«åœ°ï¼Œå¤–è¯­è¯¾æ€»æ˜¯ä»»é€‰è¯¾ï¼Œå¤§çº¦æ˜¯å› ä¸ºæ•™å­¦è®¡åˆ’ä¸­è™½ç„¶æœ‰å¤–è¯­è¯¾çš„ä½ç½®ï¼Œä½†æ¯äººè¦ä¸Šçš„å¤–è¯­è¯¾å…·ä½“æ˜¯å“ªä¸€é—¨æ˜¯ä¸ä¸€æ ·çš„ã€‚
-   info ä¸Šçš„æˆç»©å•ä»¥åŠåŸ¹å…»æ–¹æ¡ˆå®Œæˆæƒ…å†µä¸­ä¼šå¦æœ‰ä¸€å¥—è¯¾ç¨‹å±æ€§ï¼Œå¤§è‡´æ˜¯é™é€‰è¯¾å˜æˆäº†å¿…ä¿®ï¼Œä»»é€‰è¯¾å˜æˆäº†é™é€‰ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå†³å®šå¿—æ„¿ä¼˜å…ˆçº§çš„è¯¾ç¨‹å±æ€§ä¹Ÿæ˜¯ç”±æ•™å­¦è®¡åˆ’å†³å®šçš„ï¼Œè¿™ä¹Ÿæ˜¯é¼“åŠ±å¤§å®¶æŒ‰æ•™å­¦è®¡åˆ’é€‰æ‹©å¿…ä¿®è¯¾ï¼Œå¦‚æœé”™è¿‡äº†å¿…ä¿®è¯¾åœ¨æ•™å­¦è®¡åˆ’çš„å­¦æœŸï¼Œä¹‹åçš„å¿—æ„¿ç­‰çº§å¯èƒ½å°±æ˜¯ä»»é€‰äº†ã€‚

### æ•™å®¤ä½ç½®æŸ¥çœ‹

æ•™å®¤çš„ä½ç½®åœ¨é¢„é€‰æ—¶æ˜¯å°šæœªå®‰æ’å¥½çš„ï¼Œè¦åœ¨é¢„é€‰ç»“æœå‡ºæ¥åæ‰èƒ½åœ¨è¯¾è¡¨ç­‰ä½ç½®çœ‹åˆ°æ•™å®¤åœ¨å“ªã€‚

åœ¨ [courseX](https://tsinghua.app/courses) ä¸Šå¯ä»¥çœ‹åˆ°ä»–äººåˆ†äº«çš„æ•™å®¤ä½ç½®ä¿¡æ¯ï¼Œä½†ä¸ä¸€å®šå…¨ã€‚è¿™äº›ä¿¡æ¯ä¸»è¦æ˜¯ [learnX](https://tsinghua.app/learnX) åœ¨ç”¨æˆ·ä¸»åŠ¨åŒæ„åè‡ªåŠ¨æ”¶é›†çš„ï¼ŒlearnX æ˜¯å¯¹ [ç½‘ç»œå­¦å ‚](https://learn.tsinghua.edu.cn) éå¸¸å¥½çš„è¡¥å……ï¼Œæ¨èä½¿ç”¨ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶èƒ½åœ¨è®¾ç½®ä¸­å¼€å¯è¯¾ç¨‹ä¿¡æ¯å…±äº«ã€‚

### å…³äºä¸Šè¯¾æ—¶é—´

ä¸Šè¯¾æ—¶é—´ä¸€èˆ¬ä¼šä»¥å¤§èŠ‚ç¼–å·å’Œå‘¨æ•°çš„å½¢å¼å‘ˆç°ï¼Œä¾‹å¦‚ \`1-1(å…¨å‘¨),3-4(å…¨å‘¨)\` è¡¨ç¤ºæ¯å‘¨ä¸€ç¬¬ä¸€å¤§èŠ‚å’Œæ¯å‘¨ä¸‰ç¬¬å››å¤§èŠ‚ä¸Šè¯¾ï¼Œ\`4-6(å‰å…«å‘¨)\` è¡¨ç¤ºå‰å…«å‘¨å‘¨å››ç¬¬å…­å¤§èŠ‚ä¸Šè¯¾ã€‚

æ¯å¤§èŠ‚çš„å…·ä½“æ—¶é—´å¯ä»¥åœ¨è¯¾è¡¨ä¸­æŸ¥çœ‹ã€‚ä¸€å¤§èŠ‚ä¸€èˆ¬æ˜¯ä¸¤å°èŠ‚è¯¾å„ 45min ä¸­é—´æœ‰ 5min ä¼‘æ¯ï¼Œä½†ç¬¬äºŒå¤§èŠ‚å’Œç¬¬å…­å¤§èŠ‚éƒ½æœ‰ä¸‰å°èŠ‚ï¼Œæœ‰çš„è¯¾ä¼šä¸Šæ»¡ä¸‰å°èŠ‚ï¼Œè€Œæœ‰çš„è¯¾ä¼šåªä¸Šä¸¤å°èŠ‚ï¼Œè€Œè¿™ä¸€èˆ¬å¯ä»¥é€šè¿‡è¯¾ç¨‹çš„å­¦åˆ†çœ‹å‡ºæ¥ï¼Œæ¯ä¸€å­¦åˆ†å¯¹åº”å…¨å‘¨çš„ä¸€å°èŠ‚è¯¾ï¼Œä¹Ÿå°±æ˜¯å…«å‘¨çš„ä¸¤å°èŠ‚è¯¾ã€‚å¦‚æœä¸€ä¸ª 4 å­¦åˆ†çš„è¯¾åœ¨å…¨å‘¨çš„ä¸€ä¸ªç¬¬äºŒå¤§èŠ‚å’Œä¸€ä¸ªç¬¬ä¸‰å¤§èŠ‚ä¸Šï¼Œé‚£å¾ˆæœ‰å¯èƒ½å°±æ˜¯ç¬¬äºŒå¤§èŠ‚åªä¸Šä¸¤å°èŠ‚ã€‚ç‰¹åˆ«åœ°ï¼Œæ€æƒ³é“å¾·ä¸æ³•æ²»ã€ä¸­å›½è¿‘ç°ä»£å²çº²è¦ã€é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç†ç­‰è¯¾ç¨‹ä¼šæ¯”å­¦æ—¶å¯¹åº”çš„å­¦åˆ†å¤šä¸€åˆ†ï¼Œè¿™ä¸‰èŠ‚è¯¾åˆ†åˆ«æ˜¯ 3ã€3ã€4 å­¦åˆ†ï¼Œä½†åˆ†åˆ«å¯¹åº”å…¨å‘¨ä¸Š 2ã€2ã€3 å°èŠ‚ã€‚

## ä½“è‚²è¯¾ â€”â€” ä¸ºä»€ä¹ˆ 26 åˆ†çš„é™åˆ¶ TA å¯ä»¥æŠ¥ 28 åˆ†è¿˜ä¸ç”¨ç”³è¯·ç‰¹æ‰¹å­¦åˆ†ï¼Ÿ

ä½“è‚²è¯¾åœ¨é€‰è¯¾ä¸­æœ‰ä¸€äº›ç‰¹æ®Šä¹‹å¤„ï¼š

1.  ä½“è‚²è¯¾æ˜¯ä¸å ç”¨å­¦åˆ†é™åˆ¶çš„
2.  ä½“è‚²è¯¾åœ¨é€‰è¯¾æ—¶å…·æœ‰å•ç‹¬çš„è¯¾ç¨‹å±æ€§ï¼Œç®—åœ¨å¿…é™ä»»ä¹‹å¤–ï¼ˆè¿™ä¹Ÿæ˜¯æœ‰äººæ‰¾ä¸åˆ°æˆ–è€…å¿˜è®°æŠ¥ä½“è‚²è¯¾çš„ä¸€å¤§åŸå› ï¼‰
3.  ä½“è‚²è¯¾è™½ç„¶åªèƒ½ä¸Šä¸€é—¨ï¼Œä½†é¢„é€‰æ—¶å¯ä»¥æŠ¥å¾ˆå¤šé—¨ï¼Œç­‰çº§é«˜çš„å¿—æ„¿ä¼˜å…ˆé€‰ä¸Šï¼Œç­‰çº§ä½çš„å¿—æ„¿å°±ä¼šè‡ªåŠ¨å–æ¶ˆ
4.  å¦‚æœä½“è‚²è¯¾æŒ‚ç§‘äº†ï¼Œé‡ä¿®é€‰è¯¾æ—¶ä¼šæœ‰ç‰¹æ®Šçš„æµç¨‹ï¼Œè¯¦è§â€œé€‰è¯¾æ—¶é—´å®‰æ’â€

æ­£å› ä¸ºå‰ä¸‰ç‚¹ï¼Œå¯ä»¥å¤šæŠ¥å‡ é—¨ä½“è‚²è¯¾ï¼Œæé«˜é€‰ä¸Šæƒ³ä¸Šçš„è¯¾çš„æ¦‚ç‡ï¼Œæ—¢ä¸ä¼šå ç”¨å­¦åˆ†é™åˆ¶ä¹Ÿä¸ä¼šæµªè´¹ä¸€äºŒå¿—æ„¿ã€‚
`},{title:b,tags:"caddy-security uptime-kuma caddy server é—®é¢˜è§£å†³è®°å½•",content:`[Caddy Security](https://authp.github.io/) ä¸ä»…ä¼šå°†æœªç»è®¤è¯çš„è®¿é—®è€…æ‹’ä¹‹é—¨å¤–ï¼Œä¹Ÿä¼šæ‹¦ä½ [~~å¯çˆ±çš„ kuma é…±~~ Uptime Kuma](https://uptime.kuma.pet/)ã€‚è¿™é‡Œä¼šåˆ†äº«ä¸€ä¸‹æˆ‘çš„ä¸€ä¸ªæ”¾è¿‡ kuma çš„å°æŠ€å·§ã€‚



~~ï¼ˆP.S. è¿™æ˜¯ä¸æ˜¯åº”è¯¥ç®—â€œç»éªŒåˆ†äº«â€è€Œä¸æ˜¯â€œé—®é¢˜è§£å†³è®°å½•â€ï¼Œè¿™ä¸¤ä¸ª tag çš„åˆ†ç•Œçº¿åˆ°åº•åœ¨å“ªå‘¢ï¼‰~~

## é—®é¢˜æè¿°

[Caddy Security](https://authp.github.io/) å¯ä»¥ä¸º [Caddy](https://caddyserver.com/) ä¸Šçš„è·¯ç”±æä¾›èº«ä»½è®¤è¯ï¼Œè€Œè¿™ä¸€è®¤è¯å‘ç”Ÿåœ¨è¿æ¥åˆ°æœåŠ¡ä¹‹å‰ï¼Œæ‰€ä»¥å¦‚æœä¸é€šè¿‡è®¤è¯å°±æ— æ³•é€šè¿‡ç½‘ç»œè®¿é—®æ¥è·çŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œè¿›è€Œå½±å“åˆ° [Uptime Kuma](https://uptime.kuma.pet/) çš„è¿ä½œã€‚

## åˆæ­¥è§£å†³æ–¹æ¡ˆï¼Œä»¥åŠå­˜åœ¨çš„é—®é¢˜

ä¸€ä¸ªè‡ªç„¶çš„æƒ³æ³•æ˜¯ï¼Œå¯ä»¥å…³é—­ä¸€äº›éæ•æ„Ÿè·¯ç”±çš„èº«ä»½è®¤è¯ï¼Œç”¨äº uptime ç›‘æ§ã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªæœåŠ¡çš„é¦–é¡µå¯èƒ½æ˜¯éæ•æ„Ÿå¯ä»¥å…¬å¼€çš„ï¼Œæ•æ„Ÿä¿¡æ¯éƒ½ä½äºå…¶å®ƒè·¯ç”±ï¼Œåˆ™å¯ä»¥ï¼š

\`\`\`caddyfile
example.com {
    handle / {
        reverse_proxy localhost:2333
    }
    authenticate with some-auth-policy
    reverse_proxy localhost:2333
}
\`\`\`

è¿™çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†é—®é¢˜åœ¨äºï¼Œä¸€ä¸ªç½‘é¡µå¾€å¾€ä¸åªæ˜¯è¿™ä¸ªè·¯å¾„æœ¬èº«ï¼Œè¿˜æœ‰ jsã€css ç­‰èµ„æºéœ€è¦ä½¿ç”¨ã€‚Caddy Security åªä¼šåœ¨è®¿é—®éœ€è¦è®¤è¯çš„ç½‘é¡µæ—¶è¿›è¡Œè®¤è¯ï¼Œè€Œä¸ä¼šåœ¨åŠ è½½éœ€è¦è®¤è¯çš„èµ„æºæ—¶è¿›è¡Œè®¤è¯ã€‚å¦‚æœè®¿é—®ä¸€ä¸ªæ— éœ€è®¤è¯çš„ç½‘é¡µï¼Œä½†å…¶ä½¿ç”¨çš„èµ„æºéœ€è¦è®¤è¯ï¼Œè¿™äº›èµ„æºå°±å¯èƒ½åŠ è½½ä¸å‡ºæ¥ã€‚

å°†è¿™äº›èµ„æºå…¨éƒ¨åˆ—å‡ºæ¥ä¼šå¾ˆéº»çƒ¦ï¼Œå¦‚æœå¤„ç†ä¸å½“ä¹Ÿæœ‰æ³„éœ²æ•æ„Ÿä¿¡æ¯çš„é£é™©ã€‚

## è§£å†³æ–¹æ¡ˆ: ç»™ kuma ä¸€ä¸ªå•ç‹¬çš„è·¯ç”±

ä¸Šé¢çš„æ–¹æ¡ˆçš„é—®é¢˜åªå¯¹äººç±»è®¿é—®è€…æœ‰å½±å“ï¼Œè€Œè§£å†³äº† kuma çš„é—®é¢˜ã€‚æ‰€ä»¥å¯ä»¥ä½¿ç”¨åŒæ ·çš„æ€è·¯ï¼Œä½†åªå½±å“ kuma è€Œä¸å½±å“è®¿é—®è€…ï¼š

\`\`\`caddyfile
example.com {
    handle /for_uptime_kuma {
        uri replace /for_uptime_kuma /
        reverse_proxy localhost:2333
    }
    authenticate with some-auth-policy
    reverse_proxy localhost:2333
}
\`\`\`

ç„¶ååœ¨ Uptime Kuma ä¸­æŠŠç›‘æ§ç½‘å€è®¾æˆ \`https://example.com/for_uptime_kuma\` å³å¯ã€‚

å¦‚æœåœ¨å¤šä¸ªè·¯ç”±éƒ½ç”¨åˆ°è¿™ä¸ªæ“ä½œï¼Œæ¯æ¬¡é‡å¤ä¼šæ¯”è¾ƒç¹çï¼Œå¯ä»¥ä½¿ç”¨ [Caddy çš„ snippet åŠŸèƒ½](https://caddyserver.com/docs/caddyfile/concepts#snippets)ï¼š

\`\`\`caddyfile
(kuma) {
    handle /for_uptime_kuma {
        uri replace /for_uptime_kuma {args.1}
        reverse_proxy localhost:{args.0}
    }
}

homepage-public.example.com {
    import kuma 2333 /
    authenticate with some-auth-policy
    reverse_proxy localhost:2333
}

public-public.example.com {
    import kuma 6666 /public
    authenticate with some-auth-policy
    reverse_proxy localhost:6666
}
\`\`\`

## å¦ä¸€ç§è§£å†³æ–¹æ¡ˆ: ä½¿ç”¨éç½‘é¡µèµ„æºè¿›è¡Œç›‘æ§

æ—¢ç„¶é‡åˆ°çš„é—®é¢˜æ˜¯ç½‘é¡µä¼šéœ€è¦èµ„æºï¼Œåªæ”¾å¼€ç½‘é¡µçš„è®¤è¯ä¼šåŠ è½½ä¸å‡ºèµ„æºï¼Œå¦ä¸€ä¸ªæ€è·¯å°±æ˜¯ç›‘æ§èµ„æºè€Œéç½‘é¡µï¼ˆä¸ä¸€å®šæ˜¯ jsã€css è¿™äº›ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯ä»¥å…¬å¼€çš„ APIï¼Œæˆ–è€…å‡ ä¹ä¸ä¼šè¢«è®¿é—®æˆ–è®¿é—®æ—¶ä¸€å®šå·²ç»è®¤è¯äº†çš„ç½‘é¡µä¹‹ç±»çš„ï¼‰ã€‚è¿™æ¯”è¾ƒç®€å•ï¼Œå°±ä¸å¤šè®²äº†ã€‚
`},{title:h,tags:t,content:`[CS:APP](https://csapp.cs.cmu.edu/) ç¬¬äºŒç«  â€œRepresenting and Manipulating Informationâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

è¿™ç« çš„ä¸»è¦å†…å®¹ä¸º byteã€æ•´æ•°å’Œæµ®ç‚¹æ•°çš„å­˜å‚¨åŠè®¡ç®—ã€‚



## Information Storage

byte è€Œé bit æ˜¯ memory çš„åŸºæœ¬å•ä½ï¼Œmemory å¯ä»¥çœ‹ä½œ array of bytesã€‚

ä¸€ä¸ª byte å¸¸ç”¨ä¸¤ä¸ªåå…­è¿›åˆ¶æ•°ç è¡¨ç¤ºã€‚

word size è¡¨ç¤º virtual memory çš„ä½æ•°ï¼ˆå¤§å°ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æŒ‡é’ˆçš„ä½æ•°ã€‚åœ¨ C è¯­è¨€ä¸­ï¼Œword size ä¹Ÿä¼šå½±å“åˆ°æ•´å‹çš„å¤§å°ã€‚

### Byte Ordering

å¾ˆå¤šæ—¶å€™ï¼Œå•ä¸ªæ•°æ®éœ€è¦ç”¨å¤šä¸ª byte è¡¨ç¤ºï¼Œäºæ˜¯å°±æœ‰ä¸¤ç§å¯èƒ½çš„ byte ordering: big endian å’Œ little endianã€‚

å¦‚æœæŠŠæ¯ä¸ª byte çœ‹ä½œä¸€ä¸ªâ€œæ•°ä½â€ï¼Œè€ŒæŠŠç”±å¤šä¸ª byte ç»„æˆçš„å•ä¸ªæ•°æ®çœ‹ä½œä¸€ä¸ªâ€œ256 è¿›åˆ¶æ•°â€ï¼Œé‚£ä¹ˆ big endian å°±æ˜¯ä»é«˜ä½å¼€å§‹â€œä¹¦å†™â€ï¼Œlittle endian å°±æ˜¯ä»ä½ä½å¼€å§‹â€œä¹¦å†™â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œbig endian çœ‹ä¸Šå»æ˜¯æ›´åŠ ç¬¦åˆäººç±»çš„â€œä¹¦å†™ä¹ æƒ¯â€çš„ï¼Œè€Œ little endian åˆ™åƒæ˜¯æŠŠ 1234 å†™æˆ 4321ã€‚ä½†æ˜¯ï¼Œlittle endian ä¼šæŠŠä½ä½å­˜åœ¨ä½åœ°å€ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´åˆæ›´åŠ â€œè‡ªç„¶â€ä¸€äº›ã€‚

ç”±äº byte æ˜¯ memory çš„åŸºæœ¬å•ä½ï¼Œendian å½±å“çš„æ˜¯ byte çš„æ’åˆ—é¡ºåºï¼Œè€Œä¸æ˜¯ bit çš„æ’åˆ—é¡ºåºã€‚å¦‚æœæŠŠä¸€ä¸² byte åˆ†åˆ«ç”¨ big endian å’Œ little endian å†™å‡ºæ¥ï¼Œä¾‹å¦‚ big endian \`0x1234\`ï¼Œlittle endian \`0x3412\`ï¼Œå¯èƒ½ä¼šæ„Ÿè§‰ endian ä¸å½±å“â€œbyte å†…éƒ¨çš„é¡ºåºâ€å¾ˆå¥‡æ€ªï¼Œä½†å…¶å® \`0x12\` å’Œ \`0x34\` åªæ˜¯ byte çš„ä¸€ç§è¡¨ç¤ºæ–¹å¼ï¼Œå¹¶ä¸ä»£è¡¨â€œbyte å†…éƒ¨çš„é¡ºåºâ€ã€‚ä¸Šé¢è¯´â€œæŠŠç”±å¤šä¸ª byte ç»„æˆçš„å•ä¸ªæ•°æ®çœ‹ä½œä¸€ä¸ªâ€˜256 è¿›åˆ¶æ•°â€™â€ï¼Œä¹Ÿæ˜¯è€ƒè™‘åˆ° 10 è¿›åˆ¶æ•°çš„â€œåè¿‡æ¥å†™â€æ˜¯ä¸ºäººç†ŸçŸ¥çš„ï¼Œè¿™æ ·çš„è¯ç”¨â€œ256 è¿›åˆ¶æ•°â€æ¥ä½œç±»æ¯”ä¼šæ¯”è¾ƒå¥½ç†è§£ä¸”ä¸å®¹æ˜“è¯¯è§£ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œbyte ordering å¯¹äºç¨‹åºå‘˜æ¥è¯´æ˜¯æ— å…³ç´§è¦çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦å°†æ•°æ®ä¸å¤–ç•Œåˆ†äº«ï¼ˆä¾‹å¦‚é€šè¿‡ç½‘ç»œä¼ è¾“ï¼‰ï¼Œæˆ–è€…éœ€è¦æŸ¥çœ‹åŸå§‹çš„ byte arrayï¼ˆåœ¨ machine-level program ä¸­ï¼‰ï¼Œæˆ–è€…éœ€è¦é€šè¿‡ç±»å‹è½¬æ¢ã€union ç­‰æ–¹å¼ç»•å¼€ C è¯­è¨€çš„ç±»å‹ç³»ç»Ÿï¼Œåˆ™ byte ordering ä¼šéå¸¸é‡è¦ã€‚

å­—ç¬¦ä¸²çš„è¡¨ç¤ºæ˜¯ä¸å— byte ordering å½±å“çš„ã€‚

### ä½è¿ç®—

ä¸»è¦æ˜¯å·¦ç§»ã€å³ç§»ï¼Œå…¶å®ƒæ˜¯ç†ŸçŸ¥çš„ã€‚

å·¦ç§»æ—¶é«˜ä½ä¼šè¢«ä¸¢å¼ƒï¼Œä½ä½ä¼šå¡«å……é›¶ã€‚

å³ç§»åˆ™æœ‰ä¸¤ç§: é€»è¾‘å³ç§»å’Œç®—æœ¯å³ç§»ã€‚ä¸¤è€…éƒ½æ˜¯ä¸¢å¼ƒä½ä½ï¼Œä½†é€»è¾‘å³ç§»æ˜¯é«˜ä½å¡«é›¶ï¼Œç®—æœ¯å³ç§»æ˜¯é«˜ä½å¡«åŸæ¥æœ€é«˜ä½çš„å€¼ã€‚

åœ¨ C è¯­è¨€ä¸­ï¼Œunsigned integer ä¸€å®šæ˜¯é€»è¾‘å³ç§»ï¼Œè€Œ signed integer åˆ™ä¸€èˆ¬æ˜¯ç®—æœ¯å³ç§»ã€‚

ç®—æœ¯å³ç§»çš„è¡Œä¸ºæ˜¯ä¸ºäº†åœ¨ä½¿ç”¨è¡¥ç è¡¨ç¤ºè´Ÿæ•°æ—¶å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚

åœ¨ä½ç§»è¿‡å¤§ï¼ˆè¶…è¿‡ word sizeï¼‰æ—¶ï¼Œè¡Œä¸ºæ˜¯ä¸ç¡®å®šçš„ï¼Œä½†ä¸€èˆ¬ä¼šå°†ä½ç§»å¯¹ word size å–æ¨¡ã€‚

## Integer Representations

### æ•´å‹ç¼–ç 

unsigned integer çš„ç¼–ç å°±æ˜¯æ™®é€šçš„äºŒè¿›åˆ¶ã€‚

signed integer ä¸€èˆ¬é‡‡ç”¨è¡¥ç  (twoâ€™s-complement encoding)ï¼Œå³åœ¨ word size ä¸º $w$ æ—¶æœ€é«˜ä½è¡¨ç¤º $-2^{w-1}$ è€Œé $2^{w-1}$ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€é«˜ä½ä¸º 0 è¡¨ç¤ºéè´Ÿï¼Œä¸º 1 è¡¨ç¤ºè´Ÿæ•°ï¼›åœ¨æœ€é«˜ä½ä¸º 0 æ—¶å’Œ unsigned integer æ˜¯ä¸€è‡´çš„ï¼Œè€Œåœ¨æœ€é«˜ä½ä¸º 1 æ—¶æ˜¯åŒæ ·ç¼–ç çš„ unsigned integer å‡å» $2^w$ã€‚

### signed unsigned è½¬æ¢

åœ¨ C è¯­è¨€ä¸­ï¼Œåœ¨åŒæ ·é•¿åº¦çš„ signed å’Œ unsigned ä¹‹é—´è½¬æ¢æ—¶ï¼Œè™½ç„¶ä¸ä¸€å®šï¼Œä½†ä¸€èˆ¬æ˜¯ä¸æ”¹å˜ç¼–ç åœ°åªè¿›è¡Œç±»å‹çš„è½¬æ¢ã€‚

è‹¥ç®—æœ¯è¿ç®—ç¬¦çš„ä¸¤ä¾§åˆ†åˆ«æ˜¯ signed å’Œ unsignedï¼Œåˆ™ä¼šå°† signed éšå¼è½¬æ¢ä¸º unsignedï¼Œè¿™åœ¨è¿ç®—ç¬¦ä¸ºæ¯”è¾ƒè¿ç®—ç¬¦æ—¶å°¤å…¶å¯èƒ½å¯¼è‡´æ„å¤–çš„ç»“æœï¼Œä¾‹å¦‚ \`-1 > 0u\`ã€‚

<Card type="warn">
ç”±äº signed ä¸ unsigned è½¬æ¢å¯èƒ½å¸¦æ¥æ„å¤–çš„ç»“æœï¼Œå¾ˆå¤šæ—¶å€™æœ€å¥½é¿å…ä½¿ç”¨ unsigned integerã€‚å¦‚æœè¦å°† signed å’Œ unsigned æ”¾åœ¨åŒä¸€ä¸ªè¡¨è¾¾å¼ä¸­è¿ç®—ä¸€èˆ¬æ˜¯ä¼šæœ‰ warning çš„ï¼Œå¦‚æœè¦æ˜¾å¼è¿›è¡Œè½¬æ¢åˆ™è¦å°å¿ƒã€‚
</Card>

### æ•´å‹å¢é•¿

å°†æŸä¸ªé•¿åº¦çš„ unsigned integer è½¬æ¢ä¸ºæ›´é•¿çš„ unsigned integer æ—¶ï¼Œä¼šåœ¨é«˜ä½è¡¥é›¶ã€‚

å°†æŸä¸ªé•¿åº¦çš„ signed integer è½¬æ¢ä¸ºæ›´é•¿çš„ signed integer æ—¶ï¼Œä¼šåœ¨é«˜ä½è¡¥åŸæ¥çš„æœ€é«˜ä½ï¼Œç±»ä¼¼äº arithmetic right shiftï¼Œä»¥ä¿è¯è½¬æ¢åæ•°å€¼ä¸å˜ã€‚

å¦‚æœä¸€ä¸ªç±»å‹è½¬æ¢æ—¢è¦å¢é•¿åˆè¦è½¬å˜ signed/unsignedï¼Œä¼šå…ˆè½¬æ¢é•¿åº¦å†è½¬æ¢ signed/unsignedã€‚

### æ•´å‹ç¼©çŸ­

æ— è®ºæ˜¯ signed è¿˜æ˜¯ unsignedï¼Œåœ¨ç¼©çŸ­æ•´å‹æ—¶ä¼šç›´æ¥å°†é«˜ä½æˆªå»ã€‚åœ¨æ–°çš„æ•´å‹é•¿åº¦ä¸º $w$ æ—¶ï¼Œè¿™ç›¸å½“äºå¯¹ $2^w$ å–æ¨¡ã€‚

## Integer Arithmetic

### åŠ æ³•å’Œå–å

unsigned integer çš„åŠ æ³•ï¼šæ¨¡ $2^w$ã€‚

åˆ¤æ–­ unsigned integer åŠ æ³•æ˜¯å¦å‘ç”Ÿæº¢å‡ºï¼š\`x + y\` æº¢å‡ºå½“ä¸”ä»…å½“ \`x + y < x\`ã€‚

unsigned integer å–åï¼š$x \\mapsto \\begin{cases} 0 & x = 0 \\\\ 2^w - x & x > 0 \\end{cases}$

å–åæœ‰ä¸¤ç§è®¡ç®—æ–¹å¼ï¼š

-   æŒ‰ä½å–åååŠ ä¸€ï¼›
-   æˆ–è€…æ‰¾åˆ°äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æœ€ä½ä½çš„ \`1\` ç„¶åå°†æ¯”è¿™ä¸€ä½é«˜çš„ä½å–åã€‚

signed integer çš„åŠ æ³•ï¼šæŠŠç¼–ç å½“ä½œ unsigned integer ç®—ï¼Œå°±å¯ä»¥å®ç° positive overflow å’Œ negative overflow çš„æ•ˆæœï¼Œå³ overflow åä¿æŒæ¨¡ $2^w$ ä¸å˜ã€‚

åˆ¤æ–­ signed integer åŠ æ³•æ˜¯å¦å‘ç”Ÿæº¢å‡ºï¼š\`x + y\` positive overflow å½“ä¸”ä»…å½“ \`x > 0 && y > 0 && x + y <= 0\`ï¼Œnegative overflow å½“ä¸”ä»…å½“ \`x < 0 && y < 0 && x + y >= 0\`ã€‚

signed integer å–å: æŠŠç¼–ç å½“ä½œ unsigned integer æ¥å–åå³å¯ï¼Œè¡¨ç°ä¸ºï¼Œèƒ½è¡¨ç¤ºçš„æœ€å°å€¼å–åå¾—åˆ°è‡ªèº«ï¼Œå…¶å®ƒå€¼å–åå°±æ˜¯å…¶ç›¸åæ•°ã€‚

<Card type="warn">
signed integer å–æœ€å°å€¼æ—¶å–åå¾—åˆ°è‡ªèº«è€Œéå…¶ç›¸åæ•°ï¼Œè¿™å¯èƒ½ä¼šæ˜¯è¢«å¿½è§†çš„ corner case è€Œå¯¼è‡´ bugã€‚
</Card>

### ä¹˜æ³•

æ— è®º signed integer è¿˜æ˜¯ unsigned integerï¼Œä¹˜æ³•éƒ½æ˜¯ä¸¢å¼ƒé«˜ä½å³æ¨¡ $2^w$ï¼Œä¸”åœ¨ç¼–ç ä¸Šæ˜¯ç­‰ä»·çš„ã€‚

å¦‚æœä¹˜æ³•è¿ç®—ä¸­çš„æŸä¸ªå› æ•°æ˜¯å¸¸æ•°ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šæŠŠä¹˜æ³•ä¼˜åŒ–ä¸ºä½ç§»å’ŒåŠ æ³•çš„ç»„åˆã€‚æ˜¯å¦ä»¥åŠå¦‚ä½•è¿›è¡Œä¼˜åŒ–å–å†³äºå¸¸æ•°çš„å€¼ä»¥åŠç›¸å…³æŒ‡ä»¤ï¼ˆåŠ æ³•ã€ä½ç§»ã€ä¹˜æ³•ï¼Œå¯èƒ½è¿˜æœ‰ \`LEA\` ç­‰æŒ‡ä»¤ï¼‰çš„ç›¸å¯¹é€Ÿåº¦ï¼Œä¸å…·ä½“æœºå™¨å¯†åˆ‡ç›¸å…³ã€‚

### é™¤ä»¥ 2 çš„å¹‚

å¦‚æœé™¤æ³•è¿ç®—ä¸­é™¤æ•°æ˜¯ 2 çš„å¹‚ï¼Œç¼–è¯‘å™¨ä¼šå°†é™¤æ³•ä¼˜åŒ–ä¸ºå³ç§»ã€‚

### æ€»ç»“

è®¡ç®—æœºçš„æ•´æ•°è¿ç®—æ€»çš„æ¥è¯´é€šè¿‡å–æ¨¡æ¥å¤„ç†æº¢å‡ºï¼Œè€Œä½¿ç”¨è¡¥ç è¡¨ç¤º signed integer å¯ä»¥ä½¿ signed integer å’Œ unsigned integer çš„è¿ç®—åœ¨ç¼–ç å±‚é¢ä¸Šçš„å®ç°ç›¸åŒã€‚

## Floating Point

### IEEE æµ®ç‚¹è¡¨ç¤º

æµ®ç‚¹æ•°å¤§ä½“ä¸Šæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œå½¢å¦‚ $(-1)^s \\times M \\times 2^E$ã€‚

IEEE æµ®ç‚¹è¡¨ç¤ºçš„ç¼–ç åŒ…å«ä¸‰éƒ¨åˆ†ï¼š

1.  sign bitï¼Œè¡¨ç¤º $s$
2.  exponent fieldï¼Œè¡¨ç¤º $E$ï¼Œä¸‹æ–‡ä¸­è®°å…¶è¡¨ç¤ºçš„ unsigned integer ä¸º $e$
3.  fraction fieldï¼Œè¡¨ç¤º $M$ï¼Œä¸‹æ–‡ä¸­è®° fraction field ä¸º $f_{n-1} \\cdots f_1 f_0$

å¦‚æœç®€å•åœ°ä½¿ç”¨æ™®é€šæ•´æ•°çš„è¡¨ç¤ºæ³•æ¥è¡¨ç¤º $M$ å’Œ $E$ï¼Œä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼š

-   $E$ éœ€è¦èƒ½æ˜¯è´Ÿæ•°ï¼Œä»¥ç”¨æ¥è¡¨ç¤ºæ¯”è¾ƒå°çš„æ•°
-   è‹¥ $M = 0.f_{n-1} \\cdots f_1 f_0$ï¼Œé‚£ä¹ˆï¼š
    -   $E$ ä¸åŒçš„ç¼–ç å¯èƒ½è¡¨ç¤ºåŒä¸€ä¸ªå€¼ï¼Œé€ æˆç¼–ç çš„æµªè´¹
    -   å¯èƒ½ä¼šå‡ºç° $E$ æ›´å¤§ä½†å€¼æ›´å°çš„æƒ…å†µï¼Œä¼šç»™æ¯”è¾ƒä¸¤ä¸ªæ•°é€ æˆå›°éš¾
-   ä¸èƒ½è¡¨ç¤º $\\pm \\infty$ å’Œ \`NaN\` ç­‰ç‰¹æ®Šå€¼

ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒIEEE æµ®ç‚¹è¡¨ç¤ºé‡‡å–äº†å¦‚ä¸‹æªæ–½ã€‚

é¦–å…ˆï¼Œæµ®ç‚¹æ•°è¢«åˆ†ä¸ºä¸‰ç±»ï¼šnormalized values, denormalized values å’Œ special valuesã€‚

Normalized values:

-   ä¸€ä¸ªæµ®ç‚¹æ•°æ˜¯ normalized valueï¼Œå½“ä¸”ä»…å½“å…¶ exponent field æ—¢ä¸å…¨é›¶ä¹Ÿä¸å…¨ä¸€
-   $E = e - \\mathrm{Bias}$ï¼Œå…¶ä¸­ $\\mathrm{Bias}$ æ˜¯ä¸€ä¸ªé¢„å…ˆè®¾ç½®çš„å¸¸é‡
-   $M = 1.f_{n-1} \\cdots f_1 f_0$

Denormalized values:

-   ä¸€ä¸ªæµ®ç‚¹æ•°æ˜¯ denormalized valueï¼Œå½“ä¸”ä»…å½“å…¶ exponent field å…¨é›¶
-   $E = 1 - \\mathrm{Bias}$
-   $M = 0.f_{n-1} \\cdots f_1 f_0$

Special values:

-   ä¸€ä¸ªæµ®ç‚¹æ•°æ˜¯ special valueï¼Œå½“ä¸”ä»…å½“å…¶ exponent field å…¨ä¸€
-   è‹¥ fraction field å…¨é›¶ï¼Œåˆ™æ ¹æ® sign bit è¡¨ç¤º $\\pm \\infty$
-   è‹¥ fraction field éå…¨é›¶ï¼Œåˆ™è¡¨ç¤º \`NaN\`

ç°åœ¨æ¥çœ‹è¿™å¥—ç¼–ç è§„åˆ™å¦‚ä½•è§£å†³äº†ä¸Šé¢æå‡ºçš„é—®é¢˜ï¼š

1.  è®¾ç½® $\\mathrm{Bias}$ï¼Œä»¥è¡¨ç¤ºå°äºé›¶çš„ $E$
2.  å°† normalized values çš„ $M$ çš„æœ€é«˜ä½é’¦å®šä¸º 1ï¼Œä»¥é¿å…ä¸åŒ $E$ è¡¨ç¤ºåŒä¸€ä¸ªæ•°ã€‚è¿™å’Œæ ‡å‡†çš„åè¿›åˆ¶ç§‘å­¦è®¡æ•°æ³•è¦æ±‚å°æ•°åœ¨ $[1, 10)$ çš„èŒƒå›´å†…æ˜¯ä¸€ä¸ªé“ç†ï¼Œåœ¨äºŒè¿›åˆ¶ç§‘å­¦è®¡æ•°æ³•ä¸­å°±æ˜¯è¦æ±‚å°æ•°åœ¨ $[1, 2)$ çš„èŒƒå›´å†…ã€‚
3.  ç”±äº $E$ çš„å–å€¼èŒƒå›´æœ‰é™ï¼Œnormalized values çš„ $M$ æœ€é«˜ä½å¼ºåˆ¶ä¸º 1 ä½¿å…¶æ— æ³•è¡¨ç¤º $0.0$ ä»¥åŠæ¥è¿‘ $0$ çš„æ•°ï¼ˆèƒ½å¤Ÿè¡¨ç¤º $2^{-\\mathrm{Bias}}$ å’Œ $(1 + \\varepsilon) \\times 2^{-\\mathrm{Bias}}$ï¼Œå´æ— æ³•è¡¨ç¤ºä½äº $[0, 2^{-\\mathrm{Bias}})$ å†…çš„æ•°ï¼‰ï¼Œæ‰€ä»¥å¢è®¾ denormalized values è¿™ä¸€åˆ†ç±»ç”¨æ¥è¡¨ç¤ºæ¥è¿‘ $0$ çš„æ•°ä»¥åŠ $\\pm 0.0$ã€‚ç”±äº denormalized values æ²¡æœ‰å°† $M$ çš„æœ€é«˜ä½è®¾ä¸º $1$ï¼Œå®ƒçš„ $E$ è®¾ç½®ä¸º $1 - \\mathrm{Bias}$ è€Œé $-\\mathrm{Bias}$ ä½œä¸ºè¡¥å¿ã€‚
4.  é€šè¿‡ special values çš„åˆ†ç±»ï¼Œè¡¨ç¤ºäº† $\\pm \\infty$ ä»¥åŠ \`NaN\`ã€‚
5.  ä½¿ç”¨ exponent fields æŒ‰ç…§ denormalized -> normalized -> special çš„é¡ºåºè¿›è¡Œåˆ†ç±»ï¼Œå¯¹äºåŒä¸€ç¬¦å·çš„æµ®ç‚¹æ•°ï¼Œåªéœ€å°† exponent field å’Œ fraction field çœ‹ä½œæ— ç¬¦å·æ•´æ•°å³å¯æ¯”è¾ƒå¤§å°ï¼ˆå®é™…æ¯”è¾ƒæ—¶ï¼Œé™¤äº†å…ˆæ¯”è¾ƒç¬¦å·ä½ï¼Œå¯èƒ½è¿˜è¦è€ƒè™‘ $\\pm 0.0$ã€\`NaN\` ç­‰ç‰¹æ®Šæƒ…å†µï¼‰ã€‚

IEEE æµ®ç‚¹è¡¨ç¤ºè¿˜è§„å®šäº†æ¯ä¸ª field çš„é•¿åº¦ï¼š

-   32 ä½: exponent field 8 ä½ï¼Œfraction field 23 ä½
-   64 ä½: exponent field 11 ä½ï¼Œfraction field 52 ä½

è®° exponent field çš„ä½æ•°ä¸º $k$ï¼Œåˆ™ $\\mathrm{Bias} = 2^{k-1} - 1$ï¼Œå³ 32 ä½ä¸º $127$ï¼Œ64 ä½ä¸º $1023$ã€‚

### ç‰¹æ®Šï¼ˆæ ‡å¿—æ€§ï¼‰çš„æµ®ç‚¹æ•°

exponent field å’Œ fraction field å…¨é›¶è¡¨ç¤º $\\pm 0.0$ã€‚

exponent field å…¨é›¶ï¼Œfraction field æœ€ä½ä½ 1 å…¶å®ƒä½ 0ï¼Œæ˜¯èƒ½å¤Ÿè¡¨ç¤ºçš„æœ€æ¥è¿‘é›¶çš„æ•°ï¼ˆ32 ä½çº¦ä¸º $1.4 \\times 10^{-45}$ï¼Œ64 ä½çº¦ä¸º $4.9 \\times 10^{-324}$ï¼‰ã€‚ï¼ˆæ³¨æ„è¿™ä¸ªæ•°çš„å€¼ä¸º $2^{2-2^k-n}$ï¼Œå’Œ $\\varepsilon = 2^{-n}$ ä¸åŒã€‚ï¼‰

exponent field æœ€é«˜ä½ 0 å…¶å®ƒä½ 1ï¼ˆè¿™å¾—ç›Šäº $\\mathrm{Bias}$ çš„è®¾å®šï¼‰ï¼Œfraction field å…¨é›¶ï¼Œè¡¨ç¤º $\\pm 1.0$ã€‚

exponent field æœ€ä½ä½ 0 å…¶å®ƒä½ 1ï¼Œfraction field å…¨ä¸€ï¼Œæ˜¯èƒ½å¤Ÿè¡¨ç¤ºï¼ˆé special valueï¼‰çš„æœ€å¤§çš„æ•°ï¼ˆ32 ä½çº¦ä¸º $3.4 \\times 10^{38}$ï¼Œ64 ä½çº¦ä¸º $1.8 \\times 10^{308}$ï¼‰ã€‚

### æµ®ç‚¹æ•°èˆå…¥

æµ®ç‚¹æ•°çš„èˆå…¥æœ‰å››ç§æ¨¡å¼å¯ä¾›é€‰æ‹©ï¼š

-   round-to-even: ç±»ä¼¼äºâ€œå››èˆå…­å…¥äº”æˆåŒâ€ä½†æ˜¯äºŒè¿›åˆ¶ï¼Œæ˜¯é»˜è®¤çš„èˆå…¥æ¨¡å¼
-   round-toward-zero
-   round-down
-   round-up

### æµ®ç‚¹æ•°è¿ç®—

é™¤äº†ä¸€äº›ç‰¹æ®Šå€¼ï¼ˆå¦‚ \`sqrt(-1.0)\`ã€\`1/0.0\`ï¼‰ï¼Œæµ®ç‚¹æ•°çš„è¿ç®—ç»“æœè¢«å®šä¹‰ä¸ºç²¾ç¡®è®¡ç®—åè¿›è¡Œèˆå…¥å¾—åˆ°çš„ç»“æœï¼Œä½†å…·ä½“è®¡ç®—çš„å®ç°æ–¹å¼æ˜¯éšæ„çš„ï¼ˆä¸éœ€è¦çœŸçš„å…ˆç²¾ç¡®è®¡ç®—å†è¿›è¡Œèˆå…¥ï¼‰ã€‚

æµ®ç‚¹æ•°çš„åŠ æ³•å’Œä¹˜æ³•ä¼šè¿›è¡Œèˆå…¥ã€å¯èƒ½æº¢å‡ºï¼Œæ‰€ä»¥ä¸æ»¡è¶³ç»“åˆå¾‹ã€åˆ†é…å¾‹ï¼ˆä½†æ˜¯æ»¡è¶³äº¤æ¢å¾‹ï¼‰ã€‚è°ƒæ¢ç»“åˆé¡ºåºå¯èƒ½æ”¹å˜è®¡ç®—ç»“æœï¼Œæ„å‘³ç€ç¼–è¯‘å™¨æ— æ³•ä»¥æ”¹å˜ç»“åˆé¡ºåºä¸ºä»£ä»·è¿›è¡Œä¼˜åŒ–ã€‚

### C è¯­è¨€ä¸­æµ®ç‚¹æ•°ç±»å‹è½¬æ¢

ç®€å•æ¥è¯´ï¼Œæ•´æ•°è½¬æˆæµ®ç‚¹æ•°æˆ–ä¸åŒç±»å‹çš„æµ®ç‚¹æ•°ä¹‹é—´è¿›è¡Œè½¬æ¢å¯èƒ½èˆå…¥ä¹Ÿå¯èƒ½æº¢å‡ºã€‚æµ®ç‚¹æ•°è½¬æˆæ•´æ•°ä¼šå‘é›¶å–æ•´ï¼Œæº¢å‡ºæ—¶è¡Œä¸ºä¸ç¡®å®šã€‚
`},{title:f,tags:t,content:'[CS:APP](https://csapp.cs.cmu.edu/) ç¬¬ä¸‰ç«  â€œMachine-Level Representation of Programsâ€ çš„å­¦ä¹ ç¬”è®°ã€‚\n\nè¿™ç« çš„ä¸»è¦å†…å®¹ä¸ºæ±‡ç¼–ï¼ˆmachine-level programmingï¼‰ã€‚\n\n\n\nè¿‘å¹´æ¥ï¼Œéšç€ç¼–è¯‘å™¨å’Œé«˜çº§è¯­è¨€çš„å‘å±•ï¼Œæ‰‹å†™æ±‡ç¼–ã€æœºå™¨ç çš„éœ€æ±‚è¶Šæ¥è¶Šä½ï¼Œä½†é˜…è¯»ã€ç†è§£ç¼–è¯‘å™¨çš„è¾“å‡ºåœ¨ä¼˜åŒ–ç¨‹åºæ€§èƒ½ã€é¿å…å®‰å…¨æ¼æ´ç­‰æ–¹é¢ä¾ç„¶é‡è¦ã€‚\n\n## Program Encodings\n\n### æ±‡ç¼–/æœºå™¨ç ä¸­çš„ç¨‹åºçŠ¶æ€\n\nx86-64 çš„ç¨‹åºçŠ¶æ€åŒ…å«ï¼š\n\n-   program counterï¼Œè¡¨ç¤ºå¾…æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œç”¨ `%rip` è¡¨ç¤º\n-   [register file](#å¯„å­˜å™¨)ï¼Œ16 ä¸ªç”¨æ¥å­˜å‚¨æ•´å‹çš„å¯„å­˜å™¨\n-   [status flags](#status-flags)ï¼Œç”¨æ¥å­˜å‚¨æœ€è¿‘æ‰§è¡Œçš„è¿ç®—çš„çŠ¶æ€\n-   [vector registers](#ymm-å¯„å­˜å™¨)ï¼Œç”¨æ¥å­˜å‚¨å¤šä¸ªæ•´å‹æˆ–æµ®ç‚¹æ•°\n\n### å°† C ä»£ç ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç \n\nå¯ä»¥é€šè¿‡ `gcc -S` ç”Ÿæˆæ±‡ç¼–ä»£ç ï¼Œé€šè¿‡ `gcc -Og` æ¥å¯ç”¨â€œä»¥è°ƒè¯•ä½“éªŒä¸ºç›®æ ‡çš„ä¼˜åŒ–â€ï¼ˆåæ–‡ä¸­å™è¿°çš„å¾ˆå¤šç¼–è¯‘è¡Œä¸ºéƒ½æ˜¯éœ€è¦ä¸€äº›åŸºæœ¬çš„ä¼˜åŒ–çš„ï¼Œå¦‚æœå®Œå…¨ä¸å¯ç”¨ä»»ä½•ä¼˜åŒ–ï¼Œå¯èƒ½ç¼–è¯‘ç»“æœä¼šæœ‰å¾ˆå¤§çš„å·®åˆ«ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œå®Œå…¨ä¸ä¼˜åŒ–å’Œè¿‡åº¦ä¼˜åŒ–éƒ½ä¼šé™ä½æ±‡ç¼–ä»£ç çš„å¯è¯»æ€§ï¼‰ã€‚\n\nä¸ºäº†æ–¹ä¾¿ï¼Œå¯ä»¥ç”¨ä¸€æ¡å‘½ä»¤ç¼–è¯‘å¹¶ä¸ç•™æ–‡ä»¶åœ°æŸ¥çœ‹æ±‡ç¼–ä»£ç : `gcc a.c -Og -S -o - | bat -l asm`ã€‚\n\nä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ï¼š\n\n```c\nlong mult2(long, long);\n\nvoid multstore(long x, long y, long *dest)\n{\n    long t = mult2(x, y);\n    *dest = t;\n}\n```\n\nç¼–è¯‘ä¸ºå¦‚ä¸‹çš„æ±‡ç¼–ä»£ç ï¼š\n\n```asm\n	.file	"a.c"\n	.text\n	.globl	multstore\n	.type	multstore, @function\nmultstore:\n.LFB0:\n	.cfi_startproc\n	pushq	%rbx\n	.cfi_def_cfa_offset 16\n	.cfi_offset 3, -16\n	movq	%rdx, %rbx\n	call	mult2@PLT\n	movq	%rax, (%rbx)\n	popq	%rbx\n	.cfi_def_cfa_offset 8\n	ret\n	.cfi_endproc\n.LFE0:\n	.size	multstore, .-multstore\n	.ident	"GCC: (GNU) 12.2.0"\n	.section	.note.GNU-stack,"",@progbits\n```\n\n### åæ±‡ç¼–ä¸æœºå™¨ç \n\nå¯ä»¥é€šè¿‡ `objdump` åæ±‡ç¼–ï¼Œä¾‹å¦‚ `gcc a.c -Og -c && objdump -d a.o` å¾—åˆ°ï¼š\n\n```asm\na.oï¼š     æ–‡ä»¶æ ¼å¼ elf64-x86-64\n\n\nDisassembly of section .text:\n\n0000000000000000 <multstore>:\n   0:	53                   	push   %rbx\n   1:	48 89 d3             	mov    %rdx,%rbx\n   4:	e8 00 00 00 00       	call   9 <multstore+0x9>\n   9:	48 89 03             	mov    %rax,(%rbx)\n   c:	5b                   	pop    %rbx\n   d:	c3                   	ret\n```\n\nå¯ä»¥çœ‹å‡ºï¼Œæœºå™¨ç å°±æ˜¯ä¸€ä¸² bytesï¼Œè‹¥å¹²ä¸ª bytes åˆåœ¨ä¸€èµ·è¡¨ç¤ºä¸€æ¡æŒ‡ä»¤ã€‚è€Œæ¯æ¡æŒ‡ä»¤å¯¹åº”çš„ bytes æ•°é‡ä¸åŒï¼Œä¸ operands ä¸ªæ•°ä»¥åŠæŒ‡ä»¤çš„å¸¸ç”¨ç¨‹åº¦ç›¸å…³ï¼ˆç±»ä¼¼æ‘©æ–¯ç”µç ã€UTF-8ï¼‰ã€‚\n\n<Card title="æŒ‡ä»¤é›†çš„ referenceï¼›ATT æ ¼å¼ vs Intel æ ¼å¼">\nCS:APP ä»¥åŠ gcc é»˜è®¤ä½¿ç”¨çš„æ˜¯ ATT æ ¼å¼çš„æ±‡ç¼–ï¼Œå¯ä»¥åœ¨ [Instruction Set Mapping - Oracle x86 Assembly Language Reference Manual](https://docs.oracle.com/cd/E19253-01/817-5477/enmzx/index.html) æŸ¥çœ‹ ATT æ ¼å¼æ±‡ç¼–å’Œå®é™…æŒ‡ä»¤ä¹‹é—´çš„å¯¹åº”å…³ç³»ï¼Œåœ¨ [IntelÂ® 64 and IA-32 Architectures Software Developer Manuals](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html)ï¼ˆä¸‹æ–‡ä¸­ä»¥ â€œIntel Manualâ€ æŒ‡ä»£ï¼‰ï¼ˆä¸»è¦æ˜¯ç¬¬ 2 å·ï¼‰æŸ¥çœ‹å…·ä½“æŒ‡ä»¤çš„ referenceã€‚\n\nATT æ ¼å¼ä¸ Intel æ ¼å¼æœ‰ä¸€äº›å·®åˆ«ï¼Œå…¶ä¸­åœ¨æŸ¥çœ‹ reference æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒIntel æ ¼å¼çš„æŒ‡ä»¤æ²¡æœ‰ `b/w/l/q` çš„ç±»å‹åç¼€ï¼Œå¹¶ä¸” operands çš„é¡ºåºå’Œ ATT æ ¼å¼æ°å¥½ç›¸åã€‚\n\n</Card>\n\n## Data Formats\n\nç”±äºå†å²åŸå› ï¼ŒIntel ä½¿ç”¨ â€œwordâ€ è¡¨ç¤º 16 bitsï¼Œè€Œç”¨ â€œdouble wordâ€ è¡¨ç¤º 32 bitsï¼Œç”¨ â€œquad wordâ€ è¡¨ç¤º 64 bitsã€‚\n\nC è¯­è¨€ç±»å‹åœ¨ x86-64 ä¸­çš„å¤§å°ï¼š\n\n| C è¯­è¨€ç±»å‹ |  Intel æ•°æ®ç±»å‹  |  æ±‡ç¼–åç¼€   | bytes |\n| :--------: | :--------------: | :---------: | :---: |\n|   `char`   |       byte       |     `b`     |   1   |\n|  `short`   |       word       |     `w`     |   2   |\n|   `int`    |   double word    | `l` (long)  |   4   |\n|   `long`   |    quad word     |     `q`     |   8   |\n|    æŒ‡é’ˆ    |    quad word     |     `q`     |   8   |\n|  `float`   | single precision | `s` (short) |   4   |\n|  `double`  | double precision | `l` (long)  |   8   |\n\næ¯ç§ç±»å‹éƒ½æœ‰ä¸€ä¸ªç”¨åœ¨æ±‡ç¼–æŒ‡ä»¤ä¸­çš„åç¼€ï¼Œè¡¨ç¤º operand çš„ç±»å‹ï¼Œä¾‹å¦‚ `movb`ã€`movw`ã€`movl`ã€`movq`ã€‚`l` æ—¢ç”¨äº double word ä¹Ÿç”¨äº double precisionï¼Œä½†æ•´æ•°å’Œæµ®ç‚¹æ•°æ¶‰åŠçš„æŒ‡ä»¤ä¸åŒï¼Œæ‰€ä»¥ä¸ä¼šæœ‰æ­§ä¹‰ã€‚ï¼ˆåæ–‡ä¸­ [Floating-Point Code](#floating-point-code) ç”¨çš„ AVX2 æŒ‡ä»¤å¹¶ä¸ä½¿ç”¨ `s`/`l` çš„æµ®ç‚¹æ•°ç±»å‹åç¼€ã€‚ï¼‰\n\n## Accessing Information\n\n### å¯„å­˜å™¨\n\nx86-64 CPU æœ‰ 16 ä¸ª general-purpose registerï¼Œå¯ä»¥ç”¨æ¥å­˜æ•´æ•°æˆ–æŒ‡é’ˆï¼š\n\n| quad word | double word |  word   |  byte   |     ç”¨é€”      |\n| :-------: | :---------: | :-----: | :-----: | :-----------: |\n|  `%rax`   |   `%eax`    |  `%ax`  |  `%al`  | return value  |\n|  `%rbx`   |   `%ebx`    |  `%bx`  |  `%bl`  | callee saved  |\n|  `%rcx`   |   `%ecx`    |  `%cx`  |  `%cl`  | 4th argument  |\n|  `%rdx`   |   `%edx`    |  `%dx`  |  `%dl`  | 3rd argument  |\n|  `%rsi`   |   `%esi`    |  `%si`  | `%sil`  | 2nd argument  |\n|  `%rdi`   |   `%edi`    |  `%di`  | `%dil`  | 1st argument  |\n|  `%rbp`   |   `%ebp`    |  `%bp`  | `%bpl`  | callee saved  |\n|  `%rsp`   |   `%esp`    |  `%sp`  | `%spl`  | stack pointer |\n|   `%r8`   |   `%r8d`    | `%r8w`  | `%r8b`  | 5th argument  |\n|   `%r9`   |   `%r9d`    | `%r9w`  | `%r9b`  | 6th argument  |\n|  `%r10`   |   `%r10d`   | `%r10w` | `%r10b` | caller saved  |\n|  `%r11`   |   `%r11d`   | `%r11w` | `%r11b` | caller saved  |\n|  `%r12`   |   `%r12d`   | `%r12w` | `%r12b` | callee saved  |\n|  `%r13`   |   `%r13d`   | `%r13w` | `%r13b` | callee saved  |\n|  `%r14`   |   `%r14d`   | `%r14w` | `%r14b` | callee saved  |\n|  `%r15`   |   `%r15d`   | `%r15w` | `%r15b` | callee saved  |\n\næ¯ä¸ª register å¯ä»¥ç”¨å››ç§ä¸åŒçš„é•¿åº¦è®¿é—®ï¼Œå…¶ä¸­çŸ­çš„æ˜¯é•¿çš„çš„ä½ä½ã€‚ä¿®æ”¹ byte æˆ– word çš„å€¼æ—¶é«˜ä½ä¸å˜ï¼Œä¿®æ”¹ double word çš„å€¼åˆ™ä¼šå°†é«˜ä½æ¸…é›¶ã€‚\n\nä¸åŒå¯„å­˜å™¨çš„ç”¨é€”å°†åœ¨åæ–‡è¯´æ˜ï¼ˆä¸»è¦æ˜¯åœ¨ [Procedures](#procedures) è¿™ä¸€èŠ‚ï¼‰ã€‚\n\n### Operand æ ¼å¼\n\næŒ‡ä»¤çš„ operand æœ‰ä¸‰ç§æŒ‡å®šæ–¹å¼ï¼š\n\n1.  Immediateï¼Œå³å­—é¢å€¼ï¼Œä»£ç ä¸º `$Imm`ï¼Œä¾‹å¦‚ `$123` è¡¨ç¤º 123ï¼Œ`$0x123` è¡¨ç¤º 0x123\n2.  Registerï¼Œä»£ç ä¸ºå¯„å­˜å™¨çš„åç§°ï¼Œä¾‹å¦‚ `%rax`\n3.  Memoryï¼Œå®Œæ•´å½¢æ€çš„ä»£ç ä¸º `Imm(rb, ri, s)`ï¼Œè¡¨ç¤º `M[Imm + R[rb] + R[ri] * s]`ï¼ˆå…¶ä¸­ `ri` ä¸ä¸º `%rsp`ï¼Œ$s \\in \\{1, 2, 4, 8\\}$ï¼‰ï¼Œä¾‹å¦‚ `2(%rax, %rbx, 4)` è¡¨ç¤º memory ä¸­åœ°å€ä¸º `2 + %rax + 4 * %rbx` çš„å€¼ï¼›`Imm`ã€`rb`ã€`, ri, s` åˆ†åˆ«å¯ä»¥çœç•¥ï¼Œä¾‹å¦‚ `Imm`ã€`(rb)`ã€`Imm(, ri, s)`ï¼›æŒ‡å®šäº† `ri` æ—¶ä¹Ÿå¯ä»¥çœç•¥ `s` è¡¨ç¤º `s` ä¸º 1ã€‚\n\nåœ¨ä¸‹æ–‡ä¸­ï¼Œç”¨ `imm32`ã€`r64`ã€`m16`ã€`r/m64` ç­‰æ–¹å¼è¡¨ç¤ºæŒ‡ä»¤ operand çš„ç±»å‹ã€‚\n\nï¼ˆåœ¨ ATT æ ¼å¼ä¸­ï¼‰æœ‰ä¸¤ä¸ª operand æ—¶ï¼Œç¬¬ä¸€ä¸ªæ˜¯ sourceï¼Œç¬¬äºŒä¸ªæ˜¯ destinationã€‚\n\n### move ç±»æŒ‡ä»¤\n\nè™½ç„¶å« â€œmoveâ€ï¼Œä½†å®é™…ä¸Šæ˜¯å¤åˆ¶ã€‚\n\n#### MOV æŒ‡ä»¤\n\nsource å’Œ destination ç±»å‹ç›¸åŒã€‚\n\n-   `movb imm/r8, r/m8`\n-   `movb m8, r8`\n-   `movw imm/r16, r/m16`\n-   `movw m16, r16`\n-   `movl imm/r32, r/m32`\n-   `movl m32, r32`\n-   `movq imm32/r64, r/m64`\n-   `movq m64, r64`\n-   `movabsq imm64, r64`\n\nå…¶ä¸­ï¼Œsource å’Œ destination ä¸èƒ½åŒæ—¶æ˜¯ memoryã€‚\n\nç‰¹åˆ«åœ°ï¼Œ`movq` ä¸æ¥å— imm64ï¼Œå¤åˆ¶æ—¶ä¼šåœ¨ imm32 çš„é«˜ä½è¡¥ç¬¦å·ä½ï¼›`movabsq` å¯ä»¥æ¥å— imm64ï¼Œä½† destination åªèƒ½æ˜¯å¯„å­˜å™¨ã€‚è¿™æ ·è®¾è®¡çš„åŸå› å¯ä»¥å‚è€ƒ [assembly - why we can\'t move a 64-bit immediate value to memory? - Stack Overflow](https://stackoverflow.com/questions/62771323/why-we-cant-move-a-64-bit-immediate-value-to-memory)ã€‚å®é™…ä¸Šï¼Œæ”¯æŒ imm64 ä½œä¸º operand çš„æŒ‡ä»¤æ˜¯å°‘æ•°ï¼Œåé¢è¿˜ä¼šçœ‹åˆ°å¾ˆå¤šä¸æ¥å— imm64 çš„æŒ‡ä»¤ï¼Œä¸€èˆ¬éƒ½æ˜¯é«˜ä½è¡¥ç¬¦å·ä½ã€‚\n\n#### MOVZ æŒ‡ä»¤\n\nå°†é«˜ä½è¡¥é›¶åå¤åˆ¶ã€‚\n\n-   `movzbw r/m8, r16`\n-   `movzbl r/m8, r32`\n-   `movzwl r/m16, r32`\n-   `movzbq r/m8, r64`\n-   `movzwq r/m16, r64`\n\næ²¡æœ‰ `movzlq` è¿™æ¡æŒ‡ä»¤ï¼Œå› ä¸ºå°†å¯„å­˜å™¨çš„å€¼ä¿®æ”¹ä¸ºä¸€ä¸ª double word æ—¶å°±ä¼šå°†é«˜ä½æ¸…é›¶ï¼Œæ‰€ä»¥ä½¿ç”¨ `movl` å°±å¯ä»¥äº†ã€‚\n\n<Card\n    type="question"\n    title="æ²¡ç”¨çš„ <code>movzbq</code> å’Œ <code>movzwq</code> ğŸ¤”ï¼Ÿ"\n>\n    è™½ç„¶æœ‰ `movzbq` å’Œ `movzwq`ï¼Œä½†ä¸€èˆ¬ä¼šç”¨ `movzbl` å’Œ `movzwl`\n    å®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚æ²¡æœåˆ°ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸¤æ¡æŒ‡ä»¤...\n</Card>\n\n#### MOVS æŒ‡ä»¤\n\nå°†é«˜ä½è¡¥ç¬¦å·ä½åå¤åˆ¶ã€‚\n\n-   `movsbw r/m8, r16`\n-   `movsbl r/m8, r32`\n-   `movsbq r/m8, r64`\n-   `movswl r/m16, r32`\n-   `movswq r/m16, r64`\n-   `movslq r/m32, r64`\n-   `cltq`: å’Œ `movslq %eax, %rax` æ•ˆæœç›¸åŒï¼ˆä½†ç¼–ç æ›´çŸ­ï¼‰\n\n### push/pop stack\n\n-   `pushq imm32/r/m64`: å°† `R[%rsp]` å‡å…«ï¼Œç„¶åå°† operand å¤åˆ¶åˆ° `M[R[%rsp]]`ï¼ˆ`PUSH` æŒ‡ä»¤ä¸æ”¯æŒ imm64ï¼Œä¼šå°† imm32 é«˜ä½è¡¥ç¬¦å·ä½ï¼‰\n-   `popq r/m64`: å°† `M[R[%rsp]]` å¤åˆ¶åˆ° operandï¼Œç„¶åå°† `R[%rsp]` åŠ å…«\n\nå¯ä»¥çœ‹å‡ºï¼Œprogram stack æ˜¯ memory ä¸­è¿ç»­çš„ä¸€æ®µï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª quad wordï¼Œtop çš„åœ°å€æ¯” bottom ä½ï¼Œpush æ—¶ stack pointer å‡å°ã€‚\n\nç”±äº stack ä¸è¿‡æ˜¯ç”± `%rsp` æ ‡è®°æ ˆé¡¶çš„ä¸€æ®µ memoryï¼Œå¯ä»¥é€šè¿‡ç»™ `%rsp` åŠ ä¸Šä¸€ä¸ª offset è®¿é—®éæ ˆé¡¶å…ƒç´ ï¼Œä¾‹å¦‚ `8(%rsp)` ä¸ºæ ˆé¡¶ä¸‹é¢çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚\n\n<Card title="ä¸ºä»€ä¹ˆ top ä½äºä½åœ°å€ï¼Ÿ">\n    top ä½äºä½åœ°å€å¯èƒ½çœ‹èµ·æ¥å¾ˆæ€ªï¼Œå¯ä»¥å‚è€ƒ [Why does the stack address grow\n    towards decreasing memory addresses? - Stack\n    Overflow](https://stackoverflow.com/questions/4560720/why-does-the-stack-address-grow-towards-decreasing-memory-addresses)ã€‚ç®€å•æ¥è¯´ï¼Œç”±äº\n    memory layout å’Œ memory æ›¾ç»å¾ˆå°çš„å†å²åŸå› ï¼Œstack å’Œ heap\n    ä¼šå¾€ä¸åŒçš„æ–¹å‘å¢é•¿ï¼Œæ€»ä¼šæœ‰ä¸€ä¸ªåœ¨å¢é•¿æ—¶å‡å°åœ°å€ï¼Œè€Œ x86-64 é€‰æ‹©äº† push stack\n    æ—¶å‡å°åœ°å€ï¼Œè¿™ä¹Ÿä½¿å¾—è®¿é—®éæ ˆé¡¶å…ƒç´ ä¸éœ€è¦ç»™ offset åŠ è´Ÿå·ã€‚\n</Card>\n\n<Card title="<code>pushq</code>/<code>popq</code> vs ç›´æ¥ä¿®æ”¹ <code>%rsp</code>">\n    é™¤äº† `pushq`/`popq`ï¼Œä¹Ÿå¯ä»¥å‡å° `%rsp` æ¥å‘æ ˆé¡¶å‹å…¥æœªåˆå§‹åŒ–çš„æ•°æ®ï¼Œæˆ–è€…å¢å¤§\n    `%rsp` æ¥é‡Šæ”¾æ ˆç©ºé—´ï¼Œä½†è¿™æ ·åšå’Œ `pushq`/`popq`\n    ç›¸æ¯”å“ªä¸ªæ€§èƒ½æ›´å¥½æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œå¯ä»¥å‚è€ƒ [assembly - What C/C++ compiler can\n    use push pop instructions for creating local variables, instead of just\n    increasing esp once? - Stack\n    Overflow](https://stackoverflow.com/questions/49485395/what-c-c-compiler-can-use-push-pop-instructions-for-creating-local-variables)ã€‚\n</Card>\n\n## Arithmetic and Logical Operations\n\n### Load Effective Address\n\n`leaq m, r64`: å°† source operand çš„åœ°å€å¤åˆ¶åˆ° destination operandï¼ˆåªè®¡ç®— source operand çš„åœ°å€ï¼Œä¸å…¶æŒ‡å‘çš„ memory ä¸­å­˜å‚¨çš„å€¼æ— å…³ï¼‰\n\nLEA å¯ä»¥ç”¨æ¥ä¼˜åŒ–ä¸€äº›ç®€å•çš„ç®—æœ¯ï¼Œä¾‹å¦‚ï¼š\n\n```c\nlong scale(long x, long y, long z)\n{\n    long t = x + 4 * y + 12 * z;\n    return t;\n}\n```\n\n```asm\nscale:\n	leaq	(%rdi,%rsi,4), %rax\n	leaq	(%rdx,%rdx,2), %rdx\n	leaq	(%rax,%rdx,4), %rax\n	ret\n```\n\nè¿™é‡Œä¸‰ä¸ª LEA åˆ†åˆ«è®¡ç®—äº† $x + 4y$, $z + 2z$ å’Œ $(x + 4y) + 4 (z + 2z)$ã€‚\n\n### ä¸€å…ƒè¿ç®—\n\næ¯ç§ä¸€å…ƒè¿ç®—éƒ½æœ‰ b/w/l/q å››ä¸ªç±»å‹ï¼Œæ¥å—ä¸€ä¸ªç›¸åº”ç±»å‹çš„ r/mï¼Œå°†è¿™ä¸ª operand è®¡ç®—åçš„ç»“æœå­˜å…¥è¿™ä¸ª operandï¼š\n\n-   `INC`: åŠ ä¸€\n-   `DEC`: å‡ä¸€\n-   `NEG`: å–å (negate)\n-   `NOT`: æŒ‰ä½å–å (complement)\n\n### äºŒå…ƒè¿ç®—\n\næ¯ç§äºŒå…ƒè¿ç®—éƒ½æœ‰ b/w/l/q å››ä¸ªç±»å‹ï¼Œæ¥å—ç›¸åº”ç±»å‹çš„ imm/r/m ä½œä¸º sourceï¼ˆé™¤äº† imm64ï¼‰ï¼Œç›¸åº”ç±»å‹çš„ r/m ä½œä¸º destinationï¼ˆsource å’Œ destination ä¸èƒ½åŒæ—¶ä¸º memoryï¼‰ï¼Œæ•ˆæœä¸ºå°† sourceâ€œä½œç”¨äºâ€destinationï¼Œå°†è¿ç®—ç»“æœå­˜å…¥ destinationã€‚\n\n-   `ADD`: åŠ \n-   `SUB`: destination å‡å» source\n-   `IMUL`: ä¹˜\n-   `XOR`: æŒ‰ä½å¼‚æˆ–\n-   `OR`: æŒ‰ä½æˆ–\n-   `AND`: æŒ‰ä½ä¸\n\nç‰¹åˆ«åœ°ï¼Œç±»ä¼¼ `xorl %rdx, %rdx` çš„ä»£ç å¯ä»¥ç”¨æ¥ä¼˜åŒ– `movl $0, %rdx`ï¼Œå‚è§ Practice Problem 3.11 ä»¥åŠ [performance - What is the best way to set a register to zero in x86 assembly: xor, mov or and? - Stack Overflow](https://stackoverflow.com/questions/33666617/what-is-the-best-way-to-set-a-register-to-zero-in-x86-assembly-xor-mov-or-and)ã€‚\n\n### ä½ç§»\n\nä½ç§»æœ‰ b/w/l/q å››ä¸ªç±»å‹ï¼Œsource åªèƒ½æ˜¯ imm8 æˆ–è€… `%cl`ï¼Œdestination æ˜¯ç›¸åº”ç±»å‹çš„ r/mã€‚\n\n-   `SAL`/`SHL`: å·¦ç§»\n-   `SAR`: ç®—æœ¯å³ç§»\n-   `SHR`: é€»è¾‘å³ç§»\n\n<Card type="question" title="å¯¹è¿‡å¤§ä½ç§»ä½æ•°çš„å¤„ç†">\n    CS:APP ä¸Šè¯´ä½ç§»çš„ä½æ•°ä¼šå¯¹ operand size å–æ¨¡ï¼Œä½†æ ¹æ® Intel Manual\n    ä»¥åŠæˆ‘è‡ªå·±å®éªŒçš„ç»“æœï¼Œåº”è¯¥æ˜¯ b/w/l å¯¹ 32 å–æ¨¡ï¼Œq å¯¹ 64 å–æ¨¡ï¼›errata\n    ä¹Ÿæ²¡çœ‹åˆ°è¿™ä¸€æ¡ï¼Œä¸çŸ¥é“æ˜¯æ€ä¹ˆå›äº‹ã€‚\n</Card>\n\n### ç»“æœæ˜¯ operand ä¸¤å€é•¿åº¦çš„è¿ç®—\n\n128 ä½çš„æ•´æ•°å«åš oct wordï¼Œéœ€è¦å­˜åœ¨ä¸¤ä¸ªå¯„å­˜å™¨ä¸­ï¼Œåœ¨æŒ‡ä»¤ä¸­ä¸€èˆ¬é«˜ä½æ”¾åœ¨ `R[%rdx]` ä½ä½æ”¾åœ¨ `R[%rax]`ã€‚\n\nè™½ç„¶æˆªå»é«˜ä½æ—¶æ˜¯å¦æœ‰ç¬¦å·å¯¹ç¼–ç å±‚é¢çš„ä¹˜æ³•æ²¡æœ‰å½±å“ï¼Œä¸æˆªå»é«˜ä½æ—¶å°±éœ€è¦å¯¹ signed å’Œ unsigned ä½¿ç”¨ä¸åŒçš„æŒ‡ä»¤äº†ï¼š\n\n-   `imulq r/m64`: è®¡ç®— operand å’Œ `R[%rax]` ä½œä¸º signed integer ç›¸ä¹˜è€Œä¸æˆªå»é«˜ä½çš„ç»“æœï¼Œå­˜åœ¨ `R[%rdx]:R[%rax]` ä¸­ã€‚ï¼ˆå¦‚æœæœ‰ä¸¤ä¸ª operand å°±æ˜¯ä¸Šé¢çš„ [äºŒå…ƒè¿ç®—](#äºŒå…ƒè¿ç®—) äº†ã€‚ï¼‰\n-   `mulq r/m64`: è®¡ç®— operand å’Œ `R[%rax]` ä½œä¸º unsigned integer ç›¸ä¹˜è€Œä¸æˆªå»é«˜ä½çš„ç»“æœï¼Œå­˜åœ¨ `R[%rdx]:R[%rax]` ä¸­ã€‚\n\né™¤æ³•ä»¥åŠå–æ¨¡ï¼š\n\n-   `cqto`/`cqtd`: å°† `R[%rax]` é«˜ä½å¡«ç¬¦å·ä½æ”¾åœ¨ `R[%rdx]:R[%rax]`ï¼ˆä¹Ÿå°±æ˜¯ç”¨ `R[%rax]` çš„ç¬¦å·ä½å¡«æ»¡ `R[%rdx]`ï¼‰ã€‚\n-   `idivq`: è®¡ç®— `R[%rdx]:R[%rax]` æœ‰ç¬¦å·åœ°é™¤ä»¥ operandï¼Œå•†æ”¾åœ¨ `R[%rax]`ï¼Œä½™æ•°æ”¾åœ¨ `R[%rdx]`ã€‚\n-   `divq`: è®¡ç®— `R[%rdx]:R[%rax]` æ— ç¬¦å·åœ°é™¤ä»¥ operandï¼Œå•†æ”¾åœ¨ `R[%rax]`ï¼Œä½™æ•°æ”¾åœ¨ `R[%rdx]`ã€‚\n\nå¾—åˆ°çš„å•†éƒ½æ˜¯å‘ 0 å–æ•´ï¼Œæ‰€ä»¥è¢«é™¤æ•°ä¸ºè´Ÿæ—¶ä½™æ•°éæ­£ã€‚\n\nè‹¥å•†æº¢å‡ºäº†ï¼Œåˆ™ä¼šè§¦å‘ divide error å¼‚å¸¸ã€‚æ‰€ä»¥è¢«é™¤æ•°ä¸€èˆ¬ä¼šæ˜¯ 64 ä½æ•´æ•°ï¼ˆåœ¨ `idivq` ä¹‹å‰ç”¨ `cqto` æ¥è®¾ç½® `R[%rdx]`ï¼Œåœ¨ `divq` ä¹‹å‰å°† `R[%rdx]` ç½®ä¸ºå…¨é›¶ï¼‰ï¼Œå¦åˆ™å¾ˆå¯èƒ½æº¢å‡ºè€Œè§¦å‘å¼‚å¸¸ã€‚\n\nè¿™äº›è¿ç®—ä¹Ÿæœ‰ operand ä¸º 32 ä½ï¼Œç»“æœä¸º 64 ä½çš„ç‰ˆæœ¬ï¼š`imull`ã€`mull`ã€`cltd`ã€`idivl`ã€`divl`ã€‚å®ƒä»¬ä»¥ `%edx` å’Œ `%eax` æ¥ä»£æ›¿ 128 ä½è¿ç®—ä¸­çš„ `%rdx` å’Œ `%rax`ã€‚\n\n## Control\n\n<Card type="hint" title=\'<span class="mojikumi">â€œ</span>status flag<span class="mojikumi">â€</span> vs <span class="mojikumi">â€œ</span>condition code<span class="mojikumi">â€</span>\'>\n    åœ¨ CS:APP ä¸­ `CF`/`ZF`/`SF`/`OF` ç­‰è¢«å«åš â€œcondition codeâ€ï¼›è€Œåœ¨ Intel Manual\n    ä¸­ï¼Œ`CF`/`ZF`/`SF`/`OF` ç­‰è¢«å«åš â€œstatus flagâ€ï¼Œâ€œcondition codeâ€ æŒ‡çš„æ˜¯ status\n    flags çš„ç»„åˆã€‚ä¸‹æ–‡é‡‡ç”¨ Intel çš„å«æ³•ã€‚\n</Card>\n\n### Status Flags\n\nstatus flags ä¸­å­˜å‚¨äº†æœ€è¿‘ä¸€æ¬¡è¿ç®—çš„çŠ¶æ€ï¼Œå¸¸ç”¨çš„ status flag æœ‰å››ä¸ªï¼š\n\n-   `CF`: Carry Flagï¼Œè¡¨ç¤ºè¿ç®—è¿‡ç¨‹ä¸­å‘ç”Ÿäº†è¶…å‡º operand é•¿åº¦çš„è¿›ä½æˆ–å€Ÿä½ï¼Œå³å°†è¿ç®—è§†ä½œ unsigned å‘ç”Ÿäº†æº¢å‡ºã€‚\n-   `ZF`: Zero Flagï¼Œè¡¨ç¤ºè¿ç®—ç»“æœä¸ºé›¶ã€‚\n-   `SF`: Sign Flagï¼Œè¡¨ç¤ºè¿ç®—ç»“æœï¼ˆçœ‹ä½œè¡¥ç ï¼‰ä¸ºè´Ÿï¼Œå³è¿ç®—ç»“æœçš„ç¬¦å·ä½ã€‚\n-   `OF`: Overflow Flagï¼Œè¡¨ç¤ºè‹¥å°†è¿ç®—è§†ä½œ signed å‘ç”Ÿäº†æº¢å‡ºã€‚\n\n<Card title="ARM ä¸­çš„ carry flag â€”â€” carry flag vs borrow flag" fold>\nåœ¨ ARM ä¸­ï¼Œè®¡ç®—å‡æ³•æ—¶ï¼Œä¸ x86 ç›¸åï¼Œcarry flag ä¸º 0 è¡¨ç¤ºæº¢å‡ºï¼Œä¸º 1 è¡¨ç¤ºæ²¡æœ‰æº¢å‡ºã€‚\n\nè¿™æ˜¯å› ä¸ºï¼Œè®¡ç®—å‡æ³•æœ‰ä¸¤ç§æ–¹å¼ï¼Œ[subtract with borrow å’Œ subtract with carry](https://en.wikipedia.org/wiki/Carry_flag#Vs._borrow_flag)ï¼š\n\n-   subtract with borrow ç›¸å½“äºæ™®é€šçš„å‡æ³•ç«–å¼è®¡ç®—ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­è®°å½• borrow flagï¼Œæœ€åå­˜å‚¨åœ¨ carry flag ä¸­ï¼Œè¡¨ç°ä¸ºè‹¥æœ€åå‘ç”Ÿå€Ÿä½åˆ™ carry flag ä¸º 1ã€‚\n-   subtract with carry åˆ©ç”¨äº† `-x = ~x + 1` çš„æ€§è´¨ï¼Œé€šè¿‡ `a + ~b + 1` æ¥è®¡ç®— `a - b`ï¼Œè€Œå’Œæ™®é€šåŠ æ³•ä¸€æ ·è®¡ç®— carry flagï¼›è€Œåœ¨ subtract with borrow æœ€åå‘ç”Ÿå€Ÿä½æ—¶ï¼Œsubtract with carry åè€Œ carry flag æ˜¯ 0ã€‚\n\nå¯ä»¥è¿™ä¹ˆç†è§£è¿™ä¸¤è€…é—´çš„å·®å¼‚ï¼šè®¾è®¡ç®—æ˜¯ $w$ ä½çš„ï¼Œæœ€åè®¡ç®—å®Œæˆæ—¶ï¼Œborrow flag è¡¨ç¤ºç¬¬ $w+1$ ä½ä¸Šæ˜¯ $-1$ï¼Œcarry flag è¡¨ç¤ºç¬¬ $w+1$ ä½ä¸Šæ˜¯ $1$ï¼Œè€Œ subtract with carry ç›¸å½“äºå…ˆåŠ ä¸Šäº† $2^w$ å†è¿›è¡Œå‡æ³•ï¼Œå°±ä¼šå°†ç¬¬ $w+1$ ä½ä» $-1$ å˜æˆ $0$ï¼Œä» $0$ å˜æˆ $1$ã€‚\n</Card>\n\nLEA ä¸ä¼šæ”¹å˜ status flagsã€‚\n\n[ä¸€å…ƒè¿ç®—](#ä¸€å…ƒè¿ç®—) å’Œ [äºŒå…ƒè¿ç®—](#äºŒå…ƒè¿ç®—) éƒ½ä¼šæ”¹å˜ status flagsã€‚ç‰¹åˆ«åœ°ï¼Œ`INC` å’Œ `DEC` ä¸ä¼šæ”¹å˜ `CF`ã€‚\n\nä½ç§»å¯¹ status flags çš„å½±å“æ¯”è¾ƒå¤æ‚ï¼ˆå¯ä»¥å‚è€ƒ Intel Manualï¼‰ï¼Œç®€å•æ¥è¯´ `CF` ä¼šè¢«è®¾ä¸ºæœ€åä¸€ä¸ªç§»å‡ºçš„ä½ï¼Œåªæœ‰ä½ç§»ä½æ•°ä¸º 1 æ—¶æ‰ä¼šæ”¹å˜ `OF`ã€‚\n\n### Condition Codes\n\ncondition code æ˜¯ status flags çš„ç»„åˆï¼Œå¸¸ç”¨çš„æœ‰ï¼š\n\n| condition code |               åç§° (æ„ä¹‰)                |        å–å€¼        |\n| :------------: | :--------------------------------------: | :----------------: |\n|    `e`/`z`     |               equal / zero               |        `ZF`        |\n|   `ne`/`nz`    |           not equal / not zero           |       `~ZF`        |\n|      `s`       |             sign (negative)              |        `SF`        |\n|      `ns`      |         not sign (non-negative)          |       `~SF`        |\n|   `g`/`nle`    |  greater / not less equal (signed $>$)   | `~(SF ^ OF) & ~ZF` |\n|   `ge`/`nl`    | greater equal / not less (signed $\\ge$)  |    `~(SF ^ OF)`    |\n|   `l`/`nge`    |  less / not greater equal (signed $<$)   |     `SF ^ OF`      |\n|   `le`/`ng`    | less equal / not greater (signed $\\le$)  | `(SF ^ OF) \\| ZF`  |\n|   `a`/`nbe`    |  above / not below equal (unsigned $>$)  |    `~CF & ~ZF`     |\n|   `ae`/`nb`    | above equal / not below (unsigned $\\ge$) |       `~CF`        |\n|   `b`/`nae`    |  below / not above equal (unsigned $<$)  |        `CF`        |\n|   `be`/`na`    | below equal / not above (unsigned $\\le$) |     `CF \\| ZF`     |\n\nè¿™äº› condition code éƒ½æ˜¯æŒ‰ç…§å‡æ³•çš„ç»“æœæ¥å‘½åçš„ï¼Œåœ¨ä½¿ç”¨ `CMP` æŒ‡ä»¤æ—¶è¿™äº›åç§°æ˜¯è‡ªç„¶çš„ï¼Œä½†å¦‚æœä¸æ˜¯ `CMP`/`SUB` åˆ™è¦è€ƒè™‘è¿›è¡Œçš„è¿ç®—æ˜¯ä»€ä¹ˆä»¥åŠæ¯ä¸ª condition code å®é™…çš„å–å€¼ã€‚\n\n`l`/`nge` å¯ä»¥ç†è§£ä¸ºï¼Œæº¢å‡ºåä¼šå˜å·ï¼Œæ‰€ä»¥ `SF ^ OF` å°±æ˜¯å¦‚æœä¸æº¢å‡ºçš„ç¬¦å·ï¼›`b`/`nae` æ˜¯å› ä¸ºå‡æ³•å‘ç”Ÿå€Ÿä½æ—¶ä¼šæ ‡è®° `CF`ã€‚\n\n### CMP å’Œ TEST æŒ‡ä»¤\n\nå¦‚æœçœŸçš„è¿›è¡Œè¿ç®—ï¼Œdestination çš„å€¼ä¼šè¢«è¦†ç›–ï¼Œæ‰€ä»¥ï¼Œå¦‚æœè®¡ç®—ç»“æœæ˜¯ä¸éœ€è¦çš„ï¼Œä¸€èˆ¬ä¼šç”¨ `CMP` å’Œ `TEST` æ¥è·å– status flagsã€‚\n\n`CMP` å’Œ `TEST` çš„ operands å’Œ [äºŒå…ƒè¿ç®—](#äºŒå…ƒè¿ç®—) ç›¸åŒã€‚\n\n`CMP` ç›¸å½“äºæ‰§è¡Œ `SUB` ä½†åªæ›´æ–° status flags ä¸æ›´æ–° destinationã€‚å¸¸ç”¨äºæ¯”è¾ƒä¸¤ä¸ªæ•°çš„å¤§å°ã€‚\n\n<Card type="warn" title="CMP çš„æ¯”è¾ƒé¡ºåº">\n    ç”±äº ATT æ ¼å¼çš„æ±‡ç¼–æ˜¯ source åœ¨å‰ destination åœ¨åï¼Œ `CMP` çš„å‡æ³•æ˜¯\n    destination å‡å» sourceï¼Œ æ‰€ä»¥æ¯”è¾ƒæ˜¯çœ‹èµ·æ¥æ˜¯åçš„ï¼Œä¾‹å¦‚ `l` å…¶å®æ˜¯ç¬¬äºŒä¸ª\n    operand å°äºç¬¬ä¸€ä¸ª operandã€‚\n</Card>\n\n`TEST` ç›¸å½“äºæ‰§è¡Œ `AND` ä½†åªæ›´æ–° status flags ä¸æ›´æ–° destinationã€‚å¸¸è§çš„ç”¨æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¸¤ä¸ª operand ä¸ºåŒä¸€ä¸ªå¯„å­˜å™¨ä»¥åˆ¤æ–­å…¶ç¬¦å·ï¼Œå¦ä¸€ç§æ˜¯ source ä¸º bit maskã€‚\n\n### SETcc æŒ‡ä»¤\n\n`SETcc r/m8`: å°† `cc` å¤åˆ¶åˆ° operand å¤„ã€‚å…¶åç¼€ä¸æ˜¯ operand çš„é•¿åº¦ï¼Œè€Œæ˜¯ condition codeï¼Œä¾‹å¦‚ `sete r/m8`ã€`setne r/m8`ã€`sets r/m8`...\n\n### Jump ç±»æŒ‡ä»¤\n\n#### Label\n\nåœ¨æ±‡ç¼–ä¸­ jump é€šå¸¸ä¼šä½¿ç”¨ label ä½œä¸º jump targetï¼Œä¾‹å¦‚ï¼ˆCS:APP P205ï¼‰ï¼š\n\n```asm\n    movq $0, %rax\n    jmp  .L1\n    movq (%rax), %rdx\n.L1:\n    popq %rdx\n```\n\nè¿™é‡Œçš„ `.L1` å°±æ˜¯ä¸€ä¸ª labelã€‚\n\n#### æ— æ¡ä»¶è·³è½¬\n\n-   `jmp Label`: è·³è½¬åˆ° `Label` å¤„\n-   `jmp *r/m64`: è·³è½¬åˆ° operand å­˜å‚¨çš„ jump target å¤„ï¼Œä¾‹å¦‚ `jmp *%rax`ã€`jmp *(%rax)`ã€‚\n\n#### æ¡ä»¶è·³è½¬\n\n`Jcc Label`: å¦‚æœæ»¡è¶³ `cc`ï¼Œåˆ™è·³è½¬åˆ° `Label` å¤„ã€‚\n\n#### rep; ret\n\nå¦‚æœ `ret` ä¼šä½œä¸ºæŸä¸ªåˆ†æ”¯çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼ˆå³ jump æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤æˆ– jump targetï¼‰ï¼Œä¸€èˆ¬ä¼šæŠŠ `ret` æ¢æˆ `rep; ret`ï¼Œæ•ˆæœå’Œ `ret` ä¸€æ ·ï¼Œä½†å¯ä»¥é¿å…é”™è¯¯çš„åˆ†æ”¯é¢„æµ‹ï¼Œä»è€Œä¼˜åŒ–æ€§èƒ½ã€‚å…·ä½“å¯ä»¥å‚è€ƒ [repz ret - repz ret](https://repzret.org/p/repzret/)ã€‚\n\n#### jump æŒ‡ä»¤ç¼–ç \n\nåœ¨è¿›è¡Œæ±‡ç¼–æ—¶ï¼Œlabel ä¼šè¢«æ›¿æ¢ä¸º _jump æŒ‡ä»¤çš„**ä¸‹ä¸€æ¡**æŒ‡ä»¤ï¼ˆå…¶å®å°±æ˜¯ program counter çš„å€¼ï¼‰åˆ° jump target çš„åœ°å€å·®_ã€‚è€Œåœ¨é“¾æ¥æ—¶ï¼Œè™½ç„¶æŒ‡ä»¤çš„åœ°å€å˜äº†ï¼Œä½†æŒ‡ä»¤ä¹‹é—´ç›¸å¯¹çš„åœ°å€å·®ä¸å˜ï¼Œåˆ™ jump æŒ‡ä»¤ä¸ç”¨æ”¹å˜ã€‚\n\nä¾‹å¦‚ï¼ˆCS:APP P207ï¼‰ï¼š\n\n```asm\n    movq %rdi, %rax\n    jmp .L2\n.L3:\n    sarq %rax\n.L2:\n    testq %rax, %rax\n    jg .L3\n    rep; ret\n```\n\næ±‡ç¼–åï¼š\n\n```asm\n   0:	48 89 f8             	mov    %rdi,%rax\n   3:	eb 03                	jmp    0x8\n   5:	48 d1 f8             	sar    %rax\n   8:	48 85 c0             	test   %rax,%rax\n   b:	7f f8                	jg     0x5\n   d:	f3 c3                	repz ret\n```\n\nè¿™é‡Œ `jmp .L2` çš„ operand ç¼–ç ä¸º `0x03`ï¼Œå³å…¶ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ `0x5` åˆ° jump target `0x8` çš„è·ç¦»ï¼›`jg .L3` çš„ operand ç¼–ç ä¸º `0xf8` å³ -8ï¼Œä¹Ÿå°±æ˜¯å…¶ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ `0xd` åˆ° jump target `0x5` çš„è·ç¦»ã€‚\n\né“¾æ¥åï¼š\n\n```asm\n000000000000112e <foo>:\n    112e:       48 89 f8                mov    %rdi,%rax\n    1131:       eb 03                   jmp    1136 <foo+0x8>\n    1133:       48 d1 f8                sar    %rax\n    1136:       48 85 c0                test   %rax,%rax\n    1139:       7f f8                   jg     1133 <foo+0x5>\n    113b:       f3 c3                   repz ret\n```\n\n### CMOVcc æŒ‡ä»¤\n\n`CMOVcc` å¯ä»¥åœ¨æ»¡è¶³ `cc` æ—¶å°† source å¤åˆ¶åˆ° destinationã€‚è¿™æ¡æŒ‡ä»¤åœ¨ ATT æ ¼å¼ä¸­æ²¡æœ‰é•¿åº¦ç±»å‹åç¼€ï¼Œé€šè¿‡ destination register çš„é•¿åº¦æ¥æ¨æ–­ç±»å‹ã€‚ä¸æ¥å— byte ä½œä¸º operandã€‚\n\n-   `CMOVcc r/m16, r16`\n-   `CMOVcc r/m32, r32`\n-   `CMOVcc r/m64, r64`\n\n### å®ç° if-else è¯­å¥\n\nå®ç° if-else è¯­å¥ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š\n\n1.  Conditional control: å³é€šè¿‡ jump æŒ‡ä»¤æ›´æ”¹æŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºã€‚\n2.  Conditional moves: å³é€šè¿‡ `CMOVcc` ç­‰æŒ‡ä»¤ï¼Œæ ¹æ®æ¡ä»¶å†³å®šæ˜¯å¦æ‰§è¡Œè¿™ä¸€æ¡æŒ‡ä»¤ï¼Œä½†ä¸æ”¹å˜æŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºã€‚\n\nï¼ˆå…·ä½“å®ç°æ–¹å¼å¯ä»¥å‚è€ƒ CS:APP ä¸­çš„ä¾‹å­ã€‚ï¼‰\n\nconditonal control æ˜¯é€šç”¨çš„ï¼Œä½† conditonal moves åªåœ¨æœ‰é™çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨ conditional moves æ—¶éœ€è¦å…ˆå°†ä¸¤ä¸ªåˆ†æ”¯éƒ½ç®—å‡ºæ¥ï¼Œç„¶åæ ¹æ®æ¡ä»¶æ¥è¿›è¡Œ moveï¼Œæ‰€ä»¥è¦æ±‚åˆ†æ”¯ä¸­æ²¡æœ‰å‰¯ä½œç”¨ã€‚\n\nconditional moves æœ‰æ—¶å¯ä»¥ç”¨æ¥ä¼˜åŒ–æ€§èƒ½ï¼Œä¸»è¦æ˜¯å› ä¸ºç°ä»£å¤„ç†å™¨çš„ _pipelining_ï¼Œå³åœ¨ç‰©ç†ä¸ŠåŒæ—¶æ‰§è¡Œå¤šæ¡æŒ‡ä»¤ï¼ˆä½†åœ¨æ•ˆæœä¸Šå’ŒæŒ‰é¡ºåºæ‰§è¡Œä¸€è‡´ï¼‰ã€‚æ¡ä»¶è·³è½¬ä½¿å¾—å¤„ç†å™¨ä¸èƒ½ç¡®å®šæœªæ¥è¦æ‰§è¡Œå“ªäº›æŒ‡ä»¤ï¼Œè€Œåªèƒ½è¿›è¡Œåˆ†æ”¯é¢„æµ‹ï¼Œå¦‚æœé¢„æµ‹å¤±è´¥ pipelining å°±ç™½è´¹äº†ã€‚è€Œ conditional move ä¸ä¼šç ´åæŒ‡ä»¤æ‰§è¡Œçš„é¡ºåºï¼Œä¹Ÿå°±ä¸å½±å“ pipeliningï¼Œæ‰€ä»¥å¯ä»¥èµ·åˆ°ä¼˜åŒ–çš„æ•ˆæœã€‚ä½†æ˜¯ï¼Œconditional moves é™¤äº†è¦æ±‚åˆ†æ”¯æ— å‰¯ä½œç”¨ï¼Œè¿˜éœ€è¦ä¸¤ä¸ª branch éƒ½æ‰§è¡Œï¼Œæ‰€ä»¥å¦‚æœåˆ†æ”¯è¿‡å¤§ï¼Œå°±ä¸å¦‚ conditional controlã€‚\n\n### å®ç°å¾ªç¯è¯­å¥\n\n`do while`: è·‘å®Œä¸€æ®µä»£ç åè¿›è¡Œæµ‹è¯•ï¼Œé€šè¿‡åˆ™è·³è½¬åˆ°å¼€å¤´ã€‚\n\n`while`: åœ¨ `do while` çš„åŸºç¡€ä¸Šï¼Œè¦ä¹ˆåœ¨å¼€å¤´ç›´æ¥è·³è½¬åˆ°æµ‹è¯• (jump to middle)ï¼Œè¦ä¹ˆåœ¨å¼€å¤´è¿›è¡Œä¸€æ¬¡æµ‹è¯•ï¼Œä¸é€šè¿‡åˆ™è·³åˆ°ç»“å°¾ (guarded do)ã€‚\n\n`for`: åœ¨ `while` çš„åŸºç¡€ä¸Šï¼Œå¼€å¤´åˆå§‹åŒ–ï¼Œæµ‹è¯•å‰æ›´æ–°ã€‚\n\n### å®ç° switch è¯­å¥\n\nå…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒ CS:APPï¼Œé‡ç‚¹åœ¨äºï¼Œå¦‚æœ cases çš„å€¼ä¸è¿‡äºç¨€ç–ï¼Œå¯ä»¥å»ºä¸€ä¸ªå«åš jump table çš„æ•°ç»„ï¼Œä»¥ cases çš„å€¼ä½œä¸ºä¸‹æ ‡ï¼Œlabel ä½œä¸ºå€¼ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨ä¸€æ¬¡æ•°ç»„è®¿é—®è€Œéå¤šæ¬¡æ¡ä»¶è·³è½¬æ¥å®ç° `switch` è¯­å¥ã€‚jump table ä¹Ÿå¯ä»¥å’Œæ¡ä»¶è·³è½¬ç»“åˆï¼Œä»¥å¤„ç† default case æˆ–è€…ä¸ªåˆ« casesã€‚\n\n## Procedures\n\nprocedure çš„å®ç°ä¸»è¦æ¶‰åŠä¸‰ä¸ªæ–¹é¢ï¼š\n\n-   åœ¨ä¸åŒçš„ procedure ä¹‹é—´è½¬ç§»æ§åˆ¶æƒï¼Œå³è°ƒç”¨ procedure æ—¶äº¤å‡ºæ§åˆ¶æƒï¼Œprocedure è¿”å›æ—¶æ‹¿å›æ§åˆ¶æƒ\n-   ä¼ é€’å‚æ•°å’Œè¿”å›å€¼\n-   ä¸ºå±€éƒ¨å˜é‡åˆ†é…/é‡Šæ”¾å†…å­˜\n\nè°ƒç”¨ procedure çš„æ ¸å¿ƒæ˜¯åœ¨ [push/pop stack](#pushpop-stack) ä¸€èŠ‚ä¸­ä»‹ç»è¿‡çš„ runtime stackã€‚å¤§ä½“ä¸Šæ¥è®²ï¼Œstack ä¼šåˆ†æˆä¸€å † frameï¼Œæ ˆé¡¶çš„ frame ä¸ºå½“å‰ procedure çš„ç›¸å…³æ•°æ®ï¼Œä»æ ˆé¡¶åˆ°æ ˆåº•çš„å„ä¸ª frame ä¾æ¬¡æ”¾ç€è°ƒç”¨é“¾ä¸Šçš„å„ä¸ª procedureï¼Œåœ¨è°ƒç”¨ä¸€ä¸ª procedure æ—¶ä¼šå°†ç›¸å…³æ•°æ®å‹å…¥æ ˆä¸­ï¼Œè¿”å›æ—¶å†å¼¹å‡ºã€‚\n\nè¿™éƒ¨åˆ†ä¼šé‡‡å–â€œç®€ä»‹-åŸåˆ™-å®ç°â€çš„ç»“æ„ï¼Œå…ˆç®€å•ä»‹ç»å¤§æ¦‚æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œå†è¯´æ˜å®ç°éœ€è¦éµå¾ªçš„åŸåˆ™ï¼Œå†è¯´æ˜å…·ä½“å®ç°ï¼Œä»¥åŠå®ç°æ˜¯å¦‚ä½•æ»¡è¶³ä»¥åŠåˆ©ç”¨åŸåˆ™çš„ã€‚\n\n### è½¬ç§»æ§åˆ¶æƒ\n\nè°ƒç”¨ procedure æ—¶ï¼Œä¼šå°†å½“å‰ program counter çš„å€¼å­˜åœ¨ stack ä¸­ï¼Œç„¶åå°† program counter ä¿®æ”¹ä¸º calleeï¼Œåœ¨è¿”å›æ—¶å†ä» stack ä¸­å–å‡º caller çš„åœ°å€è®¾ä¸º program counterã€‚\n\n<Card type="hint" title="å­˜æ”¾ caller åœ°å€çš„åŸåˆ™">\nè¿›å…¥ä¸€ä¸ª procedure æ—¶ï¼Œæ ˆé¡¶æ”¾çš„æ˜¯ caller çš„åœ°å€ï¼ˆå…·ä½“æ¥è¯´ï¼Œæ˜¯ `call` æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚\n\nè¿”å›æ—¶ï¼Œè¿™ä¸ª caller çš„åœ°å€ä¼šå‡ºæ ˆï¼Œå³è¿”å›åçš„ `%rsp` æ˜¯è¿›å…¥æ—¶çš„ `%rsp` åŠ  8ã€‚\n\n</Card>\n\nå…·ä½“å®ç°ä¼šä½¿ç”¨ `CALL` å’Œ `RET` ä¸¤æ¡æŒ‡ä»¤ï¼š\n\n-   `call Label`\n-   `call *(r/m64)`\n-   `ret`\n\nå…¶ä¸­ `call` çš„ operand å’Œ `jmp` æ˜¯ä¸€æ ·çš„ï¼Œæ•ˆæœç›¸å½“äºå…ˆ `pushq %rip` å† `jmp`ã€‚`ret` åˆ™ç›¸å½“äºæŠŠ `popq` çš„ç»“æœä½œä¸º `jmp` çš„ operandã€‚\n\n### ä¼ é€’å‚æ•°\n\nå¯„å­˜å™¨ä¸­æœ‰ 6 ä¸ªç”¨æ¥å­˜æ”¾ procedure çš„ argumentsï¼Œå¦‚æœå‚æ•°å¤šäº 6 ä¸ªï¼Œåˆ™ä¼šæ”¾åœ¨ stack ä¸­ã€‚\n\n| bits |   1    |   2    |   3    |   4    |   5    |   6    |\n| :--: | :----: | :----: | :----: | :----: | :----: | :----: |\n|  64  | `%rdi` | `%rsi` | `%rdx` | `%rcx` | `%r8`  | `%r9`  |\n|  32  | `%edi` | `%esi` | `%edx` | `%ecx` | `%r8d` | `%r9d` |\n|  16  | `%di`  | `%si`  | `%dx`  | `%cx`  | `%r8w` | `%r9w` |\n|  8   | `%dil` | `%sil` | `%dl`  | `%cl`  | `%r8b` | `%r9b` |\n\n<Card type="hint" title="å­˜æ”¾å‚æ•°çš„åŸåˆ™">\n    è¿›å…¥ procedure æ—¶ï¼Œå‰ 6 ä¸ªå‚æ•°ï¼ˆå¦‚æœæœ‰ï¼‰ä¼šè¢«æ”¾åœ¨ç›¸åº”çš„å¯„å­˜å™¨ä¸­ï¼›å…¶ä½™å‚æ•°æ”¾åœ¨\n    stack ä¸­ï¼Œå…·ä½“æ¥è¯´ï¼Œç¬¬ $n$ ä¸ªå‚æ•°è¢«æ”¾åœ¨æ ˆé¡¶ä¸‹é¢çš„ç¬¬ $n-6$ ä¸ªä½ç½®ï¼Œä¹Ÿå°±æ˜¯\n    `M[R[%rsp] + 8(n-6)]`ã€‚\n</Card>\n\nå…·ä½“å®ç°ä¸ºï¼š\n\n-   åœ¨ caller ä¸­ã€`call` ä¹‹å‰ï¼šå°†å‰ 6 ä¸ªå‚æ•°æ”¾åœ¨ç›¸åº”çš„å¯„å­˜å™¨ï¼Œå¹¶å°†å…¶ä½™å‚æ•°æŒ‰ä»åå‘å‰çš„é¡ºåºä¾æ¬¡å‹å…¥ stack\n-   åœ¨ caller ä¸­ã€`call` ä¹‹åï¼šæŠŠ stack ä¸­çš„å‚æ•°ï¼ˆå¦‚æœæœ‰ï¼‰å¼¹å‡º (`addq $8(n-6), %rsp`)\n-   åœ¨ callee ä¸­ï¼šä»ç›¸åº”çš„å¯„å­˜å™¨æˆ– stack ä¸­è¯»å–å‚æ•°\n\n### ä¼ é€’è¿”å›å€¼\n\n<Card type="hint" title="å­˜æ”¾è¿”å›å€¼çš„åŸåˆ™">\n    åœ¨è°ƒç”¨ procedure å¹¶è¿”å›åï¼Œå¦‚æœè¯¥ procedure æœ‰è¿”å›å€¼ï¼Œ`%rax`\n    ä¸­å­˜æ”¾çš„æ˜¯è¯¥è¿”å›å€¼ã€‚\n</Card>\n\nå…·ä½“å®ç°å°±æ˜¯åœ¨ `ret` å‰ç¡®ä¿ `%rax` ä¸­æ”¾çš„æ˜¯è¿”å›å€¼ã€‚\n\n### å­˜å‚¨å±€éƒ¨å˜é‡\n\nå±€éƒ¨å˜é‡ä¸€èˆ¬ä¼šä¼˜å…ˆæ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œå¦‚æœæ”¾ä¸ä¸‹å°±ä¼šæ”¾åœ¨ stack ä¸­ã€‚\n\nç‰¹åˆ«åœ°ï¼Œå¦‚æœä»£ç ä¸­æ¶‰åŠåˆ°å–å±€éƒ¨å˜é‡çš„åœ°å€ï¼Œæˆ–è€…å±€éƒ¨å˜é‡æ˜¯ç»“æ„åŒ–æ•°æ®ï¼ˆä¾‹å¦‚æ•°ç»„æˆ–ç»“æ„ä½“ï¼‰ï¼Œåˆ™å¿…é¡»æ”¾åœ¨ stack ä¸­ã€‚\n\nå¦‚æœå±€éƒ¨å˜é‡æ”¾åœ¨å¯„å­˜å™¨ä¸­ï¼Œä¸”åœ¨ä½¿ç”¨è¯¥å±€éƒ¨å˜é‡çš„è¿‡ç¨‹ä¸­è°ƒç”¨äº† procedureï¼Œé‚£ä¹ˆè¯¥å±€éƒ¨å˜é‡å°±ä¼šéœ€è¦å…ˆå­˜èµ·æ¥ä»¥ä¿è¯è°ƒç”¨ procedure ä¹‹åä¸ä¼šæ”¹å˜ï¼Œè€Œè¿™æœ‰ä¸¤ç§æ–¹å¼å®ç°ï¼š\n\n-   caller savedï¼Œå³åœ¨ caller ä¸­å°†å¯„å­˜å™¨é‡Œçš„å€¼å­˜åœ¨ stack é‡Œã€‚\n-   callee savedï¼Œå³åœ¨ callee ä¸­å­˜å‚¨ï¼šæœ‰ä¸€äº›ç‰¹æ®Šçš„å¯„å­˜å™¨æ˜¯ callee-saved registerï¼Œå¦‚æœæŠŠå±€éƒ¨å˜é‡å­˜åœ¨è¿™äº›å¯„å­˜å™¨ä¸­ï¼Œåœ¨ caller ä¸­å°±ä¸ç”¨æ‹…å¿ƒå®ƒä»¬çš„å€¼ä¼šåœ¨è°ƒç”¨ procedure åè¢«ä¿®æ”¹ã€‚\n\n<Card type="hint" title="callee-saved registers çš„ä½¿ç”¨åŸåˆ™">\næœ‰ 6 ä¸ªç‰¹æ®Šçš„å¯„å­˜å™¨ `%rbx`ã€`%rbp`ã€`%r12-15` æ˜¯ callee-saved registerã€‚\n\nä»»ä½• procedure éƒ½è¦ä¿è¯ï¼Œæ¯ä¸ª callee-saved register çš„å€¼åœ¨è¿›å…¥å’Œè¿”å›æ—¶æ˜¯ç›¸åŒçš„ã€‚\n\n</Card>\n\ncaller saved çš„å…·ä½“å®ç°ï¼šåœ¨ `call` ä¹‹å‰ï¼ˆä»¥åŠå‹å…¥è¶…è¿‡ 6 ä¸ªçš„å‚æ•°ä¹‹å‰ï¼‰å°†å±€éƒ¨å˜é‡å…¥æ ˆï¼Œ`call` ä¹‹åï¼ˆä»¥åŠå¼¹å‡ºæ”¾åœ¨æ ˆä¸­çš„å‚æ•°ä¹‹åï¼‰å†æŠŠæ ˆä¸­å­˜çš„å¼¹å‡ºåˆ°å¯„å­˜å™¨ä¸­ã€‚\n\ncallee saved çš„å…·ä½“å®ç°ï¼šå¦‚æœä¸€ä¸ª procedure ä½¿ç”¨äº†æŸä¸ª callee-saved registerï¼Œåˆ™è¦åœ¨ procedure çš„å¼€å¤´å°†è¿™ä¸ªå¯„å­˜å™¨åŸæœ¬çš„å€¼å…¥æ ˆï¼Œè€Œåœ¨ procedure çš„ç»“å°¾å°†å­˜ä¸‹æ¥çš„è¿™ä¸ªåŸæœ¬çš„å€¼å¼¹å‡ºåˆ°ç›¸åº”çš„å¯„å­˜å™¨ä¸­ã€‚\n\nä¸ºäº†å°½å¯èƒ½ä½¿ç”¨ï¼ˆæ•°é‡å°½é‡å°‘çš„ï¼‰å¯„å­˜å™¨è€Œé stackï¼Œç»å¸¸ä¼šæœ‰å¤šä¸ªç”Ÿå‘½å‘¨æœŸä¸äº¤å‰çš„çš„å˜é‡å…±ç”¨ä¸€ä¸ªå¯„å­˜å™¨ï¼Œæˆ–è€…ä¸´æ—¶åœ°æŠŠå±€éƒ¨å˜é‡æ”¾åœ¨ä¸€èˆ¬ç”¨äºå­˜æ”¾å‚æ•°æˆ–è¿”å›å€¼çš„å¯„å­˜å™¨ä¸­ã€‚\n\n### å¯å˜å¤§å°çš„ stack frame\n\né€šå¸¸æƒ…å†µä¸‹ä¸€ä¸ª procedure çš„ stack frame çš„å¤§å°æ˜¯ç¡®å®šçš„ï¼Œä½†æœ‰æ—¶ stack frame çš„å¤§å°æ˜¯ä¸èƒ½åœ¨ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼ˆä¾‹å¦‚æœ‰éç¡®å®šå¤§å°çš„æ•°ç»„ï¼‰ã€‚\n\nstack frame å¤§å°ç¡®å®šä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿé€šè¿‡ä¸ `%rsp` å³æ ˆé¡¶çš„ç›¸å¯¹è·ç¦»æ¥è®¿é—®å±€éƒ¨å˜é‡ç­‰ï¼Œåœ¨ stack frame å¤§å°ä¸ç¡®å®šæ—¶ï¼Œåˆ™å¯ä»¥é€šè¿‡è®°å½• stack frame åº•éƒ¨çš„åœ°å€æ¥è®¿é—®å±€éƒ¨å˜é‡ã€‚\n\n<Card type="hint" title="stack frame pointer çš„åŸåˆ™">\n    åœ¨ stack frame å¤§å°ä¸ç¡®å®šæ—¶ï¼Œä½¿ç”¨ `%rbp` ä½œä¸º frame pointer (base\n    pointer)ï¼Œå…¶å€¼ä¸ºåˆšè¿›å…¥ procedure æ—¶çš„ `%rsp`ã€‚\n</Card>\n\nå…·ä½“å®ç°ä¸ºï¼š\n\n```asm\nfunction_name:\n    pushq %rbp\n    movq %rsp, %rbp\n    â€¦â€¦\n    leave\n    ret\n```\n\nè®¾ç½®å¥½ `%rbp` åï¼Œå°±å¯ä»¥ä½¿ç”¨ `-8(%rbp)` ç­‰æ–¹å¼è®¿é—®ç›¸å¯¹äº stack frame åº•ç«¯çš„ä½ç½®äº†ã€‚\n\nè¿™é‡Œæœ‰ä¸€ä¸ªæ–°æŒ‡ä»¤ `leave`: æ²¡æœ‰ operandï¼Œç›¸å½“äº `move %rbp, %rsp` ç„¶å `pop %rbp`ã€‚\n\n<Card title="<code>leave</code> vs <code>enter</code>">\n    ä¸Šé¢çš„ä»£ç ä¸­ä½¿ç”¨äº† `leave` è€Œé `move %rbp, %rsp`ã€`pop %rbp`ï¼Œä½†æ²¡æœ‰ä½¿ç”¨\n    `enter` æŒ‡ä»¤ï¼Œç®€å•æ¥è¯´æ˜¯å†å²ä»¥åŠæ€§èƒ½åŸå› ï¼Œå¯ä»¥å‚è€ƒ [assembly - "enter" vs\n    "push ebp; mov ebp, esp; sub esp, imm" and "leave" vs "mov esp, ebp; pop\n    ebp" - Stack\n    Overflow](https://stackoverflow.com/questions/5959890/enter-vs-push-ebp-mov-ebp-esp-sub-esp-imm-and-leave-vs-mov-esp-ebp)ã€‚\n</Card>\n\né™¤äº†ä½¿ç”¨ `%rbp` ä½œä¸º frame pointerï¼Œä¸ºéç¡®å®šå¤§å°çš„æ•°ç»„åˆ†é…æ ˆç©ºé—´è¿˜æ¶‰åŠåˆ° [data alignment](#data-alignment) çš„é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ CS:APP Practice Problem 3.49ã€‚\n\n### Stack Frame Alignment\n\nx86-64 ä¸­è¦æ±‚ stack frame ä»¥ 16 byte å¯¹é½ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯æ‰§è¡Œ `call` ä¹‹å‰ `%rsp` çš„å€¼å¿…é¡»æ˜¯ 16 çš„å€æ•°ï¼Œè€Œåœ¨è¿›å…¥ä¸€ä¸ª procedure æ—¶ `%rsp` çš„å€¼å°±æ¨¡ 16 ä½™ 8ã€‚\n\nä¸ºäº†æ»¡è¶³è¿™ä¸€å¯¹é½è¦æ±‚ï¼Œæœ‰æ—¶ä¼šåœ¨ `call` ä¹‹å‰å…ˆ `subq $8, %rsp`ï¼Œ`call` ä¹‹åå† `addq $8, %rsp`ã€‚\n\n## Array Allocation and Access\n\nç®€å•æ¥è¯´ï¼Œ`Imm(rb, ri, s)` çš„ operand æ ¼å¼ä½¿å¾—æ•°ç»„è®¿é—®å˜å¾—å®¹æ˜“ã€‚\n\nè€Œç¼–è¯‘å™¨ä¼šåšå¾ˆå¤šä¼˜åŒ–ï¼Œä¾‹å¦‚ç”¨æŒ‡é’ˆåŠ æ³•ä»£æ›¿æ¯æ¬¡éƒ½ç®—ä¸€éä¹˜æ³•ã€‚\n\n## Heterogeneous Data Structures\n\n### Struct\n\nç»“æ„ä½“ä¹Ÿæ˜¯å†…å­˜ä¸­è¿ç»­çš„ä¸€æ®µï¼Œä¼šåœ¨ç¼–è¯‘æ—¶åœ¨ç»“æ„ä½“åœ°å€çš„åŸºç¡€ä¸ŠåŠ ä¸Šç›¸åº”çš„ offset æ¥è®¿é—®å„ä¸ª fieldã€‚\n\n### Union\n\nunion çš„å¤§å°æ˜¯æœ€å¤§çš„ field çš„å¤§å°ï¼Œæ¯ä¸ª field çš„ offset éƒ½æ˜¯ 0ã€‚\n\nåœ¨ä½¿ç”¨ union æ—¶ï¼Œbyte ordering å¯èƒ½éå¸¸é‡è¦ã€‚\n\n### Data Alignment\n\nåœ¨ x86-64 ä¸­ï¼Œè¿›è¡Œ data alignment å¯ä»¥æå‡ç¨‹åºæ•ˆç‡ã€‚å…·ä½“è¦æ±‚ä¸ºï¼Œä»»ä½•ï¼ˆä¸»è¦æ˜¯ç»“æ„ä½“å†…çš„ï¼‰primitive type çš„åœ°å€éœ€è¦æ˜¯å…¶é•¿åº¦çš„å€æ•°ã€‚\n\nä¸ºäº†æ»¡è¶³ alignment è¦æ±‚ï¼Œå¯èƒ½éœ€è¦ï¼š\n\n1.  åœ¨ç»“æ„ä½“çš„ä¸åŒ field ä¹‹é—´æ·»åŠ  padding\n2.  ä¿è¯ç»“æ„ä½“è‡ªèº«çš„åœ°å€æ˜¯å…¶è‡ªèº« alignment çš„å€æ•°\n3.  åœ¨ç»“æ„ä½“æœ«å°¾æ·»åŠ  paddingï¼Œä¾‹å¦‚åœ¨æ•°ç»„ä¸­éœ€è¦ä¿è¯ä¸‹ä¸€ä¸ªå…ƒç´ çš„èµ·å§‹åœ°å€ä¸ºå…¶ alignment çš„å€æ•°\n\næ±‡ç¼–ä»£ç ä¸­ä¼šä½¿ç”¨ `.align` directive æ¥æŒ‡å®š data alignmentã€‚\n\n## Thwarting Buffer Overflow Attacks\n\näº†è§£äº† stack çš„æ„é€ ï¼Œå°±èƒ½æ›´åŠ æ˜ç™½æ•°ç»„è¶Šç•Œçš„å±å®³ï¼šå¯ä»¥ä¿®æ”¹ stack ä¸ŠåŒ…æ‹¬ caller address åœ¨å†…çš„æ•°æ®ï¼Œå¯¼è‡´ç¨‹åºå‡ºé”™æˆ–è·³è½¬åˆ°é”™è¯¯çš„ä½ç½®ï¼Œè€Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€æ¼æ´è·³è½¬åˆ°è®¾è®¡å¥½çš„ä½ç½®ä»¥æ‰§è¡Œæ”»å‡»ä»£ç ã€‚\n\nä¸‹é¢æ˜¯ä¸€äº›æ— éœ€ä¿®æ”¹ç¨‹åºä»£ç å°±èƒ½åšåˆ°çš„é™ä½ buffer overflow å±å®³çš„æ–¹æ³•ï¼Œå½“ç„¶ï¼Œè¿™äº›æ–¹æ³•ä¹Ÿä¸æ˜¯ä¸‡èƒ½æˆ–æ€»æ˜¯æœ‰æ•ˆçš„ã€‚\n\n### Stack Randomization\n\nå¯ä»¥ä¿®æ”¹ stack çš„èµ·å§‹åœ°å€ï¼Œä»¥é™ä½æŒ‡ä»¤åœ°å€çš„å¯é¢„æµ‹æ€§ï¼Œå¢å¤§æ”»å‡»éš¾åº¦ã€‚è¿™åœ¨ Linux ä¸­å·²ç»æ˜¯æ ‡å‡†åšæ³•äº†ï¼Œæ˜¯ address-space layout randomization (ASLR) çš„ä¸€éƒ¨åˆ†ã€‚\n\næ”»å‡»è€…å¯ä»¥é€šè¿‡ â€œnop sledâ€ï¼Œå³é€šè¿‡å¤§é‡ `nop` æŒ‡ä»¤æ¥å¢é•¿æ”»å‡»ä»£ç çš„é•¿åº¦ï¼Œæ¥é™ä½çŒœæµ‹æŒ‡ä»¤åœ°å€çš„éš¾åº¦ã€‚\n\n### Stack Corruption Detection\n\ngcc ä½¿ç”¨ _stack protector_ æ¥æ£€æµ‹ stack corruptionï¼Œä»¥é¿å… corrupted stack é€ æˆçš„å±å®³ã€‚\n\nç®€å•æ¥è¯´ï¼Œä½¿ç”¨ stack protector æ—¶ï¼Œä¼šåœ¨ stack frame ä¸­æ’å…¥ä¸€ä¸ªè¿è¡Œæ—¶éšæœºç”Ÿæˆçš„ _canary value_ (_guard value_) ï¼Œå¹¶åœ¨ `ret` å‰æ£€æŸ¥è¿™ä¸ªå€¼æ˜¯å¦è¢«ä¿®æ”¹ã€‚\n\n### Limiting Executable Code Regions\n\nå¯ä»¥é™åˆ¶èƒ½å¤Ÿè¢«æ‰§è¡Œçš„ memory regionï¼Œä»¥é¿å…æ”»å‡»è€…æ‰§è¡Œä½äº stack ä¸­çš„ã€ç”±æ”»å‡»è€…æ³¨å…¥çš„æŒ‡ä»¤ã€‚\n\nä½†æ˜¯ï¼Œæœ‰çš„è¯­è¨€ï¼ˆä¾‹å¦‚ Javaï¼‰å¯èƒ½éœ€è¦èƒ½å¤Ÿæ‰§è¡ŒåŠ¨æ€ç”Ÿæˆçš„æŒ‡ä»¤ï¼Œè¿™æ ·çš„è¯å°±ä¸èƒ½ç¦æ­¢æ‰§è¡Œ stack ä¸­çš„æŒ‡ä»¤ã€‚\n\n## Floating-Point Code\n\nè¿™éƒ¨åˆ†å†…å®¹åŸºäº AVX2 æŒ‡ä»¤é›†ï¼Œå¯ä»¥æŒ‡å®š `-mavx2` é€‰é¡¹æ¥è®©ç¼–è¯‘å™¨ä½¿ç”¨ AVX2 æŒ‡ä»¤ã€‚\n\nå¦‚æœä¸æ”¯æŒ AVXï¼Œåˆ™å¯ä»¥ä½¿ç”¨ SSE æŒ‡ä»¤é›†ï¼Œå¤§ä½“ä¸Šæ˜¯ç±»ä¼¼çš„ã€‚ç®€å•æ¥è¯´ï¼Œä¸»è¦çš„åŒºåˆ«å°±æ˜¯ AVX æŒ‡ä»¤çš„åç§°ä¼šæœ‰ä¸€ä¸ª `v` çš„å‰ç¼€ï¼Œè€Œå¾ˆå¤š AVX ä¸­ä¸‰ä¸ª operand çš„æŒ‡ä»¤åœ¨ SSE ä¸­æ˜¯ä¸¤ä¸ª operandã€‚\n\n### YMM å¯„å­˜å™¨\n\næµ®ç‚¹æ•°å­˜æ”¾åœ¨ 16 ä¸ª YMM registers ä¸­ï¼Œæ¯ä¸ªå¯„å­˜å™¨æœ‰ 256 bitsï¼Œå«åš `%ymm0-15`ï¼Œè€Œä½ä½ 128 bits å«åš `%xmm0-15`ã€‚\n\nè¿™äº›å¯„å­˜å™¨å¯ä»¥å­˜å¤šä¸ªæµ®ç‚¹æ•° (packed data) å¹¶å¯¹å®ƒä»¬åŒæ—¶è¿›è¡Œæ“ä½œä»¥åŠ é€Ÿè®¡ç®—ï¼›è€Œå¦‚æœåªå¯¹å•ä¸ªæµ®ç‚¹æ•° (scalar) è¿›è¡Œæ“ä½œï¼Œå°±åªæ¶‰åŠåˆ° `%xmm0-15` çš„ä½ä½ã€‚\n\n### æµ®ç‚¹æ•°çš„ç§»åŠ¨æŒ‡ä»¤\n\nä¸‹é¢çš„æŒ‡ä»¤éƒ½æ²¡æœ‰åˆ—å…¨å¯èƒ½çš„ operand ç±»å‹ï¼Œä»…åˆ—å‡º CS:APP é‡Œè®²åˆ°çš„å¸¸ç”¨çš„ã€‚\n\n-   `vmovss m32, xmm`\n-   `vmovss xmm, m32`\n-   `vmovsd m64, xmm`\n-   `vmovsd xmm, m64`\n-   `vmovaps xmm, xmm`\n-   `vmovapd xmm, xmm`\n\nå…¶ä¸­ `v` æ˜¯ AVX æŒ‡ä»¤çš„å‰ç¼€ï¼Œ`ss` è¡¨ç¤º scalar single-precisionï¼Œ`sd` è¡¨ç¤º scalar double-precisionï¼Œ`a` è¡¨ç¤º alignedï¼Œ`ps` è¡¨ç¤º packed single-precisionï¼Œ`pd` è¡¨ç¤º packed double-precisionã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`s` ç»“å°¾çš„ç”¨äº floatï¼Œ`d` ç»“å°¾çš„ç”¨äº doubleã€‚\n\n### æµ®ç‚¹æ•°ç±»å‹è½¬æ¢\n\n#### æµ®ç‚¹æ•°è½¬ä¸ºæ•´æ•°\n\n-   `vcvttss2si xmm/m32, r32`\n-   `vcvttsd2si xmm/m64, r32`\n-   `vcvttss2siq xmm/m32, r64`\n-   `vcvttsd2siq xmm/m64, r64`\n\nå…¶ä¸­ `cvttss2si` çš„æ„æ€æ˜¯: `cvt` -> convert, `t` -> (with) truncation, `ss` -> scalar single-precision, `2` -> to, `si` -> signed integerã€‚\n\n`ss` ç”¨äº floatï¼Œ`sd` ç”¨äº doubleï¼›ç»“å°¾ä¸º `q` çš„ç”¨æ¥è½¬æˆ 64 ä½æ•´æ•°ã€‚\n\n#### æ•´æ•°è½¬ä¸ºæµ®ç‚¹æ•°\n\n-   `vcvtsi2ss r/m32, xmm, xmm`\n-   `vcvtsi2sd r/m32, xmm, xmm`\n-   `vcvtsi2ssq r/m64, xmm, xmm`\n-   `vcvtsi2sdq r/m64, xmm, xmm`\n\nè¿™é‡Œ `cvt` åå°‘äº†ä¸€ä¸ª `t` æ˜¯å› ä¸ºæ•´æ•°è½¬ä¸ºæµ®ç‚¹æ•°ä¸ä¼š truncateã€‚\n\næ•ˆæœæ˜¯æŠŠç¬¬ä¸€ä¸ª operand è½¬æ¢åæ”¾åœ¨ç¬¬ä¸‰ä¸ª operand å¤„ï¼Œè€Œç¬¬äºŒä¸ª operand ä¸€èˆ¬ä¸ç”¨ç®¡ï¼Œè®¾ä¸ºå’Œç¬¬ä¸‰ä¸ª operand ä¸€æ ·å³å¯ã€‚ï¼ˆè½¬æ¢ç»“æœä¼šæ”¾åœ¨ destination çš„ä½ä½ï¼Œè€Œç¬¬äºŒä¸ª operand ç”¨æ¥è®¾ç½® destination çš„é«˜ä½ã€‚ï¼‰\n\n#### æµ®ç‚¹æ•°ç²¾åº¦è½¬æ¢\n\n-   `vcvtss2sd xmm, xmm, xmm`\n-   `vcvtsd2ss xmm, xmm, xmm`\n\noperand çš„ä½œç”¨å’Œä¸Šé¢æ•´æ•°è½¬ä¸ºæµ®ç‚¹æ•°çš„æŒ‡ä»¤ä¸€æ ·ã€‚\n\n<Card title="gcc ä½¿ç”¨çš„æµ®ç‚¹æ•°ç²¾åº¦è½¬æ¢æŒ‡ä»¤">\n    åœ¨æŸäº›ç‰ˆæœ¬çš„ gcc ä¸­ï¼Œæˆ–é’ˆå¯¹æŸäº›å¤„ç†å™¨æ¶æ„è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œgcc\n    å¯èƒ½ä¼šä½¿ç”¨å¦å¤–çš„æŒ‡ä»¤æ¥è¿›è¡Œæµ®ç‚¹æ•°ç²¾åº¦è½¬æ¢ã€‚è¯¦è§\n    [å¦ä¸€ç¯‡åšå®¢](/post/2022/10/gcc-use_vector_fp_converts)ã€‚\n</Card>\n\n### å‡½æ•°è°ƒç”¨ä¸­çš„æµ®ç‚¹æ•°\n\n-   å‰ 7 ä¸ªæµ®ç‚¹å‚æ•°å¯ä»¥å­˜åœ¨ `%xmm0-7` ä¸­ï¼Œå…¶ä½™å‚æ•°å­˜åœ¨ stack é‡Œã€‚\n-   æµ®ç‚¹å‡½æ•°è¿”å›å€¼å­˜åœ¨ `%xmm0` ä¸­ã€‚\n-   æ²¡æœ‰ callee-saved å¯„å­˜å™¨ï¼ˆæ‰€æœ‰å¯„å­˜å™¨éƒ½æ˜¯ caller-savedï¼‰ã€‚\n\nçœ‹å‚æ•°æ˜¯ç¬¬å‡ ä¸ªã€æ”¾åœ¨å“ªä¸ªå¯„å­˜å™¨æ—¶ï¼Œæµ®ç‚¹å‚æ•°å’Œæ•´å‹å‚æ•°æ˜¯åˆ†å¼€ç®—çš„ï¼Œä¾‹å¦‚ `double f1(int x, double y, long z)` å’Œ `double f2(double y, int x, long z)` çš„å‚æ•°å¯„å­˜å™¨åˆ†é…æ˜¯ç›¸åŒçš„ã€‚\n\n### æµ®ç‚¹æ•°ç®—æœ¯è¿ç®—\n\nä¸‹é¢çš„æŒ‡ä»¤æŠŠ `ss` æ¢æˆ `sd`ã€`m32` æ¢æˆ `m64` å³ä¸º double-precision çš„ç‰ˆæœ¬ã€‚\n\n#### æµ®ç‚¹æ•°äºŒå…ƒè¿ç®—\n\nè®°ä¸‰ä¸ª operand åˆ†åˆ«ä¸º $S_1, S_2, D$ï¼Œåˆ™æ•ˆæœä¸ºè®¡ç®— $S_2$ ä¸ $S_1$ çš„è¿ç®—ç»“æœï¼Œå­˜åœ¨ $D$ ä¸­ï¼Œä¾‹å¦‚ `vsubss S_1 S_2 D` æ˜¯ $D \\gets S_2 - S_1$ã€‚\n\n-   `vaddss xmm/m32, xmm, xmm`\n-   `vsubss xmm/m32, xmm, xmm`\n-   `vmulss xmm/m32, xmm, xmm`\n-   `vdivss xmm/m32, xmm, xmm`\n-   `vmaxss xmm/m32, xmm, xmm`\n-   `vminss xmm/m32, xmm, xmm`\n\n#### æµ®ç‚¹æ•°ä¸€å…ƒè¿ç®—\n\n`sqrtss xmm/m32, xmm`: å°† source å¼€æ–¹å­˜å…¥ destination\n\nè¿™é‡Œ CS:APP ä¸­åˆ—å‡ºçš„æ˜¯ SSE æŒ‡ä»¤ `sqrtss` è€Œé AVX æŒ‡ä»¤ `vsqrtss`ï¼Œæˆ‘è‡ªå·±ç¼–è¯‘å‡ºæ¥ä¹Ÿæ˜¯ã€‚å¯èƒ½å¯ä»¥å‚è€ƒ [c++ - Using AVX intrinsics instead of SSE does not improve speed -- why? - Stack Overflow](https://stackoverflow.com/questions/8924729/using-avx-intrinsics-instead-of-sse-does-not-improve-speed-why)ã€‚\n\n### æµ®ç‚¹æ•°å¸¸é‡\n\næµ®ç‚¹æ•°ç›¸å…³çš„æŒ‡ä»¤ä¸æ¥å— immediate value ä½œä¸º operandï¼Œæ‰€ä»¥ä½¿ç”¨å¸¸é‡æ—¶éœ€è¦å…ˆå­˜ä¸‹æ¥ï¼Œä¾‹å¦‚ï¼š\n\n```c\ndouble foo() { return 1.8; }\n```\n\n```asm\nfoo:\n	vmovsd	.LC0(%rip), %xmm0\n	ret\n.LC0:\n	.long	-858993459\n	.long	1073532108\n```\n\n### æµ®ç‚¹æ•°ä½è¿ç®—\n\nä½è¿ç®—éƒ½æ˜¯åœ¨æ•´ä¸ªå¯„å­˜å™¨ä¸Šå¯¹ packed data è¿›è¡Œçš„ã€‚\n\n-   `vxorps xmm/m128, xmm, xmm`\n-   `vxorpd xmm/m128, xmm, xmm`\n-   `vandps xmm/m128, xmm, xmm`\n-   `vandpd xmm/m128, xmm, xmm`\n\noperands æ ¼å¼å’Œä¸Šé¢ä¸€æ ·ã€‚\n\nä¸€äº›æµ®ç‚¹æ•°ä½è¿ç®—çš„å®é™…è¿ç”¨ï¼š\n\n-   ç”¨ and è¿ç®—å°† sign bit ç½®é›¶ï¼Œä»¥å–ç»å¯¹å€¼\n-   ç”¨ xor è¿ç®—å°† sign bit å–åï¼Œä»¥å–ç›¸åæ•°\n-   å°† xor çš„ä¸¤ä¸ª source è®¾ä¸ºåŒä¸€ä¸ªå¯„å­˜å™¨ä»¥å¾—åˆ° 0\n\n<Card\n    type="question"\n    title="packed single/double precision åœ¨ç§»åŠ¨å’Œä½è¿ç®—ä¸Šçš„åŒºåˆ«ï¼Ÿ"\n>\n    `vmovaps` å’Œ `vmovapd`ã€`vxorps` å’Œ `vxorpd`ã€`vandps` å’Œ `vandpd`\n    çœ‹èµ·æ¥æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆè¦ç»™ single/double precision åˆ†åˆ«ä¸€æ¡æŒ‡ä»¤å‘¢ ğŸ¤”\n</Card>\n\n### æµ®ç‚¹æ•°æ¯”è¾ƒ\n\n-   `vucomiss xmm/m32, xmm`\n-   `vucomisd xmm/m64, xmm`\n\næ•ˆæœä¸ºï¼Œè®¡ç®—ç¬¬äºŒä¸ª operand å‡å»ç¬¬ä¸€ä¸ª operand å¹¶è®¾ç½® status flagsã€‚\n\næµ®ç‚¹æ•°çš„æ¯”è¾ƒæ˜¯ â€œunorderedâ€ çš„ï¼Œå³è‹¥æŸä¸ª operand æ˜¯ NaNï¼Œåˆ™æ¯”è¾ƒç»“æœä¸º unorderedã€‚\n\nä¸åŒçš„æ¯”è¾ƒç»“æœå¯¹åº”çš„ status flags ä»¥åŠ condition code ä¸ºï¼š\n\n|  æ¯”è¾ƒç»“æœ   | CF  | ZF  | PF  | condition code |\n| :---------: | :-: | :-: | :-: | :------------: |\n|  unordered  |  1  |  1  |  1  |      `p`       |\n| $S_2 < S_1$ |  1  |  0  |  0  |      `b`       |\n| $S_2 = S_1$ |  0  |  1  |  0  |      `e`       |\n| $S_2 > S_1$ |  0  |  0  |  0  |      `a`       |\n\nå…¶ä¸­ PF åœ¨æµ®ç‚¹æ•°æ¯”è¾ƒä¸­ç”¨æ¥è¡¨ç¤º unorderedï¼Œåœ¨æ•´æ•°è®¡ç®—ä¸­ä¹Ÿä¼šè¢«è®¾ç½®ä½†å‡ ä¹æ²¡ç”¨ã€‚\n'},{title:v,tags:t,content:`æƒ³å¼€ä¸€ä¸ª [CS:APP](https://csapp.cs.cmu.edu/) å­¦ä¹ ç¬”è®°çš„ç³»åˆ—ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ä¸€äº›ä¸œè¥¿éœ€è¦åœ¨ç³»åˆ—å¼€å¤´ç®€å•è¯´ä¸€ä¸‹ï¼Œæ‰€ä»¥æœ‰è¿™ç¯‡åºã€‚



---

è¿™å­¦æœŸè¦ä¸Šâ€œè®¡ç®—æœºç³»ç»Ÿæ¦‚è®ºâ€è¿™é—¨è¯¾ï¼Œå…¶å®å°±æ˜¯ CS:APPã€‚ï¼ˆåªä¸è¿‡è€å¸ˆå£°ç§°è¿™é—¨è¯¾æ²¡æœ‰æ•™æï¼ŒCS:APP åªæ˜¯å‚è€ƒä¹¦ã€‚ï¼‰

æœ¬æ¥æ˜¯æƒ³æš‘å‡è‡ªå­¦çš„ï¼Œä½†æš‘å‡å¤šå°‘æœ‰ç‚¹æ‘†ï¼Œå°±å’•äº† ğŸ•Šï¸

è™½ç„¶ä¸Šä¸€å­¦å¹´ä»¥æ•°å­¦è¯¾ä¸ºä¸»éƒ½æŒºæ‘†çš„ï¼Œä½†è¿™å­¦æœŸï¼ˆä¸Šï¼ˆå¤å­£å°ï¼‰å­¦æœŸï¼Ÿï¼‰å¼€å§‹ä¹Ÿæœ‰ä¸€äº›è®¡ç®—æœºçš„è¯¾äº†ï¼Œè¿˜æ˜¯æƒ³å¥½å¥½å­¦ä¸€ä¸‹çš„ã€‚å°¤å…¶æ˜¯ CS:APPï¼Œå› ä¸ºç³»ç»Ÿè¿™å—æˆ‘äº†è§£çš„ä¸å¤šï¼Œç›¸æ¯”ç¨‹è®¾è®­ç»ƒã€è½¯ä»¶å·¥ç¨‹ä»€ä¹ˆçš„è¿˜æ˜¯ä¸å¤ªæœ‰ä¿¡å¿ƒã€‚å°±ç®—æš‘å‡æ‘†äº†ï¼Œä¹Ÿä¸èƒ½é å¬è¯¾å­¦å§ï¼Œ~~ä¸ä¼šçœŸçš„æœ‰ä»€ä¹ˆä¸œè¥¿æ˜¯å¬è¯¾å­¦èƒ½å­¦ä¼šçš„å§ï¼ˆ~~

çœ‹çš„ä¹¦æ˜¯å½“å‰æœ€æ–°çš„ç¬¬ä¸‰ç‰ˆã€‚è™½ç„¶å¬è¯´ CS:APP çš„ä¸­æ–‡ç¿»è¯‘è´¨é‡è¿˜ä¸é”™ï¼Œä½†æˆ‘æ„Ÿè§‰æœ¯è¯­ç¿»è¯‘åº”è¯¥å¤šå°‘è¿˜æ˜¯ä¼šæœ‰äº›å¥‡æ€ªï¼Œå°±è¿˜æ˜¯çœ‹çš„è‹±æ–‡ç‰ˆï¼ˆ~~å¦‚æœæœ‰ä¸ç¿»è¯‘æœ¯è¯­çš„ä¸­æ–‡ç‰ˆå°±å¥½äº†~~ï¼‰ã€‚ä¸€å¼€å§‹çœ‹çš„æ˜¯ Global Editionï¼Œç„¶åå‘ç°ä¹ é¢˜ç­”æ¡ˆé”™çš„ç¦»è°±ï¼Œ[å‹˜è¯¯è¡¨](https://csapp.cs.cmu.edu/3e/errata.html) ä¹Ÿè¯´æ”¾å¼ƒ Global Edition äº†ï¼Œå°±æ¢æˆäº† North American Editionã€‚

å› ä¸ºè¿™æœ¬ä¹¦æœ‰å¾ˆå¤šç»†èŠ‚çŸ¥è¯†ç‚¹ï¼Œ~~è€Œä¸”åºŸè¯å¾ˆå¤š~~ï¼Œæ„Ÿè§‰æ˜¯é€‚åˆåšç¬”è®°çš„ï¼Œ~~æ­£å¥½åšå®¢ä¹Ÿç¼ºå†…å®¹~~ï¼Œå°±æƒ³åœ¨åšå®¢ä¸Šå†™å­¦ä¹ ç¬”è®°ã€‚

ç„¶åï¼Œå› ä¸ºæ˜¯åœ¨ä¸Šè¯¾çš„â€œåŒæ—¶â€å†™è¿™äº›å­¦ä¹ ç¬”è®°ï¼Œæˆ‘å¸Œæœ›æ˜¯èƒ½åœ¨æ¯èŠ‚è¯¾ä¹‹å‰å†™å®Œç›¸åº”å†…å®¹çš„éƒ¨åˆ†ï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šæœ‰è¯¾å ‚å†…å®¹å¤–æ³„çš„å«Œç–‘äº†ï¼ˆè™½ç„¶å°±ç®—æ˜¯ä¸Šè¯¾è®°çš„ç¬”è®°å…¬å¼€åˆ†äº«ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå§ ğŸ¤”ï¼‰ï¼›é™¤å»é¿å«Œçš„åŸå› ï¼Œä¹Ÿæ˜¯ç£ä¿ƒè‡ªå·±è·Ÿä¸Šè¿›åº¦ã€‚ï¼ˆå¦‚æœåªæ˜¯æŠŠä¸Šè¯¾è®²çš„å†…å®¹æå‰è‡ªå­¦å€’è¿˜å‹åŠ›ä¸å¤§ï¼Œä½†ä¸Šè¯¾æœ‰è·³è¿‡ä¸è®²çš„ï¼ˆç›²çŒœæœ‰çš„éƒ¨åˆ†ä¼šæ”¾åˆ°å¤§ä¸‰çš„ç»„æˆåŸç†è®² ğŸ¤”ï¼‰ï¼Œä¹Ÿæœ‰ä¸æŒ‰ä¹¦çš„é¡ºåºè®²çš„ï¼Œæˆ‘è¿˜æ˜¯æƒ³æŒ‰ä¹¦çš„é¡ºåºå­¦å®Œï¼Œå°±æœ‰ç‚¹éš¾é¡¶äº†ã€‚ï¼‰

UPDï¼šå› ä¸ºå…¶ä»–è¯¾çš„ä½œä¸šä»¥åŠè‡ªå·±çš„æ‘†çƒ‚ï¼Œè¿˜æ˜¯æä¸å®Œäº†..åªèƒ½è·Ÿç€è¯¾ç¨‹çš„é¡ºåºè·³ç€å­¦äº†ï¼Œèµ·ç ä¿è¯è¯¾ä¸Šè®²çš„å†…å®¹æå‰è‡ªå­¦..

ä¹¦çš„ç¬¬ä¸€ç« æ˜¯æ€»è§ˆæ€§çš„ä»‹ç»ï¼Œå°±è·³è¿‡ä¸å†™å­¦ä¹ ç¬”è®°äº†ã€‚

ç³»åˆ—ç›®å½•å¯ä»¥çœ‹ [tag: csapp](/tag/csapp)ã€‚
`},{title:C,tags:"TeX R ç‰©ç†å®éªŒ ç»éªŒåˆ†äº«",content:`è¿™å­¦æœŸé€‰äº†ç‰©ç†å®éªŒBã€‚

ä»¥å‰åŸºæœ¬ä¸Šåªåœ¨ Markdown é‡Œå†™ LaTeXï¼Œæ²¡æ€ä¹ˆå†™è¿‡ \`.tex\`ï¼ŒR åˆ™å®Œå…¨æ²¡æœ‰æ¥è§¦è¿‡ã€‚ç†è®ºä¸Šæˆ‘åº”è¯¥å¥½å¥½å­¦ä¸€å­¦å†ç”¨ï¼Œä½†å®é™…ä¸Šæ²¡æ—¶é—´å¥½å¥½å­¦ã€‚æ€»ä¸èƒ½ç”¨ Word å†™å®éªŒæŠ¥å‘Šå¹¶ä¸”æ‰‹ç®—å§ï¼ˆ

è¿™é‡Œæ€»ç»“ä¸€ä¸‹æˆ‘å†™å®éªŒæŠ¥å‘Šç”¨åˆ°çš„ TeX å’Œ Rã€‚



## TeX

### ä¸­æ–‡

\`\`\`tex
\\documentclass[UTF8, 11pt, fontset=none]{ctexart}  % éœ€è¦ç¦ç”¨é»˜è®¤ fontset æ‰èƒ½è‡ªå®šä¹‰å­—ä½“
\\setCJKmainfont{Source Han Serif SC}
\\usepackage[T1]{fontenc}
\`\`\`

### åŸºæœ¬é¡µé¢æ ¼å¼

\`\`\`tex
\\ctexset{section/format=\\Large\\bfseries}  % å‚ç…§è®²ä¹‰ä¸Šçš„æ ¼å¼ï¼Œæ ‡é¢˜å·¦å¯¹é½
\\usepackage[a4paper, hmargin=1.5cm, vmargin=2cm]{geometry}  % é¡µé¢å¤§å°å’Œè¾¹è·
\\usepackage{enumitem}
\\setlist{topsep=0pt,itemsep=-4pt}  % åˆ—è¡¨é—´è·
\\pagestyle{plain}                  % ctex é»˜è®¤çš„é¡µç åœ¨å³ä¸Šè§’ï¼Œæ”¹æˆä¸‹æ–¹
\\setlength{\\parskip}{0.5em}        % æ®µè½é—´è·
\`\`\`

### PDF metadata

\`\`\`tex
\\usepackage[pdfusetitle]{hyperref}
\`\`\`

### æ ‡é¢˜

\`\`\`tex
\\title{å®éªŒåç§°\\ å®éªŒæŠ¥å‘Š}
\\author{å§“å}
\\makeatletter

\\begin{center}
    \\LARGE
    \\textbf{\\@title}

    \\vspace{0.5cm}
    \\normalsize
    å®éªŒè€…å§“å: \\@author\\hspace{15pt}
    å­¦å·: 2021000000\\hspace{15pt}
    å®éªŒæ—¥æœŸ: 2202å¹´10æœˆ32æ—¥\\hspace{15pt}
    å®éªŒå°å·: 1\\hspace{15pt}
    \\vspace{0.5cm}
\\end{center}
\`\`\`

### ç« èŠ‚

\`\`\`tex
\\section{å®éªŒç›®çš„}

\\subsection{æµ‹ä¸€ä¸‹è¿™ä¸ªä¸œè¥¿}
\`\`\`

### å›¾è¡¨

\`\`\`tex
\\usepackage{graphicx}
\\usepackage{float}
\\usepackage[hidelinks]{hyperref}  % ä½¿ç”¨ hidelinks é€‰é¡¹æ¥ç¦ç”¨é“¾æ¥çš„çº¢æ¡†
\\usepackage{cleveref}
\\crefname{figure}{å›¾}{å›¾}
\\crefname{table}{è¡¨}{è¡¨}
\`\`\`

å¯ä»¥ç”¨ \`\\label\` å’Œ \`\\cref\` æ¥åœ¨æ­£æ–‡ä¸­å¼•ç”¨å›¾è¡¨ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ·»åŠ å›¾è¡¨æ—¶é‡æ–°æ ‡å·ã€‚

\`\`\`tex
\\begin{figure}[H]
    \\centering
    \\includegraphics[width=0.6\\textwidth]{picture.png}
    \\caption{è¿™æ˜¯ä¸€å¹…å›¾ï¼Œè€å¸ˆè¯´å›¾çš„æ ‡é¢˜æ”¾ä¸‹é¢}
    \\label{this-is-a-picture}
\\end{figure}

å¦‚\\cref{this-is-a-picture} æ‰€ç¤º
\`\`\`

\`\`\`tex
å¦‚\\cref{this-is-a-table} æ‰€ç¤º

\\begin{table}[H]
    \\centering
    \\caption{è¿™æ˜¯ä¸€å¼ è¡¨ï¼Œè€å¸ˆè¯´è¡¨çš„æ ‡é¢˜æ”¾ä¸Šé¢}
    \\vspace{1em}
    \\begin{tabular}{|c|c||c|c|}
        \\hline
        åºå· & å€¼ & åºå· & å€¼ \\\\
        \\hline
        1  & 1.14 & 6  & 5.14 \\\\ \\hline
        2  & 1.93 & 7  & 5.95 \\\\ \\hline
        3  & 2.74 & 8  & 6.75 \\\\ \\hline
        4  & 3.55 & 9  & 7.53 \\\\ \\hline
        5  & 4.35 & 10 & 8.32 \\\\ \\hline
    \\end{tabular}
    \\label{this-is-a-table}
\\end{table}
\`\`\`

å¦‚æœæƒ³æŠŠå‡ å¼ å›¾/è¡¨æ”¾åœ¨å•ç‹¬ä¸€é¡µï¼Œä½¿å¾—è¿™ä¸€é¡µæ²¡æœ‰å…¶ä»–æ–‡å­—ï¼Œå¯ä»¥æŠŠ \`[H]\` æ”¹æˆ \`[p]\`ã€‚

### æ–œçº¿è¡¨å¤´

\`\`\`tex
\\usepackage{diagbox}

\\begin{tabular}{|c|}
\\diagbox{å·¦ä¸‹}{å³ä¸Š}
\\end{tabular}

\\begin{tabular}{|c|}
\\diagbox{å·¦ä¸‹}{ä¸­é—´}{å³ä¸Š}
\\end{tabular}
\`\`\`

è¿˜å¯ä»¥è®¾ç½®å…¶å®ƒæ ·å¼ï¼Œä½†åº”è¯¥ç”¨ä¸ä¸Šã€‚

### å¤šè¡Œ/å¤šåˆ—ï¼ˆåˆå¹¶å•å…ƒæ ¼ï¼‰

å¯ä»¥å‚è€ƒ [Latex è¡¨æ ¼æŠ€å·§ - åˆå¹¶å•å…ƒæ ¼\\_TheNetAdminçš„åšå®¢](https://blog.csdn.net/wzxlovesy/article/details/69063271)ã€‚

### å•ä½ã€ç§‘å­¦è®¡æ•°æ³•ã€ä¸ç¡®å®šåº¦ã€è§’åº¦

\`\`\`tex
\\usepackage[separate-uncertainty=true]{siunitx}[=v2]
\`\`\`

å…¶ä¸­ \`[=v2]\` ç”¨æ¥ä¿®å¤ä½¿ç”¨ \`T1\` ç¼–ç æ—¶ \`\\micro\` çš„æ ·å¼: [siunitx#619](https://github.com/josephwright/siunitx/issues/619)

\`siunitx\` è¿™ä¸ªåŒ…è§£å†³äº†è‹¥å¹²é—®é¢˜ï¼š

-   å•ä½éœ€è¦ç”¨æ­£ä½“ï¼Œæ‰‹å†™çš„è¯éœ€è¦ \`\\mathrm\`
-   æ•°å­—å’Œå•ä½ä¹‹é—´æœ€å¥½æœ‰ä¸€äº›é—´è·
-   æœ‰çš„å•ä½ä¼šè®©ä½ çº ç»“æ€ä¹ˆå†™æ¯”è¾ƒå¥½ï¼Œ[ä¾‹å¦‚æ‘„æ°åº¦](https://tex.stackexchange.com/questions/258306/how-to-insert-degree-celsius-symbol-in-node-text-in-pgfplots-tikz)
-   ç§‘å­¦è®¡æ•°æ³•å†™ \`\\times 10^\` æ¯”è¾ƒéº»çƒ¦
-   æ¯”è¾ƒé•¿çš„æ•°å­—ä¸åˆ†æ®µçš„è¯çœ‹ä¸æ¸…
-   ä¸ç¡®å®šåº¦å’Œæµ‹é‡ç»“æœæœ«ä½å¯¹é½
-   è¿™ä¸ªåŒ…è¿˜å¯ä»¥å°†ä¸ç¡®å®šåº¦å†™æˆæ‹¬å·çš„å½¢å¼ï¼Œåªä¸è¿‡å®éªŒæŠ¥å‘Šçš„è¦æ±‚æ˜¯ $\\pm$ çš„å½¢å¼
-   ~~åªè®°å¾—å•ä½çš„å­—æ¯ï¼Œä¸è®°å¾—å•ä½çš„è‹±æ–‡å~~

ä¾‹å­ï¼š

\`\`\`tex
$t = \\SI{22.5}{\\celsius}$

$v = \\SI{1.91981 \\pm 0.114514 e3}{\\kilo\\metre / \\hour}$
\`\`\`

å…¶ä¸­ä¸‹é¢é‚£ä¸ªçš„æ¸²æŸ“æ•ˆæœå¤§æ¦‚æ˜¯ï¼ˆæ²¡ç ”ç©¶è¿™ä¸ªåŒ…çš„æºç ï¼Œåªæ˜¯çœ‹æ ·å­å¤§æ¦‚å¤åˆ»ä¸€ä¸‹ï¼‰ï¼š

 $v = (1.919\\,810 \\pm 0.114\\,514) \\times 10^3 \\, \\mathrm{km/h}$

\`$v = (1.919\\,810 \\pm 0.114\\,514) \\times 10^3 \\, \\mathrm{km/h}$\`

å¯ä»¥ç”¨ \`\\unit\` æ¥åªæœ‰å•ä½æ²¡æœ‰æ•°å­—ï¼Œç”¨ \`\\num\` æ¥åªæœ‰æ•°å­—æ²¡æœ‰å•ä½ï¼Œæˆ–è€…ç”¨ \`\\SI\` ä½†æŠŠä¸€éƒ¨åˆ†ç•™ç©ºã€‚

å¯ä»¥ç”¨ \`\\ang{1;02;}\` æ¥æ˜¾ç¤º $1^\\circ 2'$ï¼Œç”¨ \`\\ang[parse-numbers=false]{1;02;}\` æ¥æ˜¾ç¤º $1^\\circ 02'$ï¼Œç”¨ \`\\sisetup{parse-numbers=false}\` æ¥åœ¨å½“å‰ç¯å¢ƒï¼ˆä¾‹å¦‚è¡¨æ ¼ï¼‰å†…è®¾ç½® \`parse-numbers=false\`ï¼Œå°±ä¸ç”¨æ¯æ¡å‘½ä»¤å•ç‹¬è®¾ç½®ã€‚

æ›´å¤šç”¨æ³•å¯ä»¥å‚è€ƒ siunitx çš„æ–‡æ¡£ã€‚

### æ¨¡æ¿

<Card fold title="å®éªŒæŠ¥å‘Šå®Œæ•´æ¨¡æ¿">

\`\`\`tex
\\documentclass[UTF8, 11pt, fontset=none]{ctexart}
\\setCJKmainfont{Source Han Serif SC}
\\usepackage[T1]{fontenc}

\\pagestyle{plain}
\\ctexset{section/format=\\Large\\bfseries}
\\usepackage[a4paper, hmargin=1.5cm, vmargin=1.9cm]{geometry}
\\setlength{\\parskip}{0.5em}
\\usepackage{enumitem}
\\setlist{topsep=0pt,itemsep=-4pt}

\\usepackage{amsmath}
\\usepackage[separate-uncertainty=true]{siunitx}[=v2]

\\usepackage{multirow}
\\usepackage{diagbox}

\\usepackage[pdfusetitle, hidelinks]{hyperref}
\\usepackage{graphicx}
\\usepackage{float}
\\usepackage{cleveref}
\\crefname{figure}{å›¾}{å›¾}
\\crefname{table}{è¡¨}{è¡¨}
\\crefname{page}{é¡µ}{é¡µ}
\\crefname{section}{èŠ‚}{èŠ‚}

\\begin{document}

\\title{XXX\\ å®éªŒæŠ¥å‘Š}
\\author{å§“å}
\\makeatletter

\\begin{center}
    \\LARGE
    \\textbf{\\@title}

    \\vspace{0.5cm}
    \\normalsize
    å®éªŒè€…å§“å: \\@author\\hspace{15pt}
    å­¦å·: 2021000000\\hspace{15pt}
    å®éªŒæ—¥æœŸ: 2022å¹´XXæœˆXXæ—¥\\hspace{15pt}
    å®éªŒå°å·: XX\\hspace{15pt}
    \\vspace{0.5cm}
\\end{center}

\\section{å®éªŒç›®çš„}

\\begin{enumerate}
    \\item
    \\item
    \\item
\\end{enumerate}

\\section{å®éªŒä»ªå™¨}

\\begin{itemize}
    \\item
    \\item
\\end{itemize}

\\newpage

\\section{æ•°æ®å¤„ç†åŠç»“æœ}

% \\begin{table}[H]
%     \\centering
%     \\caption{}
%     \\vspace{1em}
%     \\begin{tabular}{|c|c|c|}
%     \\end{tabular}
%     \\label{}
% \\end{table}

% \\begin{figure}[H]
%     \\centering
%     \\includegraphics[width=\\textwidth]{.png}
%     \\caption{}
%     \\label{}
% \\end{figure}

\\newpage

\\section{åŸå§‹æ•°æ®è®°å½•}

\\begin{center}
\\includegraphics[width=\\textwidth]{data.jpg}
\\end{center}

\\end{document}
\`\`\`

</Card>

## R

### Arch è£… R package

[arch4edu](https://github.com/arch4edu/arch4edu) æœ‰ä¸€äº› R packageï¼Œå¯ä»¥å‡å°‘ AUR çš„éœ€æ±‚ã€‚

### è¯»å–æ•°æ®

\`\`\`r
data <- readr::read_csv(file = "data.csv")
\`\`\`

### å¹³å‡æ•°ã€æ ‡å‡†åå·®

\`\`\`r
ybar <- mean(data$y)
Sy <- sd(data$y)
\`\`\`

### çº¿æ€§å›å½’

\`\`\`r
model <- lm(log(y) ~ x, data)
b <- coefficients(model)[2]   # çº¿æ€§å›å½’ç³»æ•°
r <- cor(log(data$y), data$x) # ç›¸å…³ç³»æ•°
nu <- df.residual(model)      # è‡ªç”±åº¦ (n-2)
\`\`\`

### t å› å­

\`\`\`r
t <- qt(p=0.025, df=nu, lower.tail=FALSE)
\`\`\`

R é‡Œé¢æœ‰å¥½å‡ ä¸ªå’Œ student åˆ†å¸ƒç›¸å…³çš„å‡½æ•°ï¼Œæˆ‘çŒœå¯èƒ½æœ‰çš„ä¸œè¥¿å¯ä»¥ç›´æ¥ç”¨è¿™äº›å‡½æ•°ç®—å‡ºæ¥ï¼Œä½†æˆ‘æ‡’å¾—ç ”ç©¶äº†ï¼Œåæ­£èƒ½æ‹¿åˆ° t å› å­è‡ªå·±ä»£å…¬å¼å°±æ˜¯äº†ï¼ˆ

### éçº¿æ€§å‡½æ•°çš„æ‹Ÿåˆ

\`\`\`r
model <- nls(
    y ~ a * cos(2 * pi * (14.5 - x) / lambda),
    data = data,
    start = list(a = 200, lambda = 10)
)
co <- coef(model)
a <- co["a"]
lambda <- co["lambda"]
\`\`\`

å¦‚æœä¸€ä¸ªå‡½æ•°é•¿å¾—å¾ˆå¥‡æ€ªï¼Œä¸èƒ½çº¿æ€§æ‹Ÿåˆï¼Œå¯ä»¥ç”¨ \`nls\` (Non-linear Least Squares) æ¥ä»¥å‡å°æ®‹å·®å¹³æ–¹å’Œä¸ºç›®æ ‡è¿›è¡Œæ‹Ÿåˆã€‚

\`nls\` éœ€è¦ä¼ å…¥ \`start\` å‚æ•°ä½œä¸ºæ‹Ÿåˆçš„èµ·ç‚¹ï¼Œå¯ä»¥è‡ªå·±å¤§è‡´ä¼°è®¡ä¸€ä¸‹å‚æ•°å¤§æ¦‚æ˜¯å¤šå°‘ï¼Œå¦‚æœä¼°è®¡çš„åå·®å¤ªå¤§ï¼Œå¯èƒ½å¯¼è‡´æœ€åæ‹Ÿåˆçš„ç»“æœå‡ºé”™ã€‚

### ç®€é™‹çš„å‡½æ•°å›¾åƒ

ç”»ä¸ªç®€é™‹çš„å›¾å¯ä»¥ç”¨æ¥æ£€æŸ¥å‡½æ•°æ‹Ÿåˆçš„æƒ…å†µï¼š

\`\`\`r
plot(data)
curve(a * cos(2 * pi * (14.5 - x) / lambda), add = TRUE)
\`\`\`

å¦‚æœæ˜¯åœ¨ non-interactive æ¨¡å¼ä¸‹ï¼ˆä¾‹å¦‚ä½¿ç”¨ \`R -f foo.R\` è¿è¡Œï¼‰ï¼Œç”Ÿæˆçš„å›¾åƒé»˜è®¤ä¼šæ”¾åœ¨ \`Rplots.pdf\` ä¸­ã€‚

### ggplot ç”»æ•£ç‚¹ / æŠ˜çº¿å›¾

\`\`\`r
library(tidyverse)

# å¯¼å…¥å­—ä½“
library(extrafont)
font_import()
loadfonts()
fonts()
fonttable()

data <- readr::read_csv(file = "data.csv")

p <- data %>%
    ggplot(aes(a, b + c)) + # ä»¥è¡¨ä¸­çš„ a ä¸ºæ¨ªåæ ‡ï¼Œb + c ä¸ºçºµåæ ‡
    geom_point() + # æ•£ç‚¹
    geom_line() + # æŠ˜çº¿
    labs(x = "a", y = "b") + # åæ ‡è½´æ ‡é¢˜
    theme(text = element_text(family = "Source Han Serif SC")) # å­—ä½“
ggsave("plot.png", plot = p)
\`\`\`
`},{title:y,tags:"csapp å­¦ä¹ ç¬”è®° WIP",content:'[CS:APP](https://csapp.cs.cmu.edu/) ç¬¬å››ç«  â€œProcessor Architectureâ€ çš„å­¦ä¹ ç¬”è®°ã€‚\n\nè¿™ç« çš„ä¸»è¦å†…å®¹ä¸ºä¸€ä¸ªç®€åŒ–çš„æŒ‡ä»¤é›† Y86-64 çš„è®¾è®¡ä»¥åŠ Y86-64 å¤„ç†å™¨çš„å®ç°ï¼ˆé¡ºåºå®ç°å’Œ pipeline å®ç°ï¼‰ã€‚\n\n\n\n## The Y86-64 Instruction Set Architecture\n\nè¿™éƒ¨åˆ†å®šä¹‰äº†åœ¨è¿™ä¸€ç« ä¸­ç”¨ä½œæ¼”ç¤ºçš„åä¸º â€œY86-64â€ çš„ç©å…· ISAã€‚\n\n### Y86-64 ç¨‹åºçŠ¶æ€\n\n-   15 ä¸ªå¯„å­˜å™¨ï¼ˆx86-64 çš„å¯„å­˜å™¨é™¤å» `%r15`ï¼Œä¸ºäº†ç®€åŒ–ç¼–ç ï¼‰\n-   3 ä¸ª status flag: `ZF`ã€`SF`ã€`OF`\n-   program counter: `PC`\n-   memory\n-   status code: `Stat`ï¼Œç”¨æ¥è¡¨ç¤ºç¨‹åºæ­£å¸¸è¿è¡Œæˆ–å‘ç”Ÿäº†å¼‚å¸¸\n\n### Y86-64 æŒ‡ä»¤\n\nY86-64 æŒ‡ä»¤å¤§è‡´ä¸Šæ˜¯ x86-64 çš„ä¸€ä¸ªå­é›†ï¼Œä½†åœ¨ operand ç­‰æ–¹é¢æœ‰ä¸€äº›ç®€åŒ–æˆ–åŒºåˆ«ã€‚\n\noperand ä¸ x86-64 çš„åŒºåˆ«æ˜¯ï¼š\n\n-   Immediateã€Registerã€Memory éƒ½åªæœ‰ 64 ä½çš„ç‰ˆæœ¬\n-   Register åªæœ‰ 15 ä¸ª\n-   Memory ä¸æ”¯æŒ `(, ri, s)` çš„éƒ¨åˆ†ï¼Œåªèƒ½æ˜¯ `Imm`/`(rb)`/`Imm(rb)`\n\ncondition code åªæœ‰å…­ä¸ªï¼Œå³ signed compare: `le`/`l`/`e`/`ne`/`ge`/`g`\n\næŒ‡ä»¤åˆ—è¡¨ï¼Œä»¥åŠä¸ x86-64 çš„åŒºåˆ«ï¼š\n\n-   `irmovq`/`rrmovq`/`mrmovq`/`rmmovq`ï¼Œå³å°† `movq` æŒ‰ operand ç±»å‹æ‹†æˆäº†å››ä¸ªæŒ‡ä»¤\n-   `addq`/`subq`/`andq`/`xorq`ï¼Œå®ƒä»¬åªæ¥å—å¯„å­˜å™¨ä½œä¸º operandï¼Œä¸”åªè®¾ç½® `ZF`ã€`SF`ã€`OF` ä¸‰ä¸ª status flag\n-   `jmp`/`jle`/`jl`/`je`/`jne`/`jge`/`jg`ï¼ŒåŒ…æ‹¬ `jmp` åœ¨å†…éƒ½åªèƒ½è·³è½¬åˆ°å›ºå®šçš„åœ°å€ï¼Œä¸æ¥å—å¯„å­˜å™¨ä½œä¸º operandï¼Œä¸”è¿™ä¸ªåœ°å€æ˜¯ç»å¯¹åœ°å€è€Œéç›¸å¯¹äº PC çš„åœ°å€\n-   `cmovle`/`cmovl`/`cmove`/`cmovne`/`cmovge`/`cmovg`ï¼Œå®ƒä»¬åªæ¥å—å¯„å­˜å™¨ä½œä¸º operand\n-   `call`: åœ°å€æ˜¯ç»å¯¹åœ°å€\n-   `ret`ã€`pushq`ã€`popq`ã€`nop`: ä¸ x86-64 åŸºæœ¬ç›¸åŒ\n-   `halt`: åœæ­¢è¿è¡Œï¼Œå°† status code è®¾ä¸º `HLT`\n\n### Y86-64 æŒ‡ä»¤ç¼–ç \n\nY86-64 é€šè¿‡å¯¹æŒ‡ä»¤çš„ç®€åŒ–ï¼ŒåŒæ—¶ä¹Ÿä½¿ç¼–ç å¾—åˆ°äº†ç®€åŒ–ï¼Œä½†ç›¸åº”åœ°ä½¿å¾—ç¼–ç ä¸ç´§å‡‘ï¼Œä¼šæœ‰æµªè´¹ã€‚\n\nCS:APP Figure 4.2 ç®€æ˜åœ°å±•ç¤ºäº† Y86-64 çš„æŒ‡ä»¤ç¼–ç ï¼š\n\n![Y86-64 æŒ‡ä»¤ç¼–ç ç¤ºæ„å›¾](csapp-fig4.2.png)\n\n#### æŒ‡ä»¤ç±»å‹çš„ç¼–ç \n\næŒ‡ä»¤ç¼–ç çš„ç¬¬ä¸€ä¸ª byte è¡¨ç¤ºæŒ‡ä»¤çš„ç±»å‹ã€‚è¿™ä¸ª byte çš„é«˜ä½å«åš *code*ï¼Œä½ä½å«åš *function*ï¼Œå…¶ä¸­ function åªåœ¨æŸå‡ ä¸ªæŒ‡ä»¤æœ‰ç”¨ã€‚ç‰¹åˆ«åœ°ï¼Œ`rrmovq` å’Œ `cmovXX` çš„ code æ˜¯ç›¸åŒçš„ï¼Œè¿™è¡¨ç¤º `rrmovq` å¯ä»¥çœ‹ä½œä¸€ç§ç‰¹æ®Šçš„ `cmovXX`ã€‚\n\nç®—æœ¯è¿ç®—çš„ function: `add` 0, `sub` 1, `and` 2, `xor` 3\n\ncondition code çš„ function: `le` 1, `l` 2, `e` 3, `ne` 4, `ge` 5, `g` 6ï¼›`jmp` çš„ function ä¸º 0\n\n#### Register Specifier Byte\n\né™¤äº† `jXX` å’Œ `call`ï¼ŒæŒ‡ä»¤ç¼–ç çš„ç¬¬äºŒä¸ª byteï¼ˆå¦‚æœæœ‰ï¼‰çš„é«˜ä½ä½åˆ†åˆ«è¡¨ç¤ºä¸€ä¸ª register identifierã€‚\n\nregister identifier ä» `%rax` ä¸º `0` åˆ° `%r14` ä¸º `E`ï¼›`F` è¡¨ç¤ºä¸æ˜¯å¯„å­˜å™¨ã€‚\n\n#### Constant Word\n\nåœ¨ `irmovq`ã€`rmmovq`/`mrmovq`ã€`jXX`/`call` ä¸­ï¼Œåˆ†åˆ«æœ‰ä¸€ä¸ª 8-byte çš„ constant wordï¼Œç”¨æ¥è¡¨ç¤º immediate value æˆ–åœ°å€ï¼Œbyte ordering æ˜¯ little endianã€‚\n\n### Y86-64 å¼‚å¸¸\n\nstatus code `Stat` æœ‰å››ç§å¯èƒ½çš„å–å€¼ï¼š\n\n-   `AOK`: æ­£å¸¸\n-   `HLT`: æ‰§è¡Œäº† `halt` æŒ‡ä»¤\n-   `ADR`: è®¿é—®äº†ä¸åˆæ³•çš„åœ°å€\n-   `INS`: æŒ‡ä»¤ç¼–ç ä¸åˆæ³•\n\nåœ¨ Y86-64 ä¸­ï¼Œé‡åˆ°å¼‚å¸¸åå¤„ç†å™¨ä¼šç«‹å³åœæ­¢è¿è¡Œã€‚\n\n### Y86-64 ç¨‹åº\n\nCS:APP Figure 4.8 å±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„ Y86-64 ç¨‹åºï¼š\n\n![å®Œæ•´ Y86-64 ç¨‹åºçš„æ±‡ç¼–ä¸æœºå™¨ç ](csapp-fig4.8.png)\n\nå¯ä»¥ä¸‹è½½ [Y86-64 tools](http://csapp.cs.cmu.edu/3e/sim.tar) å¹¶ä½¿ç”¨ `yas` è¿›è¡Œæ±‡ç¼–ï¼Œä½¿ç”¨ `yis` æ¨¡æ‹Ÿè¿è¡Œã€‚ç¼–è¯‘ `yas` æ—¶ [éœ€è¦æ·»åŠ  `-fcommon` ç¼–è¯‘é€‰é¡¹](https://stackoverflow.com/questions/63152352/fail-to-compile-the-y86-simulatur-csapp)ã€‚\n\n### å¯¹ %rsp è¿›è¡Œ push/pop\n\n`pushq %rsp`ã€`popq %rsp` è¿™ä¸¤æ¡æŒ‡ä»¤è™½ç„¶æ²¡ä»€ä¹ˆç”¨ï¼Œä½†å®ƒä»¬çš„è¡Œä¸ºå¯èƒ½æœ‰æ­§ä¹‰ï¼Œæ‰€ä»¥åœ¨è®¾è®¡ ISA æ—¶æ˜ç¡®è§„å®šå®ƒä»¬çš„è¡Œä¸ºæ˜¯æœ‰å¿…è¦çš„ã€‚\n\nY86-64 éµå¾ªå’Œ x86-64 ç›¸åŒçš„è§„åˆ™ï¼š`pushq %rsp` ä¼šå°†æ—§çš„ï¼ˆæ²¡æœ‰å‡ 8 çš„ï¼‰`%rsp` çš„å€¼å…¥æ ˆï¼Œ`popq %rsp` ç›¸å½“äº `mrmovq (%rsp), %rsp`ã€‚\n\n## Logic Design and the Hardware Control Language HCL\n\nè¿™ä¸€ç« ä¸­ä½¿ç”¨ç©å…·è¯­è¨€ HCL (hardware control language) æ¥æè¿° Y86-64 å¤„ç†å™¨çš„é€»è¾‘è®¾è®¡ã€‚ï¼ˆä¸ä¹‹ç±»ä¼¼ä½†ä¸æ˜¯ç©å…·çš„è¯­è¨€ï¼Œä¾‹å¦‚ VHDLã€Verilog ç­‰ï¼Œå«åš â€œ[hardware description language (HDL)](https://en.wikipedia.org/wiki/Hardware_description_language)â€ã€‚ï¼‰\n\n### é€»è¾‘é—¨\n\nCSAPP Figure 4.9:\n\n![ä¸æˆ–éé€»è¾‘é—¨](csapp-fig4.9.png)\n\n-   å›¾ä¸­åªå±•ç¤ºäº†è¾“å…¥ä¸ªæ•°ä¸º 2 çš„ AND å’Œ ORï¼Œä½†å¯ä»¥æœ‰æ›´å¤šè¾“å…¥\n-   ä¸€æ—¦è¾“å…¥æ”¹å˜ï¼Œé€»è¾‘é—¨çš„è¾“å‡ºå¾ˆå¿«å°±ä¼šéšä¹‹æ”¹å˜\n\n### ç»„åˆé€»è¾‘ç”µè·¯\n\nç»„åˆé€»è¾‘ç”µè·¯å³ç”±è‹¥å¹²é€»è¾‘é—¨ç»„åˆè€Œæˆçš„ç”µè·¯ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æ— çŠ¶æ€ï¼Œè¾“å‡ºä»…ä¸è¾“å…¥æœ‰å…³ï¼Œè¾“å…¥æ”¹å˜åè¾“å‡ºå¾ˆå¿«å°±ä¼šéšä¹‹æ”¹å˜ã€‚\n\nåœ¨ HCL ä¸­ï¼Œç”¨é€»è¾‘è¡¨è¾¾å¼æ¥è¡¨ç¤ºç»„åˆé€»è¾‘ç”µè·¯ï¼Œä¾‹å¦‚ `bool eq = (a && b) || (!a && !b)` è¡¨ç¤ºè®¡ç®— `a`ã€`b` æ˜¯å¦ç›¸ç­‰çš„ç”µè·¯ã€‚å› ä¸ºå®ƒè¡¨ç¤ºçš„æ˜¯ç”µè·¯è€Œä¸æ˜¯è®¡ç®—ï¼Œåœ¨è¿™æ¡è¯­å¥ä¹‹åï¼Œä¸€æ—¦ `a`ã€`b` çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œ`eq` çš„è¾“å‡ºä¹Ÿä¼šæ”¹å˜ï¼ˆå’Œ Vue çš„ computed ç±»ä¼¼ï¼‰ã€‚\n\n### ä»¥ word ä¸ºå•ä½è¿›è¡Œæ“ä½œçš„ç”µè·¯\n\nåœ¨å¤„ç†å™¨çš„è®¾è®¡ä¸­ï¼Œç»å¸¸éœ€è¦å¯¹ä¸€ä¸ª word è€Œéå•ä¸ª bit è¿›è¡Œæ“ä½œã€‚\n\nåœ¨ HCL ä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨å¤§å†™çš„åç§°è¡¨ç¤º wordï¼Œä¾‹å¦‚: `bool Eq = (A == B)` è¡¨ç¤ºè®¡ç®— word `A`ã€`B` æ˜¯å¦ç›¸ç­‰çš„ç”µè·¯ï¼Œå¯ä»¥å®ç°ä¸ºåˆ¤æ–­æ¯ä¸ª bit æ˜¯å¦ç›¸ç­‰å† ANDã€‚\n\n### Multiplexor (MUX)\n\nmultiplexor (MUX) çš„åŠŸèƒ½æ˜¯é€šè¿‡ä¿¡å·è¾“å…¥çš„å€¼æ¥åœ¨å…¶å®ƒè¾“å…¥ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºè¾“å‡ºï¼Œword-level çš„ MUX ç”µè·¯å¦‚å›¾ (CSAPP Figure 4.13)ï¼š\n\n![word-level MUX ç”µè·¯](csapp-fig4.13.png)\n\nåœ¨ HCL ä¸­ï¼Œä½¿ç”¨ *case expressions* è¡¨ç¤º MUXï¼Œä¾‹å¦‚\n\n```hcl-csapp\nword Mux = [\n    !s1 && !s0: A;\n    !s1: B;\n    !s0: C;\n    1: D;\n];\n```\n\nè¡¨ç¤ºä¸€ä¸ªç”± `s0` å’Œ `s1` æ§åˆ¶çš„ã€åœ¨ `A`ã€`B`ã€`C`ã€`D` ä¸­é€‰ä¸€ä¸ªä½œä¸ºè¾“å‡ºçš„ MUXã€‚\n\ncase expression åœ¨é€»è¾‘ä¸Šçš„è¯­ä¹‰æ˜¯ä¾æ¬¡åˆ¤æ–­æ¯ä¸ªæ¡ä»¶ï¼Œä»¥ç¬¬ä¸€ä¸ªæ»¡è¶³çš„æ¡ä»¶ä½œä¸ºè¾“å‡ºï¼Œç±»ä¼¼äº Rust çš„ matchã€‚\n\nä¸‹é¢çš„ HCL ä»£ç è¡¨ç¤ºè®¡ç®— `A`ã€`B`ã€`C` ä¸­çš„æœ€å°å€¼ï¼š\n\n```hcl-csapp\nword Min3 = [\n    A <= B && A <= C: A;\n    B <= C: B;\n    1: C;\n];\n```\n\n### Arithmetic/logic unit (ALU)\n\nALU æ˜¯ç”¨æ¥è¿›è¡Œç®—æœ¯/é€»è¾‘è¿ç®—çš„ç»„åˆé€»è¾‘ç”µè·¯å…ƒä»¶ï¼Œå®ƒæ¥æ”¶ä¸¤ä¸ª data input ä»¥åŠä¸€ä¸ªè¡¨ç¤ºè¿›è¡Œä½•ç§è¿ç®—çš„ control inputï¼Œè¾“å‡ºè¿ç®—çš„ç»“æœã€‚\n\n### æµ‹è¯•å€¼æ˜¯å¦å±äºé›†åˆ\n\nåœ¨ HCL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `in` æ¥è¡¨ç¤ºæµ‹è¯•å€¼æ˜¯å¦å±äºé›†åˆçš„ç”µè·¯ï¼Œä¾‹å¦‚: \n\n```hcl-csapp\nbool s1 = code in { 2, 3 };\nbool s0 = code in { 1, 3 };\n```\n\n### Memory and Clocking\n\nç»„åˆé€»è¾‘ç”µè·¯æ˜¯æ— çŠ¶æ€ä¸”å®æ—¶æ›´æ–°çš„ï¼›ä¸ä¹‹ç›¸å¯¹ï¼Œmemory å¯ä»¥å­˜å‚¨çŠ¶æ€ï¼Œä½†æ›´æ–°ç”± clock æ§åˆ¶ã€‚\n\nè¿™ä¸€ç« ä¸­ä¼šç”¨åˆ°çš„ memory æœ‰ä¸¤å¤§ç§ä¸‰å°ç§ï¼š\n\n-   clocked register: å­˜å‚¨ä¸€ä¸ªå€¼ï¼Œæœ‰ä¸€ä¸ªè¾“å…¥å’Œä¸€ä¸ªè¾“å‡ºã€‚è¾“å‡ºå³å­˜å‚¨çš„å€¼ï¼Œè€Œæ¯æ¬¡ clock rise æ—¶ä¼šå°†å­˜å‚¨çš„å€¼ä¿®æ”¹ä¸ºè¾“å…¥ã€‚\n-   random access memory:\n    -   register file: å­˜å‚¨ 15 ä¸ªå€¼ï¼ˆåœ¨ Y86-64 å¤„ç†å™¨ä¸­ï¼‰ï¼Œæœ‰ä¸¤ä¸ª read port å’Œä¸€ä¸ª write portï¼š\n        -   æ¯ä¸ª read port æœ‰ä¸€ä¸ªè¾“å…¥ `src` è¡¨ç¤º register identifierï¼Œæœ‰ä¸€ä¸ªè¾“å‡º `val` è¡¨ç¤ºè¿™ä¸ª register å­˜å‚¨çš„å€¼ï¼Œä¸” `src` æ”¹å˜å `val` ä¼šç«‹åˆ»æ”¹å˜ã€‚\n        -   write port æœ‰ä¸€ä¸ªè¾“å…¥ `dst` è¡¨ç¤º register identifierï¼Œå¦æœ‰ä¸€ä¸ªè¾“å…¥ `val` ç”¨äºå†™å…¥ã€‚æ¯æ¬¡ clock rise æ—¶ï¼Œå¦‚æœ `dst` ä¸æ˜¯ `F` å°±ä¼šå°† `val` å†™å…¥ç›¸åº”çš„ registerã€‚\n    -   data memory: å­˜å‚¨å¾ˆå¤šä¸ªå€¼ï¼Œç”¨åœ°å€è¿›è¡Œç´¢å¼•ã€‚\n        -   æœ‰ä¸€ä¸ªåœ°å€è¾“å…¥ `address`ã€‚\n        -   æœ‰ä¸€ä¸ªä¿¡å·è¾“å…¥ `write` è¡¨ç¤ºè¿›è¡Œå†™å…¥è€Œéè¯»å–ã€‚\n        -   æœ‰ä¸€ä¸ªæ•°æ®è¾“å‡º `data out`ã€‚è‹¥ `write` ä¸º 0ï¼Œ`data out` ä¼šç«‹åˆ»è¾“å‡º `address` å¤„å­˜å‚¨çš„å€¼ã€‚\n        -   æœ‰ä¸€ä¸ªæ•°æ®è¾“å…¥ `data in`ã€‚è‹¥ `write` ä¸º 1ï¼Œåœ¨ clock rise æ—¶ä¼šå°† `data in` å†™å…¥ `address` å¤„ã€‚\n        -   æœ‰ä¸€ä¸ªä¿¡å·è¾“å‡º `error`ï¼Œåœ¨ `address` ä¸æ˜¯åˆæ³•åœ°å€æ—¶è¾“å‡º 1ã€‚\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™å‡ ç§ memory çš„å…±åŒç‚¹æ˜¯è¯»å–æ˜¯å®æ—¶çš„ï¼Œä½†å†™å…¥ç”± clock æ§åˆ¶ã€‚\n\nåœ¨ Y86-64 çš„ç¨‹åºçŠ¶æ€ä¸­ï¼Œå¯„å­˜å™¨å­˜åœ¨ register file ä¸­ï¼Œstatus flagsã€program counterã€status code å­˜åœ¨ clocked register ä¸­ï¼Œmemory å­˜åœ¨ data memory ä¸­ã€‚\n\nY86-64 å¤„ç†å™¨è¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„ read-only instruction memory ç”¨æ¥è¯»å–æŒ‡ä»¤ï¼Œè€Œåœ¨çœŸå®çš„å¤„ç†å™¨ä¸­è¿™æ˜¯å’Œå†…å­˜ä¸€ä½“çš„ã€‚\n\n<Card type="question" title="data memory çš„ read ä¿¡å·">\n383 é¡µçš„å›¾ä¸­ data memory è¿˜æœ‰ä¸€ä¸ª `read` ä¿¡å·ï¼Œä½†åœ¨æ–‡å­—è¯´æ˜ä¸­æ²¡æœ‰æåˆ°å®ƒçš„ä½œç”¨ï¼Œè€Œå¯¹ `write` ä¿¡å·çš„è¯´æ˜ä¼¼ä¹ä½¿å¾— `read` ä¿¡å·æ— ç”¨ ğŸ¤”\n</Card>\n\n## Sequential Y86-64 Implementations\n\nè¿™ä¸€èŠ‚ä¼šå®ç°ä¸€ä¸ªåä¸º SEQ çš„é¡ºåºæ‰§è¡Œçš„å¤„ç†å™¨ã€‚åœ¨è¿™ä¸ªå¤„ç†å™¨ä¸­ï¼ŒæŒ‡ä»¤æ˜¯æŒ‰é¡ºåºä¸€æ¡æ¥ç€ä¸€æ¡æ‰§è¡Œçš„ï¼Œä¸”æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåœ¨ä¸€ä¸ª clock cycle å†…æ‰§è¡Œå®Œæ¯•ï¼Œè¿™è¦æ±‚ clock cycle å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å¤„ç†å™¨çš„æ‰§è¡Œå¾ˆæ…¢ï¼Œä¸‹ä¸¤èŠ‚å°†å¯¹æ­¤è¿›è¡Œä¼˜åŒ–ã€‚\n\n### æŒ‡ä»¤æ‰§è¡Œçš„é˜¶æ®µåˆ’åˆ†ä¸å…·ä½“æ“ä½œ\n\nå°†æŒ‡ä»¤çš„æ‰§è¡Œåˆ’åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œå¯ä»¥ä½¿è¡Œä¸ºæœ‰å¾ˆå¤§å·®åˆ«çš„ä¸åŒæŒ‡ä»¤æœ‰ä¸€å®šçš„ç»Ÿä¸€æ€§ï¼Œæ–¹ä¾¿ç¡¬ä»¶å®ç°ã€‚\n\næœ¬èŠ‚ä¼šå°†æŒ‡ä»¤æ‰§è¡Œåˆ’åˆ†ä¸ºå…­ä¸ªé˜¶æ®µï¼š\n\n1.  Fetch: å°†æŒ‡ä»¤ç¼–ç ä¸­ä¸åŒéƒ¨åˆ†çš„å€¼è¯»å–å‡ºæ¥\n2.  Decode: è¯»å–å¯„å­˜å™¨çš„å€¼ï¼ˆæˆ‘æ„Ÿè§‰ fetch å’Œ decode è¿™ä¸¤ä¸ªåå­—äº’æ¢ä¸€ä¸‹æ‰æ¯”è¾ƒå¯¹ ğŸ¤”ï¼‰\n3.  Execute: æ‰§è¡Œè¿ç®—\n4.  Memory: å†™å…¥æˆ–è¯»å–å†…å­˜\n5.  Write back: å†™å…¥å¯„å­˜å™¨\n6.  PC update: æ›´æ–° program counter\n\næ¯ä¸ªæŒ‡ä»¤æ¯é˜¶æ®µçš„å…·ä½“æ“ä½œå¦‚å›¾ï¼ˆCS:APP Figure 4.18~4.21ã€Solution 4.17ï¼‰ï¼š\n\n![OPq, rrmovq, irmovq](csapp-fig4.18.png)\n\n![rmmovq, mrmovq](csapp-fig4.19.png)\n\n![pushq, popq](csapp-fig4.20.png)\n\n![jXX, call, ret](csapp-fig4.21.png)\n\n![cmovXX](csapp-sol4.17.png)\n\n### SEQ çš„ä¸»ä½“ç”µè·¯\n\nCS:APP Figure 4.23 å¤§è‡´å±•ç¤ºäº† SEQ çš„ä¸»ä½“ç”µè·¯ï¼š\n\n![SEQ ä¸»ä½“ç”µè·¯](csapp-fig4.23.png)\n\nå…¶ä¸­è“è‰²çš„å…ƒä»¶æ˜¯ black boxï¼Œç°è‰²çš„å…ƒä»¶ä¼šåœ¨åé¢è¿›è¡Œè®¾è®¡ï¼Œè¿˜æœ‰éƒ¨åˆ†ç”µè·¯è¿æ¥æ²¡æœ‰ç”»å‡ºæ¥ã€‚\n\nè¿™ä¸ªç”µè·¯å¤§æ¦‚çœ‹ç€æœ‰ä¸ªå°è±¡å³å¯ï¼Œç»†èŠ‚ä¼šåœ¨åé¢è¯´æ˜ã€‚\n\n### SEQ çš„æ—¶åºæ§åˆ¶\n\nåœ¨ SEQ ä¸­ï¼Œæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰§è¡Œä¸€æ¡æŒ‡ä»¤ï¼Œè€Œæ—¶é’Ÿæ§åˆ¶çš„åªæœ‰å„ç§ memory çš„å†™å…¥ï¼Œmemory çš„è¯»å–å’Œè¿ç®—éƒ½æ˜¯ç”¨ç»„åˆé€»è¾‘ç”µè·¯å®ç°çš„ï¼Œè™½ç„¶åœ¨é€»è¾‘ä¸Šæœ‰æ‰§è¡Œé¡ºåºï¼Œåœ¨ç”µè·¯ä¸Šå´æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ªå…³äº memory çš„å‡½æ•°ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªæ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼šè¯»å– memory å¹¶è®¡ç®—å‡ºéœ€è¦å†™å…¥ memory çš„å€¼ï¼Œç„¶ååœ¨ clock rise æ—¶æ‰§è¡Œå†™å…¥ï¼Œä»è€Œè¯»å–åˆ°æ–°çš„ memory çš„å€¼è€Œæ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚\n\nä¸ºäº†è¿™ä¸ªè®¾è®¡èƒ½å¤Ÿå®ç°ï¼Œä¸€æ¡é‡è¦çš„åŸåˆ™æ˜¯ â€œNo reading backâ€ï¼Œå³ä¸€æ¡æŒ‡ä»¤ä¸èƒ½å…ˆæ›´æ–°å†è¯»å–åŒä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ `pushq` ä¸­ï¼Œä¸æ˜¯å…ˆæ›´æ–° `R[%rsp]` å†å†™å…¥ `M[R[%rsp]]`ï¼Œè€Œæ˜¯å…ˆç®—å‡º `valE`ï¼Œå†å†™å…¥ `M[valE]`ï¼Œæœ€åå°† `valE` å†™å…¥ `R[%rsp]`ã€‚åˆä¾‹å¦‚ï¼Œæœ‰çš„æŒ‡ä»¤ä¼šä¿®æ”¹ status flagsï¼Œæœ‰çš„ä¼šè¯»å–ï¼Œä½†æ²¡æœ‰æŒ‡ä»¤æ—¢ä¿®æ”¹åˆè¯»å–ã€‚\n\nå› ä¸ºè¿ç®—éƒ½æ˜¯åŒæ—¶è¿›è¡Œçš„ï¼Œæ‰§è¡Œçš„å…­ä¸ªé˜¶æ®µå®é™…ä¸Šæ˜¯å…­ä¸ªéƒ¨åˆ†ã€‚\n\n### SEQ çš„å…·ä½“å®ç°\n\n\n'},{title:x,tags:t,content:"[CS:APP](https://csapp.cs.cmu.edu/) ç¬¬ä¸ƒç«  â€œLinkingâ€ çš„å­¦ä¹ ç¬”è®°ã€‚\n\nè¿™ç« çš„ä¸»è¦å†…å®¹ä¸ºç¨‹åºçš„é“¾æ¥ã€‚å­¦ä¹ é“¾æ¥æœ‰åŠ©äºï¼šç†è§£é“¾æ¥æŠ¥é”™ï¼Œé¿å…é“¾æ¥ç›¸å…³çš„ bugï¼Œç†è§£å˜é‡ï¼ˆå‡½æ•°ï¼‰çš„ä½œç”¨åŸŸï¼Œç†è§£ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ä¸é“¾æ¥ç›¸å…³çš„æ­¥éª¤ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨å…±äº«åº“ï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰ã€‚\n\n\n\n## Compiler Drivers\n\nç¼–è¯‘æºæ–‡ä»¶å…¶å®åˆ†æˆè‹¥å¹²æ­¥éª¤ï¼Œcompiler driverï¼ˆå¦‚ gccï¼‰ä¼šä¾æ¬¡è°ƒç”¨è¿™äº›æ­¥éª¤ï¼Œå¯ä»¥ç”¨ `gcc -v` æ¥æŸ¥çœ‹è¿™äº›æ­¥éª¤çš„è¯¦ç»†ä¿¡æ¯ã€‚\n\n1.  `cpp`: é¢„å¤„ç†ï¼Œæºä»£ç  `.c` ->  intermediate file `.i`\n2.  `cc1`: `.i` -> æ±‡ç¼–ä»£ç  `.s`\n3.  `as`: `.s` -> relocatable object file `.o`\n4.  `ld`: é“¾æ¥ï¼Œå¤šä¸ª `.o` (æˆ– library) -> executable object file\n\nP.S. ä¸­é—´æ­¥éª¤çš„æ–‡ä»¶ä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `gcc`ï¼Œä¾‹å¦‚ `gcc a.s -o a`ã€‚\n\n## Static Linking\n\né™æ€é“¾æ¥ä¸»è¦æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼š\n\n1.  *Symbol resolution*: relocatable object file ä¸­æœ‰å¾ˆå¤š symbolï¼ŒåŒ…æ‹¬å‡½æ•°ã€å…¨å±€å˜é‡ã€é™æ€å˜é‡ç­‰ï¼Œlinker éœ€è¦å°†æ¯ä¸ª symbol reference å¯¹åº”åˆ°ä¸€ä¸ª symbol definitionã€‚\n2.  *Relocation*: relocatable object file ä¸­åœ°å€ä» 0 å¼€å§‹ï¼Œlinker éœ€è¦å°†æ¯ä¸ª symbol definition é‡æ–°åˆ†é…åˆ°æ­£ç¡®çš„åœ°å€ï¼Œå¹¶ç›¸åº”åœ°ä¿®æ”¹æ¯ä¸ª symbol referenceã€‚\n\n## Object Files\n\nobject file åˆ†ä¸ºä¸‰ç§ï¼š\n\n1.  Relocatable object file\n2.  Executable object file\n3.  Shared object file: ä¸€ç§ç‰¹æ®Šçš„ relocatable object fileï¼Œå¯ä»¥åœ¨ load time æˆ– run time è¿›è¡ŒåŠ¨æ€é“¾æ¥\n\nobject file æœ‰ä¸åŒçš„æ ¼å¼ï¼ŒWindows ä½¿ç”¨ Portable Executable (PE) æ ¼å¼ï¼ŒmacOS ä½¿ç”¨ Mach-O æ ¼å¼ï¼Œç°ä»£çš„ x86-64 Linux/Unix ç³»ç»Ÿä½¿ç”¨ Executable and Linkable Format (ELF) æ ¼å¼ã€‚æœ¬ç« ä¼šåŸºäº ELF-64ã€‚\n\n## Relocatable Object Files\n\nELF relocatable object file é€šå¸¸åŒ…å«ä»¥ä¸‹ sectionï¼š\n\n1.  `.text`: ç¨‹åºçš„æœºå™¨ç \n2.  `.rodata`: åªè¯»çš„æ•°æ®\n3.  `.data`: éœ€è¦åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡\n4.  `.bss`: æœªåˆå§‹åŒ–æˆ–åˆå§‹åŒ–ä¸ºé›¶çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå®ƒä»¬åœ¨è¿è¡Œæ—¶ä¼šä»¥é›¶ä¸ºåˆå€¼ï¼Œä»è€Œåœ¨ object file ä¸­ä¸å æ®æ–‡ä»¶å¤§å°\n5.  `.symtab`: symbol tableï¼Œå­˜å‚¨ symbolï¼ˆå‡½æ•°ã€å…¨å±€å˜é‡ï¼‰çš„ä¿¡æ¯ï¼Œä¸éœ€è¦ `-g` ç¼–è¯‘é€‰é¡¹ï¼Œä½†ä¸å«å±€éƒ¨å˜é‡çš„ä¿¡æ¯\n6.  `.rel.text`: åˆ—å‡ºäº† `.text` ä¸­åœ¨é“¾æ¥æ—¶éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼Œä¸€èˆ¬æ˜¯è°ƒç”¨å¤–éƒ¨å‡½æ•°æˆ–å¼•ç”¨å…¨å±€å˜é‡æ—¶éœ€è¦ä¿®æ”¹ï¼Œè€Œ [è°ƒç”¨æœ¬åœ°å‡½æ•°ä¸éœ€è¦ä¿®æ”¹](/post/2022/09/csapp-3#jump-æŒ‡ä»¤ç¼–ç )\n7.  `.rel.data`: åˆ—å‡ºäº† `.data` ä¸­åœ¨é“¾æ¥æ—¶éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼Œä¸€èˆ¬æ˜¯å…¨å±€å˜é‡çš„å€¼ä¸ºå…¶ä»–å…¨å±€å˜é‡æˆ–å¤–éƒ¨å‡½æ•°çš„åœ°å€æ—¶éœ€è¦ä¿®æ”¹\n8.  `.debug`: è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…å«å±€éƒ¨å˜é‡çš„ä¿¡æ¯ã€typedef ä¿¡æ¯ã€æºä»£ç ç­‰ï¼Œéœ€è¦ `-g` ç¼–è¯‘é€‰é¡¹æ‰æœ‰\n9.  `.line`: æºä»£ç ä¸æœºå™¨ç è¡Œå·é—´çš„å¯¹åº”å…³ç³»ï¼Œéœ€è¦ `-g` ç¼–è¯‘é€‰é¡¹æ‰æœ‰\n10. `.strtab`: ä¸€å †å­—ç¬¦ï¼Œç”¨äºå…¶å®ƒ sectionï¼Œå¯ä»¥æŒ‡å‘å…¶ä¸­ä¸€ä¸ªä½ç½®æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆä»è¿™ä¸ªä½ç½®èµ·åˆ° `\\0` ä¸ºæ­¢ï¼‰\n\n## Symbols and Symbol Tables\n\nå¯¹ linker æ¥è¯´ï¼Œsymbol æœ‰ä¸‰ç§ï¼š\n\n1.  æœ¬åœ°å®šä¹‰ï¼Œå¯ä»¥è¢«å¤–éƒ¨è®¿é—®çš„: C ä¸­é `static` çš„å‡½æ•°å’Œå…¨å±€å˜é‡\n2.  å¤–éƒ¨å®šä¹‰çš„ï¼Œä¾‹å¦‚ C ä¸­ `extern` çš„å…¨å±€å˜é‡\n3.  æœ¬åœ°å®šä¹‰ï¼Œå¤–éƒ¨ä¸å¯è®¿é—®çš„: C ä¸­ `static` çš„å‡½æ•°å’Œå˜é‡\n\nä¸€ä¸ª ELF64 symbol åŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼ˆCS:APP Figure 7.4ï¼‰ï¼š\n\n```c\ntypedef struct\n{\n    int   name;      /* String table offset */\n    char  type:4,    /* Function or data (4 bits) */\n          binding:4; /* Local or global (4 bits) */\n    char  reserved;  /* Unused */\n    short section;   /* Section header index */\n    long  value;     /* Section offset or absolute address */\n    long  size;      /* Object size in bytes */\n} Elf64_Symbol;\n```\n\n`value` åœ¨ relocatable object file ä¸­æ˜¯ symbol çš„åœ°å€ç›¸å¯¹äº section å¼€å¤´çš„ offsetï¼Œåœ¨ executable object file ä¸­æ˜¯ symbol çš„ç»å¯¹åœ°å€ã€‚\n\n`section` æ˜¯ object file çš„ section ä¹‹ä¸€ï¼ˆçš„ indexï¼‰ï¼Œåœ¨ relocatable object file ä¸­è¿˜å¯ä»¥æ˜¯ä¸€ä¸ª pseudosection:\n\n-   ABS: ä¸åº”è¢« relocate çš„ symbol\n-   UNDEF: æœªå®šä¹‰ï¼ˆåœ¨å…¶ä»– module ä¸­å®šä¹‰ï¼‰çš„ symbol\n-   COMMON: å¤šä¸ª module å…±ç”¨çš„ symbolï¼ˆè§ [Symbol Resolution](#symbol-resolution)ï¼‰ï¼Œæ­¤æ—¶ `value` çš„å€¼ç»™å‡º data alignment çš„è¦æ±‚ï¼Œ`size` ç»™å‡ºçš„æ˜¯ minimum size\n\næœªåˆå§‹åŒ–çš„é™æ€å˜é‡ä»¥åŠåˆå§‹åŒ–ä¸ºé›¶çš„å…¨å±€æˆ–é™æ€å˜é‡ä¼šæ”¾åœ¨ `.bss`ã€‚\n\næœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œå¦‚æœå¯ç”¨äº† `-fcommon` ç¼–è¯‘é€‰é¡¹åˆ™ä¼šæ”¾åœ¨ COMMONï¼Œå¦åˆ™æ”¾åœ¨ `.bss`ã€‚åœ¨ gcc 9 åŠä¹‹å‰é»˜è®¤é€‰é¡¹æ˜¯ `-fcommon`ï¼Œè€Œè‡ª gcc 10 èµ·é»˜è®¤é€‰é¡¹æ˜¯ `-fno-common`ã€‚åœ¨ C++ ä¸­ `-fcommon` æ˜¯æ— æ•ˆçš„ï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡æ€»æ˜¯æ”¾åœ¨ `.bss`ã€‚\n\nå¯ä»¥ä½¿ç”¨ `readelf -s a.o` æ¥æŸ¥çœ‹ `a.o` çš„ `.symtab`ã€‚\n\n## Symbol Resolution\n\nSymbol resolution å³æŠŠæ¯ä¸ª symbol reference å¯¹åº”åˆ°ä¸€ä¸ª symbol definitionã€‚\n\nlocal symbol çš„ resolution æ˜¯å®¹æ˜“çš„ï¼Œå› ä¸ºç¼–è¯‘å•ä¸ª module æ—¶å°±ä¿è¯äº† local symbol æ˜¯å”¯ä¸€çš„ã€‚\n\nglobal symbol å¯èƒ½é‡åˆ°å‡ ç§æƒ…å†µï¼š\n\n-   åªæœ‰ä¸€ä¸ª module é‡Œå®šä¹‰äº†è¿™ä¸ª global symbolï¼Œåˆ™ä½¿ç”¨è¿™ä¸ª symbol\n-   æ²¡æœ‰ä»»ä½• module é‡Œå®šä¹‰äº†è¿™ä¸ª global symbolï¼Œåˆ™æŠ¥é”™ undefined reference\n-   åœ¨å¤šä¸ª module é‡Œå®šä¹‰äº†è¿™ä¸ª global symbolï¼Œåˆ™ï¼š\n    -   å¦‚æœå…¶ä¸­æœ‰å¤šä¸ª symbol ä¸åœ¨ COMMON æ®µï¼Œåˆ™æŠ¥é”™ multiple definition\n    -   å¦‚æœå…¶ä¸­åªæœ‰ä¸€ä¸ªä¸åœ¨ COMMON æ®µï¼Œåˆ™ä½¿ç”¨è¿™ä¸ª symbol\n    -   å¦‚æœè¿™äº› symbol éƒ½åœ¨ COMMON æ®µï¼Œåˆ™ä½¿ç”¨å…¶ä¸­ `size` æœ€å¤§çš„ä¸€ä¸ªï¼ˆå¦‚æœ `size` ç›¸åŒåˆ™ä½¿ç”¨å“ªä¸ªæ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼‰ï¼›å¦‚æœè¿™äº› symbol æœ‰ä¸ä¸€æ ·çš„ `size`ï¼Œlinker è¿˜ä¼šç»™å‡ºè­¦å‘Š\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œè‹¥ç¼–è¯‘é€‰é¡¹ä¸º `-fcommon`ï¼Œå¦‚æœåœ¨å¤šä¸ª module ä¸­å®šä¹‰äº†åŒä¸€ä¸ªå…¨å±€å˜é‡ä¸”å…¶ä¸­æœ€å¤šæœ‰ä¸€ä¸ªåˆå§‹åŒ–äº†ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ„å¤–çš„ç»“æœã€‚å¯ä»¥ç†è§£ä¸ºï¼Œmultiple definition åœ¨æœ¬è´¨ä¸Šæ˜¯ multiple initializationã€‚\n\nåœ¨ C++ ä¸­ï¼Œå‡½æ•°é‡è½½ã€ç±»æ–¹æ³•ä¼šé€šè¿‡ *mangling* æ¥ä½¿å¾—å‡½æ•°çš„æ¯ç§é‡è½½æœ‰ç‹¬ç‰¹çš„ symbol nameã€‚\n\n## Static Libraries\n\nStatic library å…¶å®å°±æ˜¯ä¸€å † object file åŒ…è£…åœ¨ä¸€èµ·ï¼Œå®ƒçš„å¥½å¤„æ˜¯ï¼š\n\n1.  ä¸ç”¨æ¯æ¬¡é‡æ–°ç¼–è¯‘ï¼ˆæ¯”èµ·æä¾›æºç ï¼‰\n2.  ä½¿å¾—åº“å’Œç¼–è¯‘å™¨è§£è€¦ï¼ˆæ¯”èµ·å°†åº“å‡½æ•°å†…ç½®åˆ°ç¼–è¯‘å™¨ä¸­ï¼‰\n3.  åªéœ€å°†ç”¨åˆ°çš„ object file å¤åˆ¶åˆ°æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œé¿å…ç©ºé—´æµªè´¹ï¼ˆæ¯”èµ·æä¾›å•ä¸ª object fileï¼‰\n4.  å¯ä»¥è‡ªåŠ¨é€‰æ‹©ç”¨åˆ°çš„ object fileï¼Œåœ¨ç¼–è¯‘å‘½ä»¤ä¸­åªéœ€æŒ‡å®šå°‘é‡åº“çš„åç§°ï¼ˆæ¯”èµ·æä¾›ä¸€å † object fileï¼‰\n\nå¯ä»¥ä½¿ç”¨ç±»ä¼¼ `ar rcs libabc.a a.o b.o c.o` çš„å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ª static libraryã€‚\n\nåœ¨ç¼–è¯‘æ—¶ï¼Œæœ‰ä¸¤ç§ä½¿ç”¨ static library çš„æ–¹å¼ï¼š\n\n-   ç›´æ¥å°† static library çš„è·¯å¾„ä½œä¸ºå‚æ•°: `libabc.a`\n-   ä½¿ç”¨ `-lname` æ¥ä½¿ç”¨ `libname.a`ï¼Œä½†éœ€è¦ä½¿ç”¨ `-Ldir` æ¥å°† `dir` åŠ å…¥åˆ° `-l` çš„æœç´¢è·¯å¾„ä¹‹ä¸­: `-L. -labc`\n\nç‰¹åˆ«åœ°ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨å°† `libc.a` æä¾›ç»™ linkerï¼Œä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®šã€‚\n\nåœ¨é“¾æ¥æ—¶ï¼Œlinker ä¼šä¾æ¬¡å¤„ç†æ¯ä¸ªå‚æ•°ï¼š\n\n-   å¦‚æœä¸€ä¸ªå‚æ•°æ˜¯ object file å°±ä¸€å®šä¼šä½¿ç”¨\n-   å¦‚æœæ˜¯ static libraryï¼Œåˆ™ä¼šä¾æ¬¡æŸ¥çœ‹å…¶ä¸­åŒ…å«çš„æ¯ä¸€ä¸ª object fileï¼Œå¦‚æœä¸€ä¸ª object file ä¸­å®šä¹‰äº†æŸä¸ªå½“å‰å¼•ç”¨äº†ä½†ä»æœªå®šä¹‰çš„ symbolï¼Œåˆ™ä¼šä½¿ç”¨è¿™ä¸ª object fileï¼Œè€Œè¿™æ ·çš„è¿‡ç¨‹ä¼šåå¤è¿­ä»£è¿›è¡Œç›´åˆ°æ²¡æœ‰æ–°çš„ object file è¢«ä½¿ç”¨ä¸ºæ­¢ï¼ˆä¾‹å¦‚ `main.c` å¼•ç”¨äº† `b.o` è€Œæ²¡æœ‰å¼•ç”¨ `a.o`ï¼Œè€Œ `b.o` ä¸­å¼•ç”¨äº† `a.o`ï¼Œä¸”åœ¨ `libabc.a` ä¸­ `a.o` ä½äº `b.o` ä¹‹å‰ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è¿­ä»£ä¸­åªä¼šä½¿ç”¨ `b.o`ï¼Œç¬¬äºŒæ¬¡è¿­ä»£æ‰ä¼šä½¿ç”¨ `a.o`ï¼Œè€Œ `c.o` ä¸ä¼šè¢«ä½¿ç”¨ï¼‰\n\nè¿™æ ·çš„è¿‡ç¨‹ä½¿å¾—ç¼–è¯‘å‘½ä»¤ä¸­å‚æ•°çš„é¡ºåºä»¥åŠ static library ä¸­ object file çš„é¡ºåºå¯èƒ½å½±å“ç¼–è¯‘ç»“æœï¼š\n\n-   ä¸€èˆ¬æ¥è¯´éœ€è¦å°† library æ”¾åœ¨ç¼–è¯‘å‘½ä»¤çš„æœ«å°¾ï¼Œå¦åˆ™å¤„ç†ä¸€ä¸ª library æ—¶è¿˜æ²¡æœ‰å¼•ç”¨å…¶ä¸­çš„ symbolï¼Œå°±ä¸ä¼šä½¿ç”¨ç›¸åº”çš„ object fileï¼Œæœ€åå°±ä¼šæŠ¥é”™ undefined reference\n-   å¦‚æœå¤šä¸ª library ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œéœ€è¦å°†è¢«å…¶ä»– library ä¾èµ–çš„ library æ”¾åœ¨é åçš„ä½ç½®\n-   å¦‚æœå¤šä¸ª library ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–ï¼Œå¯èƒ½éœ€è¦åœ¨ç¼–è¯‘å‘½ä»¤ä¸­å¤šæ¬¡æŒ‡å®šåŒä¸€ä¸ª libraryï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥å°†è¿™ä¸¤ä¸ª library åˆå¹¶æˆä¸€ä¸ªï¼Œè¿™æ ·çš„è¯é€šè¿‡å¤šæ¬¡è¿­ä»£å°±å¯ä»¥è§£å†³å¾ªç¯ä¾èµ–ï¼‰\n-   library çš„è®¾è®¡åº”å½“é¿å… multiple definitionï¼Œä½†ç†è®ºä¸Šå­˜åœ¨ä¸åŒçš„å‚æ•°é¡ºåºæˆ– static library ä¸­ object file çš„é¡ºåºå¯¼è‡´ multiple definition çš„å¯èƒ½\n\n## Relocation\n\nrelocation åˆ†ä¸ºä¸¤æ­¥ï¼š\n\n1.  ç»™ symbol definition é‡æ–°åˆ†é…å†…å­˜åœ°å€\n2.  ç›¸åº”åœ°ä¿®æ”¹ symbol reference\n\nç¬¬ä¸€æ­¥æ˜¯ç®€å•çš„ï¼ŒæŠŠå„ä¸ª object file ä¸­çš„å„ä¸ª section åˆ†åˆ«æ‹¼åœ¨ä¸€èµ·å³å¯ã€‚\n\nä¸ºäº†è®© linker çŸ¥é“å¦‚ä½•ä¿®æ”¹ symbol referenceï¼Œéœ€è¦è®© linker çŸ¥é“ï¼š\n\n1.  éœ€è¦è¢«ä¿®æ”¹çš„ symbol reference åœ¨å“ª\n2.  éœ€è¦ä¿®æ”¹æˆä»€ä¹ˆ\n\nåœ¨ relocatable object file çš„ `.rel.text` å’Œ `.rel.data` ä¸­å­˜æ”¾äº†ç›¸å…³çš„ä¿¡æ¯ï¼Œä¸€æ¡è¿™æ ·çš„ä¿¡æ¯ç§°ä½œä¸€ä¸ª relocation entryï¼ŒåŒ…å«çš„å†…å®¹ä¸ºï¼š\n\n-   `offset`: è¿™ä¸ª symbol reference ç›¸å¯¹äºå…¶æ‰€åœ¨çš„ section çš„åç§»é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¿™ä¸ª reference æ‰€åœ¨çš„ section çš„åœ°å€çš„åŸºç¡€ä¸ŠåŠ ä¸Š `offset` å°±å¾—åˆ°äº†è¿™ä¸ª reference çš„åœ°å€ã€‚\n-   `type`: æœ‰å¾ˆå¤šç§ relocationï¼ŒCS:APP ä¸­åªä»‹ç»å…¶ä¸­çš„ `R_X86_64_PC32` å’Œ `R_X86_64_32` ä¸¤ç§ã€‚\n-   `symbol`: è¢« reference çš„ symbol åœ¨ symbol table ä¸­çš„ indexã€‚\n-   `addend`: è®¡ç®— symbol åœ°å€æ—¶åŠ åœ¨æœ€åçš„å¸¸æ•°ï¼ˆè§åæ–‡ï¼‰ã€‚\n\nç®€å•æ¥è¯´ï¼Œ`R_X86_64_32` ä½¿ç”¨ç»å¯¹åœ°å€è¿›è¡Œå®šä½ï¼Œ`R_X86_64_PC32` ä½¿ç”¨ç›¸å¯¹äº PC çš„åœ°å€è¿›è¡Œå®šä½ï¼Œä¸”è¿™ä¸¤ç§ç±»å‹çš„ relocation éƒ½åªæ”¯æŒ 32 ä½çš„åœ°å€ï¼ˆå¦‚æœä¸€ä¸ªç¨‹åºçš„å¤§å°è¶…è¿‡ 2GBï¼Œå°±éœ€è¦æŒ‡å®šç¼–è¯‘é€‰é¡¹ `-mcmodel=medium/large`ï¼‰ã€‚\n\n-   `R_X86_64_32`: ä¿®æ”¹åçš„ reference ä¸º symbol çš„åœ°å€åŠ ä¸Š `addend`\n-   `R_X86_64_PC32`: ä¿®æ”¹åçš„ reference ä¸º symbol çš„åœ°å€ä¸ reference çš„åœ°å€ä¹‹å·®åŠ ä¸Š `addend`ï¼›éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ˜¯ä¸ reference çš„åœ°å€ä¹‹å·®ï¼Œè€Œä¸æ˜¯ä¸æ‰§è¡Œåˆ° reference æ‰€åœ¨è¯­å¥æ—¶çš„ PC ä¹‹å·®ï¼Œæ‰€ä»¥é€šå¸¸ä¼šéœ€è¦é€šè¿‡ `addend` æ¥ä¿®æ­£\n\nå¯ä»¥ä½¿ç”¨ `objdump -dx` ä»¥åœ¨åæ±‡ç¼–ç»“æœä¸­æ˜¾ç¤º relocation entryï¼Œæˆ–è€…ä½¿ç”¨ `readelf -r` æ˜¾ç¤ºæ‰€æœ‰ relocation entryã€‚\n\nä¾‹å¦‚ï¼Œä½¿ç”¨ GCC 8.5 ç¼–è¯‘\n\n```c\nint foo(int *arr);\n\nint a[3] = {1, 2, 3};\nint *b = &a[2];\n\nint bar()\n{\n    return foo(&a[1]);\n}\n```\n\n`readelf -r`:\n\n```\nRelocation section '.rela.text' at offset 0x250 contains 2 entries:\n  Offset          Info           Type           Sym. Value    Sym. Name + Addend\n000000000001  000a0000000a R_X86_64_32       0000000000000008 a + 4\n000000000006  000b00000002 R_X86_64_PC32     0000000000000000 foo - 4\n\nRelocation section '.rela.data' at offset 0x280 contains 1 entry:\n  Offset          Info           Type           Sym. Value    Sym. Name + Addend\n000000000000  000a00000001 R_X86_64_64       0000000000000008 a + 8\n```\n\nåœ¨ `.rela.text` ä¸­ï¼Œ`a` çš„ `addend` æ˜¯ `4`ï¼Œæ˜¯ç›´æ¥å¾—åˆ° `a[1]` è€Œé `a[0]` çš„åœ°å€ï¼›`foo` çš„ `addend` æ˜¯ `-4`ï¼Œæ˜¯å› ä¸º reference çš„åœ°å€æ˜¯ reference æ‰€åœ¨çš„ `jmp` æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‡ 4ï¼Œå¯¼è‡´ PC çš„åœ°å€åŠ ä¸Š `foo` çš„åœ°å€å‡å» reference çš„åœ°å€å¾—åˆ°çš„æ˜¯ `foo` çš„åœ°å€åŠ  4ï¼Œéœ€è¦ `addend` æ¥ä¿®æ­£ã€‚\n\n## Executable Object Files\n\nå¯æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹å¤§ä½“ä¸Šå’Œ relocatable object file ç±»ä¼¼ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯ï¼š\n\n-   åœ¨ ELF header ä¸­æŒ‡å®šäº†ç¨‹åºçš„ entry point\n-   æœ‰ä¸€ä¸ª `.init` sectionï¼Œå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œç”¨æ¥åˆå§‹åŒ–ç¨‹åº\n-   æœ‰ä¸€ä¸ª program header tableï¼Œæè¿°äº†ç¨‹åºæ–‡ä»¶ä¸å†…å­˜çš„å¯¹åº”å…³ç³»ï¼Œå³è¦æŠŠæ–‡ä»¶çš„å“ªä¸€æ®µæ˜ å°„åˆ°å†…å­˜çš„å“ªä¸€æ®µï¼Œåœ°å€å¦‚ä½•å¯¹é½ï¼Œä»¥åŠæ¯ä¸€æ®µçš„æƒé™ï¼ˆ`.init`ã€`.text`ã€`.rodata` çš„æƒé™ä¸º `r-x`ï¼Œ`.data` å’Œ `.bss` çš„æƒé™ä¸º `rw-`ï¼‰\n-   `.symtab`ã€`.debug`ã€`.line`ã€`.strtab` åœ¨æ‰§è¡Œæ—¶ä¸ä¼šåŠ è½½åˆ°å†…å­˜ä¸­\n-   å¦‚æœ fully linkedï¼Œåˆ™æ²¡æœ‰ `.rel` section\n\n## Loading Executable Object Files\n\nåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œrun-time memory image å¤§è‡´å¦‚ä¸‹å›¾ï¼ˆCS:APP Figure 7.15ï¼‰æ‰€ç¤ºï¼š\n\n![Linux x86-64 run-time memory image](csapp-fig7.15.png)\n\nï¼ˆ[errata](https://csapp.cs.cmu.edu/3e/errata.html) ä¸­æŒ‡å‡ºï¼Œæ ˆçš„èµ·å§‹åœ°å€å¹¶ä¸æ˜¯ $2^{48}-1$ã€‚ï¼‰\n\nå› ä¸ºåœ°å€å¯¹é½ã€address-space layout randomization ç­‰åŸå› ï¼Œå®é™…ä¸Šçš„å†…å­˜ç»“æ„ä¼šä¸ä¸Šå›¾æœ‰ä¸€å®šçš„å·®å¼‚ï¼Œä½†æ¯ä¸€æ®µçš„ç›¸å¯¹ä½ç½®æ˜¯å’Œå›¾ä¸­ä¸€è‡´çš„ã€‚\n\nloader åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œé¦–å…ˆåˆ›å»º memory imageï¼Œç„¶åæ ¹æ® program header table å°†å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œæœ€åè·³è½¬åˆ°ç¨‹åºçš„ entry pointã€‚C è¯­è¨€ç¨‹åºçš„ entry point æ˜¯ `_start` å‡½æ•°ï¼ˆåœ¨ `crt1.o` ä¸­å®šä¹‰ï¼‰çš„åœ°å€ï¼Œ`_start` åˆä¼šè°ƒç”¨ `__libc_start_main` å‡½æ•°ï¼ˆåœ¨ `libc.so` ä¸­å®šä¹‰ï¼‰ï¼Œè¿›è¡Œè¿è¡Œç¯å¢ƒçš„åˆå§‹åŒ–ï¼Œç„¶åè°ƒç”¨ `main` å‡½æ•°ï¼Œæœ€åå¯¹è¿”å›å€¼è¿›è¡Œå¤„ç†ã€‚\n\n## Dynamic Linking with Shared Libraries\n\né™æ€åº“æœ‰ä¸€äº›é—®é¢˜ï¼š\n\n1.  æ›´æ–°é™æ€åº“éœ€è¦é‡æ–°é“¾æ¥\n2.  æ¯ä¸ªç¨‹åºéƒ½æœ‰ä¸€ä»½åº“çš„æ‹·è´ï¼Œä¼šé€ æˆç©ºé—´çš„æµªè´¹\n\nå…±äº«åº“ (shared library) å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ã€‚å…±äº«åº“å¯ä»¥åœ¨ run time æˆ–è€… load time è¢«åŠ¨æ€é“¾æ¥ã€‚åŠ¨æ€é“¾æ¥ç”± dynamic linker å®Œæˆã€‚å…±äº«åº“ä¹Ÿè¢«ç§°ä½œ shared objectï¼Œåœ¨ Linux ä¸­åç¼€åä¸º `.so`ï¼Œåœ¨ Windows ä¸­è¢«å«åš DLLã€‚\n\nå…±äº«åº“åœ¨ä¸¤ä¸ªå±‚é¢ä¸Šè¢«å…±äº«ï¼š\n\n1.  åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šåªæœ‰ä¸€ä»½ `.so` æ–‡ä»¶ï¼Œè€Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­æ²¡æœ‰åº“çš„æ‹·è´\n2.  åœ¨å†…å­˜ä¸­å…±äº«åº“çš„ `.text` section çš„å•ä»½æ‹·è´å¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹åŒæ—¶ä½¿ç”¨\n\nå¯ä»¥ç”¨ç±»ä¼¼äº `gcc -shared -fpic a.c b.c c.c -o libabc.so` çš„å‘½ä»¤æ„å»ºå…±äº«åº“ã€‚ç¼–è¯‘é€‰é¡¹ä¸­ `-shared` å‘Šè¯‰ç¼–è¯‘å™¨è¦ç”Ÿæˆ shared objectï¼Œ`-fpic` ç”¨æ¥ç”Ÿæˆ [position-independent code](#position-independent-code-pic)ã€‚\n\nå¯ä»¥ç”¨ç±»ä¼¼ `gcc main.c ./libabc.so -o main` çš„å‘½ä»¤æ¥ä½¿ç”¨å…±äº«åº“ã€‚\n\nè¿è¡Œ `main` æ—¶ï¼Œloader ä¼šåœ¨è¿›å…¥ entry point å‰åœ¨ `.interp` section ä¸­å‘ç° dynamic linker `ld-linux.so`ï¼Œäºæ˜¯è®© dynamic linker å®Œæˆå…±äº«åº“çš„ relocation å¹¶ä¿®æ”¹ç¨‹åºä¸­çš„ symbol referenceï¼Œæœ€åå°†æ§åˆ¶æƒäº¤è¿˜ç»™ç¨‹åºã€‚\n\n## Loading and Linking Shared Libraries from Applications\n\né™¤äº†åœ¨ç¼–è¯‘æ—¶æŒ‡å®šè¦é“¾æ¥åˆ°çš„å…±äº«åº“å¹¶åœ¨ load time é“¾æ¥ï¼Œä¹Ÿå¯ä»¥åœ¨ run time åŠ è½½å¹¶ä½¿ç”¨å…±äº«åº“ã€‚\n\nC è¯­è¨€ä¸­çš„ç›¸å…³å‡½æ•°æ”¾åœ¨ `dlfcn.h` å¤´æ–‡ä»¶ä¸­ï¼Œç¼–è¯‘æ—¶éœ€è¦ `-ldl` æ¥ä½¿ç”¨è¿™äº›å‡½æ•°ï¼š\n\n-   `void *dlopen(const char *filename, int flag)`: åŠ è½½å…±äº«åº“\n\n    -   è¿”å›å€¼: æˆåŠŸåŠ è½½åˆ™è¿”å› handleï¼Œå¦åˆ™è¿”å› `NULL`\n\n    -   `filename`: å…±äº«åº“æ–‡ä»¶å\n\n    -   `flag`: å½±å“å¦‚ä½•å¤„ç†å…±äº«åº“ä¸­å¼•ç”¨çš„ external symbolï¼Œå¿…é¡»åŒ…å« `RTLD_NOW` å’Œ `RTLD_LAZY` ä¸¤è€…ä¹‹ä¸€\n\n        -   `RTLD_NOW`: ç«‹å³ resolve æ‰€æœ‰ external symbol\n        -   `RTLD_LAZY`: ç­‰åˆ°è¿è¡Œå…±äº«åº“ä¸­çš„ä»£ç æ—¶å† resolve external symbol\n        -   `RTLD_GLOBAL`: ä¹‹åç»™å…¶ä»–å…±äº«åº“ resolve external symbol æ—¶å¯ä»¥ä½¿ç”¨å½“å‰è¿™ä¸ªå…±äº«åº“\n\n        å¦‚æœç¼–è¯‘ç¨‹åºæ—¶å¯ç”¨äº† `-rdynamic` é€‰é¡¹ï¼Œåœ¨ resolve external symbol æ—¶ï¼Œé™¤äº†ä½¿ç”¨å…¶ä»–åŠ è½½æ—¶å¯ç”¨äº† `RTLD_GLOBAL` é€‰é¡¹çš„å…±äº«åº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¨‹åºè‡ªèº«çš„ global symbolã€‚\n\n-   `void *dlsym(void *handle, char *symbol)`: è·å¾—å…±äº«åº“ä¸­æŸä¸ª symbol çš„åœ°å€\n\n    -   `symbol`: symbol åç§°\n\n    -   è¿”å›å€¼: æˆåŠŸè·å–åˆ™è¿”å› symbol åœ°å€ï¼Œå¦åˆ™è¿”å› `NULL`\n\n-   `int dlclose(void *handle)`: å…³é—­å…±äº«åº“\n\n    -   è¿”å›å€¼: æˆåŠŸå…³é—­åˆ™è¿”å› `0`ï¼Œå‡ºé”™åˆ™è¿”å› `-1`\n\n-   `const char *dlerror(void)`: è·å–æœ€åä¸€æ¬¡è°ƒç”¨ `dlopen` / `dlsym` / `dlclose` çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¦‚æœæœ€åä¸€æ¬¡è°ƒç”¨æ²¡æœ‰å‡ºé”™åˆ™è¿”å› `NULL`\n\nCS:APP ç»™å‡ºäº†ä¸€ä»½å‚è€ƒä»£ç  [code/link/dll.c](https://csapp.cs.cmu.edu/3e/ics3/code/link/dll.c)ã€‚\n\n## Position-Independent Code (PIC)\n\nå…±äº«åº“çš„ä¸€æ¡é‡è¦æ€§è´¨æ˜¯å®ƒçš„ä»£ç æ®µåœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œè€Œå¯ä»¥è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œè¿™å°±ä½¿å¾—å®ƒçš„ä»£ç ä¸­çš„ symbol reference ä¸èƒ½åœ¨åŠ¨æ€é“¾æ¥æ—¶è¢«ä¿®æ”¹ï¼Œé€‚ç”¨äºé™æ€é“¾æ¥çš„ relocation æ— æ³•å®Œæˆï¼Œæ‰€ä»¥å…±äº«åº“çš„ä»£ç éœ€è¦æ˜¯ position-independent çš„ã€‚\n\nPIC çš„ä¸»è¦æ€è·¯åŸºäºä»¥ä¸‹ä¸¤ç‚¹ï¼š\n\n1.  è™½ç„¶å…±äº«åº“çš„ä»£ç æ®µæ˜¯å…±äº«çš„ï¼Œä½†æ•°æ®æ®µæ˜¯æ¯ä¸ªè¿›ç¨‹å„æœ‰ä¸€ä»½çš„\n2.  æ— è®ºæ•´ä¸ªå…±äº«åº“è¢«æ”¾åˆ°å†…å­˜çš„å“ªä¸ªä½ç½®ï¼Œä»£ç æ®µå’Œæ•°æ®æ®µåœ°å€çš„è·ç¦»æ˜¯å›ºå®šçš„ï¼ˆè¿™ä¸ä¸Šä¸€æ¡ä¸çŸ›ç›¾ï¼Œåº”è¯¥æ˜¯å› ä¸ºè™šå­˜ï¼‰\n\nå› æ­¤ï¼Œå¯ä»¥åœ¨æ•°æ®æ®µä¸­å­˜æ”¾æ•ˆæœç›¸å½“äº relocation çš„ä¿¡æ¯ï¼Œæ¥é—´æ¥è¾¾åˆ° relocation çš„æ•ˆæœã€‚è¯´ç™½äº†å°±æ˜¯ï¼Œå› ä¸ºæ²¡æ³•ä¿®æ”¹ä»£ç æ®µï¼Œæ‰€ä»¥æŠŠ symbol çš„åœ°å€æ”¾åˆ°æ•°æ®æ®µé‡Œã€‚å…·ä½“å®ç°ä¸­ï¼Œæ•°æ®æ®µçš„å¼€å¤´æœ‰ä¸€ä¸ª *global offset table* (GOT)ï¼Œè¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªåœ°å€ï¼Œå¯ä»¥ç”± dynamic linker è¿›è¡Œä¿®æ”¹ï¼Œè€Œç”±äºä»£ç æ®µå’Œæ•°æ®æ®µçš„åœ°å€è·ç¦»å›ºå®šï¼Œå°±å¯ä»¥ç”¨ PC-relative çš„æ–¹å¼å¯»å€åˆ°è¡¨ä¸­çš„é¡¹ã€‚\n\nPIC data reference æ˜¯ç®€å•çš„ï¼Œåªè¦åœ¨ GOT ä¸­ä¸ºæ¯ä¸ª data symbol (å…¨å±€æˆ– static å˜é‡) åˆ›å»ºä¸€ä¸ªè¡¨é¡¹ï¼Œåœ¨åŠ¨æ€é“¾æ¥æ—¶ç”± dynamic linker ä¿®æ”¹è¿™äº›é¡¹ï¼Œè€Œåœ¨ä»£ç ä¸­é€šè¿‡è¿™ä¸ªè¡¨é¡¹æ¥é—´æ¥åœ°è¿›è¡Œ data referenceï¼Œä¾‹å¦‚ (CS:APP Figure 7.18ï¼Œ`GOT[3]` ä¸­å­˜æ”¾äº†å…¨å±€å˜é‡ `x` çš„åœ°å€)ï¼š\n\n```asm\n    movq Ox2OO8b9(%rip), %rax   # %rax = *GOT[3] = &x\n    addl $0x1, (%rax)           # ++x\n```\n\nå¦‚æœæ˜¯æœ¬åœ°å®šä¹‰çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ PC-relative çš„å®šä½æ–¹å¼ç›´æ¥å¼•ç”¨ï¼Œè€Œåªå¯¹å¤–éƒ¨å®šä¹‰çš„å˜é‡ä½¿ç”¨ GOTï¼Œä½†ç¼–è¯‘å™¨ä¹Ÿå¯èƒ½é€‰æ‹©ä¸åšè¿™æ ·çš„åŒºåˆ†è€Œæ˜¯ä½¿ç”¨ç»Ÿä¸€çš„æ–¹æ³•æ¥å¤„ç†ã€‚\n\nPIC procedure call ä¹Ÿå¯ä»¥å’Œ data reference ä¸€æ ·å¤„ç†ï¼ˆå¯ä»¥ç”¨ `-fno-plt` ç¼–è¯‘é€‰é¡¹æ¥è¿™æ ·åšï¼‰ï¼Œä½†å®é™…ä¸Šä¼šä½¿ç”¨åä¸º *lazy binding* çš„æŠ€æœ¯è¿›è¡Œä¼˜åŒ–ã€‚\n\nè¿™æ˜¯å› ä¸ºï¼Œé“¾æ¥åˆ°ä¸€ä¸ªå…±äº«åº“æ—¶ï¼Œå¾€å¾€æœ€ç»ˆä¼šè°ƒç”¨çš„åªæ˜¯å®ƒæä¾›çš„å¤§é‡å‡½æ•°ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œå¦‚æœå¯¹æ•´ä¸ªå…±äº«åº“ç”¨åˆ°çš„å¤–éƒ¨å‡½æ•°éƒ½åœ¨åŠ¨æ€é“¾æ¥æ—¶è®¡ç®—å‡ºç›¸åº”çš„ offsetï¼Œå°±å¯èƒ½é€ æˆæµªè´¹ã€‚è€Œ lazy binding åˆ™æ˜¯åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æŸä¸ªå¤–éƒ¨å‡½æ•°æ—¶ç»‘å®šè¿™ä¸ªå‡½æ•°çš„åœ°å€ã€‚\n\nlazy binding åŸºäºä¸€ä¸ªåä¸º *procedure linkage table* (PLT) çš„ç»“æ„ã€‚PLT ä½äºä»£ç æ®µä¸­ï¼Œè¡¨ä¸­çš„æ¯ä¸€é¡¹å…¶å®æ˜¯ä¸‰æ¡æŒ‡ä»¤ï¼Œå¦‚ CS:APP Figure 7.19 æ‰€ç¤ºï¼š\n\n![PLT åŸç†ç¤ºæ„å›¾](csapp-fig7.19.png)\n\næ•´ä¸ªæµç¨‹å°±æ˜¯ï¼š\n\n1.  è°ƒç”¨ `addvec` æ—¶ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ `PLT[2]` çš„åœ°å€\n2.  `PLT[2]` çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ä¼šè·³è½¬åˆ° `GOT[4]`ï¼Œ`GOT[4]` é‡Œä¸€å¼€å§‹æ”¾çš„æ˜¯ `PLT[2]` çš„ç¬¬äºŒæ¡æŒ‡ä»¤ï¼Œæ‰€ä»¥é¦–æ¬¡è°ƒç”¨ `PLT[2]` æ—¶å°±ä»ç¬¬ä¸€æ¡æŒ‡ä»¤è·³åˆ°ç¬¬äºŒæ¡æŒ‡ä»¤\n3.  ç¬¬äºŒæ¡æŒ‡ä»¤æ˜¯å¾€æ ˆé‡Œå‹å…¥ `addvec` çš„ IDï¼Œæ˜¯ç”¨æ¥å‘Šè¯‰ dynamic linker è¿™æ˜¯å“ªä¸ªå‡½æ•°\n4.  ç¬¬ä¸‰æ¡æŒ‡ä»¤ä¼šè·³è½¬åˆ° `PLT[0]` \n5.  `PLT[0]` çš„ç¬¬ä¸€æ¡æŒ‡ä»¤æ˜¯å¾€æ ˆé‡Œå‹å…¥ relocation entries çš„åœ°å€ï¼Œç¬¬äºŒæ¡æŒ‡ä»¤æ˜¯è·³è½¬åˆ° dynamic linker\n6.  dynamic linker é€šè¿‡æ”¾åœ¨æ ˆä¸­çš„å‡½æ•°çš„ ID ä»¥åŠ relocation entries è®¡ç®—å‡º `addvec` çš„åœ°å€ï¼Œæ”¾åœ¨ `GOT[4]`ï¼Œç„¶åè·³è½¬åˆ° `addvec`\n7.  å› ä¸ºä¸€è·¯ä¸Šéƒ½æ˜¯ `jmp`ï¼Œè·³è½¬åˆ° `addvec` åå¯ä»¥æ­£å¸¸è¿”å›åˆ°è°ƒç”¨ `PLT[2]` çš„ä½ç½®\n8.  ç¬¬äºŒæ¬¡è°ƒç”¨ `PLT[2]` æ—¶ï¼Œ`GOT[4]` é‡Œå·²ç»æ˜¯ `addvec` çš„åœ°å€ï¼Œæ‰€ä»¥å°±åœ¨ `PLT[2]` çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å¤„è·³è½¬åˆ°äº† `addvec`\n\n## Library Interpositioning\n\nLinux çš„é“¾æ¥å™¨æ”¯æŒä¸€ä¸ªåä¸º *library interpositioning* çš„æŠ€æœ¯ï¼Œå¯ä»¥ç”¨æ¥æŠŠå…±äº«åº“çš„å‡½æ•°æ›¿æ¢æ‰ï¼Œä¸€èˆ¬ä¼šæ¢æˆä¸€ä¸ª wrapper function ç”¨æ¥ traceï¼Œä½†ä¹Ÿå¯ä»¥æ¢æˆå®Œå…¨ä¸åŒçš„ä¸œè¥¿ã€‚\n\nçœ‹äº†ä¸‹ä¸­æ–‡ç‰ˆ CS:APPï¼Œè¿™ä¸ªä¸œè¥¿ç«Ÿç„¶å«â€œåº“æ‰“æ¡©â€ï¼ˆ\n\nç¼–è¯‘æ—¶çš„ library interpositioning å°±æ˜¯ç”¨ `#define` æ¢æ‰æŸä¸ªå‡½æ•° ~~ï¼Œåœ¨æœºæˆ¿é‡Œè¢« `#define sort random_shuffle` è¿‡çš„å¤§å®¶æƒ³å¿…å¯¹æ­¤éå¸¸ç†Ÿæ‚‰~~ã€‚\n\né“¾æ¥æ—¶çš„ library interpositioning æ˜¯ç»™ linker ä¼ å‚ `--wrap foo`ï¼Œç„¶åè°ƒç”¨ `foo` å°±ä¼šå®é™…ä¸Šè°ƒç”¨ `__wrap_foo`ï¼Œè€Œè°ƒç”¨ `__real_foo` åˆ™ä¼šè°ƒç”¨åŸæœ¬çš„ `foo`ã€‚ä¸€èˆ¬ä¼šç»™ `gcc` è€Œé `ld` ä¼ å‚ï¼Œå°±æ˜¯ç”¨ `gcc -Wl,--wrap,foo` ä»£æ›¿ `ld --wrap foo`ï¼Œå…¶ä¸­ `-Wl` è¡¨ç¤ºç»™ linker ä¼ å‚ï¼Œåé¢çš„é€—å·ä¼šè¢«æ¢æˆç©ºæ ¼ã€‚\n\nè¿è¡Œæ—¶çš„ library interpositioning æ˜¯åœ¨è¿è¡Œç¨‹åºæ—¶è®¾ç½®ç¯å¢ƒå˜é‡ `LD_PRELOAD=\"/path/to/wrapper.so /path/to/anotherwrapper.so\"`ï¼Œç„¶ååœ¨ä½¿ç”¨ä»»æ„å…±äº«åº“ä¸­çš„å‡½æ•°ä¹‹å‰å°±ä¼šä¼˜å…ˆå°è¯•ä½¿ç”¨ `wrapper.so` å’Œ `anotherwrapper.so`ã€‚è¿™æ—¶ï¼Œä¸ºäº†èƒ½åœ¨ wrapper function ä¸­è°ƒç”¨åŸæœ¬çš„å‡½æ•°ï¼Œå°±éœ€è¦ [åœ¨è¿è¡Œæ—¶åŠ è½½å…±äº«åº“](#loading-and-linking-shared-libraries-from-applications)ã€‚\n\nå¦‚æœæƒ³çœ‹å…·ä½“å®ç°ï¼Œå¯ä»¥å‚è€ƒ CS:APPã€‚\n\nç¼–è¯‘æ—¶çš„ library interpositioning éœ€è¦ä¿®æ”¹æºä»£ç ï¼Œé“¾æ¥æ—¶çš„ library interpositioning éœ€è¦è·å–åˆ° object file å¹¶é‡æ–°é“¾æ¥å¾—åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œè¿è¡Œæ—¶ library interpositioning åªéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¸éœ€è¦å¯¹å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¯¹å¾ˆå¤šä¸åŒç¨‹åºçš„æŸä¸ªå‡½æ•°è°ƒç”¨è¿›è¡Œè·Ÿè¸ªã€‚\n"},{title:w,tags:"gcc æ€§èƒ½ä¼˜åŒ– é—®é¢˜è§£å†³è®°å½•",content:`åœ¨å­¦ä¹  [æµ®ç‚¹æ•°ç²¾åº¦è½¬æ¢æŒ‡ä»¤](/post/2022/09/csapp-3#æµ®ç‚¹æ•°ç²¾åº¦è½¬æ¢) æ—¶ï¼ŒCS:APP é‡Œæåˆ° gcc å¹¶ä¸ä½¿ç”¨ \`vcvtss2sd\`/\`vcvtsd2ss\`ï¼Œè€Œæ˜¯ä½¿ç”¨ \`vunpcklps\` & \`vcvtps2pd\` / \`vmovddup\` & \`vcvtpd2psx\`ï¼Œä½†æ˜¯æˆ‘ä½¿ç”¨ gcc 12.2.0 ç¼–è¯‘å¾—åˆ°çš„ç»“æœå°±æ˜¯ \`vcvtss2sd\`/\`vcvtsd2ss\`ã€‚å¯¹æ­¤ï¼ŒCS:APP æ²¡æœ‰æ·±ç©¶ï¼š

> It is unclear why GCC generates this code. There is neither benefit nor need to have the value duplicated within the XMM register.

ä½†æ˜¯ CS:APP é€‰æ‹©æ”¾å¼ƒåè€Œä¼šæ¿€å‘è¯»è€…çš„æ–—å¿—å•Šï¼ˆ

è™½ç„¶ä½†æ˜¯ï¼Œæˆ‘ç¡®å®æ²¡æƒ³åˆ°è¿™ç©æ„ä¼šè®©æˆ‘æ–­æ–­ç»­ç»­æäº†ä¸‰å¤©ï¼Œddl åˆè¦å¯„äº† ğŸŒš



## é—®é¢˜æè¿°

è¿™ä¸€é—®é¢˜å¯ä»¥ç”±ä¸‹é¢çš„ä»£ç æ‰€å±•ç¤ºï¼š

\`\`\`c
double f2d(float x)
{
    return x;
}

float d2f(double x)
{
    return x;
}

double fp2d(float *x)
{
    return *x;
}

float dp2f(double *x)
{
    return *x;
}
\`\`\`

å®ƒç¼–è¯‘æˆæ±‡ç¼–çš„ç»“æœæœ‰å¦‚ä¸‹å‡ ç§ï¼š

<Card title="ç¼–è¯‘ç»“æœ" fold>

æ±‡ç¼–ä¸­ä¸é‡è¦çš„éƒ¨åˆ†å·²çœå»ã€‚

A:

\`\`\`asm
f2d:
    cvtss2sd    %xmm0, %xmm0
    ret
d2f:
    cvtsd2ss    %xmm0, %xmm0
    ret
fp2d:
    pxor        %xmm0, %xmm0
    cvtss2sd    (%rdi), %xmm0
    ret
dp2f:
    pxor        %xmm0, %xmm0
    cvtsd2ss    (%rdi), %xmm0
    ret
\`\`\`

Bï¼š

\`\`\`asm
f2d:
    unpcklps    %xmm0, %xmm0
    cvtps2pd    %xmm0, %xmm0
    ret
d2f:
    unpcklpd    %xmm0, %xmm0
    cvtpd2ps    %xmm0, %xmm0
    ret
fp2d:
    movss       (%rdi), %xmm0
    cvtps2pd    %xmm0, %xmm0
    ret
dp2f:
    movq        (%rdi), %xmm0
    cvtpd2ps    %xmm0, %xmm0
    ret
\`\`\`

A with AVX2ï¼š

\`\`\`asm
f2d:
    vcvtss2sd   %xmm0, %xmm0, %xmm0
    ret
d2f:
    vcvtsd2ss   %xmm0, %xmm0, %xmm0
    ret
fp2d:
    vxorps      %xmm0, %xmm0, %xmm0
    vcvtss2sd   (%rdi), %xmm0, %xmm0
    ret
dp2f:
    vxorps      %xmm0, %xmm0, %xmm0
    vcvtsd2ss   (%rdi), %xmm0, %xmm0
    ret
\`\`\`

B with AVX2ï¼š

\`\`\`asm
f2d:
    vunpcklps   %xmm0, %xmm0, %xmm0
    vcvtps2pd   %xmm0, %xmm0
    ret
d2f:
    vmovddup    %xmm0, %xmm0
    vcvtpd2psx  %xmm0, %xmm0
    ret
fp2d:
    vmovss      (%rdi), %xmm0
    vcvtps2pd   %xmm0, %xmm0
    ret
dp2f:
    vmovq       (%rdi), %xmm0
    vcvtpd2psx  %xmm0, %xmm0
    ret
\`\`\`

</Card>

| å‡½æ•° |          A          |            B            |      A with AVX2       |        B with AVX2        |
| :--: | :-----------------: | :---------------------: | :--------------------: | :-----------------------: |
| f2d  |     \`cvtss2sd\`      | \`unpcklps\` & \`cvtps2pd\` |      \`vcvtss2sd\`       | \`vunpcklps\` & \`vcvtps2pd\` |
| d2f  |     \`cvtsd2ss\`      | \`unpcklpd\` & \`cvtpd2ps\` |      \`vcvtsd2ss\`       | \`vmovddup\` & \`vcvtpd2psx\` |
| fp2d | \`pxor\` & \`cvtss2sd\` |  \`movss\` & \`cvtps2pd\`   | \`vxorps\` & \`vcvtss2sd\` |  \`vmovss\` & \`vcvtps2pd\`   |
| dp2f | \`pxor\` & \`cvtsd2ss\` |   \`movq\` & \`cvtpd2ps\`   | \`vxorps\` & \`vcvtsd2ss\` |  \`vmovq\` & \`vcvtpd2psx\`   |

é—®é¢˜åœ¨äºï¼Œgcc ä¸ºä»€ä¹ˆ/åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šç”Ÿæˆå¦‚ B æ‰€ç¤ºçš„æŒ‡ä»¤ã€‚å…¶ä¸­ï¼Œä½¿ç”¨ä¸¤æ¡ç†è§£èµ·æ¥éƒ½ä¸å¤ªå®¹æ˜“çš„æŒ‡ä»¤ï¼ˆ\`unpcklps\`ã€\`cvtps2pd\`ï¼‰æ¥ä»£æ›¿æŒ‡ä»¤é›†ä¸­è‡ªå¸¦çš„ \`cvtss2sd\`/\`cvtsd2ss\` æœ€ä»¤äººè´¹è§£ã€‚è€Œ source ä¸ºæŒ‡é’ˆçš„å¦å¤–ä¸¤ä¸ªå‡½æ•°æ˜¯å— [performance - Why don't GCC and Clang use cvtss2sd \\[memory\\]? - Stack Overflow](https://stackoverflow.com/questions/16597587/why-dont-gcc-and-clang-use-cvtss2sd-memory) å¯å‘ã€‚

æˆ‘å…ˆå°è¯•äº†å„ç§å…³é”®è¯ç”¨æœç´¢å¼•æ“è¿›è¡Œæœç´¢ï¼Œå‡æœªæ‰¾åˆ°ç­”æ¡ˆã€‚

## gcc ç‰ˆæœ¬çš„å®šä½

ä½¿ç”¨ [Compiler Explorer](https://gcc.godbolt.org/) è¿›è¡Œå°è¯•ï¼Œå¾ˆå¿«å°±èƒ½ç¡®è®¤ï¼Œæ˜¯åœ¨ gcc 4.8.5 / 4.9.0 ä¹‹é—´è¡Œä¸ºå‡ºç°äº†å˜åŒ–ã€‚

äºæ˜¯ï¼Œæˆ‘å…ˆçœ‹äº† [gcc 4.9 changes](https://gcc.gnu.org/gcc-4.9/changes.html)ï¼Œåˆåœ¨ commit log é‡Œå¤§åŠ›æœç´¢ â€œ\`cvtss2sd\`â€ â€œ\`cvtsd2ss\`â€ â€œ\`unpcklp\`â€ â€œfloating pointâ€ â€œconvertâ€â€¦â€¦éƒ½æ²¡æ‰¾åˆ°ç›¸å…³å†…å®¹ã€‚

## å…·ä½“ commit çš„å®šä½ï¼šgit bisect / ç¼–è¯‘ gcc

åœ¨å„ç§æœç´¢éƒ½å¤±è´¥åï¼Œæˆ‘å†³å®šä½¿ç”¨ \`git bisect\` æ‰¾åˆ°è¡Œä¸ºå‡ºç°å˜åŒ–çš„ commitã€‚

è¦ bisectï¼Œå°±å¾—ç¼–è¯‘ gcc 4.8.5 ~ 4.9.0ï¼Œæ­¥éª¤å¤§è‡´å¦‚ä¸‹ï¼š

1.  å°† gcc ä»£ç  clone ä¸‹æ¥: \`git clone https://github.com/gcc-mirror/gcc --branch releases/gcc-4.9 --depth 50000\`
2.  åˆ›å»º \`build\` ç›®å½•
3.  åœ¨ \`build\` ç›®å½•ä¸‹è¿è¡Œ \`gcc\` ä»“åº“æ ¹ç›®å½•çš„ \`configure\` è„šæœ¬
4.  åœ¨ \`build\` ç›®å½•ä¸‹è¿è¡Œ \`make\`

å…¶ä¸­ï¼Œ\`configure\` çš„é…ç½®å¯ä»¥å‚è€ƒ [Installing GCC: Configuration - GNU Project](https://gcc.gnu.org/install/configure.html)ï¼Œä½†æˆ‘åªæ˜¯ bisect ä¸€ä¸‹ï¼Œå°±æ²¡ä»”ç»†ç ”ç©¶ã€‚

è¿‡ç¨‹ä¸­èµ°çš„å¼¯è·¯å°±ä¸ä¸€ä¸€ç»†è¯´äº†ï¼Œåªè¯´ä¸€ä¸‹æœ€ç»ˆçš„è§£å†³æ–¹æ¡ˆä¸­é‡åˆ°çš„å‡ ä¸ªä¸»è¦é—®é¢˜ã€‚

æœ€ç»ˆçš„ç¼–è¯‘å‘½ä»¤ä¸º:

\`\`\`sh
CC=gcc-4.8
CXX=g++-4.8
make distclean
../gcc/configure --enable-languages=c --disable-multilib --disable-libsanitizer
make -j$(nproc)
\`\`\`

### è¯­è¨€æ ‡å‡†é—®é¢˜

å› ä¸ºç¼–è¯‘çš„æ˜¯å¤šå¹´å‰çš„ gcc 4.8~4.9ï¼Œç”¨ç°åœ¨çš„ç¼–è¯‘å™¨ä¼šé‡åˆ°ä¸€äº›è¯­è¨€æ ‡å‡†ä¸åŒçš„é—®é¢˜ã€‚ä¿®æ”¹ç¼–è¯‘é€‰é¡¹å¤§æ¦‚èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ”¹èµ·æ¥éº»çƒ¦ï¼Œä¹Ÿä¸è§å¾—èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œä¸å¦‚ç›´æ¥ç”¨æ—§ç‰ˆ gcc æ¥ç¼–è¯‘ã€‚

~~ä½†æ˜¯ç°åœ¨ç›®æ ‡å°±æ˜¯ç¼–è¯‘æ—§ç‰ˆ gccï¼Œä½ å“ªæ¥çš„æ—§ç‰ˆ gcc ç”¨æ¥ç¼–è¯‘ï¼Ÿ~~

ç”¨æ—§ç‰ˆ gcc è§£å†³ç¼–è¯‘æ—§ç‰ˆ gcc é‡åˆ°çš„é—®é¢˜çœ‹èµ·æ¥å¾ˆçŸ›ç›¾ï¼Œä½†æˆ‘ä»¬è¦è§£å†³çš„æ˜¯ç¼–è¯‘ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„ä¸€å † commitï¼Œè€Œè·å¾—ä¸€ä¸ªç”¨æ¥ç¼–è¯‘çš„æ—§ç‰ˆ gcc åªéœ€è¦ä¸€ä¸ª gcc release çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚è¿™ä¸ªç”¨æ¥ç¼–è¯‘çš„æ—§ç‰ˆ gcc å¯ä»¥ç”¨å„ç§æ–¹å¼ä¸‹è½½ä¸€ä¸ªï¼Œè€Œæˆ‘ç”¨çš„æ˜¯ Arch Linuxï¼Œå°±è£…äº† [AUR é‡Œçš„ gcc48](https://aur.archlinux.org/packages/gcc48)ã€‚

è·å¾—äº†ä¸€ä¸ªæ—§ç‰ˆ gcc åï¼Œè¿è¡Œ \`configure\` æ—¶ä¿®æ”¹ç¯å¢ƒå˜é‡ \`CC\` å’Œ \`CXX\` å³å¯ä½¿ç”¨ã€‚

P.S. æˆ‘æœ¬æ¥æƒ³ç”¨ AUR çš„ PKGBUILD æ¥ç¼–è¯‘ï¼Œä½†èƒ½ç¼–è¯‘ release ä¸ä»£è¡¨èƒ½ç¼–è¯‘å„ä¸ª commitï¼Œç„¶åè¸©å„ç§å‘è¸©äº†åŠå¤©..

### struct ucontext

è¿˜ä¼šé‡åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯: \`md-unwind-support.h:65:47: error: dereferencing pointer to incomplete type 'struct ucontext'\`

å°†ç›¸åº”ä»£ç ä¸­çš„ \`ucontext\` ä¿®æ”¹ä¸º \`ucontext_t\` å³å¯ã€‚

reference: [How to compile gcc 6.4.0 with gcc 7.2 in Archlinux - Stack Overflow](https://stackoverflow.com/questions/46999900/how-to-compile-gcc-6-4-0-with-gcc-7-2-in-archlinux)

### libsanitizer

è¿˜ä¼šé‡åˆ°ä¸€äº›ç¼–è¯‘é”™è¯¯ï¼Œåœ¨æœç´¢å…¶ä¸­ä¸€ä¸ªçš„è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæˆ‘æ‰¾åˆ°äº† [ä¸€æ¬¡ä»¤äººåè¡€çš„ ubuntu æºç å®‰è£… gcc-5.4.0 ç»å†\\_äº¿é›¶è´°è‚†çš„åšå®¢-CSDN åšå®¢\\_ubuntu å®‰è£… gcc5.4.0](https://blog.csdn.net/tuibianhuaisheng/article/details/115399019)ã€‚

è¿™ç¯‡åšå®¢ä¹Ÿæåˆ°äº†ä¸Šé¢è¯´çš„ \`struct ucontext\` çš„é—®é¢˜ï¼Œè€Œä»”ç»†ä¸€çœ‹å°±ä¼šå‘ç°ï¼Œå‰©ä¸‹å…¶ä»–é—®é¢˜å…¨éƒ½æ˜¯ \`libsanitizer\` é‡Œçš„ï¼Œè€Œæˆ‘ç ”ç©¶è¿™ä¸ªé—®é¢˜ä¸éœ€è¦ \`libsanitizer\`ï¼Œç›´æ¥ \`--disable-libsanitizer\` å°±èƒ½è§£å†³è¿™ä¸€å †ç¼–è¯‘é”™è¯¯è¿˜èƒ½ç¼©çŸ­ç¼–è¯‘ç”¨æ—¶ã€‚

### make distclean

ä¿®æ”¹å„ç§é€‰é¡¹æˆ–è€…æ›´æ¢ commit åï¼Œå¦‚æœç›´æ¥ \`make\` å®¹æ˜“å‡ºé—®é¢˜ï¼Œå¯ä»¥å…ˆ \`make distclean\` æ¥é‡ç½®ã€‚

### git bisect

åœ¨å¤„ç†å®Œä¸Šé¢å‡ ä¸ªé—®é¢˜ä¹‹åï¼Œç¼–è¯‘å°±å¾ˆé¡ºåˆ©äº†ã€‚åœ¨æˆ‘ 8C16T çš„ AMD Ryzen 7 4800H ä¸Šï¼Œç¼–è¯‘ä¸€æ¬¡å¤§çº¦éœ€è¦ 9minã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºåŸé—®é¢˜å¯ä»¥çœ‹æˆæ˜¯åœ¨æ›´è€çš„ç‰ˆæœ¬å‡ºç°ï¼Œå³æ–°ç‰ˆæœ¬ good è€ç‰ˆæœ¬ badï¼Œä½† \`git bisect\` é»˜è®¤æ˜¯è€ç‰ˆæœ¬ good æ–°ç‰ˆæœ¬ badï¼Œè¿™é‡Œå®¹æ˜“æåï¼Œéœ€è¦æ³¨æ„ã€‚ï¼ˆ\`git bisect\` å¯ä»¥æŠŠ good/bad æ”¹æˆ old/newï¼Œä½†æˆ‘æ‡’å¾—ï¼ˆç ”ç©¶æ€ä¹ˆï¼‰æ”¹äº†ã€‚ï¼‰

bisect æ‰¾åˆ°çš„ commit æ˜¯ [915e8e6e](https://github.com/gcc-mirror/gcc/commit/915e8e6eec05fb595d445cb738e4875d607ce126)ã€‚

ä»è¿™ä¸ª commit çš„å†…å®¹å¯ä»¥å¾—çŸ¥ï¼Œé‚£äº›çœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªçš„ç¼–è¯‘ç»“æœæ˜¯ä¸€ä¸ªå«åš \`use_vector_fp_converts\` çš„ä¼˜åŒ–çš„ç»“æœã€‚è¿™ä¸ª commit ä½¿å¾—è¿™ä¸ªä¼˜åŒ–åªå¯¹ amdfam10 æ¶æ„ç”Ÿæ•ˆï¼Œåœ¨æ–°ç‰ˆ gcc ä¸­ä»å¯ä½¿ç”¨ \`-mtune=amdfam10\` é€‰é¡¹è§‚å¯Ÿåˆ°è¿™ä¸€è¡Œä¸ºï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ \`-mtune-ctrl=use_vector_fp_converts\` æ¥å¯ç”¨è¿™ä¸ªä¼˜åŒ–ï¼‰ã€‚ä»£ç ä¸­å¯¹è¿™ä¸€ä¼˜åŒ–ç»™å‡ºçš„ç†ç”±æ˜¯ â€œavoids partial write to the destinationâ€ï¼Œä¹Ÿå°±æ˜¯è¯´ \`cvtss2sd\`/\`cvtsd2ss\` åªä¿®æ”¹ç›®æ ‡å¯„å­˜å™¨çš„ä½ä½ï¼Œå¯èƒ½å¯¼è‡´æ•ˆç‡ä½ã€‚

## ä¼˜åŒ–æœ€ç»ˆè¢«å…³é—­çš„åŸå› 

é”å®šäº†é—®é¢˜å‡ºç°çš„ commitï¼Œæ¥ä¸‹æ¥å°±æ˜¯æœç´¢è¿™ä¸ª commit ä¿®æ”¹çš„åŸå› äº†ã€‚

[åœ¨ \`gcc-patches\` é‡Œæœç´¢ \`use_vector_fp_converts\`](https://www.mail-archive.com/search?l=gcc-patches%40gcc.gnu.org&q=use_vector_fp_converts)ï¼Œç„¶åå†é¡ºç€é‚®ä»¶å†…å®¹æ‰¾ï¼Œå°±å¯ä»¥æ‰¾åˆ°ç›¸å…³é‚®ä»¶ï¼š

-   [\\[Google\\] X86_TUNE_USE_VECTOR_CONVERTS adjustment](https://www.mail-archive.com/gcc-patches@gcc.gnu.org/msg59433.html)
-   [\\[PATCH\\] disable use_vector_fp_converts for m_CORE_ALL](https://www.mail-archive.com/gcc-patches@gcc.gnu.org/msg61372.html) ([157ca3e9](https://github.com/gcc-mirror/gcc/commit/157ca3e989605194001568cc1864603b32fbd025))
-   [Revisit Core tunning flags](https://www.mail-archive.com/gcc-patches@gcc.gnu.org/msg62058.html)
-   [Re: \\[PATCH i386\\]: Enable push/pop in pro/epilogue for modern CPUs](https://www.mail-archive.com/gcc-patches@gcc.gnu.org/msg46926.html)

ä»¤æˆ‘è‡ªé—­çš„æ˜¯..ç›´æ¥æœç´¢ \`cvtss2sd\`/\`cvtsd2ss\` å°±èƒ½æœåˆ°è¿™äº›é‚®ä»¶ ğŸ˜µ ä¸ºä»€ä¹ˆ bisect å‡ºæ¥æ‰æƒ³ç€åœ¨é‚®ä»¶åˆ—è¡¨é‡Œæœå‘¢...ï¼ˆä½æƒ…å•†ï¼šwssbï¼›é«˜æƒ…å•†ï¼šè¿˜æ˜¯ mailing list ä½¿ç”¨ç»éªŒä¸è¶³ ğŸ˜¢ï¼‰

æ€»ç»“ä¸€ä¸‹è¿™äº›é‚®ä»¶çš„å†…å®¹ï¼Œå°±æ˜¯ï¼š

1.  åœ¨ä¸€äº› Intel CPU ä¸Šï¼ŒæŸäº› test case ä¸Šå¯ç”¨ \`use_vector_fp_converts\` æ›´å¿«ï¼Œå¦ä¸€äº› test case ä¸Šä¸å¯ç”¨æ›´å¿«ã€‚
2.  åœ¨å¯ç”¨ \`use_vector_fp_converts\` æ›´å¿«çš„ test case ä¸Šï¼Œå¯ä»¥é€šè¿‡åœ¨ \`cvtss2sd\`/\`cvtsd2ss\` ä¹‹å‰å°† XMM å¯„å­˜å™¨æ¸…ç©ºï¼ˆ\`pxor %xmm0, %xmm0\`ï¼‰ä»¥é¿å…åªæ›´æ–°ä½ä½å¸¦æ¥çš„æ€§èƒ½æŸå¤±ï¼Œä»è€Œè¾¾åˆ°å’Œå¯ç”¨ \`use_vector_fp_converts\` å·®ä¸å¤šçš„æ€§èƒ½ã€‚æ‰€ä»¥ [157ca3e9](https://github.com/gcc-mirror/gcc/commit/157ca3e989605194001568cc1864603b32fbd025) å°±å¯¹ \`m_CORE_ALL\` å…³é—­äº†è¿™ä¸ªä¼˜åŒ–å¹¶ä¸”åœ¨éœ€è¦æ—¶å…ˆå°† XMM å¯„å­˜å™¨æ¸…ç©ºã€‚
3.  åœ¨ [Re: \\[PATCH\\] disable use_vector_fp_converts for m_CORE_ALL](https://www.mail-archive.com/gcc-patches@gcc.gnu.org/msg62712.html) ä¸­ï¼ŒHonza è¡¨ç¤ºå¯ä»¥å…ˆæŠŠä¸Šé¢é‚£ä¸ª patch commit äº†ï¼Œä»–æµ‹è¯•ä¸€ä¸‹å†å†³å®šæ˜¯å¦å¯¹ \`m_GENERIC\` ä¹Ÿå…³é—­è¿™ä¸ªä¼˜åŒ–ï¼Œæ‰€ä»¥ 157ca3e9ï¼ˆå¯¹ \`m_CORE_ALL\` å…³é—­ä¼˜åŒ–å¹¶åœ¨éœ€è¦æ—¶æ¸…ç©º XMMï¼‰å’Œ 915e8e6eï¼ˆå¯¹ \`m_GENERIC\` å…³é—­ä¼˜åŒ–ï¼‰åˆ†æˆäº†ä¸¤ä¸ª commitã€‚

## ä¼˜åŒ–æœ€åˆè¢«æ·»åŠ çš„åŸå› 

ç»§ç»­è¿½æ ¹æº¯æºä¸‹å»ï¼Œé€šè¿‡ \`git blame\` æ¥æ‰¾åˆ°ä¸€å¼€å§‹æ·»åŠ è¿™ä¸ªä¼˜åŒ–çš„åŸå› ã€‚

é¦–å…ˆæ‰¾åˆ° [54723b46](https://github.com/gcc-mirror/gcc/commit/54723b46231868447f68ed5322d916bd05bffae3)ï¼Œè¿™ä¸ª commit å°† \`TARGET_USE_VECTOR_FP_CONVERTS\` ä» \`TARGET_USE_VECTOR_CONVERTS\` ä¸­æŠ½ç¦»å‡ºæ¥æˆä¸ºå•ç‹¬çš„ä¼˜åŒ–å¼€å…³ã€‚

ç„¶åæ‰¾åˆ° [4845dbb5](https://github.com/gcc-mirror/gcc/commit/4845dbb50ed31ad03c579364e4b70bbe90e7af99)ï¼Œè¿™ä¸ª commit æ·»åŠ äº† \`X86_USE_VECTOR_CONVERTS\`ï¼Œå³ \`X86_TUNE_USE_VECTOR_FP_CONVERTS\` çš„å‰èº«ã€‚

4845dbb5 çš„é‚®ä»¶æ˜¯ [SSE conversion optimization](https://gcc.gnu.org/pipermail/gcc-patches/2007-September/225078.html)ï¼Œé‡Œé¢å†™çš„å¾ˆç®€ç•¥ï¼Œå°±æ˜¯ â€œAmdfam10 preffers doing packed conversions destinating SSE register rather than scalarâ€ã€‚

åªä¸è¿‡ [performance - Why don't GCC and Clang use cvtss2sd \\[memory\\]? - Stack Overflow](https://stackoverflow.com/questions/16597587/why-dont-gcc-and-clang-use-cvtss2sd-memory) é‡Œè¿˜æ˜¯æœ‰ä¸€äº›è§£é‡Šçš„ï¼Œåæ­£ç®€å•æ¥è¯´å°±æ˜¯ partial regisiter update ä¼šæœ‰æ€§èƒ½æŸå¤±ã€‚

## å¯¹ m_CORE_ALLã€m_GENERIC å¯ç”¨ä¼˜åŒ–çš„åŸå› 

å¯ä»¥å‘ç°ï¼Œä¸€å¼€å§‹æœ‰è¿™ä¸ªä¼˜åŒ–æ—¶ï¼Œæ˜¯åªå¯¹ \`m_AMDFAM10\` å¯ç”¨çš„ï¼Œè¿™å’Œç°åœ¨æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆä¸­é—´ç»•äº†ä¸€åœˆåˆå›åˆ°æœ€å¼€å§‹çš„é€‰æ‹©å‘¢ï¼Ÿç»§ç»­å¯»æ‰¾å¯¹ \`m_CORE_ALL\` å’Œ \`m_GENERIC\` å¯ç”¨è¿™ä¸ªä¼˜åŒ–çš„åŸå› ã€‚

é¦–å…ˆæ‰¾åˆ° [3ad20bd4](https://github.com/gcc-mirror/gcc/commit/3ad20bd44836e57453b743466f1ca0d591bd10ac)ï¼Œè¿™ä¸ª commit æŠŠç›¸å…³ä»£ç æŒªäº†ä¸ªä½ç½®ã€‚

ç„¶åæ‰¾åˆ° [3a579e09](https://github.com/gcc-mirror/gcc/commit/3a579e0930abe3ed91977a71284021399339860c)ï¼Œè¿™ä¸ª commit æŠŠ \`m_CORE2I7\` æ”¹æˆäº† \`m_CORE_ALL\`ã€‚

ç„¶åæ‰¾åˆ° [3a4ffde6](https://github.com/gcc-mirror/gcc/commit/3a4ffde68cfc6fee3c20d282d6690f2569e2fffa)ï¼Œè¿™ä¸ª commit ä¿®æ”¹äº†ä¸€å †å¤„ç†å™¨æ¶æ„çš„ bitmaskï¼Œç„¶å..æŠŠ \`m_AMDFAM10\` å’Œ \`m_CORE2I7\` æ¢äº†ä¸ªä½ç½® ğŸ¤”

ç„¶åæ‰¾åˆ° [ab247762](https://github.com/gcc-mirror/gcc/commit/ab2477624b15b5d1fe43972f8f4d6082c6893624)ï¼Œè¿™ä¸ª commit æ–°å¢äº† \`m_CORE2I7\` æ¶æ„å¹¶ä¸”ä¸ºå®ƒå¯ç”¨äº† \`X86_TUNE_USE_VECTOR_FP_CONVERTS\`ã€‚è¿™ä¸ª patch çš„é‚®ä»¶æ˜¯ [0005-Switch-Core-2-to-new-tuning](https://gcc.gnu.org/pipermail/gcc-patches/2010-November/300958.html)ï¼Œç»™å‡ºçš„åŸå› æ˜¯ Core 2/i7 æ¯”è¾ƒé€‚åˆä½¿ç”¨ generic tuningï¼Œè€Œæ­¤æ—¶ \`X86_TUNE_USE_VECTOR_FP_CONVERTS\` æ˜¯å¯¹ \`m_GENERIC\` å¯ç”¨çš„ï¼Œå°±ä¹Ÿå¯¹ \`m_CORE2I7\` å¯ç”¨äº†ã€‚

è¿™æ—¶å†å›å¤´çœ‹ä¸Šé¢æ‰¾åˆ°çš„ [54723b46](https://github.com/gcc-mirror/gcc/commit/54723b46231868447f68ed5322d916bd05bffae3)ï¼Œè¿™ä¸ª commit å°† \`TARGET_USE_VECTOR_CONVERTS || TARGET_GENERIC\` æ”¹æˆäº† \`TARGET_USE_VECTOR_FP_CONVERTS\`ï¼Œæ‰€ä»¥è¦ blame è¿™ä¸ª \`|| TARGET_GENERIC\`ã€‚

æœ€åæ‰¾åˆ°æ˜¯ [bf019a1f](https://github.com/gcc-mirror/gcc/commit/bf019a1f7f992a1feb985c4b656e527475e73a30) æ·»åŠ äº† \`|| TARGET_GENERIC\`ã€‚è¿™ä¸ª patch çš„é‚®ä»¶æ˜¯ [PR target/33396](https://gcc.gnu.org/pipermail/gcc-patches/2007-September/225425.html)ï¼Œæ—¶é—´ä¸Šç´§è·Ÿç€æœ€åˆçš„ 4845dbb5ï¼Œè€Œ changelog å’Œé‚®ä»¶é‡Œåªæåˆ°äº†æ·»åŠ  \`TARGET_SSE_MATH\` è€Œæ²¡æœ‰æåˆ°æ·»åŠ  \`TARGET_GENERIC\` çš„åŸå› ï¼Œå¹¶ä¸”è¿™å°é‚®ä»¶è¿˜æ²¡äººå›å¤ã€‚

è‡³æ­¤ï¼Œæˆ‘å·²ç»ä¸çŸ¥é“èƒ½å¦‚ä½•ç»§ç»­æ¢ç©¶ä¸‹å»äº†ã€‚æˆ‘æ„Ÿè§‰å¯èƒ½æ˜¯ï¼š

1.  [SSE conversion optimization](https://gcc.gnu.org/pipermail/gcc-patches/2007-September/225078.html) ä¸­æåˆ° â€œWe are now testing if the patch is good for genericâ€ï¼Œå¯èƒ½ä»–è‡ªå·±æµ‹è¯•ä¹‹åå› ä¸ºæŸäº›åŸå› å¾—åˆ°äº†è¿™ä¸ªä¼˜åŒ– good for generic çš„ç»“è®ºï¼Œå°± commit äº†ï¼Œä¹Ÿæ²¡å†è§£é‡Šï¼›
2.  æˆ–è€…æ˜¯ï¼Œ[PR target/33396](https://gcc.gnu.org/pipermail/gcc-patches/2007-September/225425.html) é‡Œæåˆ°äº† â€œfailure with 32bit genericâ€ï¼Œå¯èƒ½æ˜¯æµ‹è¯•çš„æ—¶å€™åŠ ä¸Šäº† \`TARGET_GENERIC\`ï¼Œåæ¥å¿˜è®°åˆ æ‰äº† ğŸ¤”
3.  æˆ–è€…æ˜¯ï¼Œæœ‰ä»€ä¹ˆå…¶ä»–åŸå› ï¼Œä½†å¿˜è®°å†™åœ¨ log / é‚®ä»¶é‡Œäº†ï¼Œæˆ–è€…å†™åœ¨æŸä¸ªéšç§˜çš„è§’è½æˆ‘æ²¡æ‰¾åˆ°ã€‚

åæ­£ä¸ç®¡æ˜¯ä»€ä¹ˆåŸå› ï¼Œbf019a1f éƒ½æ˜¯ä¸€ä¸ª commit åšäº†ä¸¤ä»¶äº‹ï¼Œè¿˜åªå†™äº†ä¸€ä»¶äº‹çš„ changelogï¼Œå¯¼è‡´è¿™æˆäº†ä¸€ä¸ªè°œã€‚

## ä¸å…¶ä»–ç¼–è¯‘å™¨çš„å¯¹æ¯”

ä½¿ç”¨ [Compiler Explorer](https://gcc.godbolt.org/) çœ‹ä¸€ä¸‹å…¶ä»–ç¼–è¯‘å™¨æ˜¯æ€ä¹ˆåšçš„ã€‚

clang: æ— è®ºæ˜¯å¦ \`-mtune=amdfam10\` éƒ½æ²¡æœ‰ \`use_vector_fp_converts\`ã€‚

MSVC: æ— è®ºæ˜¯å¦ \`-mtune=amdfam10\` éƒ½æ˜¯ source in register åˆ™ \`cvtss2sd\`/\`cvtsd2ss\`ï¼Œsource in memory åˆ™è¡¨ç°å‡º \`use_vector_fp_converts\` çš„è¡Œä¸ºã€‚

ä½†æ˜¯æˆ‘å¹¶ä¸çŸ¥é“å¦‚ä½•ç ”ç©¶å…¶ä»–ç¼–è¯‘å™¨ä¸ºä»€ä¹ˆåšå‡ºè¿™æ ·çš„é€‰æ‹© ğŸ˜¢

## æ€§èƒ½æµ‹è¯•

æœ€åæ¥å®é™…æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªä¼˜åŒ–çš„æ€§èƒ½ã€‚

æµ‹è¯•ä½¿ç”¨çš„ä»£ç ä¸º [\\[PATCH\\] disable use_vector_fp_converts for m_CORE_ALL](https://www.mail-archive.com/gcc-patches@gcc.gnu.org/msg61372.html) ä¸­çš„ \`1.c\` å’Œ \`2.c\`ï¼Œä½†åŸæ¥çš„ \`2.c\` ç”¨æ—¶å¤ªçŸ­ï¼Œæ‰€ä»¥æŠŠå¾ªç¯èŒƒå›´æ”¹æˆäº† \`1ll << 32\`ï¼š

<Card fold title="æµ‹è¯•ç”¨ä»£ç ">

\`1.c\`:

\`\`\`c
float total = 0.2;
int k = 5;

int main()
{
    int i;

    for (i = 0; i < 1000000000; i++)
    {
        total += (0.5 + k);
    }

    return total == 0.3;
}
\`\`\`

\`2.c\`:

\`\`\`c
double b[1024];

float a[1024];

int main()
{
    for(long i = 0 ; i < (1ll << 32); i++)
      a[i & 1023] = a[i & 1023] * (float)b[i & 1023];
    return (int)a[512];
}
\`\`\`

</Card>

æµ‹è¯•ä½¿ç”¨çš„ç¼–è¯‘é€‰é¡¹æœ‰ï¼š

1.  \`-O2 -mtune-ctrl=^use_vector_fp_converts\`
2.  \`-O2 -mtune-ctrl=^use_vector_fp_converts -mavx2\`
3.  \`-O2 -mtune-ctrl=use_vector_fp_converts\`
4.  \`-O2 -mtune-ctrl=use_vector_fp_converts -mavx2\`

å…¶ä¸­å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ 2 å·ç¼–è¯‘é€‰é¡¹ç¼–è¯‘ \`2.c\` æ—¶ä¼šé€šè¿‡å°† \`vcvtsd2ss\` æŒ‡ä»¤çš„ç¬¬äºŒä¸ª operand è®¾ä¸º \`%xmm1\` æ¥ä»£æ›¿ \`pxor %xmm0, %xmm0\` ä»¥è¾¾åˆ°æ¸…ç©º \`%xmm0\` çš„æ•ˆæœã€‚

ä¸ºäº†æµ‹è¯•æ¸…ç©º XMM å¯„å­˜å™¨çš„æ•ˆæœï¼Œåœ¨è¿™ 4 ç§ç¼–è¯‘é€‰é¡¹ä¹‹å¤–ï¼Œè¿˜å¯¹ \`2.c\` å¢è®¾äº†æ‰‹åŠ¨åˆ æ‰ç”¨äºæ¸…ç©º \`%xmm0\` çš„æŒ‡ä»¤çš„ä¸¤ä»½æ±‡ç¼–ä»£ç ã€‚

æ‰€ä»¥æ€»å…±æœ‰ 10 ä»½æ±‡ç¼–ä»£ç ç”¨äºæµ‹è¯•ï¼š

-   1-1: \`1.c\`ï¼Œ\`-O2 -mtune-ctrl=^use_vector_fp_converts\`
-   1-2: \`1.c\`ï¼Œ\`-O2 -mtune-ctrl=^use_vector_fp_converts -mavx2\`
-   1-3: \`1.c\`ï¼Œ\`-O2 -mtune-ctrl=use_vector_fp_converts\`
-   1-4: \`1.c\`ï¼Œ\`-O2 -mtune-ctrl=use_vector_fp_converts -mavx2\`
-   2-1: \`2.c\`ï¼Œ\`-O2 -mtune-ctrl=^use_vector_fp_converts\`
-   2-2: \`2.c\`ï¼Œ\`-O2 -mtune-ctrl=^use_vector_fp_converts -mavx2\`
-   2-3: \`2.c\`ï¼Œ\`-O2 -mtune-ctrl=use_vector_fp_converts\`
-   2-4: \`2.c\`ï¼Œ\`-O2 -mtune-ctrl=use_vector_fp_converts -mavx2\`
-   2-5: \`2.c\`ï¼Œ\`-O2 -mtune-ctrl=^use_vector_fp_converts\`ï¼Œç„¶ååˆ æ‰ \`pxor %xmm0, %xmm0\`
-   2-6: \`2.c\`ï¼Œ\`-O2 -mtune-ctrl=^use_vector_fp_converts -mavx2\`ï¼Œç„¶åå°† \`vcvtsd2ss\` çš„ç¬¬äºŒä¸ª operand æ”¹ä¸º \`%xmm0\`ã€‚

<Card fold title="æµ‹è¯•ç”¨æ±‡ç¼–ä»£ç ">

<Card fold title="1-1">

\`\`\`asm
	.file	"1.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	pxor	%xmm1, %xmm1
	movss	total(%rip), %xmm0
	movl	$1000000000, %eax
	cvtsi2sdl	k(%rip), %xmm1
	addsd	.LC0(%rip), %xmm1
	.p2align 4,,10
	.p2align 3
.L2:
	cvtss2sd	%xmm0, %xmm0
	addsd	%xmm1, %xmm0
	cvtsd2ss	%xmm0, %xmm0
	subl	$1, %eax
	jne	.L2
	movss	%xmm0, total(%rip)
	xorl	%edx, %edx
	cvtss2sd	%xmm0, %xmm0
	ucomisd	.LC1(%rip), %xmm0
	setnp	%dl
	cmove	%edx, %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	k
	.data
	.align 4
	.type	k, @object
	.size	k, 4
k:
	.long	5
	.globl	total
	.align 4
	.type	total, @object
	.size	total, 4
total:
	.long	1045220557
	.section	.rodata.cst8,"aM",@progbits,8
	.align 8
.LC0:
	.long	0
	.long	1071644672
	.align 8
.LC1:
	.long	858993459
	.long	1070805811
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="1-2">

\`\`\`asm
	.file	"1.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	vxorps	%xmm1, %xmm1, %xmm1
	vmovss	total(%rip), %xmm0
	movl	$1000000000, %eax
	vcvtsi2sdl	k(%rip), %xmm1, %xmm1
	vaddsd	.LC0(%rip), %xmm1, %xmm1
	.p2align 4,,10
	.p2align 3
.L2:
	vcvtss2sd	%xmm0, %xmm0, %xmm0
	vaddsd	%xmm1, %xmm0, %xmm0
	vcvtsd2ss	%xmm0, %xmm0, %xmm0
	subl	$1, %eax
	jne	.L2
	vmovss	%xmm0, total(%rip)
	xorl	%edx, %edx
	vcvtss2sd	%xmm0, %xmm0, %xmm0
	vucomisd	.LC1(%rip), %xmm0
	setnp	%dl
	cmove	%edx, %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	k
	.data
	.align 4
	.type	k, @object
	.size	k, 4
k:
	.long	5
	.globl	total
	.align 4
	.type	total, @object
	.size	total, 4
total:
	.long	1045220557
	.section	.rodata.cst8,"aM",@progbits,8
	.align 8
.LC0:
	.long	0
	.long	1071644672
	.align 8
.LC1:
	.long	858993459
	.long	1070805811
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="1-3">

\`\`\`asm
	.file	"1.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	pxor	%xmm1, %xmm1
	movss	total(%rip), %xmm0
	movl	$1000000000, %eax
	cvtsi2sdl	k(%rip), %xmm1
	addsd	.LC0(%rip), %xmm1
	.p2align 4,,10
	.p2align 3
.L2:
	unpcklps	%xmm0, %xmm0
	cvtps2pd	%xmm0, %xmm0
	addsd	%xmm1, %xmm0
	unpcklpd	%xmm0, %xmm0
	cvtpd2ps	%xmm0, %xmm0
	subl	$1, %eax
	jne	.L2
	movss	%xmm0, total(%rip)
	unpcklps	%xmm0, %xmm0
	xorl	%edx, %edx
	cvtps2pd	%xmm0, %xmm0
	ucomisd	.LC1(%rip), %xmm0
	setnp	%dl
	cmove	%edx, %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	k
	.data
	.align 4
	.type	k, @object
	.size	k, 4
k:
	.long	5
	.globl	total
	.align 4
	.type	total, @object
	.size	total, 4
total:
	.long	1045220557
	.section	.rodata.cst8,"aM",@progbits,8
	.align 8
.LC0:
	.long	0
	.long	1071644672
	.align 8
.LC1:
	.long	858993459
	.long	1070805811
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="1-4">

\`\`\`asm
	.file	"1.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	vxorps	%xmm1, %xmm1, %xmm1
	vmovss	total(%rip), %xmm0
	movl	$1000000000, %eax
	vcvtsi2sdl	k(%rip), %xmm1, %xmm1
	vaddsd	.LC0(%rip), %xmm1, %xmm1
	.p2align 4,,10
	.p2align 3
.L2:
	vunpcklps	%xmm0, %xmm0, %xmm0
	vcvtps2pd	%xmm0, %xmm0
	vaddsd	%xmm1, %xmm0, %xmm0
	vmovddup	%xmm0, %xmm0
	vcvtpd2psx	%xmm0, %xmm0
	subl	$1, %eax
	jne	.L2
	vmovss	%xmm0, total(%rip)
	vunpcklps	%xmm0, %xmm0, %xmm0
	xorl	%edx, %edx
	vcvtps2pd	%xmm0, %xmm0
	vucomisd	.LC1(%rip), %xmm0
	setnp	%dl
	cmove	%edx, %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	k
	.data
	.align 4
	.type	k, @object
	.size	k, 4
k:
	.long	5
	.globl	total
	.align 4
	.type	total, @object
	.size	total, 4
total:
	.long	1045220557
	.section	.rodata.cst8,"aM",@progbits,8
	.align 8
.LC0:
	.long	0
	.long	1071644672
	.align 8
.LC1:
	.long	858993459
	.long	1070805811
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="2-1">

\`\`\`asm
	.file	"2.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	xorl	%eax, %eax
	leaq	a(%rip), %rcx
	leaq	b(%rip), %rdi
	movabsq	$4294967296, %rsi
	.p2align 4,,10
	.p2align 3
.L2:
	movq	%rax, %rdx
	pxor	%xmm0, %xmm0
	addq	$1, %rax
	andl	$1023, %edx
	cvtsd2ss	(%rdi,%rdx,8), %xmm0
	mulss	(%rcx,%rdx,4), %xmm0
	movss	%xmm0, (%rcx,%rdx,4)
	cmpq	%rsi, %rax
	jne	.L2
	cvttss2sil	2048+a(%rip), %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	a
	.bss
	.align 32
	.type	a, @object
	.size	a, 4096
a:
	.zero	4096
	.globl	b
	.align 32
	.type	b, @object
	.size	b, 8192
b:
	.zero	8192
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="2-2">

\`\`\`asm
	.file	"2.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	vxorps	%xmm1, %xmm1, %xmm1
	xorl	%eax, %eax
	leaq	a(%rip), %rcx
	movabsq	$4294967296, %rsi
	leaq	b(%rip), %rdi
	.p2align 4,,10
	.p2align 3
.L2:
	movq	%rax, %rdx
	addq	$1, %rax
	andl	$1023, %edx
	vcvtsd2ss	(%rdi,%rdx,8), %xmm1, %xmm0
	vmulss	(%rcx,%rdx,4), %xmm0, %xmm0
	vmovss	%xmm0, (%rcx,%rdx,4)
	cmpq	%rsi, %rax
	jne	.L2
	vcvttss2sil	2048+a(%rip), %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	a
	.bss
	.align 32
	.type	a, @object
	.size	a, 4096
a:
	.zero	4096
	.globl	b
	.align 32
	.type	b, @object
	.size	b, 8192
b:
	.zero	8192
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="2-3">

\`\`\`asm
	.file	"2.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	xorl	%eax, %eax
	leaq	a(%rip), %rcx
	leaq	b(%rip), %rdi
	movabsq	$4294967296, %rsi
	.p2align 4,,10
	.p2align 3
.L2:
	movq	%rax, %rdx
	addq	$1, %rax
	andl	$1023, %edx
	movq	(%rdi,%rdx,8), %xmm0
	cvtpd2ps	%xmm0, %xmm0
	mulss	(%rcx,%rdx,4), %xmm0
	movss	%xmm0, (%rcx,%rdx,4)
	cmpq	%rsi, %rax
	jne	.L2
	cvttss2sil	2048+a(%rip), %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	a
	.bss
	.align 32
	.type	a, @object
	.size	a, 4096
a:
	.zero	4096
	.globl	b
	.align 32
	.type	b, @object
	.size	b, 8192
b:
	.zero	8192
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="2-4">

\`\`\`asm
	.file	"2.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	xorl	%eax, %eax
	leaq	a(%rip), %rcx
	leaq	b(%rip), %rdi
	movabsq	$4294967296, %rsi
	.p2align 4,,10
	.p2align 3
.L2:
	movq	%rax, %rdx
	addq	$1, %rax
	andl	$1023, %edx
	vmovq	(%rdi,%rdx,8), %xmm0
	vcvtpd2psx	%xmm0, %xmm0
	vmulss	(%rcx,%rdx,4), %xmm0, %xmm0
	vmovss	%xmm0, (%rcx,%rdx,4)
	cmpq	%rsi, %rax
	jne	.L2
	vcvttss2sil	2048+a(%rip), %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	a
	.bss
	.align 32
	.type	a, @object
	.size	a, 4096
a:
	.zero	4096
	.globl	b
	.align 32
	.type	b, @object
	.size	b, 8192
b:
	.zero	8192
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="2-5">

\`\`\`asm
	.file	"2.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	xorl	%eax, %eax
	leaq	a(%rip), %rcx
	leaq	b(%rip), %rdi
	movabsq	$4294967296, %rsi
	.p2align 4,,10
	.p2align 3
.L2:
	movq	%rax, %rdx
	addq	$1, %rax
	andl	$1023, %edx
	cvtsd2ss	(%rdi,%rdx,8), %xmm0
	mulss	(%rcx,%rdx,4), %xmm0
	movss	%xmm0, (%rcx,%rdx,4)
	cmpq	%rsi, %rax
	jne	.L2
	cvttss2sil	2048+a(%rip), %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	a
	.bss
	.align 32
	.type	a, @object
	.size	a, 4096
a:
	.zero	4096
	.globl	b
	.align 32
	.type	b, @object
	.size	b, 8192
b:
	.zero	8192
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

<Card fold title="2-6">

\`\`\`asm
	.file	"2.c"
	.text
	.section	.text.startup,"ax",@progbits
	.p2align 4
	.globl	main
	.type	main, @function
main:
.LFB0:
	.cfi_startproc
	xorl	%eax, %eax
	leaq	a(%rip), %rcx
	movabsq	$4294967296, %rsi
	leaq	b(%rip), %rdi
	.p2align 4,,10
	.p2align 3
.L2:
	movq	%rax, %rdx
	addq	$1, %rax
	andl	$1023, %edx
	vcvtsd2ss	(%rdi,%rdx,8), %xmm0, %xmm0
	vmulss	(%rcx,%rdx,4), %xmm0, %xmm0
	vmovss	%xmm0, (%rcx,%rdx,4)
	cmpq	%rsi, %rax
	jne	.L2
	vcvttss2sil	2048+a(%rip), %eax
	ret
	.cfi_endproc
.LFE0:
	.size	main, .-main
	.globl	a
	.bss
	.align 32
	.type	a, @object
	.size	a, 4096
a:
	.zero	4096
	.globl	b
	.align 32
	.type	b, @object
	.size	b, 8192
b:
	.zero	8192
	.ident	"GCC: (GNU) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
\`\`\`

</Card>

</Card>

ç”¨äºæµ‹è¯•çš„æœºå™¨æœ‰äº”å°ï¼ŒCPU å‹å·åˆ†åˆ«ä¸ºï¼š

-   A: AMD Ryzen 7 4800H with Radeon Graphics ï¼ˆç¬”è®°æœ¬ï¼‰
-   B: Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz ï¼ˆHostwindsï¼‰
-   C: Intel(R) Xeon(R) CPU E5-4610 v2 @ 2.30GHz ï¼ˆTHU æ ¡å†…æœåŠ¡å™¨ï¼‰
-   D: Intel(R) Xeon(R) Platinum 8255C CPU @ 2.50GHz ï¼ˆè…¾è®¯äº‘ï¼‰
-   E: Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz ï¼ˆé˜¿é‡Œäº‘ï¼‰

æµ‹è¯•æ—¶ï¼Œå°†ç¨‹åºè¿è¡Œ 10 éï¼Œè®°å½•å…¶ä¸­ç¬¬ 3 çŸ­çš„ç”¨æ—¶ã€‚

<Card fold title="ssh è¿œç¨‹æµ‹è¯•è„šæœ¬">

\`\`\`bash
#!/bin/bash

eval "$(ssh-agent)"
ssh-add

dir="$(ssh "$1" mktemp -d)"
scp ./*-*.s "$1:$dir"

ssh "$1" 'grep "model name" /proc/cpuinfo | head -n1'

for i in 1-1 1-2 1-3 1-4 2-1 2-2 2-3 2-4 2-5 2-6; do
    echo "$i"
    ssh "$1" gcc "$dir/$i.s" -o "$dir/$i"
    for _ in $(seq 1 10); do
        ssh "$1" /usr/bin/time "$dir/$i"
    done
done

ssh "$1" rm -r "$dir"

ssh-agent -k
\`\`\`

</Card>

æµ‹è¯•ç»“æœä¸ºï¼š

| ä»£ç /ç”¨æ—¶(s) |  A   |  B   |   C   |  D   |  E   |
| :----------: | :--: | :--: | :---: | :--: | :--: |
|     1-1      | 2.10 | 3.15 | 3.96  | 4.62 | 4.41 |
|     1-2      | 2.10 | 3.11 | 3.95  | 4.61 | 4.42 |
|     1-3      | 3.50 | 3.82 | 4.52  | 5.30 | 5.04 |
|     1-4      | 3.50 | 3.77 | 4.90  | 5.30 | 5.04 |
|     2-1      | 1.62 | 6.47 | 7.22  | 3.59 | 3.43 |
|     2-2      | 1.41 | 6.26 | 7.65  | 4.31 | 4.08 |
|     2-3      | 1.61 | 4.66 | 5.31  | 3.24 | 3.11 |
|     2-4      | 1.61 | 4.76 | 5.69  | 3.59 | 3.43 |
|     2-5      | 1.40 | 9.06 | 10.41 | 7.12 | 6.77 |
|     2-6      | 1.41 | 9.03 | 10.98 | 7.11 | 6.77 |

è¿™æ•°æ®çœŸçš„éå¸¸è®©äººæ€€ç–‘æ˜¯ä¸æ˜¯æµ‹é”™äº†ï¼ˆ

åªèƒ½è¯´æ˜¯å¤§åƒä¸–ç•Œæ— å¥‡ä¸æœ‰ï¼Œæ€§èƒ½ä¼˜åŒ–å®åœ¨æ˜¯å¤ªç„å­¦äº†ï¼ˆ

ä½†æµ‹è¯•ä¼¼ä¹è¡¨æ˜ï¼Œsource in register æ—¶å…³é—­ \`use_vector_fp_converts\`ã€source in memory æ—¶å¼€å¯ \`use_vector_fp_converts\`ï¼Œä¹Ÿå°±æ˜¯ MSVC çš„é€‰æ‹©ï¼Œåœ¨æ€»ä½“ä¸Šæ˜¯æ¯”è¾ƒä¼˜çš„ã€‚
`},{title:E,tags:t,content:`[CS:APP](https://csapp.cs.cmu.edu/) ç¬¬å…«ç«  â€œExceptional Control Flowâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

æœ¬ç« çš„ä¸»è¦å†…å®¹ä¸º exceptionã€system callã€processã€signalã€longjmpã€‚



åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPC ä¼šæŒ‰ç…§æŒ‡ä»¤çš„é¡ºåºä»¥åŠè·³è½¬æŒ‡ä»¤æ¥å˜åŒ–ã€‚ä½†åœ¨å¾ˆå¤šæ—¶å€™ï¼Œè¿™æ ·çš„æ§åˆ¶æµæ˜¯ä¸èƒ½æ»¡è¶³éœ€è¦çš„ï¼Œéœ€è¦ *exceptional control flow* (ECF) ä½œä¸ºè·³è½¬æŒ‡ä»¤çš„è¡¥å……ï¼Œä»¥å¤„ç†ä¸€äº›â€œå¼‚å¸¸â€çš„æˆ–è€…æ¥è‡ªâ€œå¤–éƒ¨â€çš„å˜åŒ–ã€‚

ECF å­˜åœ¨äºå„ä¸ªå±‚æ¬¡ï¼Œä¾‹å¦‚ï¼š

-   ç¡¬ä»¶ç›‘æµ‹åˆ°äº‹ä»¶å‘ç”Ÿæ—¶è°ƒç”¨ exception handler
-   æ“ä½œç³»ç»Ÿåœ¨ä¸åŒè¿›ç¨‹ä¹‹é—´è¿›è¡Œ [context switch](#context-switch)
-   ä¸åŒè¿›ç¨‹é—´é€šè¿‡å‘é€ [signal](#signals) æ¥è°ƒç”¨æ¥æ”¶è€…çš„ signal handler
-   ç¨‹åºå†…éƒ¨é€šè¿‡ [nonlocal jump](#nonlocal-jumps) æ¥å®ç°é”™è¯¯å¤„ç†

## Exceptions

*exception* æ˜¯ç”±æŸç§â€œçŠ¶æ€æ”¹å˜â€ï¼ˆå¯èƒ½æ˜¯æŸæ¡æŒ‡ä»¤æ‰§è¡Œçš„ç»“æœï¼Œæˆ–è€…æ¥è‡ªå¤–éƒ¨ I/O çš„å˜åŒ–ç­‰ç­‰ï¼‰å¯¼è‡´çš„æ§åˆ¶æµçš„çªå˜ã€‚

å¤„ç†å™¨æ£€æµ‹åˆ°è¿™ç§çŠ¶æ€æ”¹å˜åï¼Œä¼šè°ƒç”¨ *exception handler*ï¼Œç„¶åè·³è½¬åˆ°è§¦å‘å‰çš„æŒ‡ä»¤æˆ–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæˆ–è€…ç»ˆæ­¢æ•´ä¸ªç¨‹åºã€‚

### Exception Handling

æ¯ç§ exception éƒ½ä¼šæœ‰ä¸€ä¸ª *exception number*ï¼ŒæŸäº› exception çš„ number ç”±ç¡¬ä»¶å†³å®šï¼Œå¦ä¸€äº›ç”±æ“ä½œç³»ç»Ÿå†³å®šã€‚

å†…å­˜ä¸­ä¼šæœ‰ä¸€ä¸ª *exception table*ï¼Œä»¥ exception number ä¸ºç´¢å¼•ï¼Œæ¯ä¸€é¡¹æ˜¯å¯¹åº”çš„ exception handlerã€‚å¤„ç†å™¨ä¸­æœ‰ä¸€ä¸ª *exception table base register*ï¼Œç”¨æ¥å­˜ exception table çš„èµ·å§‹åœ°å€ï¼Œç»“åˆ exception number å°±å¯ä»¥å¯¹æ¯ä¸€é¡¹å¯»å€ã€‚

exception ä¸ procedure call çš„ä¸»è¦åŒºåˆ«æœ‰ï¼š

-   procedure call è¿”å›åˆ°æ ˆé¡¶å­˜å‚¨çš„è¿”å›åœ°å€ï¼Œè€Œ exception è¿”å›åˆ°è§¦å‘æ—¶çš„æŒ‡ä»¤æˆ–ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œæˆ–ç»ˆæ­¢ç¨‹åºã€‚
-   è°ƒç”¨ exception handler æ—¶ï¼Œä¼šä¿å­˜åŒ…æ‹¬ condition codes åœ¨å†…çš„ä¸€äº›å¤„ç†å™¨çŠ¶æ€ï¼Œåœ¨è¿”å›æ—¶æ¢å¤ã€‚
-   exception handler åœ¨ [kernel mode](#user-kernel-mode) ä¸‹è¿è¡Œï¼Œä½¿ç”¨çš„è¿è¡Œæ ˆä¹Ÿæ˜¯ kernel çš„ã€‚

### Classes of Exceptions

exception ä¸€èˆ¬æœ‰å››ç§ï¼š

-   interrupt: å¼‚æ­¥è§¦å‘ï¼ˆä¸æ˜¯æŸæ¡æŒ‡ä»¤çš„æ‰§è¡Œå¯¼è‡´äº† exceptionï¼‰ï¼Œè¿”å›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ä¸€èˆ¬æ˜¯ç”±å¤–éƒ¨ I/O è®¾å¤‡è§¦å‘ï¼ˆè®¾å¤‡é€šè¿‡ interrupt pin å‘Šè¯‰å¤„ç†å™¨æœ‰ interruptï¼Œé€šè¿‡ system bus å‘é€ exception numberï¼Œå¤„ç†å™¨åœ¨æ¯æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤åæ£€æŸ¥ interrupt pinï¼‰ï¼Œè§¦å‘åè°ƒç”¨ interrupt handlerï¼Œå†å›åˆ°åŸæ¥çš„ä½ç½®ç»§ç»­æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚
-   trap: åŒæ­¥è§¦å‘ï¼Œè¿”å›åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚æ¯”å¦‚ [system call](#linux-ä¸­çš„-system-call) æ˜¯ä¸€ç§å¸¸è§çš„ trapï¼Œé€šè¿‡ \`syscall\` æŒ‡ä»¤ä¸»åŠ¨è§¦å‘ exceptionï¼Œçœ‹ä¸Šå»å’Œå‡½æ•°è°ƒç”¨ç±»ä¼¼ï¼Œä½†å¯ä»¥åœ¨ kernel mode ä¸‹è¿è¡Œã€‚
-   fault: åŒæ­¥è§¦å‘ï¼Œè¿”å›åˆ°è§¦å‘ exception çš„æŒ‡ä»¤æˆ–é€€å‡ºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œfault handler ä¼šå°è¯•è§£å†³å¯¼è‡´ fault å‘ç”Ÿçš„é—®é¢˜ï¼Œå¦‚æœæˆåŠŸè§£å†³åˆ™è¿”å›åˆ°è§¦å‘ exception çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¸å†æ¬¡è§¦å‘ exception è€Œç»§ç»­æ‰§è¡Œä¸‹å»ï¼›å¦‚æœæ²¡èƒ½æˆåŠŸè§£å†³ï¼Œåˆ™ abortã€‚
-   abort: åŒæ­¥è§¦å‘ï¼Œä¸€å®šé€€å‡ºã€‚ä¸€èˆ¬ä»£è¡¨ä¸¥é‡çš„ä¸å¯æ¢å¤çš„é”™è¯¯ã€‚

### Exceptions in Linux/x86-64 Systems

#### x86-64 ä¸­çš„ fault / abort

-   Divide Error Exception (Interrupt 0): é™¤ä»¥é›¶ã€‚å®ƒæ˜¯ faultï¼Œä½†å®é™…ä¸Š Linux ä¸ä¼šå°è¯•ä» divide error ä¸­æ¢å¤ï¼Œè€Œæ˜¯ä¼šç›´æ¥ abortï¼Œä¸€èˆ¬ä¼šæ˜¾ç¤ºä¸º â€œfloating point exceptionâ€ã€‚
-   General Protection Exception (Interrupt 13): æœ‰å¤šç§è§¦å‘åŸå› ï¼Œä¾‹å¦‚è®¿é—®æœªå®šä¹‰çš„å†…å­˜ï¼Œå°è¯•å†™å…¥åªè¯»çš„å†…å­˜æ®µã€‚Linux ä¹Ÿä¸ä¼šå°è¯•ä»ä¸­æ¢å¤ï¼Œè€Œæ˜¯ä¼šç›´æ¥ abortï¼Œä¸€èˆ¬ä¼šæ˜¾ç¤ºä¸º â€œsegmentation faultâ€ã€‚
-   Page-Fault Exception (Interrupt 14): page fault æ˜¯ä¸€ä¸ªåå‰¯å…¶å®çš„ faultï¼Œä¼šå°è¯•æ¢å¤ï¼Œè¯¦è§[ç¬¬ä¹ç« ](/post/2022/11/csapp-9)ã€‚
-   Machine-Check Exception (Interrupt 18): ä¸¥é‡çš„ç¡¬ä»¶é”™è¯¯ï¼Œæ˜¯ abortã€‚

ï¼ˆå®Œæ•´åˆ—è¡¨å‚è§ [IntelÂ® 64 and IA-32 Architectures Software Developer Manuals](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html) Volume 3A çš„ â€œ6.15 EXCEPTION AND INTERRUPT REFERENCEâ€ ä¸€èŠ‚ã€‚ï¼‰

#### Linux ä¸­çš„ system call

Linux ä¸­å¸¸ç”¨çš„ä¸€äº› system call å¦‚ CS:APP Figure 8.10 æ‰€ç¤ºï¼š

![Linux ä¸­å¸¸ç”¨çš„ä¸€äº› system call](csapp-fig8.10.png)

ï¼ˆæ›´å¤š system call å‚è§ \`man syscalls\`ï¼‰

åœ¨ C è¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ \`syscall\` å‡½æ•°æ¥è°ƒç”¨ system callï¼Œä½†ä¸€èˆ¬ä¸è¿™æ ·åšï¼Œè€Œæ˜¯ä½¿ç”¨æ¯ä¸ª system call å¯¹åº”çš„ wrapper functionã€‚\`syscall\` å’Œ wrapper function ç»Ÿç§°ä¸º *system-level function*ã€‚

## Processes

ä¸€ä¸ªç³»ç»Ÿä¸­ä¼šæœ‰å¾ˆå¤šè¿›ç¨‹åŒæ—¶è¿è¡Œï¼Œä½†è¥é€ å‡ºäº†æ¯ä¸ªè¿›ç¨‹éƒ½ç‹¬å äº†å¤„ç†å™¨å’Œå†…å­˜çš„å‡è±¡ã€‚

è¿›ç¨‹ç‹¬å å†…å­˜çš„å‡è±¡æ˜¯é€šè¿‡æ¯ä¸ªè¿›ç¨‹çš„ private address space å®ç°çš„ï¼Œè¯¦è§[ç¬¬ä¹ç« ](/post/2022/11/csapp-9)ã€‚

### Logical / Concurrent Flow

æ ¹æ®ä¸€ä¸ªç¨‹åºçš„æŒ‡ä»¤å¾—åˆ°çš„ control flow ç§°ä½œ *logical (control) flow*ã€‚ç³»ç»Ÿä¼šåœ¨ä¸åŒçš„è¿›ç¨‹é—´æ¥å›åˆ‡æ¢ï¼Œä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢å‡ºå»ç§°ä½œå°†è¿™ä¸ªè¿›ç¨‹ *preempt*ã€‚

å¦‚æœä¸¤ä¸ª control flow çš„å­˜æ´»æ—¶é—´æœ‰é‡å ï¼Œåˆ™ç§°å®ƒä»¬æ˜¯ *concurrent flow* æˆ–å®ƒä»¬ *run concurrently*ã€‚è¿™ç§ç°è±¡è¢«ç§°ä½œ *concurrency*ï¼Œä¹Ÿè¢«ç§°ä½œ *multitasking*ã€‚æ¯æ¬¡è¿ç»­æ‰§è¡Œçš„åŒä¸€ä¸ª logical flow ä¸­çš„ä¸€æ®µç§°ä½œä¸€ä¸ª *time slice*ï¼Œæ‰€ä»¥ multitasking ä¹Ÿè¢«ç§°ä½œ *time slicing*ã€‚å¦‚æœä¸¤ä¸ª logical flow åœ¨ä¸åŒçš„ processor core ä¸Šè¿è¡Œï¼Œåˆ™ç§°å®ƒä»¬æ˜¯ *parallel flow*ï¼Œ*run in parallel*ã€‚

### User / Kernel Mode

åœ¨å¤„ç†å™¨ä¸­å­˜æœ‰ä¸€ä¸ª *mode bit*ï¼Œè¡¨ç¤ºå½“å‰æ˜¯ user mode è¿˜æ˜¯ kernel modeã€‚åªæœ‰åœ¨ kernel mode ä¸‹æ‰èƒ½æ‰§è¡ŒæŸäº› *privileged instruction*ã€ä¿®æ”¹ mode bitã€è®¿é—®åœ°å€ç©ºé—´ä¸­å±äº kernel çš„åŒºåŸŸã€‚

user mode çš„ç¨‹åºåªèƒ½é€šè¿‡ exception æ¥è¿›å…¥ kernel modeï¼Œä»¥æ‰§è¡Œ privileged instruction æˆ–è€…è®¿é—® kernel çš„æ•°æ®ã€‚åœ¨ Linux ä¸­ï¼Œä¹Ÿå¯ä»¥åœ¨ user mode ä¸‹è®¿é—® \`/proc\`ã€\`/sys\` æ¥è·å¾—ä¸€äº› kernel çš„æ•°æ®ã€‚

### Context Switch

æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª *context*ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨å†…å®¹ã€PCã€user stackã€kernel stackã€condition codesã€page tableã€process tableã€file table ç­‰ç­‰ã€‚

æ“ä½œç³»ç»Ÿé€šè¿‡ *context switch* æ¥åœ¨ä¸åŒè¿›ç¨‹é—´åˆ‡æ¢ï¼Œå³ä¿å­˜å½“å‰è¿›ç¨‹çš„ contextï¼Œæ¢å¤è¦åˆ‡æ¢åˆ°çš„è¿›ç¨‹çš„ contextï¼Œæœ€ååˆ‡æ¢è¿‡å»ã€‚context switch åœ¨ exception ä¸­å‘ç”Ÿï¼Œå¤„ç† exception æ—¶æ“ä½œç³»ç»Ÿä¸­çš„ *scheduler* ä¼šå†³å®šæ˜¯å¦è¿›è¡Œ context switchï¼Œschedule åˆ°å“ªä¸ªè¿›ç¨‹ã€‚ä¾‹å¦‚ï¼š

-   åœ¨é€šè¿‡ system call è¯»å–æ–‡ä»¶æ—¶è¿›è¡Œ context switchï¼Œä»¥åœ¨ç­‰å¾…è¯»å–æ–‡ä»¶æ—¶å…ˆæ‰§è¡Œå…¶ä»–è¿›ç¨‹ï¼›è¯»å–åˆ°æ–‡ä»¶ååœ¨ interrupt ä¸­å† context switch å›æ¥ã€‚
-   ç³»ç»Ÿä¼šå‘¨æœŸæ€§åœ°ï¼ˆä¾‹å¦‚æ¯ 1msï¼‰è§¦å‘ interruptï¼Œä»è€Œå¯ä»¥åœ¨ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œäº†ä¸€æ®µæ—¶é—´åè¿›è¡Œ context switchã€‚

å› ä¸ºç¨‹åºä¸çŸ¥é“æ“ä½œç³»ç»Ÿä¼šå¦‚ä½• scheduleï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸åŒè¿›ç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯æ²¡æœ‰ä¿è¯çš„ã€‚

## System Call Error Handling

system-level function ä¸€èˆ¬ä»¥è¿”å› -1 ä»£è¡¨å‡ºé”™ï¼Œè€Œå°†å…·ä½“çš„é”™è¯¯è®°å½•åœ¨å…¨å±€æ•´å‹å˜é‡ \`errno\` (\`#include <errno.h>\`)ï¼Œå‡½æ•° \`strerror\` å¯ä»¥ç”¨æ¥æ ¹æ® \`errno\` å¾—åˆ°æ–‡å­—é”™è¯¯ä¿¡æ¯ã€‚

è°ƒç”¨ system-level function æ—¶åº”å½“æ£€æŸ¥é”™è¯¯ã€‚ä¸ºäº†ä½¿é”™è¯¯å¤„ç†æ›´åŠ ç®€ä¾¿ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼ä¸‹é¢çš„ wrapper functionï¼š

\`\`\`c
#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

void unix_error(char *msg)
{
    fprintf(stderr, "%s: %s\\n", msg, strerror(errno));
    exit(errno);
}

pid_t Fork(void)
{
    pid_t pid = fork();

    if (pid < 0)
        unix_error("Fork error");

    return pid;
}
\`\`\`

## Process Control

C è¯­è¨€ä¸­æœ‰å¾ˆå¤šç”¨æ¥æ§åˆ¶ Unix è¿›ç¨‹çš„å‡½æ•°ã€‚

### è·å– PID

æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ª PIDã€‚

-   \`pid_t getpid(void)\`: è¿”å›å½“å‰è¿›ç¨‹çš„ PID
-   \`pid_t getppid(void)\`: è¿”å›å½“å‰è¿›ç¨‹çš„ parent çš„ PID

### è¿›ç¨‹çš„çŠ¶æ€

æ¯ä¸ªè¿›ç¨‹å¯èƒ½å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š

1.  Running: æ­£åœ¨è¿è¡Œä¸­ï¼Œä¼šè¢« scheduleã€‚
2.  Stopped: è¢« suspend äº†ï¼Œä¸ä¼šè¢« scheduleã€‚Stopped å¯èƒ½æ˜¯ SIGSTOPã€SIGTSTPã€SIGTTINã€SIGTTOU å¯¼è‡´çš„ï¼Œå¯ä»¥ç”± SIGCONT æ¢å¤è¿è¡Œã€‚
3.  Terminated: è¿›ç¨‹æ°¸ä¹…åœ°ç»“æŸäº†ï¼Œå¯èƒ½æ˜¯ä» \`main\` å‡½æ•°è¿”å›ã€è°ƒç”¨äº† \`exit\` å‡½æ•°æˆ–è€…æ”¶åˆ°äº†æŸäº› signalã€‚

-   \`void exit(int status)\`: ä»¥æŸä¸ª exit status å°†å½“å‰è¿›ç¨‹ terminate

### fork

-   \`pid_t fork(void)\`: åˆ›å»ºå­è¿›ç¨‹

fork ä¼šå°†å½“å‰è¿›ç¨‹çš„æ‰€æœ‰çŠ¶æ€å¤åˆ¶ä¸€ä»½åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œæ–°çš„è¿›ç¨‹æœ‰ç€å’ŒåŸæ¥ç›¸åŒçš„ä»£ç ã€æ•°æ®ã€æ–‡ä»¶ï¼ˆä¾‹å¦‚ \`stdout\`ï¼‰ï¼Œä½† PID ä¸åŒï¼Œå¹¶ä¸”åç»­å¯¹æ•°æ®çš„ä¿®æ”¹æ˜¯å’ŒåŸè¿›ç¨‹ç‹¬ç«‹çš„ã€‚

fork ä¼šè°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¸­è¿”å›ï¼Œåœ¨ parent ä¸­è¿”å› child çš„ PIDï¼Œåœ¨ child ä¸­è¿”å› 0ï¼Œå‡ºé”™åˆ™è¿”å› -1ã€‚

fork å‡ºçš„è¿›ç¨‹å’ŒåŸè¿›ç¨‹åœ¨æ¥ä¸‹æ¥ä¼šæ‰§è¡ŒåŒä¸€ä»½ä»£ç ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šåˆ¤æ–­ \`fork\` çš„è¿”å›å€¼æ˜¯å¦ä¸º 0 æ¥è®©ä¸¤ä¸ªè¿›ç¨‹æ‰§è¡Œä¸åŒçš„åˆ†æ”¯ã€‚

### process group

æ¯ä¸ªè¿›ç¨‹ä¼šå±äºä¸€ä¸ª process groupï¼Œæ¯ä¸ª process group æœ‰ä¸€ä¸ª IDã€‚

åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œå­è¿›ç¨‹ä¼šé»˜è®¤å¤„äº parent çš„ process groupã€‚

-   \`pid_t getpgrp(void)\`: è¿”å›å½“å‰è¿›ç¨‹çš„ process group ID
-   \`int setpgid(pid_t pid, pid_t pgid)\`: å°† \`pid\` å¯¹åº”çš„è¿›ç¨‹çš„ progress group ID ä¿®æ”¹ä¸º \`pgid\`ï¼Œ\`pid\` ä¸º 0 è¡¨ç¤ºå½“å‰è¿›ç¨‹ï¼Œ\`pgid\` ä¸º 0 è¡¨ç¤ºä¿®æ”¹ä¸º \`pid\` å¯¹åº”çš„è¿›ç¨‹çš„ PID

### wait

-   \`pid_t waitpid(pid_t pid, int *statusp, int options)\`: ç­‰å¾…å­è¿›ç¨‹ç»“æŸ
-   \`pid_t wait(int *statusp)\`: \`waitpid(-1, statusp, 0)\`

#### waitpid çš„ pid å‚æ•°

å‚æ•° \`pid\` å†³å®šäº†è¦ç­‰å¾…çš„æ˜¯å“ªäº›å­è¿›ç¨‹ï¼š

-   -1: æ‰€æœ‰å­è¿›ç¨‹
-   \\> 0: PID ä¸º \`pid\` çš„å­è¿›ç¨‹
-   0: process group ä¸å½“å‰è¿›ç¨‹ç›¸åŒçš„å­è¿›ç¨‹
-   \\< -1: process group ID ä¸º \`-pid\` çš„å­è¿›ç¨‹

#### waitpid çš„è¡Œä¸º (options)

é»˜è®¤æƒ…å†µä¸‹ï¼Œ\`waitpid\` ä¼šç­‰å¾…åˆ°æœ‰æŸä¸ªè¢«ç­‰å¾…çš„å­è¿›ç¨‹ terminate å†è¿”å›ï¼Œ\`options\` å¯ä»¥æ”¹å˜è¿™ä¸€è¡Œä¸ºï¼Œå…¶å€¼å¯ä»¥åŒ…å«ä¸‹åˆ— flagï¼š

-   \`WNOHANG\`: ç«‹å³è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„å­è¿›ç¨‹åˆ™è¿”å› 0
-   \`WUNTRACED\`: é™¤äº† terminateï¼Œå­è¿›ç¨‹ stop ä¹Ÿå¯ä»¥ç»“æŸç­‰å¾…
-   \`WCONTINUED\`: é™¤äº† terminateï¼Œå­è¿›ç¨‹ä» stopped ä¸­ continue ä¹Ÿå¯ä»¥ç»“æŸç­‰å¾…

#### reap

é™¤äº†ç­‰å¾…ï¼Œwait è¿˜ä¼šå°† terminated çš„å­è¿›ç¨‹ *reap*ï¼Œå³å½»åº•æ¸…é™¤æ‰ã€‚æ²¡æœ‰è¢« reap ä½† terminated çš„è¿›ç¨‹è¢«ç§°ä½œ *zombie*ï¼Œä¼šå ç”¨ä¸€å®šçš„ç³»ç»Ÿèµ„æºã€‚åœ¨ \`ps\` ä¸­ï¼Œzombie æ˜¾ç¤ºä¸º \`[defunct]\`ã€‚

å¦‚æœ parent terminate äº†ï¼Œæ²¡æœ‰ terminate çš„å­è¿›ç¨‹ä¼šè¢«è®¾ç½®ä¸º PID ä¸º 1 çš„ \`init\` è¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œè€Œ zombie å­è¿›ç¨‹åˆ™ä¼šè¢« \`init\` reapã€‚

#### wait è·å–å­è¿›ç¨‹çš„ status

å¦‚æœ \`statusp\` å‚æ•°ä¸æ˜¯ \`NULL\`ï¼Œåœ¨ \`waitpid\` è¿”å›æ—¶ \`*statusp\` å†…å°±ä¼šå­˜æœ‰å¼•èµ·ç­‰å¾…ç»“æŸçš„é‚£ä¸ªå­è¿›ç¨‹çš„ä¿¡æ¯ã€‚

æœ‰ä¸€ç³»åˆ— macro å¯ä»¥ç”¨æ¥æå– status ä¸­çš„ä¿¡æ¯ï¼ˆå‚æ•°æ˜¯ \`*statusp\`ï¼Œä¸æ˜¯æŒ‡é’ˆï¼‰ï¼š

-   \`WIFEXITED(status)\`: æ˜¯å¦æ­£å¸¸é€€å‡º (ä» \`main\` å‡½æ•°è¿”å›æˆ–è°ƒç”¨äº† \`exit\` å‡½æ•°)
-   \`WEXITSTATUS(status)\`: å¦‚æœæ­£å¸¸é€€å‡ºï¼Œåˆ™è¿”å› exit status (\`main\` å‡½æ•°è¿”å›å€¼ / \`exit\` å‡½æ•°å‚æ•°)
-   \`WIFSIGNALED(status)\`: æ˜¯å¦ç”±æŸä¸ª signal terminate
-   \`WTERMSIG(status)\`: å¦‚æœæ˜¯ç”±æŸä¸ª signal terminateï¼Œè¿”å›è¿™ä¸ª signal
-   \`WIFSTOPPED(status)\`: æ˜¯å¦è¢« stop
-   \`WSTOPSIG(status)\`: å¦‚æœè¢« stopï¼Œè¿”å›ä½¿å…¶ stop çš„ signal
-   \`WIFCONTINUED(status)\`: æ˜¯å¦è¢« continue

#### wait çš„æŠ¥é”™

å‡ºé”™æ—¶ wait ä¼šè¿”å› -1ï¼Œ\`errno\` å¯èƒ½æ˜¯ \`ECHILD\` è¡¨ç¤ºè¢«ç­‰å¾…çš„å­è¿›ç¨‹é›†åˆä¸ºç©ºï¼Œå¯èƒ½æ˜¯ \`EINTR\` è¡¨ç¤º wait å‡½æ•°è¢«æŸä¸ª signal ä¸­æ–­äº†ã€‚

wait ä¼šåœ¨æ¯æœ‰ä¸€ä¸ªå­è¿›ç¨‹ç»“æŸæ—¶è¿”å›ï¼Œä½†å­è¿›ç¨‹å…¨éƒ¨ç»“æŸæ—¶ä¼šæŠ¥é”™ \`ECHILD\`ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹é€šè¿‡ \`while\` å¾ªç¯æ¥ç­‰å¾…æ‰€æœ‰å­è¿›ç¨‹å…¨éƒ¨ç»“æŸã€‚

### sleep

-   \`unsigned int sleep(unsigned int secs)\`: sleep è‹¥å¹²ç§’ï¼Œè¿”å›å‰©ä½™åº”å½“ sleep çš„ç§’æ•°ï¼ˆæ­£å¸¸æƒ…å†µä¸‹æ²¡è¢« interrupt å°±æ˜¯ 0ï¼‰
-   \`int pause(void)\`: ä¸€ç›´ sleepï¼Œç›´åˆ°è¢« signal interruptï¼Œæ€»æ˜¯è¿”å› -1

### execve

-   \`int execve(const char *filename, char *const argv[], char *const envp[])\`

\`execve\` ä¼šä»¥ \`argv\` ä½œä¸ºå‚æ•°ã€\`envp\` ä½œä¸ºç¯å¢ƒå˜é‡ï¼Œåœ¨å½“å‰è¿›ç¨‹å†…æ‰§è¡Œ executable object file \`filename\`ã€‚å¯ä»¥å’Œ \`fork\` é…åˆæ¥åœ¨å­è¿›ç¨‹å†…æ‰§è¡Œå…¶ä»–ç¨‹åºã€‚

\`argv\` æ˜¯ä¸€ä¸ªä»¥ \`NULL\` ä¸ºç»“å°¾çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œè¡¨ç¤ºå„ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªä¸€èˆ¬æ˜¯ç¨‹åºçš„åç§°ã€‚

\`envp\` ä¹Ÿæ˜¯ä»¥ \`NULL\` ä¸ºç»“å°¾çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²å½¢å¦‚ \`name=value\`ã€‚

æœ‰ä¸€äº›å‡½æ•°å¯ä»¥ç”¨æ¥è·å–ã€è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

-   \`char *getenv(const char *name)\`: è¿”å› \`NULL\` æˆ–ç¯å¢ƒå˜é‡çš„å€¼
-   \`int setenv(const char *name, const char *newvalue, int overwrite)\`: æˆåŠŸåˆ™è¿”å› 0ï¼Œå¤±è´¥ï¼ˆ\`overwrite\` ä¸º 0 è€Œ \`name\` å·²å­˜åœ¨ï¼‰åˆ™è¿”å› -1
-   \`void unsetenv(const char *name)\`

## Signals

### signal çš„ç§ç±»

å¯ä»¥ç”¨ \`man signal.7\` æŸ¥çœ‹ signal çš„åˆ—è¡¨ï¼ˆåç§°ã€è¯­ä¹‰ã€ç¼–å·ã€é»˜è®¤è¡Œä¸ºï¼‰ã€‚

ç‰¹åˆ«åœ°ï¼š

-   é™¤ä»¥é›¶æ—¶ä¼šè¢«å‘é€ SIGFPE
-   æ‰§è¡Œéæ³•æŒ‡ä»¤æ—¶ä¼šè¢«å‘é€ SIGILL
-   éæ³•è®¿é—®å†…å­˜æ—¶ä¼šè¢«å‘é€ SIGSEGV
-   æŒ‰ Ctrl+C æ—¶ foreground process group ä¼šè¢«å‘é€ SIGINT
-   å­è¿›ç¨‹ terminate æ—¶ä¼šå‘ parent å‘é€ SIGCHLD
-   å¯ä»¥é€šè¿‡ SIGKILL æ¥å¼ºè¡Œ terminate ä¸€ä¸ªè¿›ç¨‹

### signal çš„å·¥ä½œæµç¨‹

-   æ¯ä¸ªè¿›ç¨‹ä¼šè®°å½•æ¯ä¸ª signal æ˜¯å¦ *pending*ã€æ˜¯å¦ *blocked*
-   å‘é€ signal ä¼šä½¿æ¥æ”¶è€…çš„è¿™ä¸ª signal å˜ä¸º pending
-   è¿›ç¨‹å¯ä»¥æ”¹å˜æ¯ä¸ª signal çš„ blocked çŠ¶æ€
-   åœ¨åˆ‡æ¢åˆ° user mode æ‰§è¡Œè¿›ç¨‹æ—¶ï¼Œå¦‚æœä¸€ä¸ª signal å¤„äº pending çŠ¶æ€ä¸”æ²¡æœ‰è¢« blockedï¼Œå°±ä¼šæ¥æ”¶è¿™ä¸ª signalï¼Œå¹¶è®¾ä¸ºæ²¡æœ‰åœ¨ pending

è¿™æ„å‘³ç€ï¼š

-   signal åªè®°å½•æ˜¯å¦ pendingï¼Œä¸ä¼šè®°å½•å‘é€äº†å‡ æ¬¡ï¼Œåœ¨è¢«æ¥æ”¶å‰å¤šæ¬¡å‘é€åªä¼šè¢«æ¥æ”¶ä¸€æ¬¡
-   åœ¨ blocked çŠ¶æ€ä¸‹è¢«å‘é€ signalï¼Œä¼šåœ¨ unblock æ—¶æ”¶åˆ°

### å‘é€ signal

#### kill å‘½ä»¤

å¯ä»¥ç”¨ \`kill\` å‘½ä»¤åœ¨ shell ä¸­å‘æŒ‡å®šçš„è¿›ç¨‹å‘é€ä¿¡å·ã€‚ä¸€èˆ¬ shell ä¼šæœ‰ builtin çš„ \`kill\`ï¼Œä¹Ÿæœ‰ä½äº \`/usr/bin/kill\` çš„ \`kill\`ï¼Œå¯èƒ½æœ‰ä¸€å®šçš„åŒºåˆ«ã€‚

åŸºç¡€çš„ \`kill\` å‘½ä»¤å½¢å¦‚ \`kill -sig pid\`ï¼Œå…¶ä¸­ \`-sig\` å¯ä»¥å½¢å¦‚ \`-INT\`/\`-SIGINT\`/\`-2\`ï¼Œè€Œ \`pid\` è¡¨ç¤ºè¦æŠŠä¿¡å·å‘é€ç»™ï¼š

-   \\> 0: PID ä¸º \`pid\` çš„è¿›ç¨‹
-   0: process group å’Œå½“å‰è¿›ç¨‹ç›¸åŒçš„è¿›ç¨‹
-   -1: é™¤ PID ä¸º 1 çš„ \`init\` å¤–çš„æ‰€æœ‰è¿›ç¨‹
-   \\< 0: process group ID ä¸º \`-pid\` çš„è¿›ç¨‹

è¿™ä¸ [waitpid çš„ pid å‚æ•°](#waitpid-çš„-pid-å‚æ•°) æ˜¯ç±»ä¼¼çš„ã€‚

#### åœ¨ shell ä¸­ä½¿ç”¨é”®ç›˜å‘é€ SIGINT / SIGTSTP

shell ä¸­ä¼šæœ‰è‡³å¤šä¸€ä¸ª foreground job å’Œé›¶ä¸ªæˆ–è‹¥å¹²ä¸ª background jobã€‚shell ä¼šç»™æ¯ä¸ª job ä¸­çš„æ‰€æœ‰è¿›ç¨‹æŒ‡å®šåŒæ ·çš„ process groupã€‚

Ctrl+C ä¼šå‘ foreground group å‘é€ SIGINTï¼ŒCtrl+Z ä¼šå‘ foreground group å‘é€ SIGTSTPã€‚

#### ä½¿ç”¨å‡½æ•°å‘é€ signal

-   \`int kill(pid_t pid, int sig)\`: ä¸ [kill å‘½ä»¤](#kill-å‘½ä»¤)ç±»ä¼¼
-   \`unsigned int alarm(unsigned int secs)\`: è®© kernel åœ¨ \`secs\` ç§’åå‘å½“å‰è¿›ç¨‹å‘é€ SIGALRMï¼›å¦‚æœæœ‰å°šæœªå‘é€çš„ alarm åˆ™å–æ¶ˆæ‰ï¼Œå¦‚æœ \`secs\` ä¸º 0 åˆ™å–æ¶ˆåä¸ä¼šå‘é€æ–°çš„ SIGALRMï¼›æ²¡æœ‰å°šæœªå‘é€çš„ alarm åˆ™è¿”å›å€¼æ˜¯ 0ï¼Œå¦åˆ™æ˜¯è¢«å–æ¶ˆçš„ alarm è¿˜å‰©çš„ç§’æ•°

### è®¾ç½® signal handler

é™¤äº† SIGKILL å’Œ SIGSTOPï¼Œå…¶ä»– signal çš„è¡Œä¸ºå¯ä»¥è¢«æ”¹å˜ã€‚

\`\`\`c
#include <signal.h>
typedef void (*sighandler_t)(int);
sighandler_t signal(int signum, sighandler_t handler);
\`\`\`

å‡½æ•° \`signal\` ç”¨æ¥æ”¹å˜å¤„ç† signal \`signum\` çš„æ–¹å¼ã€‚\`handler\` å¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œä¹Ÿå¯ä»¥æ˜¯ \`SIG_IGN\` è¡¨ç¤ºæ— è§†è¿™ä¸ª signalï¼Œæˆ–è€… \`SIG_DFL\` è¡¨ç¤ºä½¿ç”¨è¿™ä¸ª signal çš„é»˜è®¤è¡Œä¸ºã€‚

æœ‰ handler æ—¶ï¼Œæ¥æ”¶åˆ°ä¸€ä¸ª signal å°±ä¼šè§¦å‘ exception æ¥æ‰§è¡Œ handlerï¼Œåœ¨ handler ç»“æŸæ—¶ä¸€èˆ¬ä¼šè¿”å›åˆ°åŸæ¥çš„æŒ‡ä»¤ã€‚

åœ¨æ‰§è¡Œ handler çš„è¿‡ç¨‹ä¸­ï¼Œç›¸åº”çš„ signal ä¼šè¢« blockï¼Œä½† handler å¯ä»¥è¢«å…¶ä»–ç±»å‹çš„ signal interruptï¼Œåœ¨å¤„ç†å®Œè¿™å¦ä¸€ä¸ª signal åè¿”å›åˆ°ä¸€å¼€å§‹çš„ handlerã€‚

### block / unblock signal

è¿›ç¨‹å¯ä»¥ä¸»åŠ¨ block / unblock æŒ‡å®šçš„ signalï¼š

-   \`int sigprocmask(int how, const sigset_t *set, sigset_t *oldset)\`

å…¶ä¸­ \`how\` æ˜¯ \`SIG_BLOCK\` / \`SIG_UNBLOCK\` / \`SIG_SETMASK\`ï¼Œåˆ†åˆ«è¡¨ç¤º block \`set\` é‡Œçš„ signal / unblock \`set\` é‡Œçš„ signal / å°† blocked set è®¾ä¸º \`set\`ã€‚

è‹¥ \`oldset\` ä¸æ˜¯ \`NULL\`ï¼Œåˆ™ä¼šå°†ä¿®æ”¹å‰çš„ blocked set å­˜ä¸‹æ¥ã€‚

è¿˜æœ‰ä¸€äº›ç”¨æ¥è®¾ç½® \`sigset_t\` çš„å‡½æ•°ï¼š

-   \`int sigemptyset(sigset_t *set)\`: å°† \`set\` è®¾ä¸ºç©º
-   \`int sigfillset(sigset_t *set)\`: å°† \`set\` è®¾ä¸ºæ‰€æœ‰ signal
-   \`int sigaddset(sigset_t *set, int signum)\`: å°† \`signum\` åŠ å…¥ \`set\`
-   \`int sigdelset(sigset_t *set, int signum)\`: å°† \`signum\` ä» \`set\` ä¸­åˆ å»
-   \`int sigismember(const sigset_t *set, int signum)\`: æ£€æŸ¥ \`signum\` æ˜¯å¦åœ¨ \`set\` ä¸­ï¼Œè¿”å› 0/1 æˆ–å‡ºé”™è¿”å› -1

### ç¼–å†™ã€ä½¿ç”¨ signal handler

#### ç¼–å†™å®‰å…¨çš„ signal handler

ç”±äº signal handler å’Œä¸»ç¨‹åºå¹¶è¡Œè¿è¡Œã€å…±äº«æ•°æ®ï¼Œå¹¶ä¸”ä¸»ç¨‹åºå¯èƒ½åœ¨æ„æƒ³ä¸åˆ°çš„åœ°æ–¹æ¥æ”¶åˆ° signal è€Œè¢« interruptï¼Œç¼–å†™å®‰å…¨çš„ signal handler æ˜¯å›°éš¾çš„ï¼Œä¸€èˆ¬è¦éµå¾ªä¸‹é¢çš„å®ˆåˆ™ï¼š

0.  handler åº”å½“å°½é‡ç®€å•ï¼Œä¾‹å¦‚å¯ä»¥è®¾ç½®ä¸€ä¸ª flag è€Œåœ¨ä¸»ç¨‹åºä¸­æ£€æŸ¥ flag å¹¶è¿›è¡Œå¤„ç†ï¼Œè€Œéç›´æ¥åœ¨ handler ä¸­å¤„ç†
1.  åœ¨ handler ä¸­åªè°ƒç”¨ async-signal-safe çš„å‡½æ•°ï¼ˆå‡½æ•°åˆ—è¡¨å‚è§ \`man signal-safety\`ï¼‰ï¼Œå¸¸ç”¨çš„ \`printf\`ã€\`sprintf\`ã€\`malloc\`ã€\`exit\` éƒ½ä¸æ˜¯ async-signal-safe çš„
2.  å­˜å‚¨å¹¶æ¢å¤ \`errno\`ï¼Œä¿è¯è°ƒç”¨ handler å‰å \`errno\` ä¸å˜
3.  è®¿é—® handler ä¸ä¸»ç¨‹åºå…±äº«çš„æ•°æ®æ—¶ï¼Œblock signal ä»¥é˜²æ­¢åœ¨è®¿é—®çš„ä¸­é€”è¢« interrupt
4.  æŠŠåœ¨ handler ä¸­ä¿®æ”¹è€Œåœ¨ä¸»ç¨‹åºä¸­è®¿é—®çš„çš„å…¨å±€å˜é‡å£°æ˜ä¸º \`volatile\` çš„ï¼Œé˜²æ­¢ç¼–è¯‘å™¨è¯¯è®¤ä¸ºå˜é‡æ²¡æœ‰è¢«ä¿®æ”¹è€Œé”™è¯¯åœ°è¿›è¡Œä¼˜åŒ–
5.  å°† flag å£°æ˜ä¸º \`sig_atomic_t\` ç±»å‹ï¼Œå®ƒçš„å•æ¬¡è®¿é—®æ˜¯ atomic çš„ï¼Œä¸ä¼šè¢« interruptï¼ˆä½†å…ˆè¯»åå†™æ˜¯ä¸¤æ¬¡è®¿é—®ï¼Œå¯èƒ½è¢« interruptï¼‰

<Card title="ä¸ºä»€ä¹ˆå‡½æ•°ä¼šä¸ async-signal-safe">
ä»¥ \`printf\` ä¸ºä¾‹ï¼Œ\`printf\` ä¼šä½¿ç”¨ä¸€ä¸ª statically allocated bufferï¼Œå¦‚æœåœ¨ä¸­é€”è¢« interruptï¼Œè€Œåœ¨è¿”å›åˆ°è¢« interrupt çš„ä½ç½®å‰çš„è¿™æ®µæ—¶é—´é‡Œï¼Œ\`printf\` å†æ¬¡è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ª buffer å°±ä¼šå¤„äºä¸€ä¸ª inconsistent çš„ä¸­é—´æ€ï¼Œå¯¼è‡´ UBã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå‡½æ•°ä¸ async-signal-safe ä¸€èˆ¬æ˜¯å› ä¸ºä½¿ç”¨äº†ä¸€äº›å…¨å±€å˜é‡å¹¶ä¸”å¯èƒ½åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢« interruptã€‚è¦å®‰å…¨åœ°è°ƒç”¨è¿™æ ·çš„å‡½æ•°ï¼Œåœ¨å…¶è¢« interrupt åï¼Œä¸‹æ¬¡æ‰§è¡Œå¿…é¡»è¦æ˜¯ä»è¢« interrupt çš„åœ°æ–¹ç»§ç»­ï¼Œè€Œä¸èƒ½ä»å¤´å¼€å§‹ã€‚

é™¤äº†åœ¨ handler ä¸­åªè°ƒç”¨ async-signal-safe çš„å‡½æ•°ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åœ¨ä¸»ç¨‹åºä¸­è°ƒç”¨é async-signal-safe å‡½æ•°æ—¶ block æ‰ handler ä½¿ç”¨äº†è¿™ä¸€å‡½æ•°çš„ signalï¼Œä½†è¿™å¾ˆéš¾åšåˆ°ã€‚
</Card>

#### æ­£ç¡®å¤„ç†å¤šæ¬¡å‘é€çš„ signal

å¤šæ¬¡å‘é€ signal å¯èƒ½åªä¼šæ”¶åˆ°ä¸€æ¬¡ï¼Œæ‰€ä»¥å¤„ç† signal æ—¶ä¸èƒ½è¯¯ä»¥ä¸ºæ”¶åˆ°çš„æ¬¡æ•°ä¸å‘é€çš„æ¬¡æ•°ç›¸åŒã€‚

ä¾‹å¦‚ï¼Œæ¥æ”¶ SIGCHLD æ¥ reap child æ—¶ï¼Œåº”å½“åœ¨ handler ä¸­ reap æ‰æ‰€æœ‰å·² terminate çš„å­è¿›ç¨‹ï¼Œè€Œéåª reap ä¸€ä¸ªå­è¿›ç¨‹ã€‚

#### ä¸åŒç³»ç»Ÿä¸Š signal handling çš„å·®å¼‚

åœ¨ä¸€äº›ç³»ç»Ÿä¸Šï¼Œsignal handling çš„è¯­ä¹‰ä¼šæœ‰åŒºåˆ«ï¼š

-   åœ¨ä¸€äº›ç³»ç»Ÿä¸Šï¼Œè°ƒç”¨äº† handler åè¿™ä¸ª signal å°±ä¼šæ¢å¤é»˜è®¤è¡Œä¸ºï¼Œéœ€è¦åœ¨ handler ä¸­é‡æ–°è°ƒç”¨ \`signal\` æ‰èƒ½ä¸€ç›´ä½¿ç”¨è¿™ä¸ª handlerã€‚

-   åœ¨ä¸€äº›ç³»ç»Ÿä¸Šï¼Œéœ€è¦æ‰§è¡Œè¾ƒé•¿æ—¶é—´çš„ system call ä¼šåœ¨è¢« interrupt åæŠ¥é”™ EINTRï¼Œè€Œåœ¨ç°ä»£ç³»ç»Ÿä¸Šä¼šå°½å¯èƒ½åœ°è‡ªåŠ¨é‡æ–°æ‰§è¡Œè¿™ä¸ª system callï¼Œè¯¦è§ \`man signal.7\` çš„ â€œInterruption of system calls and library functions by signal handlersâ€ ä¸€èŠ‚ã€‚

    ï¼ˆP.S. è¿™å°±æ˜¯ [Rise of Worse Is Better](https://www.dreamsongs.com/RiseOfWorseIsBetter.html) ä¸­ç”¨æ¥ä¸¾ä¾‹çš„ â€œPC loser-ing problemâ€ï¼ŒåŸæœ¬é‡‡ç”¨ worse-is-better çš„ Unix ç°åœ¨ä¹Ÿè¿›åŒ–æˆäº† the right thingï¼‰
    ï¼ˆP.P.S. å½“æ—¶è¯»è¿™ç¯‡çš„æ—¶å€™æˆ‘å®Œå…¨æ²¡çœ‹æ‡‚è¿™ä¸€æ®µï¼Œæ²¡æƒ³åˆ°ç°åœ¨ç«Ÿç„¶è¿˜èƒ½è®°èµ·æ¥ï¼‰

å¯ä»¥é€šè¿‡ \`sigaction\` å‡½æ•°æ¥è®¾ç½®æƒ³è¦çš„ signal handling è¯­ä¹‰ã€‚

#### æ³¨æ„ handler è¢«è°ƒç”¨çš„æ—¶æœº

handler å¯èƒ½ä¼šåœ¨æ„æƒ³ä¸åˆ°çš„æ—¶æœºè¢«è°ƒç”¨ï¼Œä¸ºäº†é¿å…å‡ºé”™ï¼ˆraceï¼‰ï¼Œå¯èƒ½ä¼šéœ€è¦æš‚æ—¶ block signal æ¥ç¡®ä¿ handler åœ¨æ­£ç¡®çš„æ—¶æœºè¢«è°ƒç”¨ã€‚è¯¦è§ CS:APP ä¸Šçš„ä¾‹å­ã€‚

### ç­‰å¾… signal

-   \`int sigsuspend(const sigset_t *mask)\`: å°† blocked set è®¾ä¸º \`mask\`ï¼Œåœ¨æ¥æ”¶åˆ°ä»»ä½• signal åè¿”å›

å¯ä»¥åœ¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ† block æ‰æŸä¸ª signalï¼Œç„¶ååœ¨ \`sigsuspend\` çš„å‚æ•°ä¸­å°†å…¶ unblockï¼Œä»¥è¾¾åˆ°ç­‰å¾…è¯¥ signal çš„ç›®çš„ã€‚å› ä¸º \`sigsuspend\` ç­‰å¾…çš„ä¸æ˜¯æŸä¸ªç‰¹å®šçš„ signalï¼Œå¯ä»¥é…åˆ \`while\` å¾ªç¯æ¥æ£€æŸ¥ç”± handler è®¾ç½®çš„æŸä¸ª flagã€‚

\`sigsuspend\` çš„æ•ˆæœç±»ä¼¼äºä¸‹é¢çš„è¿™æ®µä»£ç ï¼š

\`\`\`c
sigprocmask(SIG_SETMASK, &mask, &prev);
pause();
sigprocmask(SIG_SETMASK, &prev, NULL);
\`\`\`

ä¸åŒçš„æ˜¯ï¼Œä¸Šé¢è¿™æ®µä»£ç æœ‰å¯èƒ½ä¼šæ°å¥½åœ¨ \`sigprocmask\` ä¹‹åã€\`pause\` ä¹‹å‰æ¥æ”¶åˆ° signalï¼Œå¯¼è‡´è¿™ä¸ª signal æ²¡æœ‰å°† \`pause\` interrupt è€Œä¸€ç›´ sleep ä¸‹å»ã€‚\`sigsuspend\` æ˜¯ atomic çš„ï¼Œå°±ä¸å­˜åœ¨è¿™æ ·çš„é—®é¢˜ã€‚

## Nonlocal Jumps

-   \`int setjmp(jmp_buf env)\`
-   \`void longjmp(jmp_buf env, int val)\`

\`setjmp\` ä¼šå°†å½“å‰çš„ PC å’Œå¯„å­˜å™¨ç­‰ä¿¡æ¯å­˜åœ¨ \`env\` ä¸­ï¼Œè€Œ \`longjmp\` ä¼šæ¢å¤ \`env\` ä¸­ä¿å­˜çš„ä¿¡æ¯ï¼Œè·³è½¬åˆ° \`setjmp\` çš„ä½ç½®ã€‚

è¿™æ„å‘³ç€ \`setjmp\` å¯èƒ½è¿”å›å¤šæ¬¡ï¼Œè€Œ \`longjmp\` ä¸ä¼šè¿”å›ã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨ \`setjmp\` ä¼šè¿”å› 0ï¼Œè€Œä¹‹åè°ƒç”¨ \`longjmp\` æ—¶ä¼šåœ¨ \`setjmp\` çš„ä½ç½®è¿”å›å‚æ•° \`val\` çš„å€¼ï¼ˆç‰¹åˆ«åœ°ï¼Œå¦‚æœ \`val\` çš„å€¼æ˜¯ 0ï¼Œä¼šè¿”å› 1ï¼Œå¼ºåˆ¶å’Œé¦–æ¬¡è¿”å›åŒºåˆ†å¼€ï¼‰ã€‚

å› ä¸º \`setjmp\` / \`longjmp\` åªæ˜¯æ¢å¤ PC å’Œå¯„å­˜å™¨ï¼ˆåŒ…æ‹¬ \`%rsp\`ï¼‰ï¼š

-   è°ƒç”¨ \`longjmp\` æ—¶ \`setjmp\` æ‰€åœ¨çš„å‡½æ•°å¿…é¡»è¿˜æ²¡æœ‰è¿”å›ï¼Œå¦åˆ™ \`setjmp\` æ‰€åœ¨çš„ stack frame å°±å¤±æ•ˆäº†ã€‚
-   \`setjmp\` çš„è¿”å›å€¼åªåº”å‡ºç°åœ¨[ä¸€äº›ç®€å•çš„è¡¨è¾¾å¼ä¸­](https://pubs.opengroup.org/onlinepubs/9699919799/functions/setjmp.html)ï¼Œå¦åˆ™æ˜¯ UBã€‚ç‰¹åˆ«åœ°ï¼Œä¸åº”å°† \`setjmp\` çš„è¿”å›å€¼èµ‹ç»™ä¸€ä¸ªå˜é‡ï¼Œä½†å¯ä»¥æ”¾åœ¨ \`if\` æˆ– \`switch\` é‡Œã€‚è¿™æ˜¯è€ƒè™‘åˆ°ï¼Œè®¡ç®—ä¸€ä¸ªå¤æ‚çš„è¡¨è¾¾å¼å¯èƒ½ä¼šæœ‰ä¸€äº›ä¸­é—´é‡ä»¥åŠ dynamic stack allocationï¼Œè€Œ \`longjmp\` å›æ¥æ—¶è¿™äº›ä¸­é—´é‡ã€dynamic stack allocation ä¸ä¸€å®šèƒ½è¢«æ­£ç¡®æ¢å¤ï¼Œå¯¼è‡´è¡¨è¾¾å¼ä¸ä¸€å®šèƒ½è¢«æ­£ç¡®è®¡ç®—ã€‚
-   å¦‚æœä¿®æ”¹äº†å­˜æ”¾åœ¨å†…å­˜ä¸­çš„å±€éƒ¨å˜é‡ï¼Œè·³è½¬åä¼šæ˜¯è¢«ä¿®æ”¹è¿‡çš„å€¼è€Œä¸æ˜¯åŸæ¥çš„å€¼ï¼Œè€Œå­˜æ”¾åœ¨å¯„å­˜å™¨ä¸­çš„å€¼åˆ™ä¼šè¢«æ¢å¤ã€‚è¦ç¡®ä¿å˜é‡ä¸è¢«å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œå¿…é¡»ä½¿ç”¨ \`volatile\` å£°æ˜å˜é‡ï¼Œå¦åˆ™ï¼ˆå³ä¾¿ä½¿ç”¨äº† \`register\` æˆ– \`auto\` æ¥å£°æ˜å˜é‡ï¼‰ç¼–è¯‘å™¨å¯èƒ½ä»»æ„åœ°æŠŠå˜é‡æ”¾åœ¨å†…å­˜æˆ–å¯„å­˜å™¨ä¸­ï¼Œé€ æˆè·³è½¬åå˜é‡çš„å€¼ä¸ç¡®å®šã€‚

<Card type="question" title="volatile vs å–åœ°å€">
C99 rationale å’Œ \`man setjmp\` éƒ½è¯´è¦ç”¨ \`volatile\` æ‰èƒ½ç¡®ä¿å±€éƒ¨å˜é‡å­˜åœ¨æ ˆä¸Šï¼Œé‚£å¦‚æœä¸€ä¸ªå±€éƒ¨å˜é‡è¢«å–äº†åœ°å€ï¼Œè¿˜æœ‰å¯èƒ½å­˜åœ¨å¯„å­˜å™¨ä¸­å—ï¼Ÿå¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œæ˜¯æ ‡å‡†å…è®¸è¿™æ ·ä½†äº‹å®ä¸Šä¸ä¼šï¼Œè¿˜æ˜¯çœŸçš„å¯ä»¥åœ¨ gcc ä¸­åšåˆ°ï¼Ÿ
</Card>

-   \`int sigsetjmp(sigjmp_buf env, int savesigs)\`
-   \`void siglongjmp(sigjmp_buf env, int val)\`

\`sigsetjmp\` / \`siglongjmp\` ä¼šé¢å¤–å­˜å‚¨ã€æ¢å¤ pending / blocked signal çš„ä¿¡æ¯ï¼ˆéœ€è¦ä»¥é 0 \`savesigs\` è°ƒç”¨ \`sigsetjmp\`ï¼‰ï¼Œå¯ä»¥ç”¨äº signal handlerã€‚

nonlocal jump ä¸»è¦æœ‰ä¸¤ç§ç”¨é€”ï¼š

-   å‡ºé”™æ—¶ç›´æ¥è·³è½¬åˆ°ä¸€ä¸ªé›†ä¸­çš„ä½ç½®æ¥å¤„ç†é”™è¯¯ï¼Œè€Œä¸ç”¨ä¸€å±‚å±‚å¾€ä¸Šè¿”å›
-   å¤„ç† signal æ—¶ä¸è¿”å›åˆ°è¢« interrupt çš„ä½ç½®ï¼Œè€Œè·³è½¬åˆ°æŒ‡å®šçš„ä½ç½®

åœ¨ signal handler ä¸­ä½¿ç”¨ nonlocal jump æ—¶éœ€è¦æ³¨æ„ï¼š

-   å…ˆ \`sigsetjmp\` å† install signal handlerï¼Œå¦åˆ™å¯èƒ½ race
-   \`siglongjmp\` è·³è½¬åˆ°çš„åç»­ä»£ç ä¸­åªèƒ½è°ƒç”¨ async-signal-safe çš„å‡½æ•°

nonlocal jump å¯èƒ½é€ æˆå¯è¯»æ€§çš„é—®é¢˜ï¼Œä¹Ÿå¯èƒ½å› ä¸ºè·³è¿‡äº†ä¸­é—´å¾ˆå¤šå‡½æ•°çš„è¿”å›ï¼Œé€ æˆå†…å­˜æ³„éœ²ç­‰åæœï¼Œè¦è°¨æ…ä½¿ç”¨ã€‚

## Tools for Manipulating Processes

-   \`strace\`: æ˜¾ç¤ºç¨‹åºè°ƒç”¨çš„æ‰€æœ‰ system callï¼Œå¯ä»¥é™æ€é“¾æ¥æ¥é¿å…çœ‹åˆ°å¤§é‡å…±äº«åº“ç›¸å…³çš„è¾“å‡º
-   \`ps\`: åˆ—å‡ºè¿›ç¨‹ä¿¡æ¯
-   \`top\`: åˆ—å‡ºè¿›ç¨‹çš„èµ„æºä½¿ç”¨ï¼ˆå¯ä»¥ç”¨ \`htop\`ï¼‰
-   \`pmap\`: æŸ¥çœ‹è¿›ç¨‹çš„ memory map
-   \`/proc\`: æŸ¥çœ‹å„ç§è¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ (\`man proc.5\`)
`},{title:S,tags:t,content:`[CS:APP](https://csapp.cs.cmu.edu/) ç¬¬ä¹ç«  â€œVirtual Memoryâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

æœ¬ç« çš„ä¸»è¦å†…å®¹ä¸º page tableã€address translationã€memory mappingã€dynamic allocationã€‚



è™šå­˜æ˜¯å¯¹ main memory çš„æŠ½è±¡ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æœ‰ï¼š

-   å°† main memory ç”¨ä½œ disk çš„ cacheï¼Œåªå°† active çš„éƒ¨åˆ†æ”¾åœ¨ main memoryï¼Œåœ¨éœ€è¦æ—¶åœ¨ disk å’Œ memory ä¹‹é—´ä¼ é€’æ•°æ®
-   é€šè¿‡ç»™åº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„åœ°å€ç©ºé—´ï¼Œç®€åŒ–å†…å­˜ç®¡ç†
-   é€šè¿‡ç»™ä¸åŒè¿›ç¨‹æä¾›ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œé˜²æ­¢ä¸€ä¸ªè¿›ç¨‹çš„æ•°æ®è¢«å…¶ä»–è¿›ç¨‹ç ´å

è™šå­˜åœ¨ç³»ç»Ÿä¸­èµ·ç€éå¸¸é‡è¦çš„ä½œç”¨ï¼Œå­¦ä¹ è™šå­˜ä¸€æ–¹é¢å¯ä»¥å­¦ä¼šä½¿ç”¨å®ƒçš„ä¸€äº›å¼ºå¤§åŠŸèƒ½ï¼ˆä¾‹å¦‚å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä¸­ï¼‰ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥é¿å…ä¸€äº›å†…å­˜ç®¡ç†ç›¸å…³çš„é”™è¯¯ã€‚

## Physical and Virtual Addressing

å†…å­˜æœ‰ä¸¤ç§å¯»å€æ–¹å¼ï¼šç‰©ç†å¯»å€å’Œè™šæ‹Ÿå¯»å€ã€‚

main memory å¯ä»¥çœ‹ä½œ $M$ ä¸ª byte æ’åˆ—åœ¨ä¸€èµ·ï¼Œåœ°å€åˆ†åˆ«ä¸º $0 \\sim M-1$ï¼Œç‰©ç†å¯»å€å°±æ˜¯ CPU ç›´æ¥å°†éœ€è¦çš„åœ°å€ä¼ ç»™ main memoryï¼Œè·å–åˆ°æ•°æ®åä¼ å› CPUã€‚

è™šæ‹Ÿå¯»å€éœ€è¦ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿé…åˆï¼ŒCPU å°†è™šæ‹Ÿåœ°å€ä¼ ç»™ *memory management unit* (MMU)ï¼ŒMMU å°†è™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ä¼ ç»™ main memoryï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹åˆå’Œæ“ä½œç³»ç»Ÿç›¸å…³ã€‚

## Address Spaces

ï¼ˆçº¿æ€§ï¼‰åœ°å€ç©ºé—´æ˜¯è¿ç»­çš„éè´Ÿæ•´æ•°æ„æˆçš„é›†åˆï¼Œä¸€ä¸ªç³»ç»Ÿæœ‰ä¸€ä¸ªç‰©ç†åœ°å€ç©ºé—´ $[0, M-1]$ï¼Œè¿˜æœ‰è‹¥å¹²ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ $[0, N-1]$ï¼Œå…¶ä¸­ $N = 2^n$ï¼Œç§°ä½œ $n$-bit åœ°å€ç©ºé—´ï¼Œä¸€èˆ¬æ˜¯ 32-bit æˆ–è€… 64-bitã€‚

åŒä¸€ä»½æ•°æ®å¯ä»¥åœ¨ä¸åŒçš„åœ°å€ç©ºé—´æœ‰ä¸åŒçš„åœ°å€ï¼Œæ˜¯è™šå­˜çš„ä¸€ä¸ªåŸºæœ¬æ€æƒ³ã€‚

## VM as a Tool for Caching

å¯ä»¥è¯´ï¼Œè™šå­˜æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„ï¼Œè€Œç‰©ç†å†…å­˜æ˜¯è™šå­˜çš„ cacheã€‚ï¼ˆä½†å®é™…ä¸Šè™šå­˜åœ¨å¾ˆå¤šæ—¶å€™ä¼šåªå‡ºç°åœ¨è¿™ä¸ª cache é‡Œè€Œåªåœ¨å¿…è¦æ—¶è¢«å†™å…¥åˆ°ç£ç›˜ä¸Šã€‚ï¼‰

### page

è™šå­˜è¢«åˆ†æˆäº†å¾ˆå¤šå›ºå®šå¤§å°çš„å—ï¼Œæ¯ä¸€å—ç§°ä½œä¸€ä¸ª *virtual page*ï¼Œè€Œç‰©ç†å†…å­˜è¢«åˆ†ä¸ºåŒæ ·å¤§å°çš„å—ï¼Œæ¯ä¸€å—è¢«ç§°ä½œä¸€ä¸ª *physical page*ã€‚åœ¨ cache ä¸­ï¼Œè¿™æ ·çš„ä¸€å—ä¸€èˆ¬è¢«ç§°ä½œä¸€ä¸ª blockï¼Œä½†åœ¨è™šå­˜ä¸­è¢«ç§°ä½œä¸€ä¸ª pageã€‚

å› ä¸º DRAM æ¯”ç£ç›˜å¿«å¾ˆå¤šï¼Œå¹¶ä¸”ç£ç›˜çš„è¿ç»­è®¿é—®æ¯”éšæœºè®¿é—®å¿«å¾ˆå¤šï¼š

-   è™šå­˜çš„ä¸€ä¸ª page ä¼šæ¯”è¾ƒå¤§ï¼Œä¸€èˆ¬æœ‰ 4KB ~ 2MB
-   è™šå­˜æ˜¯ [fully associative cache](/post/2022/12/csapp-6#cache-çš„åˆ†ç±»)
-   æ“ä½œç³»ç»Ÿä¼šä½¿ç”¨ä¸€äº›æ¯” SRAM cache æ›´åŠ å¤æ‚çš„ç®—æ³•ä½œä¸º replacement policy æ¥ç®¡ç†è™šå­˜

ä¸€ä¸ª virtual page å¯èƒ½å¤„äºä¸‰ç§çŠ¶æ€ä¹‹ä¸€: unallocatedã€cachedã€uncachedã€‚

### page table

åœ¨ç‰©ç†å†…å­˜ä¸­å­˜æ”¾ç€ä¸€å¼  *page table*ï¼Œè™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„æ¯ä¸ª page éƒ½å¯¹åº” page table ä¸­çš„ä¸€é¡¹ (*page table entry*, PTE)ã€‚æ¯ä¸€é¡¹åŒ…å«ä¸€ä¸ª valid bit å’Œä¸€ä¸ªåœ°å€ï¼š

-   cached: valid bit setï¼Œåœ°å€ä¸ºè¯¥ page çš„ç¼“å­˜çš„ç‰©ç†åœ°å€
-   uncached: valid bit not setï¼Œåœ°å€æŒ‡å‘ç£ç›˜ä¸Šçš„ virtual page
-   unallocated: valid bit not setï¼Œåœ°å€ä¸º null

### page fault

åœ¨åœ°å€ç¿»è¯‘æ—¶ï¼ŒMMU ä¼šæŸ¥çœ‹ä¼ å…¥çš„è™šæ‹Ÿåœ°å€å¯¹åº”çš„ PTEï¼Œè‹¥ cachedï¼Œåˆ™ç§°ä½œ *page hit*ï¼Œå°±ä¼šå°† PTE å­˜å‚¨çš„ç‰©ç†åœ°å€ä¼ ç»™ main memoryï¼›å¦åˆ™ï¼Œå°±æ˜¯ cache missï¼Œåœ¨è™šå­˜ä¸­è¢«ç§°ä½œ *page fault*ã€‚

page fault æ˜¯ä¸€ä¸ª exceptionï¼Œä¼šè§¦å‘ kernel ä¸­çš„ page fault handlerã€‚page fault handler ä¼šåœ¨ physical memory ä¸­é€‰æ‹©ä¸€ä¸ª physical pageï¼ˆvictim pageï¼‰ç”¨æ¥å­˜è¿™ä¸ªè§¦å‘ page fault çš„ pageï¼Œå…ˆå°† victim page åŸæœ‰çš„æ•°æ®åœ¨å¿…è¦æ—¶æ”¾å›ç£ç›˜ï¼Œç„¶åå°†æ–°çš„æ•°æ®å­˜å…¥ victim pageï¼Œå†ç›¸åº”åœ°ä¿®æ”¹ page table ä¸­çš„è¿™ä¸¤ä¸ª PTEï¼Œä½¿å¾— victim page åŸæ¥å­˜çš„é‚£ä¸ª virtual page å˜ä¸º uncachedï¼Œè€Œæ–°å­˜å…¥çš„ virtual page å˜ä¸º cached å¹¶ä¸”åœ°å€æŒ‡å‘ victim pageã€‚page fault handler çš„æœ€ç»ˆæ•ˆæœå°±æ˜¯ï¼Œä¸€å¼€å§‹æƒ³è¦çš„ virtual page å·²ç» cachedï¼Œäºæ˜¯åœ¨è¿”å›åˆ° exception è§¦å‘çš„ä½ç½®æ—¶å°±å¯ä»¥ page hit è€Œæ­£å¸¸è¯»å–æ•°æ®äº†ã€‚

åœ¨ç£ç›˜å’Œå†…å­˜é—´ä¼ é€’æ•°æ®åœ¨è™šå­˜ä¸­è¢«ç§°ä½œ *swapping* æˆ– *paging*ï¼š

> Pages are *swapped in* (*paged in*) from disk to DRAM, and *swapped out* (*paged out*) from DRAM to disk.

è™šå­˜çš„ cache miss æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œä½†ç”±äºç¨‹åºè®¿é—®å†…å­˜çš„ localityï¼Œä¸€èˆ¬æ¥è¯´ page fault å¾ˆå°‘è§¦å‘ï¼Œæ•ˆç‡å°±ä¸ä¼šå¤ªå·®ã€‚ä¸æ–­è§¦å‘ page fault çš„æƒ…å†µç§°ä½œ *thrashing*ï¼Œä¼šå¤§å¤§å½±å“ç¨‹åºçš„æ•ˆç‡ã€‚

## VM as a Tool for Memory Management

å®é™…ä¸Šï¼Œpage table åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­å¹¶éåªæœ‰ä¸€ä»½ï¼Œè€Œæ˜¯æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä»½ï¼Œå¹¶ä¸”å¯ä»¥æŠŠåŒä¸€ä¸ª physical page æ˜ å°„åˆ°ä¸åŒè¿›ç¨‹ä¸­çš„å¤šä¸ª virtual pageã€‚

è™šå­˜ä¸ºå†…å­˜ç®¡ç†æä¾›äº†å¦‚ä¸‹çš„ä¾¿åˆ©ï¼š

-   ç®€åŒ–äº† linkingï¼Œä½¿å¾—é“¾æ¥æ—¶æ— éœ€è€ƒè™‘å…·ä½“çš„ç‰©ç†åœ°å€ï¼Œä¸åŒç¨‹åºå¯ä»¥ä½¿ç”¨åŒæ ·çš„è™šæ‹Ÿåœ°å€åˆ†é…æ–¹æ¡ˆã€‚
-   ç®€åŒ–äº† loadingï¼Œä½¿å¾—åŠ è½½ç¨‹åºæ—¶åªéœ€å°†å¯æ‰§è¡Œæ–‡ä»¶çš„æ®µè½æ˜ å°„åˆ°è™šå­˜ä¸­ï¼Œä¸ç”¨æ‹·è´æ•°æ®ï¼Œç­‰è®¿é—®åˆ°æŸä¸ª page æ—¶æ‰ä¼š page inã€‚è¿™æ ·çš„å°†æ–‡ä»¶å†…å®¹æ˜ å°„åˆ°è™šå­˜ä¸­çš„æ“ä½œç§°ä½œ [memory mapping](#memory-mapping)ï¼ŒLinux æä¾›äº† \`mmap\` system call æ¥è¿›è¡Œ memory mappingã€‚
-   ç®€åŒ–äº†å†…å­˜å…±äº«ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥å°†è¿›ç¨‹ç§æœ‰çš„æ•°æ®æ˜ å°„åˆ°ä¸åŒçš„ physical pageï¼Œè€Œå°†å…±äº«çš„æ•°æ®æ˜ å°„åˆ°ç›¸åŒçš„ physical pageã€‚
-   ç®€åŒ–äº†å†…å­˜åˆ†é…ï¼Œå› ä¸ºåº”ç”¨è¯·æ±‚ä¸€æ®µè¿ç»­çš„ virtual pages æ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥å°†å…¶æ˜ å°„åˆ°ä¸è¿ç»­çš„ physical pagesã€‚

## VM as a Tool for Memory Protection

-   è™šå­˜å¯ä»¥è½»æ¾åœ°ç»™ä¸åŒçš„è¿›ç¨‹æä¾›ä¸åŒçš„ç§æœ‰å†…å­˜ç©ºé—´ã€‚
-   é€šè¿‡ç»™ PTE æ·»åŠ  permission bit \`SUP\`ã€\`READ\`ã€\`WRITE\`ï¼Œå°±å¯ä»¥ä½¿æŸä¸ª page åªè¯»æˆ–è€…åªèƒ½åœ¨ kernel mode ä¸‹è¢«è®¿é—®ã€‚å¦‚æœè¯•å›¾è®¿é—®ä¸€ä¸ª page æ—¶æƒé™å‡ºé”™ï¼Œåˆ™ä¼šè§¦å‘ CPU çš„ general protection exceptionï¼Œè¿›è€Œç”± exception handler å‘è¿›ç¨‹å‘é€ SIGSEGVã€‚

## Address Translation

ä¸€ä¸ªå†…å­˜åœ°å€å¯ä»¥è¢«åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œè™šæ‹Ÿåœ°å€è¢«åˆ†ä¸ºé«˜ä½çš„ *virtual page number* (VPN) å’Œä½ä½çš„ *virtual page offset* (VPO)ï¼Œç‰©ç†åœ°å€è¢«åˆ†ä¸º PPN å’Œ PPOã€‚

CPU ä¸­æœ‰ä¸€ä¸ª *page table base register* (PTBR)ï¼ŒæŒ‡å‘ page table çš„èµ·å§‹åœ°å€ã€‚åœ°å€ç¿»è¯‘æ—¶ï¼ŒMMU é€šè¿‡ PTBR å’Œ VPN å¾—åˆ° PTE çš„åœ°å€ï¼Œä» main memory è·å– PTEï¼Œæ ¹æ® valid bitï¼Œè¦ä¹ˆè§¦å‘ page faultï¼Œè¦ä¹ˆè·å–åˆ° PPNï¼Œè€Œ PPO = VPOï¼Œå°±å¾—åˆ°äº†ç‰©ç†åœ°å€ã€‚

SRAM cache ä¸€èˆ¬ä¼šä»¥ç‰©ç†åœ°å€æ¥ cache main memoryï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡ PTE çš„åœ°å€è®¿é—® PTEã€é€šè¿‡ç‰©ç†åœ°å€è®¿é—® main memory æ—¶ä¼šé¦–å…ˆå°è¯•é€šè¿‡ SRAM cache æ¥è®¿é—®ã€‚

å¦‚æœæ¯æ¬¡éƒ½ä» main memory è·å– PTEï¼Œå³ä½¿åœ¨ L1 cache hit äº†æ•ˆç‡ä¹Ÿä¸å¤Ÿé«˜ï¼Œæ‰€ä»¥ MMU ä¸­è¿˜æœ‰ä¸€ä¸ªå°çš„ page table cacheï¼Œå«åš *translation lookaside buffer* (TLB)ã€‚VPN è¢«åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šä½ä½çš„ TLBI (index) å’Œé«˜ä½çš„ TLBT (tag)ï¼Œå…¶ä¸­ TLBI ç”¨æ¥é€‰æ‹© cache setï¼ŒTLBT ç”¨æ¥è¿›è¡Œ cache line matchingã€‚åœ¨åœ°å€ç¿»è¯‘æ—¶ï¼Œä¼šä¼˜å…ˆæŸ¥è¯¢ TLBï¼Œè‹¥ miss å†æŸ¥è¯¢ page tableã€‚

åœ°å€ç©ºé—´å¾€å¾€å¾ˆå¤§ï¼Œå¦‚æœåªç”¨ä¸€å¼  page tableï¼Œé‚£ä¹ˆ page table æœ¬èº«å°±ä¼šå ç”¨å¤§é‡çš„ç©ºé—´ï¼Œæ‰€ä»¥å¯ä»¥å°† page table åˆ†å±‚ï¼Œæ¯å±‚ page table æŒ‡å‘ä¸‹ä¸€å±‚ page tableï¼Œç›´åˆ°æœ€åä¸€å±‚æŒ‡å‘ VP / PPã€‚

## Case Study: Core i7 Address Translation

Core i7 memory system å¦‚ CS:APP Figure 9.21 æ‰€ç¤ºï¼š

![The Core i7 memory system](csapp-fig9.21.png)

Core i7 ä½¿ç”¨ 48-bit çš„è™šæ‹Ÿåœ°å€ç©ºé—´å’Œ 52-bit çš„ç‰©ç†åœ°å€ç©ºé—´ï¼Œpage size å¯ä»¥è®¾ç½®ä¸º 4KB æˆ– 4MBï¼Œæœ‰å››çº§ page tableã€‚

æ¯ä¸ª PTE æœ‰ä»¥ä¸‹å†…å®¹ï¼šï¼ˆè¿˜æœ‰ä¸€äº›å…¶ä»–å†…å®¹ï¼‰

-   P: valid bit
-   R/W: æ˜¯å¦åªè¯»
-   U/S: æ˜¯å¦éœ€è¦åœ¨ kernel mode ä¸‹è®¿é—®
-   XD: æ˜¯å¦å¯ä»¥è¢«è¯»å–æŒ‡ä»¤ï¼ˆæ˜¯å¦å¯æ‰§è¡Œï¼‰
-   A: reference bitï¼Œè®¿é—®åˆ°æ—¶ç”± MMU è®¾ç½®ï¼Œè€Œç”±è½¯ä»¶æ¸…é™¤ï¼ˆå¯ä»¥ç”¨äº replacement algorithmï¼‰
-   Base addr: child page table / physical page çš„åœ°å€çš„é«˜ä½ 40 bitsï¼ˆå‰©ä¸‹ 12 bits å³ 4KBï¼Œè¿™è¦æ±‚åœ°å€ä»¥ 4KB å¯¹é½ï¼Œè€Œ page size ä¸€èˆ¬å°±æ˜¯ 4KBï¼‰

L1 page table è¿˜æœ‰ä¸€é¡¹ PS ç”¨æ¥æŒ‡å®š page sizeã€‚

L4 page table è¿˜æœ‰ dirty bit D ç”¨æ¥è¡¨ç¤º page è¢«å†™å…¥è¿‡éœ€è¦è¢« swap out (write back)ï¼Œä»¥åŠ G è¡¨ç¤º global page å³åˆ‡æ¢è¿›ç¨‹æ—¶ä¸ä» TLB ä¸­ evict æ‰ã€‚

VPN æœ‰ 36 bitsï¼Œæ¯ 9 bits ç”¨æ¥è®¿é—®ä¸€çº§ page tableã€‚

å› ä¸º L1 cache æ˜¯ 8-way 32KB çš„ï¼Œæ­£å¥½æœ‰ 12 bits ç”¨æ¥é€‰æ‹© cache setï¼Œæ‰€ä»¥åœ¨è·å– PPN çš„åŒæ—¶å°±å¯ä»¥æŠŠ VPO å‘é€ç»™ L1 cache æ¥æå‰é€‰æ‹©å¥½ cache setã€‚

## Linux Virtual Memory System

kernel çš„è™šå­˜ä¸­åŒ…å«ï¼š

-   kernel çš„ä»£ç ä»¥åŠå…¨å±€çš„æ•°æ®ç»“æ„

-   å°†æ•´ä¸ªç‰©ç†å†…å­˜è¿ç»­åœ°æ˜ å°„åˆ°è™šå­˜ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®ç‰¹å®šçš„ç‰©ç†åœ°å€

-   å’Œæ¯ä¸ªè¿›ç¨‹ç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ page tableã€kernel stackã€\`task_struct\` ç­‰

    ï¼ˆP.S. è¿™éƒ¨åˆ†è™½ç„¶æ˜¯å’Œæ¯ä¸ªè¿›ç¨‹ç›¸å…³ï¼Œä½†å¹¶ä¸ä¼šåœ¨æ¯ä¸ªè¿›ç¨‹ä¸­æœ‰æ‰€ä¸åŒï¼ŒCS:APP ä¸­è¿™é‡Œå†™é”™äº†ï¼Œåœ¨ errata ä¸­æŒ‡å‡ºäº†ï¼‰

Linux å°†è™šå­˜åˆ’åˆ†ä¸ºè‹¥å¹² *area*ï¼ˆä¹Ÿç§° *segment*ï¼‰æ¥ç®¡ç†ï¼Œä¾‹å¦‚ code segmentã€data segmentã€heapã€shared library segmentï¼Œæ¯ä¸ª area æ˜¯è™šå­˜ä¸­è¿ç»­çš„ä¸€æ®µã€‚

kernel ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤äº†ä¸€ä¸ª \`task_struct\`ï¼Œå…¶ä¸­çš„ \`mm\` ä¸€é¡¹æ˜¯ä¸€ä¸ª \`mm_struct\`ã€‚\`mm_struct\` çš„ \`pgd\` ä¸€é¡¹æ˜¯ L1 page table çš„åœ°å€ï¼Œè€Œ \`mmap\` æŒ‡å‘ä¸€ä¸ª \`vm_area_struct\`ã€‚æ¯ä¸ª \`vm_area_struct\` è¡¨ç¤ºä¸€ä¸ª areaï¼Œæœ‰ä»¥ä¸‹å‡ é¡¹ï¼ˆè¿˜æœ‰ä¸€äº›å…¶ä»–é¡¹ï¼‰ï¼š

-   \`vm_start\` / \`vm_end\`: æŒ‡å‘ area çš„å¼€å¤´ / ç»“å°¾
-   \`vm_page_prot\`: area ä¸­æ‰€æœ‰ page çš„ access permission
-   \`vm_flags\`: ä¸€äº› flagï¼Œä¾‹å¦‚è¿™ä¸ª area ä¸­çš„ page æ˜¯å¦è¢«æ‰€æœ‰è¿›ç¨‹å…±äº«
-   \`vm_prev\` / \`vm_next\`: æŒ‡å‘ç›¸é‚»çš„ \`vm_area_struct\`ï¼Œæ„æˆä¸€ä¸ªé“¾è¡¨

åœ¨å¤„ç† page fault æ—¶ï¼Œpage fault handler é¦–å…ˆä¼šæ£€æŸ¥åœ°å€æ˜¯å¦åœ¨æŸä¸ª area å†…ï¼ˆä¸åœ¨åˆ™è§¦å‘ segmentation faultï¼‰ï¼Œç„¶åä¼šæ£€æŸ¥æ˜¯å¦æœ‰è®¿é—®æƒé™ï¼ˆæ²¡æœ‰åˆ™è§¦å‘ protection exceptionï¼‰ï¼Œå¦‚æœä¸€åˆ‡ ok å°±ä¼šæ ¹æ® replacement algorithm é€‰æ‹© victim pageï¼Œè‹¥å…¶ dirty åˆ™å°†å…¶ swap outï¼Œç„¶åå°†æ–°çš„ page swap inï¼Œæœ€åæ›´æ–° page table å¹¶è¿”å›ã€‚

<Card type="question" title="segmentation fault vs protection exception">
segmentation fault å’Œ protection exception æœ‰åŒºåˆ«å—ï¼Ÿgeneral protection exception ä¸åº”è¯¥æ˜¯ CPU è§¦å‘çš„å—ï¼Œæ€ä¹ˆæ˜¯ page fault handler è§¦å‘ï¼Ÿsegmentation fault å’Œ SIGSEGV æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ

æˆ‘çš„ç†è§£æ˜¯ kernel æ”¶åˆ° CPU çš„ general protection exception ä¼šå‘è¿›ç¨‹å‘é€ SIGSEGVï¼Œä½† CS:APP è¿™é‡Œåœ¨ç›¸é‚»çš„ä¸¤æ®µåˆ†åˆ«ç”¨äº† â€œsegmentation faultâ€ å’Œ â€œprotection exceptionâ€ã€‚
</Card>

## Memory Mapping

å°†ä¸€ä¸ª *object* çš„å†…å®¹è®¾ä¸ºä¸€æ®µè™šå­˜çš„åˆå§‹å€¼ç§°ä½œ *memory mapping*ã€‚è¿™ä¸ª object å¯ä»¥æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­ä¸€ä¸ªæ–‡ä»¶çš„ä¸€æ®µ (*file-backed*)ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆå§‹ä¸ºç©ºçš„ *anonymous file* (*demand-zero*)ã€‚

åœ¨ map æ—¶å¹¶ä¸ä¼šç«‹å³å°†æ•°æ®æ”¾åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œè€Œæ˜¯ç­‰åˆ°è®¿é—®åˆ°æŸä¸ª page æ—¶å† swap inï¼Œè¿™ç§°ä½œ *demand paging*ã€‚æ“ä½œç³»ç»Ÿä¼šä½¿ç”¨ *swap file* æ¥è¿›è¡Œ swappingï¼Œä½†åªæœ‰è¿›è¡Œäº†ä¿®æ”¹æ‰ä¼šéœ€è¦ swap outï¼Œå¦åˆ™å¯ä»¥ç›´æ¥ä» map åˆ°çš„æ–‡ä»¶ swap inã€‚

å¦‚æœä¸åŒçš„è¿›ç¨‹æ˜ å°„åˆ°äº†åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€æ®µï¼Œåœ¨ç‰©ç†å†…å­˜ä¸­ä¼šåªæœ‰ä¸€ä»½æ•°æ®ã€‚

memory mapping æœ‰ shared å’Œ private ä¸¤ç§ï¼š

-   map as shared objects: ä¿®æ”¹å¯¹å…¶ä»–è¿›ç¨‹å¯è§ï¼Œå¦‚æœæ˜¯ file-backed è¿˜ä¼šå°†å†…å­˜ä¿®æ”¹åŒæ­¥åˆ°ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚
-   map as private objects: ä¿®æ”¹å¯¹å…¶ä»–è¿›ç¨‹ä¸å¯è§ï¼Œä¹Ÿä¸ä¼šåŒæ­¥åˆ°ç£ç›˜ä¸Šï¼Œå¹¶ä¸”æ˜¯ copy-on-write çš„ï¼šä¸€å¼€å§‹å°† PTE è®¾ä¸ºåªè¯»ï¼Œåœ¨è§¦å‘ protection exception åï¼Œexception handler å‘ç°è¿™ä¸ª area æ˜¯å¯ä»¥å†™å…¥ä½† private çš„ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„ pageï¼Œå°†åŸæ¥çš„ page å¤åˆ¶è¿‡å»ï¼Œå°† PTE è®¾ä¸ºå¯ä»¥å†™å…¥ã€‚

### fork çš„åŸç†

fork æ—¶ä¼šå°†åŸæ¥çš„ \`mm_struct\` ä»¥åŠ page table å¤åˆ¶ä¸€ä»½ï¼Œä½†æ˜¯å°†åŸæ¥çš„ private area ä¸­çš„ PTE å¯ä»¥å†™å…¥çš„é‡æ–°å˜ä¸ºåªè¯»ï¼Œä»è€Œåœ¨ä¹‹åå†å†™å…¥æ—¶é‡æ–°è§¦å‘ copy-on-writeï¼Œå°±åšåˆ°äº† parent å’Œ child ä¸€å¼€å§‹æœ‰ä¸€æ ·çš„æ•°æ®ä½†åç»­å†™å…¥ç‹¬ç«‹ã€‚åœ¨ fork å‰å°±åˆ›å»ºäº†çš„ shared area ä¼šç”±ä¸¤ä¸ªè¿›ç¨‹å…±äº«ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åœ¨ parent å’Œ child ä¹‹é—´é€šä¿¡ã€‚

### execve çš„åŸç†

1.  åˆ é™¤å½“å‰è¿›ç¨‹çš„æ‰€æœ‰ area (\`vm_area_struct\`)
2.  æ ¹æ® program header table è¿›è¡Œ memory mappingï¼š
    -   \`.init\`ã€\`.text\`ã€\`.rodata\`: private, file-backed, read-only
    -   \`.data\`: private, file-backed, read/write
    -   \`.bss\`ã€heapã€stack: private, demand-zero, read/write
3.  å¦‚æœæœ‰ link åˆ°å…±äº«åº“ï¼Œä¼šè¿›è¡ŒåŠ¨æ€é“¾æ¥ï¼Œå°†å…±äº«åº“ private, file-backed map
4.  ä¿®æ”¹ program counter

<Card title="å…³äºå…±äº«åº“çš„ map æ–¹å¼" fold type="info">

ä¸‹é¢æ˜¯ä¸€å°å‘é€äº 2022.12.18ï¼Œå°šæœªæ”¶åˆ°å›å¤çš„é‚®ä»¶ï¼š

> Dear Drs. Randy Bryant and Dave O'Hallaron,
> 
> I am a student at Tsinghua University and I am writing to ask a question about the book CS:APP3e.
> 
> In â€œ9.8.3 The execve Function Revisitedâ€ on page 837, it is stated that shared libraries are â€œmapped into the shared region of the userâ€™s virtual address spaceâ€. In Figure 9.31, it is stated that â€œMemory-mapped region for shared librariesâ€ are â€œShared, file-backedâ€.
> 
> However, I believe that shared libraries are actually mapped as private objects rather than shared objects. I have come to this conclusion for the following reasons:
> 
> 1.  If there is data in the shared library, it should be copy-on-write, and should not be shared among different processes.
> 2.  /proc/self/maps shows that all mappings to shared libraries of my shell are private.
> 3.  The source code and comments of dl-load indicate that the mapping should be private. (See https://github.com/bminor/glibc/blob/71e408e45dcacf429a94b2807f75aaadd8d37cb9/elf/dl-load.h#L32-L49 and https://github.com/bminor/glibc/commit/9b8a44cd18fbf1aedeb03e19f4bcdb06b0ee409b.)
> 
> I have checked the errata but did not find this issue addressed. I am writing to you in the hope that you can provide an explanation of this statement or add it to the errata. Thank you for your attention to this matter.
> 
> Sincerely,  
> Yufan You

</Card>

### mmap

\`void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset)\`

-   \`addr\`: area çš„èµ·å§‹åœ°å€ï¼Œä»…ä½œæç¤ºä½œç”¨ï¼Œä¸€èˆ¬ \`NULL\` å°±è¡Œ
-   \`length\`: area çš„é•¿åº¦
-   \`prot\`: \`PROT_EXEC\`ã€\`PROT_READ\`ã€\`PROT_WRITE\`ã€\`PROT_NONE\`
-   \`flags\`: æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨çš„æœ‰ \`MAP_SHARED\`ã€\`MAP_PRIVATE\`ã€\`MAP_ANONYMOUS\`
-   \`fd\`: map åˆ°çš„ file descriptor
-   \`offset\`: map åˆ°çš„æ–‡ä»¶å†…å®¹çš„ offsetï¼Œå¿…é¡»æ˜¯ page size çš„å€æ•°

åœ¨ \`MAP_ANONYMOUS\` æ—¶ï¼Œæœ€å¥½å°† \`fd\` è®¾ä¸º -1ã€\`offset\` è®¾ä¸º 0ï¼ˆåœ¨æœ‰çš„å®ç°ä¸­è¿™æ˜¯å¿…é¡»çš„ï¼‰ã€‚

å¤±è´¥æ—¶ \`mmap\` ä¼šè¿”å› \`MAP_FAILED\`ã€‚

\`int munmap(void *addr, size_t length)\`: å°†è‡ª \`addr\` èµ· \`length\` é•¿çš„èŒƒå›´å†…çš„ mapping åˆ é™¤ï¼Œä»¥åå†è®¿é—®å°±ä¼š segmentation faultã€‚\`addr\` å¿…é¡»æ˜¯ page size çš„å€æ•°ã€‚

## Dynamic Memory Allocation

### åŠ¨æ€åˆ†é…çš„ç›¸å…³å‡½æ•°

åœ¨ C è¯­è¨€ä¸­ï¼Œå¯ä»¥ç”¨ \`malloc\` å’Œ \`free\` æ¥è·å– / é‡Šæ”¾åŠ¨æ€åˆ†é…çš„å†…å­˜ã€‚å¯ä»¥ä½¿ç”¨ \`calloc\` æ¥åˆå§‹åŒ–åˆ†é…åˆ°çš„å†…å­˜å¹¶åœ¨ä½¿ç”¨ä¹˜æ³•è®¡ç®—å†…å­˜å¤§å°æ—¶æ£€æµ‹æ˜¯å¦å‘ç”Ÿæº¢å‡ºã€‚å¯ä»¥ä½¿ç”¨ \`realloc\` æ¥ç»™ä¸€å—åŠ¨æ€åˆ†é…çš„å†…å­˜è°ƒæ•´å¤§å°ã€‚è¯¦è§ \`man malloc\`ã€‚

ä¸ºäº†è®©åŠ¨æ€åˆ†é…å¾—åˆ°çš„å†…å­˜å¯ä»¥ç”¨äºä»»ä½•æ•°æ®ç±»å‹ï¼Œåœ°å€ä¼šä»¥ double word å¯¹é½ï¼Œå³ 32 ä½ç³»ç»Ÿå¯¹é½åˆ° 8 çš„å€æ•°ï¼Œ64 ä½ç³»ç»Ÿå¯¹é½åˆ° 16 çš„å€æ•°ã€‚

æ“ä½œç³»ç»Ÿä½¿ç”¨ \`brk\` æŒ‡é’ˆæ¥æŒ‡å‘ heap çš„ç»“å°¾ï¼Œå¯ä»¥é€šè¿‡ \`sbrk\` å‡½æ•°æ¥å¢å¤§ heapã€‚

### allocator çš„è¦æ±‚å’Œç›®æ ‡

Dynamic memory allocator ä¼šå°† heap åˆ’åˆ†ä¸ºè‹¥å¹²å¤§å°ä¸ç­‰çš„ blockï¼Œæ¯ä¸ª block è¦ä¹ˆ allocated è¦ä¹ˆ freeã€‚

allocator éœ€è¦åšåˆ°ï¼š

-   èƒ½å¤Ÿå¤„ç†ä»¥ä»»æ„é¡ºåºå‘é€çš„ allocate å’Œ free è¯·æ±‚ï¼ˆä¸èƒ½å¯¹é¡ºåºåšä»»ä½•å‡å®šï¼‰
-   ç«‹å³å¯¹è¯·æ±‚åšå‡ºå“åº”ï¼ˆä¸èƒ½ç¦»çº¿ï¼‰
-   åªä½¿ç”¨ heap å­˜å‚¨æ•°æ®ï¼ˆä¸èƒ½å°†æ•°æ®å­˜å‚¨åœ¨è™šå­˜çš„å…¶ä»–ä½ç½®ï¼‰
-   æ»¡è¶³å¯¹é½è¦æ±‚ï¼ˆèƒ½å¤Ÿå­˜å‚¨ä»»ä½•ç±»å‹çš„æ•°æ®ï¼‰
-   ä¸èƒ½ä¿®æ”¹æˆ–ç§»åŠ¨ allocated blockï¼ˆå¯ä»¥ä¿®æ”¹ free block æˆ–è€… heap ä¸­ä¸æ˜¯ block çš„åŒºåŸŸï¼‰

è€Œ allocator æœ‰ä¸¤ä¸ªæ€§èƒ½æ–¹é¢çš„ç›®æ ‡ï¼š

1.  æ›´å¿«åœ°å“åº”è¯·æ±‚ï¼ˆæ›´å¤§çš„ååé‡ï¼‰
2.  æ›´é«˜æ•ˆåœ°åˆ©ç”¨å†…å­˜

å…¶ä¸­ï¼Œå¯¼è‡´å†…å­˜åˆ©ç”¨ç‡ä½çš„ä¸»è¦åŸå› æ˜¯ *fragmentation*ï¼š

-   internal fragmentation: å®é™…åˆ†é…çš„ allocated block æ¯” alloc è¯·æ±‚ä¸­ç”³è¯·çš„å¤§
-   external fragmentation: æ‰€æœ‰ free block åŠ èµ·æ¥å¤§å°è¶³å¤Ÿï¼Œä½†æ¯å•ä¸ª free block éƒ½ä¸å¤Ÿå¤§ï¼Œå¯¼è‡´éœ€è¦ä½¿ç”¨æ›´å¤š heap ç©ºé—´

### ä¸€ç§ç®€å•çš„ allocator å®ç°æ–¹å¼

#### block header

allocator éœ€è¦è®°å½• block çš„ä¿¡æ¯ï¼Œè€Œåªèƒ½ä½¿ç”¨ heap ç©ºé—´ï¼Œæ‰€ä»¥ç›´æ¥åœ¨ block çš„å¼€å¤´è®°å½• block headerï¼Œå³ block size ä»¥åŠæ˜¯å¦ allocatedã€‚

å› ä¸ºåœ°å€æœ‰å¯¹é½è¦æ±‚ï¼Œblock size çš„æœ€ä½å‡ ä½ä¸€å®šæ˜¯ 0ï¼Œå°±å¯ä»¥ç”¨æœ€ä½ä½æ¥å­˜ allocated bitã€‚

block size å……å½“äº†å•å‘é“¾è¡¨çš„ä½œç”¨ã€‚å¦‚æœæƒ³è®¿é—® free blockï¼Œå°±å¾—è®¿é—®æ¯ä¸ª block å†çœ‹æ˜¯å¦ freeï¼Œæ‰€ä»¥è¿™æ ·çš„ç»“æ„è¢«ç§°ä½œ *implicit free list*ã€‚

#### placement policy

allocate æ—¶éœ€è¦æ‰¾åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ free blockï¼Œallocator è¿›è¡Œè¿™æ ·çš„æœç´¢çš„æ–¹å¼ç§°ä½œ *placement policy*ï¼š

-   first fitï¼šä»å¤´å¼€å§‹æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ free block
-   next fitï¼šä»ä¸Šæ¬¡æœç´¢ç»“æŸçš„åœ°æ–¹å¼€å§‹æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ free block
-   best fitï¼šéå†æ‰€æœ‰ free blockï¼Œä½¿ç”¨è¶³å¤Ÿå¤§çš„ free block ä¸­æœ€å°çš„

ä½¿ç”¨ implicit free list æ—¶ï¼Œnext fit æ¯” first fit ååé‡æ›´å¤§ä½†å†…å­˜åˆ©ç”¨ç‡æ›´ä½ï¼Œbest fit å†…å­˜åˆ©ç”¨ç‡æœ€å¥½ä½†ååé‡æœ€å·®ã€‚

#### åˆ†å‰² free block

å¦‚æœ allocate æ—¶ free block çš„å‰©ä½™ç©ºé—´æ¯”éœ€è¦çš„ç©ºé—´å¤§ï¼Œä¸”å¤§çš„è¶…è¿‡ä¸€ä¸ª block çš„ minimum size (double word)ï¼Œå°±å¯ä»¥å°†è¿™ä¸ª block åˆ†ä¸ºä¸¤åŠï¼Œä¸€åŠç”¨ä½œ allocated blockï¼Œå¦ä¸€åŠä¸º free blockã€‚

#### è·å–æ›´å¤šçš„ heap ç©ºé—´

å¦‚æœå·²æœ‰çš„ heap ç©ºé—´æ— æ³•æ»¡è¶³ allocate è¯·æ±‚ï¼Œå¯ä»¥ä½¿ç”¨ \`sbrk\` æ¥è·å–æ›´å¤šçš„ heap ç©ºé—´ï¼Œå¹¶å°†æ–°å¾—åˆ°çš„ç©ºé—´è®¾ä¸º free blockã€‚

#### åˆå¹¶ free block

å¦‚æœå¾ˆå¤š free block ç›¸é‚»åœ°æ”¾åœ¨ä¸€èµ·ï¼Œå¯èƒ½ä¼šé€ æˆ *false fragmentation*ï¼Œå³åˆå¹¶åèƒ½æ”¾ä¸‹ä½†æ¯ä¸ªå•ç‹¬æ— æ³•æ”¾ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å¯¹ç›¸é‚»çš„ free block è¿›è¡Œåˆå¹¶ (coalesce)ã€‚

åˆå¹¶æœ‰ä¸¤ç§ç­–ç•¥ï¼š

-   immediate coalescingï¼šæ¯æ¬¡ free æ—¶éƒ½å°†æ–°å¾—åˆ°çš„ free block ä¸ç›¸é‚»çš„ free block åˆå¹¶ï¼Œè¿™æ ·çš„è¯æ¯æ—¶æ¯åˆ»éƒ½ä¸ä¼šæœ‰ç›¸é‚»çš„ free block
-   deferred coalescingï¼šç­‰åˆ°æŸä¸ªæ—¶å€™å†åˆå¹¶ï¼Œä¾‹å¦‚åœ¨æœªèƒ½æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ free block æ—¶

immediate coalescing çš„å®ç°è¾ƒä¸ºç®€å•ï¼Œå¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…å®Œæˆï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´åå¤çš„åˆå¹¶å’Œåˆ†å‰²ï¼Œå¸¦æ¥ä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚

åˆå¹¶æ—¶éœ€è¦çŸ¥é“ä¸Šä¸€ä¸ª block çš„ä¿¡æ¯ï¼Œè¿™å¯ä»¥é€šè¿‡åœ¨ block å°¾éƒ¨æ·»åŠ ä¸€ä¸ªä¸ header å†…å®¹ç›¸åŒçš„ footer æ¥å®ç°ï¼Œè¿™è¢«ç§°ä½œä½¿ç”¨ *boundary tags*ã€‚ç”±äºåªæœ‰ free block éœ€è¦ footerï¼Œå¯ä»¥çœå» allocated block çš„ footerï¼Œè€Œåœ¨ header ä¸­å­˜å‚¨ä¸Šä¸€å—çš„ allocated bitï¼Œæ¥èŠ‚çœç©ºé—´ã€‚

### explicit free list

å¯ä»¥åœ¨ free block ä¸­å­˜å‚¨æŒ‡å‘å‰é©±åç»§çš„æŒ‡é’ˆæ¥ç»´æŠ¤ä¸€ä¸ª free block çš„é“¾è¡¨ï¼Œç§°ä½œ *explicit free list*ã€‚

è¿™ä¸ª list å¯ä»¥æ˜¯ LIFO çš„æˆ–è€…æŒ‰åœ°å€é¡ºåºçš„ã€‚LIFO çš„ list å¯ä»¥åœ¨å¸¸æ•°æ—¶é—´å†…å®Œæˆ free æ“ä½œï¼Œè€ŒæŒ‰åœ°å€é¡ºåºçš„ list éœ€è¦ä½¿ç”¨çº¿æ€§æ—¶é—´æ¥æ‰¾åˆ°ä¸€ä¸ª block åœ¨ list ä¸­çš„ä½ç½®ï¼Œä½†å†…å­˜åˆ©ç”¨ç‡æ›´é«˜ã€‚

ç”±äºéœ€è¦è¶³å¤Ÿå¤§çš„ç©ºé—´æ¥å­˜å‚¨å‰é©±åç»§çš„æŒ‡é’ˆï¼Œexplicit free list çš„ minimum block size æ›´å¤§ï¼Œå¯èƒ½ä¼šå‡ºç°æ›´ä¸¥é‡çš„ internal fragmentation å¯¼è‡´å†…å­˜åˆ©ç”¨ç‡ä¸‹é™ã€‚

### segregated free lists

å¯ä»¥å°† block æŒ‰ size åˆ†ç±»ï¼Œä¾‹å¦‚æŒ‰ 2 çš„æ¬¡å¹‚åˆ†ç±»ï¼Œæ¯ä¸€ç±»ç»´æŠ¤ä¸€ä¸ª listã€‚å…·ä½“å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ simple segregated storage å’Œ segregated fitsã€‚

#### simple segregated storage

æ¯ä¸€ç±»çš„æ‰€æœ‰ block éƒ½æ˜¯è¿™ä¸€ç±»çš„æœ€å¤§ sizeï¼Œå¦‚æœä¸€ç±» block ç”¨å…‰äº†å°±ç”³è¯·æ–°çš„ heap ç©ºé—´ï¼Œfree æ—¶ç›´æ¥æ”¾å›ç›¸åº”çš„ listï¼Œä¸åˆå¹¶ä¹Ÿä¸åˆ†å‰²ã€‚

è¿™æ ·çš„è¯ï¼Œheader å’Œ footer éƒ½ä¸éœ€è¦äº†ï¼Œåªéœ€åœ¨ free block é‡Œå­˜æ”¾ä¸€ä¸ªåç»§æŒ‡é’ˆå³å¯ï¼Œä½† internal fragmentation å’Œ external fragmentation éƒ½å¾ˆä¸¥é‡ã€‚

#### segregated fit

æ¯ä¸€ç±»ä¸­æœ‰ä¸åŒå¤§å°çš„ blockï¼Œæœ‰åˆ†å‰²å’Œåˆå¹¶ã€‚allocate æ—¶ä»ç›¸åº”çš„ç±»åˆ«å¼€å§‹æ‰¾ï¼Œåœ¨ä¸€ç±»ä¸­æ‰¾ä¸åˆ°å°±ç»§ç»­æ‰¾ä¸‹ä¸€ç±»ï¼Œè¿™æ ·è¿‘ä¼¼äº best-fit searchï¼Œä½†é€Ÿåº¦å¾ˆå¿«ã€‚

segregated fit çš„ç»¼åˆæ€§èƒ½è¾ƒå¥½ï¼Œæ‰€ä»¥åŒ…æ‹¬ libc ä¸­çš„ \`malloc\` å‡½æ•°åœ¨å†…çš„ allocator å¾€å¾€é€‰æ‹©ä½¿ç”¨ segregated fitã€‚

#### buddy system

æ‰€æœ‰ block size éƒ½æ˜¯ 2 çš„æ¬¡å¹‚ï¼Œåˆ†å‰²æ—¶æ¯æ¬¡åˆ†æˆä¸¤åŠç›´åˆ°å¤§å°åˆé€‚ï¼Œåˆå¹¶æ—¶åªå’Œ â€œbuddyâ€ åˆå¹¶ã€‚

è¿™é‡Œæè¿°æ¸…æ¥šå¯èƒ½æ¯”è¾ƒå¤æ‚ï¼Œå°±æ„Ÿæ€§ç†è§£ä¸€ä¸‹ï¼Œæ‰€æœ‰çš„ block ä¼šå½¢æˆä¸€ä¸ªå¦‚ä¸‹å›¾æ‰€ç¤ºæ ‘çŠ¶çš„æ ·å­ï¼ˆæœ‰ç‚¹æ ‘çŠ¶æ•°ç»„çš„æ„Ÿè§‰ï¼‰ï¼Œparent ç›¸åŒçš„ block å°±æ˜¯ buddyã€‚

![buddy system](buddy-system.png)

è¿™æ ·çš„è¯ï¼Œæœç´¢å’Œåˆå¹¶ä¼šæ¯”è¾ƒå¿«é€Ÿï¼Œä½†ç”±äº block size éƒ½æ˜¯ 2 çš„æ¬¡å¹‚ï¼Œå¯èƒ½å‡ºç°ä¸¥é‡çš„ internal fragmentationã€‚

### å¹³è¡¡æ ‘ç»´æŠ¤ free block

CS:APP ä¸­æ²¡æœ‰æåˆ°è¿™ç§æ–¹å¼ï¼Œä½†åªè¦ç†è§£äº†ä¸Šé¢è¿™å‡ ç§ free listï¼Œå°±å¾ˆå¥½ç†è§£ï¼Œfree block ä¸ä¸€å®šè¦ç”¨é“¾è¡¨ç»´æŠ¤ï¼Œä¹Ÿå¯ä»¥ç”¨å¹³è¡¡æ ‘ç»´æŠ¤ï¼šåœ¨ free block ä¸­å­˜æ”¾æ ‘çš„èŠ‚ç‚¹æ‰€éœ€çš„ childrenã€parent ç­‰ä¿¡æ¯ï¼Œå°±å¯ä»¥é«˜æ•ˆå®ç°ä¸¥æ ¼çš„ best fitï¼Œå¤æ‚åº¦ä¹Ÿä¸ä¼šåƒ segregated fit ä¸€æ ·åœ¨æç«¯æƒ…å†µä¸‹å‘ç”Ÿé€€åŒ–ã€‚ä½†æ˜¯æ ‘çš„èŠ‚ç‚¹éœ€è¦çš„ä¿¡æ¯å¾€å¾€æ¯”é“¾è¡¨å¤šï¼Œå¯èƒ½ä¼šè®© minimum block size å¢å¤§åˆ° 6 ä¸ª wordã€‚

æˆ‘è‡ªå·±å†™ malloc lab çš„æ—¶å€™è¯•ç€å†™äº†ä¸ª Splayï¼Œå‘ç°ä¸€èˆ¬æƒ…å†µä¸‹è¿˜æ˜¯æ¯” segregated fit æ…¢ä¸å°‘ï¼Œå†…å­˜åˆ©ç”¨ç‡ä¹Ÿä¸ä¸€å®šæœ‰æ˜æ˜¾æå‡ï¼Œä¸çŸ¥é“å…¶ä»–å¹³è¡¡æ ‘ / ç‰¹æ®Šåœºæ™¯ä¸‹æ€§èƒ½å¦‚ä½•ã€‚å€’æ˜¯åœ¨ç½‘ä¸Šçœ‹åˆ°æœ‰è¯´çº¢é»‘æ ‘å¯ä»¥åœ¨ malloc lab æ‹¿é«˜åˆ†ï¼ˆ~~è°ç”¨å¥½çš„ç®—æ³•æ‹¿é«˜åˆ†å•Šï¼Œä¸æ˜¯è€ƒéªŒå¯¹ç€æ•°æ®è°ƒå‚çš„èƒ½åŠ›å—ï¼Œæˆ‘è§‰å¾—æˆ‘å¯¹æ•°æ®è¿‡æ‹Ÿåˆçš„ segregated fit åˆ†å·²ç»å¤Ÿé«˜äº†~~ï¼‰ï¼ˆ~~è™šå‡çš„ segregated fitï¼šæŒ‰ block size segregate æ¥å¯»æ‰¾ fitï¼›çœŸæ­£çš„ segregated fitï¼šæŒ‰æµ‹è¯•æ•°æ® segregate åˆ†åˆ«è¿›è¡Œ fit~~ï¼‰ã€‚

## Garbage Collection

å¯ä»¥é€šè¿‡ block ä¹‹é—´ä»¥åŠ stackã€registerã€global å˜é‡å¯¹ block çš„å¼•ç”¨å…³ç³»æ‰¾åˆ°ä¸å¯è¾¾çš„ block è€Œè¿›è¡Œ garbage collectionã€‚

åœ¨ C ä¸­ï¼Œç”±äºæ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œå¯èƒ½ä¼šå°†éæŒ‡é’ˆç±»å‹çš„æ•°æ®è§†ä½œå¯¹ block çš„å¼•ç”¨ï¼Œå¯¼è‡´ä¸å¯è¾¾çš„ block è¢«è§†ä½œå¯è¾¾ï¼Œæ‰€ä»¥ C è¯­è¨€çš„ garbage collection åªèƒ½æ˜¯ conservative çš„ã€‚
`},{title:k,tags:"æ¸¸æ³³ ç»éªŒåˆ†äº«",content:`è¿™å­¦æœŸé€‰äº†æ¸¸æ³³é›¶åŸºç¡€ç­ä½œä¸ºä½“è‚²è¯¾ã€‚ä¸€å¼€å§‹çš„æ—¶å€™åªæ˜¯ç•¥ä½äºå¹³å‡æ°´å¹³ï¼Œä½†åˆ°åæ¥å­¦ä¹ æ¢æ°”çš„æ—¶å€™ï¼Œåœ¨ 20~40m å·¦å³å¡äº†å¾ˆä¹…ï¼Œæœ€åèƒ½è¿ç»­æ¸¸ 50m æ¯”ç­ä¸Šå€’æ•°ç¬¬äºŒæ™šäº†ä¸‰èŠ‚è¯¾ã€‚

åœ¨ä½“è‚²æ–¹é¢ä¼šå«åº•æ˜¯æˆ‘é¢„æ–™ä¹‹ä¸­çš„ï¼Œä½†æ¯”å€’æ•°ç¬¬äºŒå·®å¤ªå¤šï¼Œé•¿æœŸå’Œç­ä¸ŠåŒå­¦åˆ†å¼€ä¸Šè¯¾ï¼Œè¿˜æ˜¯æŒºéš¾å—çš„ã€‚ä½†æ˜¯ï¼Œè¿™æ®µç»å†ä¹Ÿè®©æˆ‘æœ‰äº†ä¸°å¯Œçš„å¤±è´¥ç»éªŒï¼ˆï¼Œå¯ä»¥æ°´ä¸€ç¯‡è¸©å‘è®°å½•ï¼Œå¹¸è¿çš„è¯å¯èƒ½è¿˜èƒ½åœ¨æœªæ¥å¸®åˆ°æŸäººã€‚



åœ¨è¿‡ç¨‹ä¸­ï¼Œè€å¸ˆä¸æ–­å’Œæˆ‘è¯´â€œå¤ªç´§å¼ äº†â€â€œè¦åšæŒä¸‹æ¥â€â€œå‘›åˆ°æ°´ã€æ¢æ°”ä¸å……åˆ†è¦å­¦ä¼šè°ƒæ•´ï¼Œä¸è¦æ€»æ˜¯åœä¸‹æ¥â€â€œä¸ºä»€ä¹ˆåœä¸‹æ¥å‘¢â€ï¼ˆä¹Ÿæœ‰åŠ¨ä½œçº æ­£ï¼Œåªä¸è¿‡åœ¨è¿™ä¹‹å‰æœ‰å¾ˆå¤š PUAï¼‰ï¼Œä½†åœ¨æœ€åå­¦ä¼šä¹‹åï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—ï¼Œæ­£ç¡®çš„åŠ¨ä½œè¿œèƒœäºç›²ç›®çš„ç»ƒä¹ ï¼Œæ›´åˆ«æç„å­¦çš„ã€Šå¿ƒæ€ã€‹äº†ã€‚æ¯”èµ·å‡ºé—®é¢˜åå­¦ä¼šè°ƒæ•´ï¼Œä¸å‡ºé—®é¢˜æ‰æ˜¯æœ€é‡è¦çš„ã€‚

ä¸çŸ¥é“å¿ƒæ€ã€æ¯…åŠ›åœ¨æ¸¸å‡ ç™¾ç±³æ—¶æœ‰å¤šé‡è¦ï¼Œä½†å¦‚æœå‡ èŠ‚è¯¾éƒ½æ²¡ä»€ä¹ˆè¿›æ­¥ã€50m éƒ½æ¸¸ä¸ä¸‹æ¥ï¼Œå¾ˆå¯èƒ½è¿˜æ˜¯åŠ¨ä½œæœ‰é—®é¢˜ã€‚

è™½ç„¶æ•´ä¸ªè¿‡ç¨‹å¾ˆè‰°è¾›ï¼Œä½†æ€»ç»“èµ·æ¥ä¹Ÿæ²¡å¤šå°‘ä¸œè¥¿ï¼Œå°±æ˜¯ä¸‹é¢è¿™å‡ ç‚¹ï¼š

1.  åœ¨æŠ¬å¤´æ¢æ°”å‰ï¼Œè¦å…ˆåœ¨æ°´ä¸‹æŠŠæ°”åå¹²å‡€ã€‚å¼€å§‹åæ°”çš„æ—¶æœºå¤§æ¦‚æ˜¯æ¢æ°”å‰æœ€åä¸€æ¬¡è¹¬è…¿æ—¶ã€‚
2.  å¦‚æœè¹¬å¤ªå¤šæ¬¡è…¿å†æ¢æ°”ï¼Œå¯èƒ½ä¼šæ°”ä¸å¤Ÿï¼Œå¯ä»¥åªè¹¬ 1~2 æ¬¡è…¿å°±æ¢æ°”ã€‚
3.  æ¢æ°”åä¸‹æ²‰æ˜¯æ­£å¸¸çš„ï¼Œæ¢æ°”åç«‹å³è¹¬ä¸€æ¬¡è…¿å¯ä»¥ç¼“è§£ä¸‹æ²‰ã€‚
4.  åˆ’æ‰‹æ—¶ï¼Œè¦ä»¥åˆé€‚çš„è§’åº¦å¾€ä¸‹æ’‘ï¼Œå‡­å€Ÿä¸‹æ’‘çš„åä½œç”¨åŠ›è®©å¤´æŠ¬èµ·æ¥ã€‚å¦åˆ™ï¼Œå¦‚æœå•é ä¸‹å·´å’Œè…°ï¼Œå¤´å°±å¾ˆéš¾æŠ¬é«˜ï¼Œä»è€Œæ²¡æœ‰å……åˆ†çš„æ—¶é—´æ¢æ°”ã€‚
5.  è™½ç„¶å¸æ°”åªç”¨å˜´ï¼Œä½†åæ°”æ—¶å¯ä»¥é€‚å½“ç”¨é¼»å­è¾…åŠ©ï¼Œä¹Ÿå¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢é¼»å­è¿›æ°´ã€‚
6.  å˜´å·´è¦å¼ å¤§ï¼Œç±»ä¼¼äºæ‰“å“ˆæ¬ çš„ç¨‹åº¦ï¼Œä»¥è‡³äºå¸æ°”æ—¶æ„Ÿå—ä¸åˆ°æ°”æµã€‚å¦‚æœå˜´å¼ çš„å°ï¼Œå°±å®¹æ˜“æ¢æ°”ä¸å……åˆ†æˆ–è€…å‘›åˆ°æ°´ï¼Œæ—¶é—´ä¹…äº†ä¹Ÿå®¹æ˜“ç´¯ã€ä¸é€‚ã€‚ä¸€å¼€å§‹è€å¸ˆè·Ÿæˆ‘è¯´è¦å¼ å¤§çš„æ—¶å€™æˆ‘è¿˜ä»¥ä¸ºæ˜¯ä» wo å¼ å¤§åˆ° oï¼Œåæ¥æ‰çŸ¥é“è¦åˆ°æ‰“å“ˆæ¬ çš„ç¨‹åº¦ã€‚

ä¸çŸ¥é“æœ€åè€å¸ˆè¯´â€œæ¯”ä¸Šå‘¨å¥½å¤šäº†â€â€œè¿™ä¸æ˜¯ 100m å°±æ¸¸ä¸‹æ¥äº†å—â€çš„æ—¶å€™ï¼Œæ˜¯å¦è§‰å¾—æˆ‘â€œä¸ç´§å¼ äº†â€â€œèƒ½åšæŒä¸‹æ¥äº†â€ã€‚åæ­£ï¼Œæˆ‘å¿ƒé‡Œæƒ³çš„æ˜¯ï¼šâ€œåŸæ¥å˜´ tmd è¦å¼ è¿™ä¹ˆå¤§ï¼Œå˜´ä¸€å¼ å¤§ç«‹åˆ»è½»æ¾ä¸€ä¸‡å€ã€‚â€

P.S. è¿™ç¯‡çš„ [og](https://ogp.me/) image æ˜¯ [ã€ä¸­å­—ã€‘æ‰“é“è‡ªè¿°åŠ±å¿—å­¦æ¸¸æ³³ç»å†](https://www.bilibili.com/video/av556552520) çš„ [å°é¢](/images/2022/11/swim.jpg)ï¼Œå› ä¸ºå¾ˆè‰æ‰€ä»¥æƒ³èµ·æ¥å°±ç”¨ä½œ og image äº†ï¼ˆï¼Œç„¶åé‡æ–°çœ‹äº†ä¸€éè¿™ä¸ªåˆ‡ç‰‡ï¼Œå½“æ—¶çœ‹çš„æ—¶å€™è¿˜ä½“ä¼šä¸åˆ°æŒ‰è·ç¦»åˆ†ç»„ã€è‡ªå·±å«åº•çš„æ„Ÿè§‰ï¼Œç°åœ¨ä¹Ÿèƒ½å¯¹ kanonï¼ˆ~~è€ƒå“¥éœ‡æ€’~~ï¼‰çš„è‹¦å‘€è¥¿æ„ŸåŒèº«å—äº†ã€‚
`},{title:P,tags:t,content:`[CS:APP](https://csapp.cs.cmu.edu/) ç¬¬å…­ç«  â€œThe Memory Hierarchyâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

è¿™ç« çš„ä¸»è¦å†…å®¹æœ‰ï¼šå„ç§å­˜å‚¨è®¾å¤‡ï¼ˆRAMã€ROMã€HDDã€SSDï¼‰çš„ç‰¹ç‚¹ã€ç¨‹åºçš„å±€éƒ¨æ€§ã€ç¼“å­˜çš„ç»“æ„ä»¥åŠåŸç†ã€ç¼“å­˜å¯¹ç¨‹åºæ€§èƒ½çš„å½±å“ã€‚



å› ä¸ºæ—¶é—´ä¸å¤ªå¤Ÿï¼Œæœ¬æ¥æˆ‘æƒ³å…ˆè·³è¿‡è¿™ç« ä»¥åå†è¡¥çš„ï¼Œä½†å­¦ç¬¬ä¹ç« çš„æ—¶å€™æ„Ÿè§‰è¿˜æ˜¯è·³ä¸å¾—ï¼Œå¦åˆ™ç¬¬ä¹ç« æœ‰äº›ä¸œè¥¿æ„Ÿè§‰å­¦äº†ä¸ªåŠæ‡‚ã€‚~~è™½ç„¶åªç”¨å­¦ä¸€å°éƒ¨åˆ†å°±è¶³ä»¥æ»¡è¶³ç¬¬ä¹ç« çš„éœ€æ±‚ï¼Œä½†æˆ‘æ‰“ç®—æ‘†çƒ‚äº†ï¼Œè¯¥å­¦çš„ä¸œè¥¿å­¦ä¸å®Œå°±å­¦ä¸å®Œï¼Œæˆ‘æƒ³å­¦å•¥å°±å­¦å•¥ã€‚~~

## Storage Technologies

### RAM

*Random access memory* åˆ†ä¸º SRAM å’Œ DRAM ä¸¤ç§ï¼ŒSRAM æœ‰æ›´å¿«çš„è®¿é—®é€Ÿåº¦ä½†æ›´åŠ æ˜‚è´µã€‚

#### SRAM

SRAM (Static RAM) å°†æ¯ä¸ª bit å­˜å‚¨åœ¨ä¸€ä¸ª *bistable* çš„ memory cell ä¸­ï¼Œæ¯ä¸ª cell ç”± 6 ä¸ªæ™¶ä½“ç®¡ç»„æˆï¼Œæœ‰ä¸¤ç§å¯èƒ½çš„ç¨³å®šæ€ï¼Œé‡åˆ°å¾®å°çš„æ‰°åŠ¨ä¹Ÿä¼šè¿…é€Ÿæ¢å¤åˆ°è¿™ä¸¤ç§çŠ¶æ€ä¹‹ä¸€ã€‚

#### DRAM

DRAM (Dynamic RAM) å°†æ¯ä¸ª bit å­˜å‚¨åœ¨ä¸€ä¸ªå¾ˆå°çš„ç”µå®¹ä¸­ï¼Œå®¹æ˜“å—åˆ°å¤–ç•Œå¹²æ‰°ï¼Œæ‰€ä»¥éœ€è¦å‘¨æœŸæ€§åœ°å°†æ•°æ®å¤åˆ¶å‡ºå»å†å¤åˆ¶å›æ¥ä»¥è¿›è¡Œåˆ·æ–°ï¼Œå¯èƒ½è¿˜ä¼šé…åˆçº é”™ç æ¥ä¿è¯æ•°æ®æ­£ç¡®ã€‚

DRAM çš„è®¾è®¡ä½¿å…¶å­˜å‚¨å¯†åº¦æ›´é«˜ï¼Œä½†è®¿é—®é€Ÿåº¦æ›´æ…¢ï¼›SRAM åˆ™æ›´å¿«ï¼Œä½†å¯†åº¦æ›´ä½ï¼Œæ›´è´µï¼Œæ›´è´¹ç”µã€‚è®¿é—® DRAM çš„ç”¨æ—¶å¤§çº¦æ˜¯ SRAM çš„ 10 å€ï¼Œè€Œ SRAM çš„é€ ä»·å¤§çº¦æ˜¯ DRAM çš„ 1000 å€ã€‚

#### Conventional DRAM

DRAM èŠ¯ç‰‡è¢«åˆ†ä¸ºè‹¥å¹² *supercell*ï¼Œæ¯ä¸ª supercell å­˜å‚¨ä¸€ä¸ª wordï¼Œä¸€èˆ¬æ˜¯ 1 byteã€‚supercell æ’åˆ—ä¸ºäºŒç»´é˜µåˆ—ï¼Œå¯ä»¥ç”¨äºŒç»´åæ ‡ $(i, j)$ å®šä½ã€‚

DRAM é€šè¿‡ *pin* è¿æ¥åˆ° *memory controller* æ¥å’Œå¤–ç•Œé€šä¿¡ã€‚è¯»å–ä½äº $(i, j)$ çš„ supercell æ—¶ï¼Œmemory controller ä¼šä¾æ¬¡å‘é€ *row access strobe* (RAS) $i$ å’Œ *column access strobe* (CAS) $j$ï¼Œåœ¨æ”¶åˆ° RAS å DRAM ä¼šå°†ç¬¬ $i$ è¡Œå¤åˆ¶åˆ°ä¸€ä¸ªå†…éƒ¨çš„ row bufferï¼Œæ”¶åˆ° CAS åå†ä» row buffer é‡Œå°†ç¬¬ $j$ åˆ—å‘é€ç»™ memory controllerã€‚

#### Memory Module

DRAM èŠ¯ç‰‡ä¼šè¢«ç»„è£…ä¸º *memory module* æ¥æ’åˆ°ä¸»æ¿ä¸Šã€‚

DIMM æ˜¯ä¸€ç§ memory moduleã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª DIMM å¯ä»¥åŒ…å« 8 ä¸ª DRAM èŠ¯ç‰‡ï¼Œæ¯ä¸ª 64-bit çš„ word åœ¨æ¯ä¸ª DRAM èŠ¯ç‰‡çš„åŒä¸€ä¸ªåœ°å€ä¸Šåˆ†åˆ«å­˜ä¸€ä¸ª byteï¼Œä»è€Œæ•´ä¸ª DIMM å¯ä»¥ä»¥ 64-bit ä¸ºå•ä½ä¸å¤–ç•Œé€šä¿¡ã€‚

#### Enhanced DRAM

æœ´ç´ çš„ DRAM æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå†å²ä¸Šæ›¾ç»æœ‰è¿‡è‹¥å¹²å¯¹ conventional DRAM çš„ä¼˜åŒ–ï¼š

1.  FPM (fast page mode) DRAM: å¦‚æœè¿ç»­ä¸¤æ¬¡ RAS æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥çœç•¥æ‰åç»­ç›¸åŒçš„ RASï¼Œç›´æ¥å‘é€ CAS
2.  EDO (extended data out) DRAM: å»¶é•¿äº†æ•°æ®è¾“å‡ºçš„æ—¶é—´ï¼Œå¯¹ pipelining æœ‰å¸®åŠ©
3.  SDRAM (synchronous): é€šè¿‡æ—¶é’Ÿä¿¡å·çš„ rising edge åŒæ­¥åœ°é€šä¿¡ï¼Œè€Œéé€šè¿‡å‘é€ RAS/CAS å¼‚æ­¥é€šä¿¡
4.  DDR (double data-rate) SDRAM: é€šè¿‡åŒæ—¶ä½¿ç”¨æ—¶é’Ÿä¿¡å·çš„ rising edge å’Œ falling edge è¾¾åˆ° double data-rateï¼Œåˆ†ä¸º DDRã€DDR2ã€DDR3ã€DDR4ã€DDR5 ç­‰
5.  VRAM (video): ä¸€èˆ¬ç”¨äºæ˜¾å¡ã€frame buffer ç­‰ï¼Œå®ƒçš„è¾“å‡ºæ˜¯ç›´æ¥è¾“å‡ºæ•´ä¸ª bufferï¼Œå¹¶ä¸”å¯ä»¥å¹¶è¡Œåœ°åŒæ—¶è¯»å’Œå†™

### ROM

RAM ä¼šåœ¨æ–­ç”µåä¸¢å¤±æ•°æ®ï¼Œæ‰€ä»¥æ˜¯ *volatile* çš„ã€‚ä¸ä¹‹ç›¸å¯¹ï¼Œè¿˜æœ‰ nonvolatile çš„å­˜å‚¨å™¨ï¼Œç»Ÿç§°ä¸º *read-only memory* (ROM)ï¼Œå°½ç®¡æœ‰çš„ ROM æ˜¯å¯ä»¥å†™å…¥çš„ã€‚ROM çš„å†™å…¥ç§°ä½œ *reprogram*ã€‚

-   PROM (programmable ROM) åªèƒ½è¢«å†™å…¥ä¸€æ¬¡ã€‚
-   EPROM (erasable PROM) éœ€è¦ç”¨ç‰¹æ®Šè®¾å¤‡å†™å…¥ï¼Œå¯ä»¥å†™å…¥å¤§çº¦ 1000 æ¬¡ã€‚
-   EEPROM (electrically EPROM) ä¸éœ€è¦ç”¨ç‰¹æ®Šè®¾å¤‡å°±å¯ä»¥å†™å…¥ï¼Œå¯ä»¥å†™å…¥å¤§çº¦ $10^5$ æ¬¡ã€‚
-   flash memory æ˜¯ä¸€ç§åŸºäº EEPROM çš„ nonvolatile å­˜å‚¨å™¨ï¼Œè¢«å¹¿æ³›ä½¿ç”¨ï¼ŒåŒ…æ‹¬ç”¨äº [SSD](#ssd)ã€‚
-   å›ºä»¶ (firmware) å¾€å¾€å­˜å‚¨äº ROM ä¸­ã€‚

### è®¿é—® main memory

ä¸€ä¸ª *bus* æ˜¯ä¸€ç»„ç”¨æ¥é€šä¿¡çš„å¯¼çº¿ï¼Œå¯ä»¥ä¼ è¾“åœ°å€ã€æ•°æ®ã€æ§åˆ¶ä¿¡å·ç­‰ã€‚CPU å’Œ main memory ä¹‹é—´çš„é€šä¿¡é€šè¿‡ *bus transaction* è¿›è¡Œã€‚

CPU é€šè¿‡ system bus è¿æ¥ I/O bridgeï¼ŒI/O bridge é€šè¿‡ memory bus è¿æ¥ main memoryã€‚I/O bridge è´Ÿè´£ system bus signal å’Œ memory bus signal ä¹‹é—´çš„è½¬æ¢ã€‚

### HDD

#### ç£ç›˜çš„ç»“æ„

ç£ç›˜ç”±è‹¥å¹² *platter*ï¼ˆç›˜ç‰‡ï¼‰ç»„æˆã€‚æ¯ä¸ª platter æœ‰ä¸¤ä¸ª *surface*ï¼ˆè¡¨é¢ï¼‰ï¼Œæ¯ä¸ª surface ä¸Šè¦†ç›–ç€ç£æ€§è®°å½•ææ–™ã€‚platter ç”±ä½äºä¸­å¿ƒçš„ *spindle*ï¼ˆä¸»è½´ï¼‰å¸¦åŠ¨ï¼Œä»¥æŸä¸ªä¸€èˆ¬æ˜¯ 5400~15000 RPM çš„é€Ÿåº¦è½¬åŠ¨ã€‚

æ¯ä¸ª surface è¢«åˆ†æˆè‹¥å¹²ä¸ªç§°ä½œ *track*ï¼ˆç£é“ï¼‰çš„åŒå¿ƒåœ†ç¯ï¼Œæ¯ä¸ª track è¢«åˆ†ä¸ºè‹¥å¹² *sector*ï¼ˆæ‰‡åŒºï¼‰ã€‚æ¯ä¸ª sector å­˜æœ‰ç›¸åŒå¤§å°çš„æ•°æ®ï¼ˆä¸€èˆ¬æ˜¯ 512 bytesï¼‰ï¼Œç›¸é‚»çš„ sector ä¹‹é—´ç”± *gap*ï¼ˆé—´éš™ï¼‰éš”å¼€ï¼Œgap ä¸å­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯ç”¨æ¥è¯†åˆ« sectorã€‚

ä¸€ä¸ªç£ç›˜é€šå¸¸ç”±å¤šä¸ªå †å åœ¨ä¸€èµ·çš„ platter æ„æˆï¼Œè¿™äº› platter å…±äº«ä¸€ä¸ª spindleã€‚å¯¹äºæŸä¸ªè·ç¦» $k$ï¼Œä¸€ä¸ªç£ç›˜å†…æ‰€æœ‰ surface ä¸Šç¦»è½¬è½´è·ç¦»ä¸º $k$ çš„ track çš„é›†åˆç§°ä½œä¸€ä¸ª *cylinder*ï¼ˆæŸ±é¢ï¼‰ã€‚

æ•´ä½“ç»“æ„å¦‚ CS:APP Figure 6.9 æ‰€ç¤ºï¼š

![ç£ç›˜ç»“æ„ç¤ºæ„å›¾](csapp-fig6.9.png)

#### ç£ç›˜çš„å®¹é‡

ç£ç›˜çš„å®¹é‡æœ‰ä¸‰ä¸ªè¡¡é‡æŒ‡æ ‡ï¼š

-   recording density: å•ä½é•¿åº¦çš„ track å­˜å‚¨çš„ bit æ•°é‡
-   track density: å•ä½é•¿åº¦çš„åŠå¾„ä¸Šçš„ track ä¸ªæ•°
-   areal density: å•ä½é¢ç§¯ä¸Šå­˜å‚¨çš„ bit æ•°é‡

æ—©æœŸçš„ç£ç›˜çš„æ‰€æœ‰ track éƒ½æœ‰ç›¸åŒæ•°é‡çš„ sectorï¼Œè¿™æ ·çš„è¯ä½äºå¤–éƒ¨çš„ track çš„ sector å°±ä¼šæ›´åŠ ç¨€ç–ã€‚åæ¥ä¸ºäº†æé«˜å®¹é‡ï¼Œå°† cylinder åˆ’åˆ†æˆäº†è‹¥å¹²ä¸ª *recording zone*ï¼Œæ¯ä¸ª recording zone ç”±è‹¥å¹²ç›¸é‚»çš„ cylinder ç»„æˆï¼ŒåŒä¸€ä¸ª recording zone å†…çš„æ‰€æœ‰ track æœ‰ç›¸åŒæ•°é‡çš„ sectorã€‚

#### ç£ç›˜çš„è¯»å†™

ç£ç›˜é€šè¿‡è¿åœ¨ä¼ åŠ¨è‡‚ä¸Šçš„è¯»å†™å¤´è¿›è¡Œè¯»å†™ï¼Œæ¯æ¬¡è¯»å†™å‰éœ€è¦å…ˆå°†è¯»å†™å¤´ç§»åŠ¨åˆ°ç›¸åº”çš„ä½ç½®ï¼ˆå¯»é“ï¼‰ï¼Œå¹¶ç­‰å¾…ç›®æ ‡ sector è½¬åŠ¨åˆ°è¯»å†™å¤´ä¸‹ï¼Œå†å¼€å§‹è¯»å†™ã€‚

å¯»é“ç”¨æ—¶ä¸è¯»å†™å¤´åŸæœ¬çš„ä½ç½®åˆ°ç›®æ ‡ä½ç½®çš„è·ç¦»æœ‰å…³ï¼Œç­‰å¾…è½¬åŠ¨çš„ç”¨æ—¶åˆ™çœ‹è¿æ°”ã€‚åœ¨ CS:APP ä¸¾çš„ä¾‹å­ä¸­ï¼Œå¯»é“å¹³å‡ç”¨æ—¶ä¸º 9 msï¼Œç­‰å¾…æ—‹è½¬å¹³å‡ç”¨æ—¶ä¸º 4 msï¼Œè¯»å†™ä¸€ä¸ª sector ç”¨æ—¶ 20 Î¼sã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œç£ç›˜è¯»å†™çš„ä¸»è¦ç”¨æ—¶æ˜¯å¯»é“ä»¥åŠç­‰å¾…æ—‹è½¬ç”¨æ—¶ï¼Œä¹Ÿå°±æ˜¯åˆæ¬¡è®¿é—®ä¸€æ®µè¿ç»­çš„ sector çš„ç”¨æ—¶ï¼Œè€Œä¸è®¿é—®å¤šå°‘ä¸ªè¿ç»­çš„ sector å…³ç³»ä¸å¤§ã€‚å¯¹äºå•ä¸ª sectorï¼Œç£ç›˜è®¿é—®çš„ç”¨æ—¶å¯ä»¥è¾¾åˆ° SRAM çš„ $10^4$ å€ï¼ŒDRAM çš„ $10^3$ å€ï¼Œä½†è¿ç»­ sector çš„è¯»å†™ç”¨æ—¶ä»…ä¸º DRAM çš„ä¸åˆ°åå€ã€‚

#### Logical Disk Blocks

ç£ç›˜å¯¹å¤–æä¾›äº† *logical block* ä½œä¸º sector çš„æŠ½è±¡ï¼Œæ¯ä¸ª logical block çš„å¤§å°å’Œä¸€ä¸ª sector ç›¸åŒï¼Œç”±è¿ç»­çš„éè´Ÿæ•´æ•°ç´¢å¼•ï¼Œé€šè¿‡ *disk controller* ç¿»è¯‘æˆå½¢å¦‚ *(surface, track, sector)* çš„åæ ‡ã€‚

<Card title="ç£ç›˜æ ¼å¼åŒ–">
ç£ç›˜åœ¨ä½¿ç”¨å‰éœ€è¦è¿›è¡Œæ ¼å¼åŒ–ï¼šåœ¨ gap ä¸­å†™å…¥ sector çš„æ ‡è¯†ä¿¡æ¯ï¼Œè¯†åˆ«å‡ºæœ‰æ•…éšœçš„ cylinderï¼Œå°†ä¸€äº› cylinder è®¾ä¸ºå¤‡ç”¨ä»¥é˜²å…¶ä»– cylinder æŸåã€‚ç”±äºå¤‡ç”¨ cylinder çš„å­˜åœ¨ï¼Œformatted capacity ä¼šå°äº maximum capacityã€‚
</Card>

### I/O bus

ä¸åŒçš„ I/O è®¾å¤‡é€šè¿‡ I/O bus ä¸ I/O bridge è¿æ¥ã€‚ä¾‹å¦‚æ˜¾å¡ã€è¿æ¥å„ç§è®¾å¤‡çš„ USB controllerã€é€šè¿‡ SCSI/SATA ç­‰æ¥å£è¿æ¥ç£ç›˜çš„ host bus adapter ç­‰éƒ½ä¼šè¿æ¥åˆ° I/O busã€‚

### è®¿é—®ç£ç›˜

è®¿é—®ç£ç›˜éœ€è¦å‘ç£ç›˜å‘é€ä¸‰æ¡æŒ‡ä»¤ï¼š

1.  å‘ç£ç›˜å‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰ç£ç›˜è¦è¯»å–æ•°æ®
2.  å°†è¦è¯»å–çš„ logical block number å‘é€ç»™ç£ç›˜
3.  å‘Šè¯‰ç£ç›˜è¯»å–åˆ°çš„æ•°æ®è¦æ”¾åœ¨ main memory çš„å“ªä¸ªåœ°å€

å‘é€å®Œè¿™äº›æŒ‡ä»¤åï¼ŒCPU ä¼šç»§ç»­å¹²å…¶ä»–äº‹æƒ…ã€‚ç£ç›˜è¯»å–åˆ°æ•°æ®åï¼Œä¼šé€šè¿‡ I/O bus ç›´æ¥å°†æ•°æ®å­˜æ”¾åˆ° main memory ä¸­è€Œä¸ç»è¿‡ CPUï¼Œè¿™è¢«ç§°ä½œ *direct memory access* (DMA)ã€‚å­˜æ”¾å¥½æ•°æ®åï¼Œç£ç›˜å‘ CPU å‘é€ interrupt signal æ¥è·³è½¬åˆ°å¤„ç†ç£ç›˜è¯»å–å®Œæˆçš„ signal handlerã€‚

### SSD

SSD å°†ä¸€ä¸ªæˆ–å¤šä¸ª flash memory åŒ…è£…èµ·æ¥ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ª *flash translation layer* æ¥å°†è¾“å…¥çš„ logical block number è½¬æ¢ä¸ºå¯¹ flash memory çš„è®¿é—®ï¼Œå¯¹å¤–è¡¨ç°å‡ºä¸ HDD ç±»ä¼¼çš„æ¥å£ã€‚

flash memory ç”±è‹¥å¹² block ç»„æˆï¼Œæ¯ä¸ª block åˆç”±è‹¥å¹²ï¼ˆ32-128 ä¸ªï¼‰page ç»„æˆï¼Œæ¯ä¸ª page ä¸€èˆ¬æ˜¯ 512B-4KB å¤§ï¼Œæ•°æ®ä¼ è¾“çš„æœ€å°å•ä½æ˜¯ pageã€‚

SSD çš„å†™å…¥æ¯”è¾ƒç‰¹æ®Šï¼šä¸€ä¸ª page éœ€è¦åœ¨æ‰€å±çš„æ•´ä¸ª block éƒ½è¢«æ“¦é™¤ï¼ˆæ”¹ä¸ºå…¨ 1ï¼‰åæ‰èƒ½å†™å…¥ä¸€æ¬¡ï¼Œå¦‚æœè¦å†™å…¥ç¬¬äºŒæ¬¡å°±å¾—å†æŠŠæ•´ä¸ª block æ“¦é™¤ä¸€éã€‚åœ¨å†™å…¥æ—¶ï¼Œä¸ºäº†æ“¦é™¤æŸä¸ª blockï¼Œå¯èƒ½ä¼šéœ€è¦æŠŠè¿™ä¸ª block å­˜å‚¨çš„æ•°æ®å¤åˆ¶åˆ°å…¶ä»– blockã€‚æ“¦é™¤æ˜¯ä¸€ä¸ªè€—æ—¶ç›¸å¯¹è¾ƒé•¿çš„æ“ä½œï¼Œéœ€è¦çº¦ 1 msï¼Œå¹¶ä¸”æ¯ä¸ª block åœ¨æ“¦é™¤çº¦ $10^5$ æ¬¡åå°±ä¼šæŸåã€‚

è¿™ä½¿å¾— SSD çš„å†™å…¥æ¯”è¯»å–ç•¥æ…¢ï¼Œå¹¶ä¸”å†™å…¥å¾ˆå¤šæ¬¡åå¯èƒ½æŸåã€‚flash translation layer ä¼šé€šè¿‡ *wear-leveling logic* æ¥å°½å¯èƒ½ä½¿å¾—æ¯ä¸ª block çš„æ“¦é™¤æ¬¡æ•°ç›¸åŒï¼Œä»¥å»¶é•¿ SSD çš„ä½¿ç”¨å¯¿å‘½ã€‚

diskã€RAMã€CPU é€Ÿåº¦å·®å¼‚çš„å†å²å˜åŒ–å¦‚ CS:APP Figure 6.16 æ‰€ç¤ºï¼Œå…¶ä¸­ CPU cycle time æ˜¯å•æ ¸çš„ï¼Œeffective CPU cycle time æ˜¯å¤šæ ¸çš„ï¼š

![diskã€RAMã€CPU é€Ÿåº¦å·®å¼‚çš„å†å²å˜åŒ–](csapp-fig6.16.png)

## Locality

å¥½çš„ç¨‹åºå…·æœ‰è‰¯å¥½çš„ *locality*ã€‚locality æœ‰ä¸¤ç§è¡¨ç°å½¢å¼ï¼Œ*temporal locality* æŒ‡çš„æ˜¯æœ€è¿‘è®¿é—®è¿‡çš„æ•°æ®æ›´æœ‰å¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥å†æ¬¡è¢«è®¿é—®ï¼Œ*spatial locality* æŒ‡çš„æ˜¯è®¿é—®è¿‡ä¸€å¤„çš„æ•°æ®åæ›´æœ‰å¯èƒ½åœ¨ä¸ä¹…çš„å°†æ¥è®¿é—®é‚»è¿‘çš„å…¶ä»–æ•°æ®ã€‚

å…·æœ‰è‰¯å¥½ locality çš„ç¨‹åºè·‘å¾—æ›´å¿«ï¼Œå› ä¸ºè®¡ç®—æœºç³»ç»Ÿè®¾è®¡çš„å„ä¸ªå±‚é¢éƒ½åˆ©ç”¨ locality åšäº†ä¼˜åŒ–ã€‚

ä¸€äº› locality çš„ä¾‹å­ï¼š

-   é‡å¤å¼•ç”¨åŒä¸€ä¸ªå˜é‡çš„ç¨‹åºæœ‰è‰¯å¥½çš„ localityã€‚
-   åœ¨ä¸€æ®µè¿ç»­å†…å­˜ï¼ˆæ•°ç»„ï¼‰ä¸­ä¾æ¬¡è®¿é—®æ¯ä¸ªå…ƒç´ ç§°ä½œ *stride-1 reference pattern*ï¼Œæ¯æ¬¡é—´éš” $k-1$ ä¸ªå…ƒç´ è¿›è¡Œè®¿é—®ç§°ä½œ *stride-k reference pattern*ï¼Œ$k$ è¶Šå° locality è¶Šå¥½ã€‚éå†é«˜ç»´æ•°ç»„æ—¶å°¤å…¶è¦æ³¨æ„è®¿é—®çš„é¡ºåºã€‚
-   ç”±äºå¾ªç¯ä¼šé‡å¤è®¿é—®åŒä¸€æ®µæŒ‡ä»¤ï¼Œå¾ªç¯çš„æŒ‡ä»¤è¯»å–å±€éƒ¨æ€§è‰¯å¥½

## The Memory Hierarchy

åœ¨ç¡¬ä»¶ä¸Šï¼Œä¸åŒå­˜å‚¨æŠ€æœ¯ä¹‹é—´å­˜åœ¨æ€§èƒ½ã€ä»·æ ¼ã€å®¹é‡çš„ trade-offï¼›åœ¨è½¯ä»¶ä¸Šï¼Œç¨‹åºå…·æœ‰ localityã€‚ç¡¬ä»¶å’Œè½¯ä»¶çš„è¿™ä¸¤æ¡æ€§è´¨æ­£å¥½å¯ä»¥æ­é…åœ¨ä¸€èµ·ï¼Œä¿ƒä½¿ memory system é‡‡ç”¨äº†å¦‚ CS:APP Figure 6.21 æ‰€ç¤ºçš„ç§°ä½œ *memory hierarchy* çš„ç»„ç»‡æ–¹å¼ï¼š

![The memory hierarchy](csapp-fig6.21.png)

memory hierarchy çš„æ„æˆå¹¶ä¸ä¸€å®šå’Œä¸Šå›¾å®Œå…¨ä¸€è‡´ï¼Œä¾‹å¦‚ SRAM çš„çº§æ•°å¯èƒ½ä¸æ˜¯ä¸‰çº§ã€DRAM å’Œ HDD é—´å¯èƒ½è¿˜æœ‰ SSDã€ç£å¸¦ä¹Ÿå¯ä»¥ä½œä¸º memory hierarchy ä¸­æ¯” HDD æ›´ä½çš„ä¸€çº§ã€‚

### Cache

caching æŒ‡çš„æ˜¯ç”¨ä¸€ä¸ªç›¸å¯¹å°è€Œå¿«çš„å­˜å‚¨è®¾å¤‡æ¥å­˜å‚¨ä¸€ä¸ªç›¸å¯¹å¤§è€Œæ…¢çš„å­˜å‚¨è®¾å¤‡ä¸­æœ€ä¸ºæ´»è·ƒçš„éƒ¨åˆ†ï¼Œè¿™ä¸ªå°çš„å­˜å‚¨è®¾å¤‡ç§°ä½œå¤§çš„å­˜å‚¨è®¾å¤‡çš„ cacheã€‚

åœ¨ memory hierarchy ä¸­ï¼Œæ¯ä¸€çº§éƒ½æ˜¯ä¸‹ä¸€çº§çš„ cacheã€‚æ•°æ®ä¼šåœ¨å„ä¸ªç›¸é‚»å±‚çº§é—´ä¸æ–­åœ°ä¼ è¾“ï¼Œä¸åŒå±‚çº§ä¹‹é—´ä¼šä»¥ä¸åŒçš„ block size ä½œä¸ºæ•°æ®ä¼ è¾“çš„åŸºæœ¬å•ä½ã€‚

### ä» cache è·å–æ•°æ®

æƒ³è¦ä» memory hierarchy çš„æŸä¸€çº§è·å–æ•°æ®æ—¶ï¼Œé¦–å…ˆä¼šå°è¯•ä»å®ƒçš„ cache è·å–æ•°æ®ï¼Œå¦‚æœæˆåŠŸè·å–åˆ™ç§°ä½œ *cache hit*ï¼Œå¦åˆ™ç§°ä½œ *cache miss*ã€‚

å‘ç”Ÿ cache miss æ—¶ï¼Œä¸€èˆ¬ä¼šå…ˆå°†æ•°æ®ä»ä¸‹ä¸€çº§å¤åˆ¶åˆ°ä¸Šä¸€çº§ï¼Œä»è€Œæœ€ç»ˆè¿˜æ˜¯è¡¨ç°ä¸ºä» cache ä¸­è·å–æ•°æ®ã€‚å¦‚æœ cache æ»¡äº†ï¼Œåœ¨ä»ä¸‹ä¸€çº§è·å–æ•°æ®æ—¶ï¼Œå°±éœ€è¦åˆ é™¤ cache ä¸­çš„ä¸€äº›æ•°æ®æ¥è…¾å‡ºç©ºé—´ï¼Œè¿™æ—¶éœ€è¦åœ¨ cache ä¸­é€‰æ‹©è¢«åˆ é™¤çš„æ•°æ®ï¼Œè¢«åˆ é™¤çš„ block ç§°ä½œ *victim block*ï¼Œè¿™ä¸ªè¡Œä¸ºç§°ä½œå°† victim block *evict*ï¼Œè€Œé€‰æ‹© victim block æ˜¯æ ¹æ® *replacement policy* è¿›è¡Œçš„ï¼Œä¾‹å¦‚ random replacement policyã€least recently used (LRU) replacement policy ç­‰ã€‚

### Cache çš„ç®¡ç†

cache å¯èƒ½ç”±ç¡¬ä»¶ã€OSã€è½¯ä»¶ä»¥åŠå®ƒä»¬ä¹‹é—´çš„ç›¸äº’é…åˆæ¥è¿›è¡Œç®¡ç†ï¼Œè€Œè¿™åœ¨å¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæ— éœ€åº”ç”¨ç¨‹åºçš„ç¨‹åºå‘˜æ“å¿ƒã€‚

å„çº§ cache å¦‚ CS:APP Figure 6.23 æ‰€ç¤ºï¼š

![æ— å¤„ä¸åœ¨çš„å„å¼å„æ ·çš„ cache](csapp-fig6.23.png)

### Cache å¯¹ locality çš„åˆ©ç”¨

temporal locality ä½¿å¾—é‡å¤ä½¿ç”¨çš„æ•°æ®ç•™å­˜åœ¨ cache ä¸­ä»è€Œæ›´å®¹æ˜“ cache hitï¼›cache ä¸­çš„æ•°æ®æŒ‰ block å­˜å‚¨åˆ™åˆ©ç”¨äº† spatial localityï¼Œä½¿å¾—ä¸€ä¸ªæ•°æ®è¢« cache æ—¶ä¸å…¶é‚»è¿‘çš„å¤„äºåŒä¸€ä¸ª block çš„æ•°æ®ä¹Ÿè¢« cacheã€‚

## Cache Memories

éšç€ CPU å’Œ DRAM çš„é€Ÿåº¦å·®å¼‚è¶Šæ¥è¶Šå¤§ï¼ŒSRAM è¢«ç”¨æ¥å¡«å……å®ƒä»¬ä¹‹é—´çš„ gapã€‚

åœ¨ä¸‹é¢çš„è®¨è®ºä¸­ï¼Œä¸ºäº†ç®€ä¾¿ï¼Œå‡è®¾åªæœ‰ L1 cacheï¼Œæ²¡æœ‰ L2ã€L3 cacheã€‚ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯åœ¨ä»‹ç» L3 cache æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ï¼‰

### Cache çš„ç»“æ„ä¸è¯»å–

è®¾ main memory æœ‰ $2^m$ ä¸ªåœ°å€ï¼Œæ¯ä¸ªåœ°å€å­˜æ”¾ä¸€ä¸ª byteã€‚å®ƒçš„ cache ä¼šåˆ†æˆ $2^s$ ä¸ª *cache set*ï¼Œæ¯ä¸ª cache set åŒ…å« $E$ ä¸ª *cache line*ï¼Œæ¯ä¸ª cache line å­˜æ”¾ä¸€ä¸ªå¤§å°ä¸º $2^b$ byte çš„ data blockã€ä¸€ä¸ª *valid bit*ã€ä»¥åŠé•¿åº¦ä¸º $t = m-b-s$ çš„ *tag bits*ã€‚

æ¯ä¸ªåœ°å€ä¼šè¢«åˆ†æˆä¸‰éƒ¨åˆ†ï¼Œé«˜ä½çš„ $t$ ä½æ˜¯ tagï¼Œä¸­é—´ $s$ ä½æ˜¯ set indexï¼Œä½ä½ $b$ ä½æ˜¯ block offsetã€‚è·å–å­˜æ”¾åœ¨æŸä¸ªåœ°å€çš„æ•°æ®æ—¶ï¼Œå…ˆæ ¹æ®å…¶ set index æ‰¾åˆ°å¯¹åº”çš„ cache setï¼Œå†åœ¨ cache set ä¸­æ‰¾åˆ° valid bit ä¸º 1 ä¸” tag ç›¸ç¬¦çš„ cache lineï¼Œæœ€åé€šè¿‡ block offset æ¥ä» block ä¸­æå–å‡ºå•ä¸ª byteã€‚

åœ¨ cache miss æ—¶ï¼Œéœ€è¦ä»ä¸‹ä¸€çº§è·å–æ•°æ®ï¼Œå­˜æ”¾åˆ° cache ä¸­ã€‚å¦‚æœå¯¹åº”çš„ cache set æ‰€æœ‰ cache line éƒ½æ»¡äº†ï¼Œå°±éœ€è¦ evict æŸä¸ªå·²æœ‰çš„ cache lineã€‚

### Conflict Miss

cache set çš„è®¾è®¡åŸºäºä¸€ä¸ªå‡è®¾ï¼Œå³åœ¨å±€éƒ¨å†…è®¿é—®çš„æ•°æ®åœ°å€çš„ä½ä½å¾€å¾€æ˜¯ä¸åŒçš„ï¼Œä½†å®é™…ä¸Šå¯èƒ½å¹¶éå¦‚æ­¤ã€‚å¦‚æœä»¥ $2^{s+b}$ çš„å€æ•°ä¸ºåœ°å€é—´éš”è®¿é—®æ•°æ®ï¼Œå°±å¯èƒ½è¿ç»­è®¿é—®åŒä¸€ä¸ª cache set å†…çš„æ•°æ®ï¼Œå¯¼è‡´ cache missï¼ˆ$E$ è¾ƒå°ï¼Œå°¤å…¶æ˜¯ $E=1$ æ—¶ï¼Œè¿™ç§æƒ…å†µæ›´å¯èƒ½è§¦å‘ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ•°ç»„çš„å¤§å°æ˜¯ $2$ çš„æ¬¡å¹‚è€Œäº¤æ›¿è®¿é—®ç›¸é‚»æ•°ç»„çš„åŒä¸€ä¸ªä¸‹æ ‡æ—¶å°±å¯èƒ½è¿™æ ·ã€‚ï¼ˆè¿™å¤§æ¦‚åœ¨ APIO2019 è®²è¿‡ï¼Œå½“æ—¶æˆ‘è‡ªç„¶æ˜¯å•¥éƒ½æ²¡å¬æ‡‚ï¼Œå°±åªè®°å¾—æ•°ç»„ä¸è¦å¼€ $2$ çš„æ¬¡å¹‚ã€‚ï¼‰

### Cache çš„åˆ†ç±»

$E=1$ çš„ cache ç§°ä½œ *direct-mapped cache*ã€‚ï¼ˆ~~ä¹¦ä¸Šåœ¨è¿™ä»”ç»†è§£é‡Šäº†åŠå¤©ï¼Œæ„Ÿè§‰åºŸè¯å¥½å¤šå•Šã€‚~~ï¼‰

$E > 1$ çš„ cache ç§°ä½œ *set associative cache*ã€‚å…¶ä¸­ï¼Œ$s > 0$ çš„ç§°ä½œ E-way set associative cacheï¼Œè€Œ $s = 0$ çš„ç§°ä½œ fully associative cacheã€‚

### Cache çš„å†™å…¥

åœ¨ cache hit æ—¶ï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š

-   *write-through*: æ—¢ä¿®æ”¹ cacheï¼Œåˆä¿®æ”¹ä¸‹ä¸€çº§
-   *write-back*: åªä¿®æ”¹ cacheï¼Œå¹¶ä¸”åœ¨æ¯ä¸ª cache line ä¸­æ·»åŠ ä¸€ä¸ª *dirty bit*ï¼Œç”¨æ¥è®°å½•æ˜¯å¦è¢«ä¿®æ”¹è¿‡ï¼Œåœ¨è¢« evict æ—¶è‹¥ dirty åˆ™å†™å…¥ä¸‹ä¸€çº§

åœ¨ cache miss æ—¶ï¼Œä¹Ÿæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š

-   *write-allocate*: å…ˆä»ä¸‹ä¸€çº§è·å–æ•°æ®ï¼Œç„¶åç”¨ä¸ cache hit ç›¸åŒçš„å¤„ç†æ–¹å¼
-   *no-write-allocate*: ç›´æ¥å†™å…¥ä¸‹ä¸€çº§ï¼Œä¸è·å–åˆ° cache ä¸­

ä¸€èˆ¬ write-through å’Œ no-write-allocate æ­é…ï¼Œwrite-back å’Œ write-allocate æ­é…ã€‚

å®é™…ä¸Šï¼Œcache å†™å…¥çš„ä¼˜åŒ–æ˜¯éå¸¸å¤æ‚çš„é—®é¢˜ï¼Œè¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»äº†ä¸€ä¸‹ã€‚ä½œä¸ºç¨‹åºå‘˜ï¼Œå¯ä»¥æŠŠ cache å†™å…¥å½“æˆæ˜¯ write-backã€write-allocate çš„ã€‚

### i-cache å’Œ d-cache

åªå­˜æ”¾æŒ‡ä»¤çš„ cache ç§°ä½œ *i-cache*ï¼Œåªå­˜æ”¾æ•°æ®çš„ cache ç§°ä½œ *d-cache*ï¼Œéƒ½å­˜æ”¾çš„ cache ç§°ä½œ *unified cache*ã€‚

å°† i-cache å’Œ d-cache åˆ†å¼€ï¼Œå°±å¯ä»¥å¯¹å®ƒä»¬åˆ†åˆ«è¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚ i-cache æ˜¯åªè¯»çš„ï¼ŒäºŒè€…å¯ä»¥æœ‰ä¸ä¸€æ ·çš„å¤§å°ã€ä¸ä¸€æ ·çš„ cache set è®¾ç½®ã€‚å°†ä¸¤è€…åˆ†å¼€è¿˜å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé¿å… conflict missã€‚

åœ¨ Core i7 å¤„ç†å™¨ä¸­ï¼Œæ¯ä¸ªæ ¸æœ‰è‡ªå·±çš„ L1 i-cacheã€L1 d-cacheã€L2 unified cacheï¼Œæ‰€æœ‰æ ¸å…±äº«ä¸€ä¸ª L3 unified cacheã€‚

### Cache çš„æ€§èƒ½

cache æ€§èƒ½çš„è¡¡é‡æŒ‡æ ‡æœ‰ï¼š

-   miss rate
-   hit rate
-   hit time: cache hit æ—¶çš„è®¿é—®ç”¨æ—¶
-   miss penalty: cache miss æ—¶çš„è®¿é—®ç”¨æ—¶ï¼Œä¸æœ€ç»ˆä»å“ªä¸€çº§è·å–åˆ°æ•°æ®æœ‰å…³

ä¸€èˆ¬æ¥è¯´ï¼Œcache çš„å‚æ•°å¯¹æ€§èƒ½çš„å½±å“æ˜¯ï¼š

-   cache size è¶Šå¤§ï¼Œhit rate å°±è¶Šé«˜ï¼Œä½†é€Ÿåº¦ä¼šæ…¢ã€‚
-   å¢å¤§ block size å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ spatial localityï¼Œä½†ä¹Ÿæœ‰å¯èƒ½å›  cache line æ•°é‡å‡å°‘è€Œé™ä½ hit rateï¼Œå¹¶ä¸”ä¼šå› ä¸ºæ¯æ¬¡éœ€è¦ä¼ é€’çš„æ•°æ®å˜å¤šè€Œå¢å¤§ miss penaltyã€‚
-   æ›´å¤§çš„ $E$ å¯ä»¥é™ä½ conflict miss çš„å¯èƒ½æ€§ï¼Œä½†ä¹Ÿä¼šä½¿å¾— tag åŒ¹é…ä»¥åŠ victim line çš„é€‰æ‹©æ›´åŠ å¤æ‚ï¼Œä»è€Œå¢å¤§ hit time å’Œ miss penaltyã€‚åœ¨ Core i7 å¤„ç†å™¨ä¸­ï¼ŒL1ã€L2 cache æ˜¯ 8-way çš„ï¼ŒL3 cache æ˜¯ 16-way çš„ã€‚
-   write-through å®ç°èµ·æ¥æ›´åŠ å®¹æ˜“ï¼Œå¹¶ä¸”åœ¨ read miss æ—¶ä¸ä¼šè§¦å‘å†™å…¥ã€‚è€Œ write-back å¯ä»¥å‡å°‘æ•°æ®ä¼ é€’çš„æ€»é‡ï¼Œé™ä½ I/O bus å¸¦å®½çš„å ç”¨ï¼Œä¹Ÿå¯èƒ½é™ä½æ•°æ®ä¼ é€’çš„ç”¨æ—¶ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œmemory hierarchy ä¸­è¾ƒä½çš„å±‚çº§æ›´å€¾å‘äºä½¿ç”¨ write-backã€‚

## The Impact of Caches on Program Performance

### The Memory Mountain

å¯¹ä¸€å®š size çš„æ•°æ®æŒ‰ç…§ä¸€å®šçš„ stride è¿›è¡Œè®¿é—®ï¼Œå°† sizeã€stride ä¸æ•°æ®ååé‡çš„å…³ç³»ç”»æˆä¸‰ç»´å›¾åƒï¼Œå°±å¾—åˆ°äº† *memory mountain*ã€‚

CS:APP Figure 6.41 å±•ç¤ºäº†ä¸€åº§ Core i7 çš„ memory mountain:ï¼ˆè¿™ä¹Ÿæ˜¯ CS:APP çš„å°é¢ï¼‰

![Core i7 çš„ memory mountain](csapp-fig6.41.png)

Memory mountain è¾ƒä¸ºå®Œæ•´åœ°å‘ˆç°äº†ä¸€ä¸ª memory system çš„æ€§èƒ½ï¼Œä»¥åŠ temporal locality å’Œ spatial locality å¯¹æ€§èƒ½çš„å½±å“ã€‚

åœ¨æ¯çº§ cache çš„å®¹é‡å¤„ï¼Œååé‡ä¼šå‘ç”Ÿæ˜æ˜¾çš„çªå˜ã€‚

åœ¨ size ç›¸åŒæ—¶ï¼Œstride è¶Šå°ååé‡è¶Šé«˜ã€‚åœ¨ stride æ¥è¿‘ 1 æ—¶å˜åŒ–å°¤å…¶æ˜æ˜¾ï¼Œè¿™å’Œ Core i7 ç³»ç»Ÿçš„ prefetching æŠ€æœ¯æ¯æ¯ç›¸å…³ï¼Œå¤„ç†å™¨èƒ½å¤Ÿè¯†åˆ«å‡º stride-1 reference pattern å¹¶åœ¨å®é™…è®¿é—®åˆ°æ•°æ®ä¹‹å‰å°±è¿›è¡Œ prefetchã€‚

### çŸ©é˜µä¹˜æ³•çš„å¾ªç¯é¡ºåº

ï¼ˆä¹¦ä¸Šåœ¨è¿™è®²äº†åŠå¤©ï¼Œ~~æ„Ÿè§‰åºŸè¯å¥½å¤š~~ï¼Œæˆ‘å°±æ”¾ä¸ªæµ‹è¯•ç»“æœä¸Šæ¥å§ã€‚ï¼‰ï¼ˆCS:APP Figure 6.46ï¼‰

![Core i7 çŸ©é˜µä¹˜æ³•æ€§èƒ½](csapp-fig6.46.png)
`},{title:D,tags:i,content:`[DDPP5](https://wakerly.org/DDPP/) ç¬¬äºŒç«  â€œNumber Systems and Codesâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

æœ¬ç« çš„ä¸»è¦å†…å®¹ä¸ºä¸€äº›å¸¸ç”¨çš„ç¼–ç ä»¥åŠçº é”™ç çš„åŸç†ã€‚



å¼€å¤´æ•´æ•°ç¼–ç çš„å†…å®¹å¾ˆå¤šæ˜¯ [CS:APP ç¬¬äºŒç« ](/post/2022/09/csapp-2) è®²è¿‡çš„ï¼Œä¹Ÿæœ‰ä¸€äº›æ–°å†…å®¹ï¼Œä½†åŸºæœ¬ä¸Šéƒ½æ˜¯æ ‡æ˜Ÿçš„å¯é€‰å†…å®¹ï¼Œæˆ‘çœ‹æ˜¯çœ‹äº†ä½†æ‡’å¾—å†™ç¬”è®°äº†ï¼ˆ

---

ä¸€å¥—ç¼–ç è¢«ç§°ä½œä¸€ä¸ª *code*ï¼Œä¸€ä¸ª code ä¸­çš„å•ä¸ªåˆæ³•ç¼–ç ï¼ˆäºŒè¿›åˆ¶ä¸²ï¼‰è¢«ç§°ä½œä¸€ä¸ª *code word*ã€‚

## Gray Code

Gray code çš„æ€§è´¨ï¼šç›¸é‚»ä¸¤ä¸ªæ•°çš„ code word åªæœ‰ä¸€ä½ä¸åŒï¼Œä¸” $2^n-1$ çš„ code word ä¸­åªæœ‰ä¸€ä¸ª 1ï¼ˆä¹Ÿå°±æ˜¯è¯´ $n$-bit Gray code çš„é¦–å°¾ä¹Ÿåªæœ‰ä¸€ä½ä¸åŒï¼‰ã€‚

<Card title="4-bit Gray code" fold>

\`\`\`
 0: 0000
 1: 0001
 2: 0011
 3: 0010
 4: 0110
 5: 0111
 6: 0101
 7: 0100
 8: 1100
 9: 1101
10: 1111
11: 1110
12: 1010
13: 1011
14: 1001
15: 1000
\`\`\`

</Card>

é€’å½’æ„é€ ï¼š

1.  $1$-bit Gray code: 0 æ˜¯ 0ï¼Œ1 æ˜¯ 1
2.  $(n+1)$-bit Gray code:
    -   å‰ $2^n$ ä¸ªæ•°å’Œ $n$-bit Gray code ç›¸åŒï¼ˆå¼€å¤´åŠ ä¸Š 0ï¼‰
    -   å $2^n$ ä¸ªæ•°æ˜¯æŠŠ $2^n$ ä¸ª $n$-bit Gray code é€†åºæ’åˆ—å†åœ¨å¼€å¤´åŠ ä¸Š 1

ç›´æ¥è®¡ç®—å•ä¸ªæ•°çš„ Gray codeï¼š

-   é€’å½’å°±èƒ½ç›´æ¥è®¡ç®—ï¼Œ~~ç›¸ä¿¡å¤§å®¶éƒ½ä¼šåš [NOIPD1T1](https://uoj.ac/problem/488) å§ï¼Œè®°å¾—å¼€ \`unsigned long long\`~~ï¼ˆ
-   ä¹Ÿå¯ä»¥è¿™ä¹ˆç®—ï¼š$n$ çš„ Gray code ç¬¬ $i$ ä½ä¸º 1 å½“ä¸”ä»…å½“ $n$ çš„äºŒè¿›åˆ¶ä¸­ç¬¬ $i$ ä½å’Œç¬¬ $i+1$ ä½ä¸åŒ

ä¹¦ä¸­æè¿°äº†ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼šä¸€ä¸ªç£ç›˜çš„æ¯ä¸ªæ‰‡åŒºéœ€è¦ç¼–ç ï¼Œä»æ‰‡åŒºä¸Šè¯»å–è‹¥å¹² bits æ¥è¯†åˆ«å½“å‰å¤„äºå“ªä¸ªæ‰‡åŒºï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»æ‰‡åŒºçš„äº¤ç•Œå¤„å¯èƒ½æœ‰éƒ¨åˆ† bits æ¥è‡ªå…¶ä¸­ä¸€ä¸ªæ‰‡åŒºï¼Œå¦å¤–çš„ bits æ¥è‡ªå¦ä¸€ä¸ªæ‰‡åŒºï¼ŒGray code å¯ä»¥ä½¿æœ€ç»ˆè¯»å–åˆ°çš„ç»“æœä¸€å®šæ˜¯è¿™ä¸¤ä¸ªæ‰‡åŒºä¹‹ä¸€ã€‚

## Codes for Actions, Conditions, and States

è¯´ç™½äº†å°±æ˜¯å¦‚ä½•ç¼–ç ä¸€ä¸ª enumã€‚ä¸åŒçš„ç¼–ç æ–¹å¼æœ‰å„è‡ªçš„ç‰¹ç‚¹ï¼Œå¯ä»¥ä»ç¼–ç é•¿åº¦ã€ç”µè·¯å¼€é”€ã€è®¾è®¡éš¾åº¦ã€å¯çº é”™æ€§ç­‰è§’åº¦è€ƒè™‘ï¼Œé€‰æ‹©æœ€åˆé€‚çš„ç¼–ç æ–¹å¼ï¼Œæˆ–è€…ç»„åˆä½¿ç”¨å¤šç§ç¼–ç æ–¹å¼ã€‚

-   é¡ºç€ç¼–ç ä¸ºäºŒè¿›åˆ¶å¯ä»¥ä½¿ç¼–ç é•¿åº¦æœ€çŸ­ï¼ˆ$\\lceil \\log_2 n \\rceil$ï¼‰ã€‚
-   *1-out-of-n-code*ï¼šåˆæ³•çš„ code word åªæœ‰ä¸€ä½æ˜¯ 1ï¼Œæ¯ä¸ª enum å¯¹åº”æŸä¸€ä½ä¸º 1ã€‚ä¾‹å¦‚ï¼Œæ§åˆ¶å“ªä¸ªç¯å¼€æ—¶ï¼Œè¿™ç§ç¼–ç æ–¹å¼æ— éœ€å†æœ‰ç”µè·¯æ¥é€‰æ‹©è¦å¼€çš„ç¯ï¼Œç›´æ¥å°†ç¼–ç çš„æ¯ä¸€ä½è¿åˆ°ä¸€ç›ç¯å°±å¯ä»¥äº†ã€‚
-   *m-out-of-n-code*ï¼šåˆæ³•çš„ code word æ°æœ‰ $m$ ä½æ˜¯ 1ã€‚è¦æ£€æµ‹ä¸€ä¸ª code wordï¼Œåªéœ€ä½¿ç”¨ä¸€ä¸ª $m$-input AND gateï¼Œç”µè·¯è¾ƒä¸ºç®€å•ã€‚è€Œ code word æ€»æ•°æœ‰ $\\binom nm$ï¼Œä¹Ÿå¾ˆå¤šã€‚

## n-Cubes and Distance

ä»¥ $2^n$ ä¸ª $n$-bit äºŒè¿›åˆ¶ä¸²ä½œä¸ºé¡¶ç‚¹ï¼Œåœ¨åªæœ‰ä¸€ä¸ª bit ä¸åŒçš„ä¸²ä¹‹é—´è¿è¾¹ï¼Œå¾—åˆ°çš„å›¾è¢«ç§°ä½œ *$n$-cube*ï¼Œå¯ä»¥ç”»æˆä¸€ä¸ªï¼ˆè¶…ï¼‰ç«‹æ–¹ä½“ï¼šï¼ˆDDPP5 Figure 2-8ï¼‰

![n-cubes for n = 1, 2, 3, and 4.](ddpp-fig-2-8.png)

å›¾ä¸Šä¸¤ä¸ªäºŒè¿›åˆ¶ä¸²ä¹‹é—´çš„è·ç¦»è¢«ç§°ä½œ *Hamming distance*ï¼Œè¡¨ç¤ºä¸¤ä¸ªä¸²ä¸­ä¸ç›¸åŒçš„ä½æ•°ã€‚

## Codes for Detecting and Correcting Errors

å®é™…å­˜å‚¨ã€ä¼ è¾“ç¼–ç æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚é”™è¯¯çš„å…·ä½“è¡Œä¸ºå¯ä»¥ç”± *error model* åˆ»ç”»ã€‚æœ€ç®€å•çš„ error model æ˜¯ *independent error model*ï¼Œå³æ¯ä¸ªé”™è¯¯åªç‹¬ç«‹åœ°æ”¹å˜ç¼–ç ä¸­çš„ä¸€ä½ï¼Œå¤šä½åŒæ—¶å‘ç”Ÿé”™è¯¯çš„æ¦‚ç‡æ¯”ä¸€ä½å‘ç”Ÿé”™è¯¯çš„æ¦‚ç‡å°å¾—å¤šã€‚

### Error-Detecting Codes

å¯¹äºä¸€ä¸ª codeï¼Œä¸æ˜¯ code word çš„äºŒè¿›åˆ¶ä¸²ç§°ä½œ *noncode word*ã€‚

*error-detecting code* å…·æœ‰è¿™æ ·çš„æ€§è´¨ï¼šä»»ä½•ä¸€ä¸ª code word åœ¨ä»»æ„ä¿®æ”¹ä¸€ä½åéƒ½ä¼šå¾—åˆ°ä¸€ä¸ª noncode wordã€‚

ä½¿ç”¨ error-detecting code æ—¶ï¼Œå¯ä»¥è®¤ä¸ºåªè¦æ˜¯ code word éƒ½æ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œnoncode word åˆ™ä¸€å®šå‘ç”Ÿäº†é”™è¯¯ã€‚

ä¸€ä¸ª $n$-bit error-detecting code æ˜¯ $n$-cube çš„ä¸€ä¸ªç‚¹ç‹¬ç«‹é›†ï¼Œä¹Ÿå°±æ˜¯è¯´ä»»æ„ä¸¤ä¸ª code word çš„ Hamming distance éƒ½è‡³å°‘ä¸º 2ã€‚

å¥‡å¶æ€§å¯ä»¥ç”¨æ¥è®¾è®¡ error-detecting codeï¼šä»»ç»™ä¸€ä¸ª $n$-bit codeï¼Œå°†ç¬¬ $n+1$ ä½è®¾ä¸ºå‰ $n$ ä½ä¸­ 1 çš„ä¸ªæ•°çš„å¥‡å¶æ€§ï¼ˆç§°ä½œ *parity bit*ï¼‰ï¼Œåˆ™å¯ä»¥å¾—åˆ°ä¸€ä¸ª $(n+1)$-bit error-detecting codeã€‚è¿™æ ·çš„ç¼–ç ç§°ä½œ *1-bit parity code*ï¼Œè‹¥ code word éƒ½æœ‰å¶æ•°ä¸ª 1 åˆ™ç§°ä½œ *even-parity code*ï¼Œæœ‰å¥‡æ•°ä¸ª 1 åˆ™ç§°ä½œ *odd-parity code*ã€‚

### Error-Correcting and Multiple-Error-Detecting Codes

å¦‚æœä¸€ä¸ª code ä¸­ä¸¤ä¸ª code word çš„æœ€å° Hamming distance æœ‰ $2c+d+1$ï¼Œåˆ™å¯ä»¥å¯¹æœ€å¤š $c$ ä½çš„é”™è¯¯è¿›è¡Œçº æ­£ï¼Œå¹¶ä¸”æ£€æµ‹åˆ°æœ€å¤š $c+d$ ä½çš„é”™è¯¯ï¼ˆä¸€ä¸ª $c+d+1 \\sim 2c+d$ ä½çš„é”™è¯¯ä¼šè¢«è®¤ä¸ºæ˜¯æ¥è‡ªå¦ä¸€ä¸ªæ–¹å‘çš„é”™è¯¯è€Œè¢«é”™è¯¯åœ°çº æ­£ï¼Œä»è€Œä¸èƒ½è¢«æ£€æµ‹åˆ°ï¼›å¯ä»¥é€‰æ‹©å°‘çº é”™å‡ ä½æ¥æ£€æµ‹åˆ°æ›´å¤šä½çš„é”™è¯¯ï¼‰ã€‚

çº é”™å°±æ˜¯æ‰¾åˆ°å’Œä¸€ä¸ª noncode word çš„ Hamming distance æœ€å°çš„å”¯ä¸€ä¸€ä¸ª code wordï¼Œè¿›è¡Œçº é”™çš„ç¡¬ä»¶è¢«ç§°ä½œ error-correcting decoderã€‚

### Hamming Codes

*Hamming code* æ˜¯ä¸€ç§é€šç”¨çš„æœ€å°è·ç¦»ä¸º 3 çš„ç¼–ç ã€‚ä¸€ä¸ªæœ‰ $n$ ä¸ª check bit çš„ Hamming code æœ€å¤šå¯ä»¥å­˜å‚¨ $2^n-n-1$ ä¸ª information bitï¼Œä»è€Œæ€»å…±æœ‰ $2^n-1$ ä¸ª bitã€‚

ä¸€ä¸ª $(2^n-1)$-bit Hamming code çš„ bit ä¾æ¬¡ç¼–å·ä¸º $1 \\sim 2^n-1$ï¼Œç¼–å·ä¸º $1, 2, 4, \\ldots, 2^{n-1}$ çš„ bit æ˜¯ check bitã€‚æ¯ä¸ª check bit ä»£è¡¨ä¸€ä¸ª groupï¼Œç¼–å·ä¸º $2^i$ çš„ check bit æ‰€ä»£è¡¨çš„ group åŒ…å«çš„æ˜¯ç¼–å·çš„äºŒè¿›åˆ¶ä¸­åŒ…å« $2^i$ çš„æ‰€æœ‰ bitã€‚check bit çš„å–å€¼ä½¿å¾—æ¯ä¸ª group éƒ½å«å¶æ•°ä¸ª 1ã€‚

å®é™…ä½¿ç”¨çš„ Hamming code å¾€å¾€ä¼šå°† check bit ç§»åˆ°æœ«å°¾ï¼Œä¾‹å¦‚ä¸€ä¸ª $15$-bit Hamming code ä¸­ bit çš„ç¼–å·ä¾æ¬¡ä¸º 15, 14, 13, 12, 11, 10, 9, 7, 6, 5, 3, 8, 4, 2, 1ã€‚

å› ä¸ºæ¯ä¸ª bit éƒ½è‡³å°‘å±äºä¸€ä¸ª groupï¼Œæ”¹å˜ä¸€ä¸ª bit ä¼šå¾—åˆ° noncode wordã€‚æ”¹å˜ç¼–å·ä¸º $i$ å’Œ $j$ çš„ä¸¤ä¸ª bit æ—¶ï¼Œä¼šæ”¹å˜ $i$ å¼‚æˆ– $j$ å¯¹åº”çš„ groupï¼Œæ‰€ä»¥æ”¹å˜ä¸¤ä¸ª bit ä¼šå¾—åˆ° noncode wordã€‚æ‰€ä»¥ Hamming code ä¸­ä¸¤ä¸ª code word çš„ Hamming distance è‡³å°‘ä¸º 3ã€‚

çº é”™æ—¶ï¼Œåªè¦å°†é”™è¯¯çš„ check bit çš„ç¼–å·æˆ–èµ·æ¥å°±å¯ä»¥å¾—åˆ°é”™è¯¯çš„ bit çš„ç¼–å·ã€‚

å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ª parity bit æ¥å¾—åˆ°ä¸€ä¸ªæœ€å°è·ç¦»ä¸º 4 çš„ $2^n$-bit extended Hamming codeã€‚

### CRC Codes

*cyclic-redundancy-check (CRC) codes* æ˜¯ä¸€ç§å¾—åˆ°å¹¿æ³›åº”ç”¨çš„ error-correcting codeï¼Œä¾‹å¦‚è¢«ç”¨åœ¨æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œé€šä¿¡ä¸­ï¼Œå®ƒå¯ä»¥æ£€æµ‹åˆ°æˆå›¢å‡ºç°çš„å¤šä½é”™è¯¯ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸­è¿™ç§é”™è¯¯æ¯”éšæœºå‡ºç°çš„é”™è¯¯æ¦‚ç‡æ›´é«˜ã€‚

### Two-Dimensional Codes

å¦‚ DDPP5 Figure 2-14 (a) æ‰€ç¤ºï¼š

![æ‰€æœ‰ bits æ’åˆ—æˆä¸€ä¸ªçŸ©é˜µï¼ŒçŸ©é˜µè¢«åˆ’åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†: information bits, checks on rows, checks on columns, checks on checks.](ddpp-fig-2-14-a.png)

é€‰æ‹© $C_{\\mathrm{row}}$ å’Œ $C_{\\mathrm{col}}$ ä¸¤ç§ç¼–ç æ–¹å¼ï¼Œè®¾ç½® checks on rows ä½¿å¾— information bits æ‰€åœ¨çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ª $C_{\\mathrm{row}}$ çš„ code wordï¼Œè®¾ç½® checks on columns ä½¿å¾— information bits æ‰€åœ¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸€ä¸ª $C_{\\mathrm{col}}$ çš„ code wordï¼Œè€Œ checks on checks åˆ™å¯ä»¥é€‰æ‹©ï¼Œè¦ä¹ˆæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ª $C_{\\mathrm{row}}$ çš„ code wordï¼Œè¦ä¹ˆæ¯ä¸€åˆ—éƒ½æ˜¯ä¸€ä¸ª $C_{\\mathrm{col}}$ çš„ code wordã€‚

è¿™æ ·å¾—åˆ°çš„ *two-dimensional code* çš„æœ€å°è·ç¦»æ˜¯ $C_{\\mathrm{row}}$ å’Œ $C_{\\mathrm{col}}$ çš„ä¹˜ç§¯ï¼Œæ‰€ä»¥ two-dimensional code ä¹Ÿè¢«å«åš *product code*ã€‚

RAID å°±å¯ä»¥çœ‹ä½œä½¿ç”¨äº† two-dimensional codeï¼šæ¯å—æ•°æ®ç›˜å†…çš„æ¯ä¸ª block éƒ½æœ‰ CRC codeï¼Œè¿˜æœ‰ä¸€å—ç¡¬ç›˜ç”¨æ¥å­˜æ‰€æœ‰æ•°æ®ç›˜çš„ parity bitsã€‚

### Checksum Codes

parity bit å¯ä»¥çœ‹ä½œæ˜¯ bits åœ¨æ¨¡ 2 æ„ä¹‰ä¸‹çš„å’Œï¼Œå¯ä»¥æ¨å¹¿ä¸º *checksum*ã€‚

ä¾‹å¦‚ï¼Œæ¨¡ 256 æ„ä¹‰ä¸‹ï¼Œå¯ä»¥è®¡ç®— bytes çš„å’Œï¼Œæ¥æ£€æµ‹ bytes çš„é”™è¯¯ã€‚

é™¤äº†æ”¹å˜æ¨¡æ•°ï¼Œè¿˜å¯ä»¥æ”¹å˜è®¡ç®—æ–¹å¼ï¼Œä¾‹å¦‚ä½¿ç”¨ onesâ€™ complement åŠ æ³•æ¥è®¡ç®—æ¨¡ 255 æˆ– 65535 æ„ä¹‰ä¸‹çš„ checksumã€‚

### m-out-of-n Codes

[m-out-of-n code](#codes-for-actions-conditions-and-states) çš„æœ€å°è·ç¦»ä¸º 2ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ£€æµ‹åˆ° *unidirectional multiple errors*ï¼Œå³æ‰€æœ‰é”™è¯¯éƒ½æ˜¯ 0 å˜ 1 æˆ– 1 å˜ 0 çš„æ”¹å˜å¤šä½çš„é”™è¯¯ã€‚

## Codes for Transmitting and Storing Serial Data

-   parallel data transmission: ä¸€ä¸ª data word çš„æ‰€æœ‰ bit åŒæ—¶ä¼ è¾“
-   serial data transmission: ä¸€ä¸ª bit ä¸€ä¸ª bit ä¼ è¾“

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œserial data transmission å¯ä»¥å‡å°‘çº¿è·¯å¼€é”€ï¼Œæˆ–è€…å‡å°‘ä¸€äº›è®¾è®¡ä¸Šçš„å›°éš¾ã€‚

æœ€åŸºæœ¬çš„ serial data transmission éœ€è¦ä¸‰ä¸ªä¿¡å·ï¼š

-   CLOCK: å°†æ—¶é—´åˆ’åˆ†ä¸ºä¸€ä¸ªä¸ª *bit cell*ï¼Œæ ‡è¯†å‡ºæ¯ä¸ª bit æ‰€å¤„çš„æ—¶é—´èŒƒå›´
-   SERDATA: å®é™…ä¼ è¾“çš„æ•°æ®ï¼Œå…·ä½“å†…å®¹ä¾ *line code* è€Œå®š
-   SYNC: ç”¨æ¥æ ‡è¯† bit çš„ significanceï¼Œä¾‹å¦‚ä¼ è¾“ bytes æ—¶ç”¨æ¥æ ‡è®°æ¯ä¸ª byte çš„å¼€å¤´

å®é™…ä¸Šï¼Œä¹Ÿå¯ä»¥é€‰æ‹©åˆé€‚çš„ line code ä»è€Œåªéœ€ä¼ è¾“ä¸€ä¸ªä¿¡å·ï¼Œä»æ•°æ®ä¿¡å·ä¸­è¯»å–å‡º CLOCK å’Œ SYNC çš„ä¿¡æ¯ã€‚

<Card title="Serial Line Codes" type="wip">
Serial Line Codes è¿™ä¸€èŠ‚æˆ‘æ„Ÿè§‰æœ‰äº›åœ°æ–¹æ²¡å®Œå…¨ç†è§£ï¼Œä¹Ÿæœ‰å’Œ Wikipedia æœ‰å‡ºå…¥çš„åœ°æ–¹ï¼Œä¹Ÿæ ‡æ˜Ÿäº†ï¼Œæ„Ÿè§‰åé¢ä¸ä¸€å®šç”¨å¾—ä¸Šï¼Œå°±å…ˆå’•äº†ã€‚
</Card>
`},{title:A,tags:i,content:`[DDPP5](https://wakerly.org/DDPP/) ç¬¬ä¸‰ç«  â€œSwitching Algebra and Combinational Logicâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

æœ¬ç« çš„ä¸»è¦å†…å®¹ä¸ºé€»è¾‘ä»£æ•°ã€é€»è¾‘ä»£æ•°åœ¨ç”µè·¯ä¸­çš„ä½¿ç”¨åŠåŒ–ç®€ã€timing hazardã€‚



## Switching Algebra

è¿™ä¸€èŠ‚åŸºæœ¬ä¸Šå°±æ˜¯ç¦»æ•£æ•°å­¦ (1) å¼€å¤´ä¸¤ç« çš„å†…å®¹ï¼Œæœ¯è¯­å’Œè®°å·æœ‰å¾ˆå¤šä¸åŒï¼Œ~~å¹¸å¥½å¿˜çš„å·®ä¸å¤šäº†ï¼Œä¸ç„¶éƒ½è¦ææ··äº†~~ã€‚

### è®°å·

-   ANDï¼š$X\\ \\cdot\\ Y$
-   <span class="inline-block w-3"/>ORï¼š$X + Y$
-   NOTï¼š$X'$
-   AND çš„ä¼˜å…ˆçº§é«˜äº OR

ï¼ˆyysy æˆ‘è¿˜æ˜¯æ›´å–œæ¬¢ $\\lor, \\land$ï¼Œ$\\cdot$ ä¹Ÿè¿˜è¡Œï¼Œ$+$ çœŸçš„æœ‰ç‚¹éš¾ä»¥æ¥å—ã€‚ï¼‰ï¼ˆ~~å®ƒä»¬æ˜æ˜æ˜¯å¯¹å¶çš„æ€ä¹ˆæå¾—åƒä¸ªç¯ä¸€æ ·ã€‚~~ï¼‰ï¼ˆä¸»è¦è¿˜æ˜¯ä¸‹é¢è¿™äº›å®šç†ç”¨åŠ å·çœ‹èµ·æ¥çœŸçš„å¥½æ€ªã€‚ï¼‰ï¼ˆå¼‚æˆ–ä¸æ˜¯è¿˜å·ç§°äºŒè¿›åˆ¶åŠ æ³•å—ã€‚ï¼‰

### å…¬ç†

$$
\\begin{array}{rl}
\\text{(A1)} & X \\ne 1 \\implies X = 0 \\\\
\\text{(A1D)} & X \\ne 0 \\implies X = 1 \\\\\\\\
\\text{(A2)} & X = 0 \\implies X' = 1 \\\\
\\text{(A2D)} & X = 1 \\implies X' = 0 \\\\\\\\
\\text{(A3)} & 0 \\ \\cdot\\  0 = 0 \\\\
\\text{(A3D)} & 1 + 1 = 1 \\\\\\\\
\\text{(A4)} & 1 \\ \\cdot\\  1 = 1 \\\\
\\text{(A4D)} & 0 + 0 = 0 \\\\\\\\
\\text{(A5)} & 0 \\ \\cdot\\  1 = 1 \\ \\cdot\\  0 = 0 \\\\
\\text{(A5D)} & 1 + 0 = 0 + 1 = 1
\\end{array}
$$

### å®šç†

ä¸­æ–‡åæ¥è‡ªã€Šæ•°ç†é€»è¾‘ä¸é›†åˆè®ºï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹2.2 èŠ‚â€œç­‰å€¼å…¬å¼â€ã€‚

$$
\\begin{array}{ll}

\\begin{array}{rl}
\\enspace\\text{(T1)} & X + 0 = X \\\\
\\enspace\\text{(T1D)} & X \\ \\cdot\\  1 = X
\\end{array}
& \\text{Identitiesï¼ˆåŒä¸€å¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\text{(T2)} & X + 1 = 1 \\\\
\\enspace\\text{(T2D)} & X \\ \\cdot\\  0 = 0
\\end{array}
& \\text{Null elementsï¼ˆé›¶å¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\text{(T3)} & X + X = X \\\\
\\enspace\\text{(T3D)} & X \\ \\cdot\\  X = X
\\end{array}
& \\text{Idempotencyï¼ˆå¹‚ç­‰å¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\quad\\ \\text{(T4)} & (X')' = X
\\end{array}
& \\text{Involutionï¼ˆåŒé‡å¦å®šå¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\text{(T5)} & X + X' = 1 \\\\
\\enspace\\text{(T5D)} & X \\ \\cdot\\  X' = 0
\\end{array}
& \\text{Complementsï¼ˆè¡¥ä½™å¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\text{(T6)} & X + Y = Y + X \\\\
\\enspace\\text{(T6D)} & X \\ \\cdot\\  Y = Y \\ \\cdot\\  X
\\end{array}
& \\text{Commutativityï¼ˆäº¤æ¢å¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\text{(T7)} & (X + Y) + Z = X + (Y + Z) \\\\
\\enspace\\text{(T7D)} & (X \\ \\cdot\\  Y) \\ \\cdot\\  Z = X \\ \\cdot\\  (Y \\ \\cdot\\  Z)
\\end{array}
& \\text{Associativityï¼ˆç»“åˆå¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\text{(T8)} & X \\ \\cdot\\  (Y + Z) = \\,\\: X \\ \\cdot\\  Y \\,\\: + \\,\\: X \\ \\cdot\\  Z \\,\\: \\\\
\\enspace\\text{(T8D)} & X + \\,\\: Y \\ \\cdot\\  Z \\,\\: = (X + Y) \\ \\cdot\\  (X + Z)
\\end{array}
& \\text{Distributivityï¼ˆåˆ†é…å¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\text{(T9)} & X + \\,\\: X \\ \\cdot\\  Y \\,\\: = X \\\\
\\enspace\\text{(T9D)} & X \\ \\cdot\\  (X + Y) = X
\\end{array}
& \\text{Coveringï¼ˆå¸æ”¶å¾‹ï¼‰}
\\\\\\\\

\\begin{array}{rl}
\\text{(T10)} & \\,\\: X \\ \\cdot\\  Y \\,\\: + \\,\\: X \\ \\cdot\\  Y' \\,\\: = X \\\\
\\text{(T10D)} & (X + Y) \\ \\cdot\\  (X + Y') = X
\\end{array}
& \\text{Combining}
\\\\\\\\

\\begin{array}{rl}
\\text{(T11)} & \\begin{aligned} & X \\cdot Y + X' \\cdot Z + Y \\cdot Z \\\\[-0.2em] =\\ & X \\cdot Y + X' \\cdot Z \\end{aligned} \\\\
\\text{(T11D)} & \\begin{aligned} & (X + Y) \\cdot (X' + Z) \\cdot (Y + Z) \\\\[-0.2em] =\\ & (X + Y) \\cdot (X' + Z) \\end{aligned}
\\end{array}
& \\text{Consensus}
\\\\\\\\

\\begin{array}{rl}
\\text{(T12)}  & X + X + \\cdots + X = X \\\\
\\text{(T12D)} & X \\ \\cdot\\  X \\ \\cdot\\ \\cdots\\ \\cdot\\  X = X
\\end{array}
& \\text{Generalized idempotency}
\\\\\\\\

\\begin{array}{rl}
\\text{(T13)} &
\\begin{aligned}
& (X \\ \\ \\cdot\\  X \\ \\ \\cdot\\ \\cdots\\ \\cdot\\  X)' \\\\[-0.2em]
= & \\,\\: X' + X' + \\cdots + X'
\\end{aligned}
\\\\
\\text{(T13D)} &
\\begin{aligned}
& (X + X + \\cdots + X)' \\\\[-0.2em]
= & \\,\\: X' \\cdot\\  X' \\cdot\\  \\cdots \\ \\cdot\\  X'
\\end{aligned}
\\end{array}
& \\begin{array}{c} \\text{DeMorganâ€™s theorem} \\\\ \\text{ï¼ˆæ‘©æ ¹å¾‹ï¼‰} \\end{array}
\\\\\\\\

\\begin{array}{rl}
\\enspace\\ \\text{(T14)} &
\\begin{aligned}
 & [F(X_1, X_2, \\ldots, X_n, +, \\ \\cdot\\ )]' \\\\[-0.2em]
=&\\ F(X_1', X_2', \\ldots, X_n', \\ \\cdot\\ , +)
\\end{aligned}
\\end{array}
& \\begin{array}{c} \\text{Generalized} \\\\ \\text{DeMorganâ€™s theorem} \\end{array}
\\end{array}
$$

$$
\\begin{array}{rl}
& \\text{Shannonâ€™s expansion theorems} \\\\[0.3em]
\\text{(T15)} & F(X_1, X_2, \\ldots, X_n) = \\ X_1 \\ \\cdot\\  F(1, X_2, \\ldots, X_n) + X_1' \\ \\cdot\\  F(0, X_2, \\ldots, X_n) \\\\
\\text{(T15D)} & F(X_1, X_2, \\ldots, X_n) = [X_1 + F(1, X_2, \\ldots, X_n)] \\cdot [X_1' + F(0, X_2, \\ldots, X_n)]
\\end{array}
$$

ï¼ˆ~~è‰ï¼Œå¯¹é½å¥½ç´¯ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦æµªè´¹è¿™ä¸ªæ—¶é—´ã€‚~~ï¼‰

### Duality

å°†ä¸€ä¸ªç­‰å¼ä¸­æ‰€æœ‰çš„ $0$ æ¢æˆ $1$ã€$1$ æ¢æˆ $0$ã€$+$ æ¢æˆ $\\cdot$ã€$\\cdot$ æ¢æˆ $+$ï¼Œç­‰å¼ä¾ç„¶æˆç«‹ã€‚

ä¸Šé¢çš„å®šç†ä¸­å¸¦ â€œDâ€ çš„éƒ½æ˜¯ä¸Šä¸€æ¡çš„å¯¹å¶ã€‚

### Standard Representations of Logic Functions

è¿™é‡Œéœ€è¦ç¿»å‡ºæ¥æˆ‘ç¦»æ•£ (1) å†™çš„ [çœŸå€¼è¡¨ç”Ÿæˆå™¨](https://ouuan.github.io/truth-table-generator/)ï¼ˆå…¶å®å¯ä»¥å»åŠ ä¸Š $+$ å’Œ $\\cdot$ ä½œä¸º aliasï¼Œä½†å¦‚æœè¦åŠ  $'$ çš„è¯ä¼šå¾ˆéº»çƒ¦æ‰€ä»¥å¹²è„†ä¸åŠ äº†å§ï¼ˆ

logic function æœ‰è‹¥å¹²ç²¾ç¡®çš„æ ‡å‡†è¡¨ç¤ºæ–¹æ³•ï¼š

-   çœŸå€¼è¡¨
-   canonical sum: ä¸»æå–èŒƒå¼ï¼Œæå°é¡¹ (minterm) çš„å’Œ
-   ä½¿ç”¨ $\\sum$ è¡¨ç¤ºçš„ minterm list
-   canonical product: ä¸»åˆå–èŒƒå¼ï¼Œæå¤§é¡¹ (maxterm) çš„å’Œ
-   ä½¿ç”¨ $\\prod$ è¡¨ç¤ºçš„ maxterm list
-   Verilog \`case\` è¯­å¥

è¿™é‡Œç”¨ $\\prod$ è¡¨ç¤º maxterm list çš„ä¸‹æ ‡æ¯”ç¦»æ•£ (1) è®²çš„èˆ’æœå¤šäº†ï¼šminterm çš„ index å°±æ˜¯å“ªç»„å˜é‡å–å€¼ä¸‹è¡¨è¾¾å¼å€¼ä¸º 1ï¼Œmaxterm çš„ index å°±æ˜¯å“ªç»„å˜é‡å–å€¼ä¸‹è¡¨è¾¾å¼ä¸º 0ï¼Œæ‰€ä»¥ä¸¤ç§èŒƒå¼çš„ä¸‹æ ‡åˆšå¥½æ˜¯è¡¥é›†ã€‚ä¾‹å¦‚ï¼Œæœ‰ $X, Y, Z$ ä¸‰ä¸ªå˜é‡ï¼Œ$X' \\cdot Y \\cdot Z'$ çš„ä¸‹æ ‡æ˜¯ $2$ï¼Œ$X' + Y + Z'$ çš„ä¸‹æ ‡æ˜¯ $5$ï¼›$\\sum_{X,Y,Z}(1,2,6) = X' \\cdot Y' \\cdot Z + X' \\cdot Y \\cdot Z' + X \\cdot Y \\cdot Z' = \\prod_{X,Y,Z}(0,3,4,5,7)$ã€‚

Verilog çš„ \`case\` è¯­å¥å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼šï¼ˆè™½ç„¶è¿˜å®Œå…¨æ²¡å­¦ Verilogï¼Œä½†æˆ‘æ„Ÿè§‰ Shiki è‡ªå¸¦çš„ system-verilog é«˜äº®çœ‹èµ·æ¥å°±æ¯” verilog æ­£ç¡®è®¸å¤šï¼Œä»¥åå¯èƒ½ä¹Ÿç”¨ system-verilog çš„é«˜äº®äº†ï¼‰

\`\`\`system-verilog
case ({X,Y,Z})
  1,2,6:    F = 1;
  default:  F = 0;
endcase
\`\`\`

## Combinational-Circuit Analysis

è¿™ä¸€èŠ‚å°±æ˜¯è¯´ç»™ä½ ä¸€ä¸ªç”µè·¯å›¾æ€ä¹ˆæå‡ºå®ƒçš„ logic functionã€‚å…¶å®æ²¡å•¥å¥½è¯´çš„ï¼Œå°±ï¼ˆæŒ‰æ‹“æ‰‘åºï¼‰ä¸€ä¸ªä¸€ä¸ª gate é€’æ¨å°±è¡Œï¼Œå¯ä»¥ç”¨çœŸå€¼è¡¨ä¹Ÿå¯ä»¥ç”¨é€»è¾‘è¡¨è¾¾å¼ã€‚

æœ‰ä¸€ä¸ªå° trickï¼šDeMorganâ€™s theorem åœ¨ç”µè·¯å›¾ä¸­è¡¨ç°ä¸ºï¼Œå°† inversion bubble æ¢åˆ°å¦ä¸€ä¾§ï¼ˆè¾“å…¥ / è¾“å‡ºï¼‰ï¼Œå¹¶ä¸”æ”¹å˜ gate çš„ç±»å‹ï¼ˆAND / ORï¼‰ï¼Œè¿™æ ·çš„è¯ï¼Œå¦‚æœä¸¤ä¸ª inversion bubble åœ¨ä¸€æ¡ wire ä¸Šå°±å¯ä»¥æ¶ˆæ‰ã€‚

## Combinational-Circuit Synthesis

åœ¨ digital design ä¸­ï¼Œâ€œSynthesisâ€ æœ‰è‹¥å¹²ç§å«ä¹‰ï¼ˆä¾‹å¦‚ä» HDL åˆ° FPGAï¼‰ï¼Œè€Œåœ¨è¿™ä¸€èŠ‚åªæ˜¯æŒ‡ä» formal description åˆ° gate-level circuitã€‚

### Circuit Descriptions and Designs

è‡ªç„¶è¯­è¨€æè¿° â†’ é€»è¾‘è¡¨è¾¾å¼ / çœŸå€¼è¡¨ï¼ˆcanonical sum / productï¼‰ â†’ ç”µè·¯

å¾ˆå¤šæ—¶å€™å†™å‡ºé€»è¾‘è¡¨è¾¾å¼ä¼šæ¯”åˆ—å‡ºçœŸå€¼è¡¨ç®€å•ä¸€äº›ï¼Œä½†åœ¨é¢å¯¹è¾ƒä¸ºå¤æ‚çš„é€»è¾‘å…³ç³»æ—¶ï¼Œåˆ—å‡ºçœŸå€¼è¡¨å¯ä»¥å¼ºåˆ¶è®¾è®¡å¸ˆè€ƒè™‘åˆ°æ¯ç§æƒ…å†µï¼Œä»è€Œé¿å…æ¼æ‰ corner caseã€‚

ä¸€ä¸ªè¾“å‡ºæ˜¯æŸä¸ªé€»è¾‘è¡¨è¾¾å¼çš„ç”µè·¯è¢«ç§°ä½œ *realize* äº†è¿™ä¸ªè¡¨è¾¾å¼ï¼Œæ˜¯è¿™ä¸ªè¡¨è¾¾å¼çš„ *realization* æˆ–è€… *implementation*ã€‚

### Circuit Manipulations

åœ¨å¤šæ•°ç”µè·¯æŠ€æœ¯ï¼ˆåŒ…æ‹¬ CMOSï¼‰ä¸­ï¼ŒNAND / NOR æ¯” AND / OR æ•ˆç‡æ›´é«˜ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šä¿®æ”¹ç”µè·¯æ¥å°½é‡ä½¿ç”¨ inverting gate è€Œé noninverting gateï¼š

-   åœ¨ wire ä¸Šç§»åŠ¨ inversion bubbleï¼ˆä»ä¸Šä¸€ä¸ªè¾“å‡ºç§»åˆ°ä¸‹ä¸€ä¸ªè¾“å…¥ï¼‰
-   åœ¨ wire çš„ä¸¤ä¾§åŒæ—¶åŠ ä¸Š inversion bubbleï¼ˆæˆ–è€… NOT gateï¼‰
-   æ¶ˆé™¤åŒä¸€æ ¹ wire ä¸Šçš„ä¸¤ä¸ª inversion bubble
-   å°† inversion bubble æ¢åˆ°å¦ä¸€ä¾§ï¼ˆè¾“å…¥ / è¾“å‡ºï¼‰ï¼Œå¹¶ä¸”æ”¹å˜ gate çš„ç±»å‹ï¼ˆAND / ORï¼‰

### Combinational-Circuit Minimization

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€»è¾‘è¡¨è¾¾å¼çš„åŒ–ç®€ä¸»è¦ç”¨çš„æ˜¯å®šç† T10ï¼ˆCombiningï¼‰ï¼Œå°±æ˜¯åœ¨ sum of products ä¸­æ‰¾åˆ°ä»…æœ‰ä¸€é¡¹ç›¸åçš„ä¸¤ä¸ª product å°†å®ƒä»¬åˆå¹¶ï¼Œæœ€ç»ˆå¾—åˆ°çš„ä¹Ÿæ˜¯ä¸€ä¸ª sum of productsï¼Œå®ç°ä¸º 2-levelï¼ˆfirst-level è®¡ç®— productï¼Œsecond-level è®¡ç®— sumï¼‰çš„ç”µè·¯ã€‚

product of sums ç”µè·¯æ˜¯å¯¹å¶çš„ï¼Œå°±ä¸é‡å¤äº†ï¼Œä¸‹æ–‡ä¹Ÿæ˜¯ä¸€æ ·ã€‚

### Karnaugh Maps

å¦‚ DDPP5 Figure 3-23 æ‰€ç¤ºï¼š

![2-variable, 3-variable, and 4-variable Karnaugh maps](ddpp-fig-3-23.png)

åœ¨ Karnaugh map ä¸­ï¼Œæ¯ä¸€ä¸ªè¡¨ç¤ºä¸€ä¸ª mintermï¼Œç›¸é‚»ï¼ˆåŒ…æ‹¬è·¨è¿‡è¾¹ç•Œåˆ°å¦ä¸€ä¾§çš„ç›¸é‚»ï¼‰çš„æ ¼å­ä»…æœ‰ä¸€ä½ç›¸åï¼Œæ‰€ä»¥è¾¹é•¿ä¸º 1 / 2 / 4 çš„çŸ©å½¢å¯ä»¥åˆå¹¶ã€‚

é€‰å‡ºè‹¥å¹²çŸ©å½¢ï¼Œæ°å¥½è¦†ç›–æ‰€æœ‰è¾“å‡ºä¸º 1 çš„æ ¼å­ï¼Œå°±å¯ä»¥åŒ–ç®€é€»è¾‘è¡¨è¾¾å¼ã€‚

å¦‚æœä¸€ä¸ªçŸ©å½¢è¦†ç›–çš„å…¨æ˜¯ 1ï¼Œå¹¶ä¸”æ˜¯æå¤§çš„ï¼ˆåœ¨å…¶å¯¹åº”çš„ product ä¸­å‡å°‘ä»»ä½•ä¸€ä¸ªè¾“å…¥éƒ½ä¼šä½¿å…¶è¦†ç›–åˆ° 0ï¼‰ï¼Œå°±ç§°ä½œä¸€ä¸ª *prime implicant*ã€‚æœ€ç®€çš„é€»è¾‘è¡¨è¾¾å¼æ˜¯è‹¥å¹² prime implicant çš„ sumã€‚

æœ‰çš„å‡½æ•°çš„ Karnaugh map éå¸¸åˆ†æ•£ï¼ˆä¾‹å¦‚ parity functionï¼‰ï¼Œæ²¡æœ‰è¿æˆä¸€å—çš„ 1ï¼Œå°±éœ€è¦å¤šçº§è€Œé 2-level çš„ç”µè·¯æ¥è¿›è¡ŒåŒ–ç®€ã€‚

åœ¨ FPGA ä¸­ï¼Œè¾“å…¥æ•°é‡è¾ƒå°‘çš„ç”µè·¯éƒ½æ˜¯é€šè¿‡ lookup table (LUT) è€Œé gate-level circuit æ¥å®ç°ï¼Œåªéœ€çœŸå€¼è¡¨å°±å¯ä»¥ã€‚ä½†å¤æ‚çš„ç”µè·¯éœ€è¦ç”±å¤šä¸ª LUT ç»„åˆèµ·æ¥ï¼Œæ­¤æ—¶é€»è¾‘è¡¨è¾¾å¼çš„åŒ–ç®€ä¾ç„¶æœ‰ç”¨ã€‚

## Timing Hazards

çœŸå®çš„ç”µè·¯ä¸­ä¼šæœ‰ delayï¼Œè€Œä¸Šé¢ç ”ç©¶çš„éƒ½æ˜¯ combinational logic circuit çš„ *steady-state behavior*ï¼Œæ²¡æœ‰è€ƒè™‘åˆ° *transient behavior*ã€‚

å› ä¸º delay çš„å­˜åœ¨ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼šè¾“å…¥å‘ç”Ÿäº†æ”¹å˜ï¼Œç¨³æ€ä¸‹çš„è¾“å‡ºä¸å˜ï¼Œä½†åœ¨ä¸€ç¬é—´å†…è¾“å‡ºå‘ç”Ÿäº†å˜åŒ–ï¼ˆäº§ç”Ÿäº†ä¸€ä¸ª short pulseï¼‰ã€‚è¿™æ ·çš„ pulse è¢«ç§°ä½œ *glitch*ã€‚

å¦‚æœä¸€ä¸ªç”µè·¯æœ‰äº§ç”Ÿ glitch çš„å¯èƒ½æ€§ï¼Œåˆ™ç§°è¿™ä¸ªç”µè·¯å­˜åœ¨ *hazard*ã€‚å®é™…ç‰©ç†ç”µè·¯çš„ delay å¤§å°ç­‰å› ç´ éš¾ä»¥æ§åˆ¶ï¼Œæ‰€ä»¥è¿™é‡Œåªæ˜¯è€ƒè™‘äº§ç”Ÿ glitch çš„å¯èƒ½æ€§ï¼Œè€Œéå®é™…æ˜¯å¦æœ‰ glitch äº§ç”Ÿï¼ˆæœ‰ç‚¹ç±»ä¼¼äºå¹¶å‘ç¼–ç¨‹ä¸­è¦ä¿è¯æ‰€æœ‰å¯èƒ½çš„æ‰§è¡Œé¡ºåºä¸‹éƒ½ä¸å‡ºé”™ï¼‰ã€‚

### Static Hazards

*static-1 hazard*ï¼šç¨³æ€è¾“å‡ºæ˜¯ 1ï¼Œæ”¹å˜æŸä¸€ä¸ªè¾“å…¥åç¨³æ€è¾“å‡ºè¿˜æ˜¯ 1ï¼Œä½†è¿™ä¸€ä¸ªè¾“å…¥æ”¹å˜æ—¶å¯èƒ½ä¼šçŸ­æš‚åœ°è¾“å‡º 0ã€‚static-0 hazard æ˜¯ç±»ä¼¼çš„ã€‚

ä¹¦ä¸Šç»™äº†ä¸ªä¾‹å­ï¼Œä½†è¿™ä¸ªå…¶å®å¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯ç”µè·¯çš„ä¸€ä¸ªè¾“å…¥ä½œä¸ºå¤šä¸ª gate çš„è¾“å…¥ï¼Œè€Œè¿™äº› gate çš„è¾“å‡ºå˜åŒ–å¾—æœ‰å¿«æœ‰æ…¢ã€‚

### Finding Static Hazards Using Maps

æ­£å¸¸çš„ sum of products ç”µè·¯ä¸­ä¸ä¼šæœ‰ static-0 hazardï¼Œå¯èƒ½æœ‰ static-1 hazardã€‚

å¯ä»¥ç”¨ Karnaugh map æ¥æ‰¾åˆ° hazardï¼šå¦‚æœä¸¤ä¸ªç›¸é‚»çš„ 1 æ²¡æœ‰è¢«åŒä¸€ä¸ª gate è¦†ç›–ï¼Œä»å…¶ä¸­ä¸€ä¸ªå˜ä¸ºå¦ä¸€ä¸ªæ—¶å°±å¯èƒ½äº§ç”Ÿ glitchã€‚ï¼ˆå› ä¸ºæç«¯æƒ…å†µä¸‹å¯èƒ½æ‰€æœ‰è¦†ç›–åŸæ¥é‚£ä¸€æ ¼çš„ gate å…ˆå…¨éƒ¨å˜ä¸º 0ï¼Œè¦†ç›–åæ¥é‚£ä¸€æ ¼çš„ gate æ‰å˜ä¸º 1ã€‚ï¼‰

æ¶ˆé™¤ hazard å°±æ˜¯ç”¨å†—ä½™çš„ gate æ¥è¦†ç›–è¿™æ ·çš„ç›¸é‚»çš„ 1ï¼Œç±»ä¼¼äºå®šç† T11ï¼ˆConsensusï¼‰ã€‚

### Dynamic Hazards

å¦‚æœå˜åŒ–ä¸€ä¸ªè¾“å…¥æ—¶å¯èƒ½äº§ç”Ÿä¸æ­¢ä¸€æ¬¡ glitchï¼Œå°±ç§°ä½œ *dynamic hazard*ã€‚

ä¸€ä¸ªæ­£å¸¸çš„ 2-level sum of products / product of sums ç”µè·¯ä¸­ä¸ä¼šæœ‰ dynamic hazardã€‚

### Designing Hazard-Free Circuits

åœ¨å¤šæ•°ç”µè·¯ä¸­ï¼ˆå°¤å…¶æ˜¯ synchronous digital system ä¸­ï¼‰ï¼Œhazard ä¸ä¼šé€ æˆä»€ä¹ˆå½±å“ã€‚ä½†åœ¨æŸäº›ç”µè·¯ï¼ˆasynchronous sequential circuitsï¼‰ä¸­ï¼Œéœ€è¦é¿å… hazard çš„å­˜åœ¨ã€‚

åœ¨ä¸€èˆ¬çš„ç”µè·¯ä¸­æ¶ˆé™¤ hazard æ˜¯å¤æ‚çš„ï¼Œè€Œåœ¨ sum of products ä¸­ï¼Œå¯ä»¥ç”¨ Karnaugh map æˆ–è€…å–éæ‰€æœ‰ prime implicantï¼ˆç§°ä½œ *complete sum*ï¼‰æ¥æ¶ˆé™¤ hazardã€‚
`},{title:T,tags:i,content:`[DDPP5](https://wakerly.org/DDPP/) ç¬¬å››ç«  â€œDigital Design Practicesâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

æœ¬ç« çš„ä¸»è¦å†…å®¹ä¸ºæ•°å­—è®¾è®¡çš„æ–‡æ¡£è§„èŒƒã€åˆæ­¥è®¤è¯† circuit timingã€åŸºäº HDL çš„æ•°å­—è®¾è®¡æ‰€ä½¿ç”¨çš„å·¥å…·ä¸è®¾è®¡æµç¨‹ã€‚



## Documentation Standards

ä¸€ä¸ª <dfn>document package</dfn> é€šå¸¸è‡³å°‘åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

specification (*spec*)
:   å‡†ç¡®åœ°æè¿°ç³»ç»Ÿçš„æ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºä»¥åŠåŠŸèƒ½ã€‚

block diagram
:   å¤§è‡´æè¿°ç³»ç»Ÿçš„ä¸»è¦æ¨¡å—ä¹‹é—´çš„è¿æ¥ã€‚

logic-device description
:   åˆ†åˆ«æè¿°æ¯ä¸ª â€œcustomâ€ logic device çš„åŠŸèƒ½ï¼Œè¿™é‡Œ â€œcustomâ€ æ˜¯ä¸ç°æˆçš„ã€ç”±å…¶ä»–åˆ¶é€ å•†ç”Ÿäº§çš„ç›¸å¯¹ï¼Œä¾‹å¦‚ ASICã€FPGAã€CPLD ç­‰éƒ½æ˜¯ custom çš„ã€‚

schematic diagram
:   å¯¹æ¯ä¸ªæ¨¡å—çš„ç»†èŠ‚æè¿°ï¼Œæ¯” *logic diagram* æ›´åŠ ç»†è‡´ï¼Œåœ¨ board-level design ä¸­æ˜¯åŒ…æ‹¬ IC typeã€reference designatorã€signal nameã€pin number ç­‰ç»†èŠ‚ä¿¡æ¯çš„ç”µè·¯å›¾ï¼Œåœ¨ FPGAã€CPLD ä¸­åˆ™ç”± HDL model æ¥å……å½“è¿™ä¸€è§’è‰²ã€‚

timing diagram
:   å±•ç¤ºå„ä¸ªä¿¡å·éšæ—¶é—´çš„å˜åŒ–æƒ…å†µã€‚

circuit description
:   è§£é‡Šç”µè·¯çš„å·¥ä½œåŸç†ä»¥åŠæ³¨æ„äº‹é¡¹ã€‚

test plan
:   å¦‚ä½•å¯¹ç³»ç»Ÿè¿›è¡Œæµ‹è¯•ã€‚

æ„Ÿè§‰å¤§è‡´ä¸Šæ¥è¯´ï¼Œä¸è½¯ä»¶è¿›è¡Œç±»æ¯”çš„è¯ï¼Œlogic-device description åƒæ˜¯ç»„ä»¶çš„ API æ–‡æ¡£ï¼Œcircuit description åƒæ˜¯ä»£ç å†…çš„æ³¨é‡Šï¼Œblock diagram åƒæ˜¯æ•´ä¸ªç¨‹åºçš„ç»“æ„å›¾ï¼Œschematic åˆ™æ˜¯â€œä»£ç â€ã€‚æ€»ä¹‹ï¼Œè¿™ä¸ª document package å’Œè½¯ä»¶çš„æ–‡æ¡£ä¸ä¸€æ ·ï¼Œè¿˜åŒ…å« schematic è¿™ç§å…·ä½“å®ç°ã€‚

### Block Diagrams

å¤§æ¦‚å°±æ˜¯ DDPP5 Fig.4-1 è¿™ç§æ„Ÿè§‰ï¼š

![block diagram for a shift-and-add multiplier](ddpp-fig-4-1.png)

æ•´ä¸ªç³»ç»Ÿè¢«åˆ’åˆ†ä¸ºè‹¥å¹² componentï¼Œblock diagram å±•ç¤ºå®ƒä»¬ä¹‹é—´æœ€ä¸»è¦çš„ä¸€äº›è¿çº¿è€Œç•¥å»ç»†èŠ‚ã€‚

åœ¨ block diagram ä¸­ï¼Œä¿¡å·çš„æµåŠ¨å¯ä»¥æ˜¯ä»»æ„æ–¹å‘çš„ï¼Œä¸éœ€è¦éƒ½æ²¿ä¸€ä¸ªæ–¹å‘ã€‚

### Gate Symbols

æ ¹æ® generalized DeMorganâ€™s theoremï¼ŒANDã€ORã€NANDã€NORã€NOT (inverter)ã€BUFFER (non-inverting buffer) å„è‡ªéƒ½æœ‰ä¸¤ç§ä¸åŒçš„ç”»æ³•ï¼Œå¦‚ DDPP5 Fig.4-4 æ‰€ç¤ºï¼š

![åœ¨ generalized DeMorgan's theorem ä¸‹ç­‰ä»·çš„ gate symbols](ddpp-fig-4-4.png)

### Signal Names and Active Levels

ä¸ºäº†å…¼å®¹æ›´å¤šçš„ HDL å’Œ EDAï¼Œsignal name æœ€å¥½ä¸è¦æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œè€Œæ˜¯åªä½¿ç”¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿ï¼Œä»¥å­—æ¯å¼€å¤´ã€‚

signal name å¾€å¾€ä»£è¡¨æŸç§çŠ¶æ€æˆ–æŸç§æ“ä½œï¼Œä½†å¹¶ä¸æ€»æ˜¯åœ¨ä½äº HIGH æ—¶è¡¨ç¤ºç›¸åº”çš„æ„æ€ã€‚æ¯ä¸ª signal name ä¼šæœ‰ä¸€ä¸ª <dfn>active level</dfn>ï¼Œ<dfn>active-high</dfn> æ„å‘³ç€è¿™ä¸ª signal ä½äº HIGH æ—¶ï¼ˆåœ¨ positive-logic ä¸­å³ä¸º 1 æ—¶ï¼‰è¡¨ç¤ºè¿™æŸç§çŠ¶æ€æˆ–æŸç§æ“ä½œï¼Œ<dfn>active-low</dfn> åˆ™ä¸ä¹‹ç›¸åã€‚ä¸€ä¸ª signal ä½äºå…¶ active level æ—¶ï¼Œæˆ‘ä»¬è¯´å®ƒ is <dfn>asserted</dfn>ï¼Œåä¹‹åˆ™è¯´å®ƒ is <dfn>negated</dfn> (*deasserted*)ã€‚

signal name ä¼šä»¥æŸç§ naming convention æ¥è¡¨ç¤ºå…¶ active levelï¼ŒDDPP5 é‡‡ç”¨çš„ convention æ˜¯ active-high ä¿æŒä¸å˜ï¼Œè€Œ active-low åŠ ä¸Š \`_L\` åç¼€ã€‚ä¾‹å¦‚ï¼Œ\`READY\` ä¸º 1 / \`READY_L\` ä¸º 0 è¡¨ç¤º readyï¼Œ\`READY\` ä¸º 0 / \`READY_L\` ä¸º 1 è¡¨ç¤ºæ²¡æœ‰ readyã€‚

ä¸€èˆ¬æ¥è¯´ active-high ç†è§£èµ·æ¥ç›¸å¯¹å®¹æ˜“ï¼Œä½†ç”±äºæ€§èƒ½ã€å…¼å®¹æ€§ç­‰åŸå› ä¹Ÿç»å¸¸ä¼šéœ€è¦ active-lowã€‚

### Active Levels for Pins

gate æˆ–å…¶ä»– logic element çš„ pin ä¸Šæœ‰ inversion bubble æ—¶ï¼Œé™¤äº†ç†è§£æˆä¸åŒçš„é€»è¾‘å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆ active-low çš„è¾“å…¥/è¾“å‡ºã€‚

ä¾‹å¦‚ï¼ŒANDã€NANDã€NORã€OR å¯ä»¥è¡¨ç¤ºå››ç§ä¸åŒ active level çš„ ANDï¼šï¼ˆDDPP5 Fig.4-6ï¼‰

![å››ç§ä¸åŒ active level çš„ AND: AND, NAND, NOR, OR](ddpp-fig-4-6.png)

å› ä¸º inverting gate å¾€å¾€æ€§èƒ½æ›´å¥½ï¼Œå¯ä»¥å°† noninverting gate æ›¿æ¢ä¸º inverting gateï¼Œè€Œç†è§£æˆè¾“å…¥è¾“å‡ºçš„ active level ç›¸åçš„ noninverting gateã€‚

### Bubble-to-Bubble Logic Design

åœ¨ç”»ç”µè·¯å›¾æ—¶ï¼Œå°½é‡å°† active-low çš„ä¿¡å·è¿æ¥åˆ° inversion bubble ä¸Šï¼Œåœ¨ç†è§£ç”µè·¯æ—¶å°±å¯ä»¥å°‘ä¸€äº› logical negationï¼ˆæœ¬è´¨ä¸Šæ˜¯å› ä¸º active-low ä¿¡å·çš„ä¸¤ä¾§éƒ½æœ‰ inversion bubbleï¼Œä»è€Œèƒ½å¤Ÿæ¶ˆå»ï¼‰ï¼Œä½¿ç”µè·¯æ›´å¥½ç†è§£ã€‚

### Constant Logic Signals

ç”µè·¯è®¾è®¡ä¸­å¶å°”ä¼šç”¨åˆ° constant 0 ï¼ˆ*ground*ï¼‰ å’Œ constant 1 ï¼ˆ*power-supply voltage*ï¼‰ï¼Œåœ¨ç”µè·¯å›¾ä¸­å®ƒä»¬çš„è®°å·å¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆDDPP5 Fig.4-9 (b))

![constant 0 and 1 inputs with individual gates](ddpp-fig-4-9-b.png)

### Drawing Layout

logic diagram å’Œ schematic ä¸€èˆ¬è¦ä»å·¦åˆ°å³ç”»ï¼Œæ‰€æœ‰è¾“å…¥éƒ½åœ¨æœ€å·¦ä¾§ï¼Œæ‰€æœ‰è¾“å‡ºéƒ½åœ¨æœ€å³ä¾§ã€‚

åœ¨çº¿è·¯å‘ç”Ÿäº¤å‰æ—¶ï¼Œæœ‰ä¸¤ç§åŒºåˆ†é‡å å’Œè¿æ¥çš„æ–¹æ³•ï¼š

-   è¿æ¥å¤„æ‰“ç‚¹ï¼Œé‡å ä¸æ‰“ç‚¹
-   è¿æ¥éƒ½å½¢å¦‚ âŸ‚ / âŠ¤ï¼Œé‡å åˆ™å½¢å¦‚ +

ç”±äº schematic éœ€è¦å¾ˆå¤šç»†èŠ‚ï¼Œä¸€å¼ å›¾å¯èƒ½ç”»ä¸ä¸‹ï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š

-   åˆ†ä¸ºå¤šå¼ å¹¶åˆ—çš„å›¾ï¼Œæ ‡æ³¨å‡ºè·¨è¶Šä¸¤å¼ å›¾çš„è¿çº¿ã€‚
-   å°†å›¾ç»„ç»‡ä¸ºæ ‘çŠ¶ï¼ˆä¸ Web å‰ç«¯çš„ component ç±»ä¼¼ï¼‰ï¼Œæ ‘æ ¹ä¸ block diagram ç±»ä¼¼ã€‚å›¾ä¸­çš„ component å¯ä»¥æ˜¯å¦ä¸€å¼  schematicï¼Œä¹Ÿå¯ä»¥æ˜¯ standard logic device æˆ–è€… HDL modelã€‚

### Buses

ä¸ºäº†æ–¹ä¾¿ç”»å›¾ï¼Œå¤šä¸ªå¹¶åˆ—çš„ä¿¡å·å¯ä»¥ç”»æˆä¸€ä¸ª <dfn>bus</dfn>ã€‚

bus çš„åå­—ä¸€èˆ¬å½¢å¦‚ \`ADDR[15:0]\`ï¼Œè¡¨ç¤º \`ADDR15\`ã€\`ADDR14\`ã€â€¦â€¦ã€\`ADDR1\`ã€\`ADDR0\`ã€‚

åœ¨å›¾ä¸Š bus ç”¨ä¸€æ¡è¾ƒç²—çš„çº¿è¡¨ç¤ºï¼Œä»è¿™æ¡ç²—çº¿ä¸Šè¿å‡ºä¸€æ¡ç»†çº¿è¡¨ç¤ºä»ä¸­ â€œpullâ€ å‡ºå•ç‹¬ä¸€ä¸ªä¿¡å·ã€‚

### Additional Schematic Information

åœ¨ board-level design ä¸­ï¼Œä¸€ä¸ª schematic åœ¨ç”µè·¯å›¾çš„åŸºç¡€ä¸Šè¿˜éœ€è¦æ ‡æ˜ IC typeã€reference designatorã€pin number ç­‰ä¿¡æ¯ï¼Œç”¨æ¥ç²¾ç¡®åœ°æè¿°ç”µè·¯ã€‚

å…¶ä¸­ï¼ŒIC type æè¿°äº† IC çš„åŠŸèƒ½ï¼Œ<dfn>reference designator</dfn> ç”¨æ¥åœ¨ä¸€ç±» IC ä¸­æŒ‡å®šç‰¹å®šçš„ä¸€ä¸ªå®ä¾‹ï¼Œ<dfn>pin number</dfn> ç”¨æ¥æŒ‡å®šä»å“ªè¿åˆ°å“ªã€‚

å…¨éƒ½æ ‡ä¸Šé•¿è¿™æ ·ï¼šï¼ˆDDPP5 Fig.4-18ï¼‰

![schematic diagram for a circuit using several SSI parts](ddpp-fig-4-18.png)

## Circuit Timing

åœ¨æ—¶åºç”µè·¯ä¸­ï¼Œç”µè·¯ç”±ä¸€ä¸ª clock æ§åˆ¶ï¼Œè€Œ clock çš„é¢‘ç‡ä¼šæ ¹æ®å®Œæˆä¸€æ­¥æ“ä½œåœ¨æœ€åæƒ…å†µä¸‹çš„ç”¨æ—¶æ¥åˆ¶è®¢ï¼Œæ‰€ä»¥è®¡ç®—ã€ä¼˜åŒ–ç”µè·¯çš„ timing å¯¹ç”µè·¯çš„æ€§èƒ½å’Œæ­£ç¡®æ€§éƒ½éå¸¸é‡è¦ã€‚

### Timing Diagrams

*timing diagram* ç”¨æ¥å±•ç¤ºç”µè·¯é‡Œå„ä¸ªä¿¡å·éšæ—¶é—´å˜åŒ–çš„æƒ…å†µï¼Œå¦‚ DDPP5 Fig.4-19 (b)(c) æ‰€ç¤ºï¼š

![(b) å±•ç¤º causality å’Œ propagation delay çš„ timing diagram (c) å±•ç¤º minimum / maximum delay çš„ timing diagram](ddpp-fig-4-19-bc.png)

ä¿¡å·çš„è½¬å˜ä¸æ˜¯ç¬é—´å‘ç”Ÿçš„ï¼Œä»ä¸€ä¸ªçŠ¶æ€åˆ°å¦ä¸€ä¸ªçŠ¶æ€çš„ç”¨æ—¶ç§°ä½œ <dfn>transition time</dfn>ï¼Œä» LOW åˆ° HIGH çš„ç”¨æ—¶å«åš <dfn>rise time</dfn>ï¼Œä» HIGH åˆ° LOW çš„ç”¨æ—¶å«åš <dfn>fall time</dfn>ã€‚

åœ¨å›¾ (b) ä¸­ï¼Œä¸åŒçš„ç®­å¤´ç”¨æ¥è¡¨ç¤º transition ä¹‹é—´çš„ causality ï¼ˆå› æœå…³ç³»ï¼‰ã€‚

æœ‰å› æœå…³ç³»çš„ transition å¹¶ä¸æ˜¯ç«‹åˆ»ä¸€ä¸ªæ¥ç€ä¸€ä¸ªå‘ç”Ÿï¼Œè€Œæ˜¯ä¼šæœ‰ *delay*ï¼Œä¸åŒçš„ä¿¡å·ã€è·¯å¾„ä¼šæœ‰ä¸åŒçš„ delayã€‚delay ä¸€èˆ¬æ˜¯æŒ‡ä¸¤ä¸ª transition å„è‡ªä¸­ç‚¹çš„è·ç¦»ã€‚

å¾ˆå¤šå› ç´ éƒ½ä¼šå¯¹ delay é€ æˆå½±å“ï¼Œæ‰€ä»¥ delay ä¸€èˆ¬ä¸æ˜¯å•ä¸ªæ•°å­—ï¼Œè€Œæ˜¯ä¸€ä¸ªåŒºé—´ã€‚å›¾ (c) ä¸­æ ‡æ˜äº† minimum delay å’Œ maximum delayã€‚

æœ‰æ—¶å€™ timing diagram ä¸éœ€è¦åŒºåˆ† rise å’Œ fallï¼Œä¾‹å¦‚ç”¨æ¥å­˜å‚¨æ•°æ®çš„ä¿¡å·ï¼Œå°±å¯ä»¥å¦‚ DDPP5 Fig.4-20 (a) è¿™æ ·ç”»ï¼š

![ä¸åŒºåˆ† rise å’Œ fall çš„ timing diagram](ddpp-fig-4-20-a.png)

å¯ä»¥å°†ä¸€ä¸ª bus ç”»åœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥ç”¨æ•°å­—æ ‡æ³¨ bus çš„å–å€¼ï¼Œå¦‚ DDPP5 Fig.4-20 (b) æ‰€ç¤ºï¼š

![å°† bus ç”»åœ¨ä¸€èµ·çš„ timing diagram](ddpp-fig-4-20-b.png)

### Propagation Delay

<dfn>propagation delay</dfn> æŒ‡çš„æ˜¯ç”µè·¯çš„æŸä¸ªè¾“å…¥å‘ç”Ÿæ”¹å˜åæ²¿ç€æŸä¸ªè·¯å¾„äº§ç”ŸæŸä¸ªè¾“å‡ºçš„ delayï¼Œä¸€èˆ¬è®°ä½œ $t_{\\mathrm{pX}}$ï¼Œå…¶ä¸­ $\\mathrm{X}$ ç”¨æ¥æ ‡è¯†è¿™ä¸ªè·¯å¾„ã€‚

å½±å“ propagation delay çš„å› ç´ æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ï¼š

-   Power-supply voltage: åŒ…æ‹¬æ ‡å®šçš„ç”µå‹ï¼Œä»¥åŠå°çš„ç”µå‹æ³¢åŠ¨
-   Temperature: åŒ…æ‹¬ç¯å¢ƒæ¸©åº¦å’Œç”µè·¯å·¥ä½œäº§ç”Ÿçš„çƒ­é‡
-   Output loading: ç”µè·¯çš„è¾“å‡ºå¯èƒ½ä¸åç»­ç”µè·¯çš„å¾ˆå¤šä¸ªè¾“å…¥ç›¸è¿ï¼Œè¿æ¥åˆ°çš„è¾“å…¥è¶Šå¤šï¼Œå°†ä¿¡å·ä¼ é€’è¿‡å»å°±ç”¨æ—¶è¶Šé•¿
-   Input rise and fall times: å¦‚æœè¾“å…¥çš„ transition æ…¢ï¼Œä¹Ÿä¼šè®¡å…¥ propagation delay
-   Transition direction: æœ‰æ—¶ rise å’Œ fall çš„ç”¨æ—¶ä¼šä¸åŒ
-   Speed-of-light delays: å¦‚æœç”µè·¯çš„ç‰©ç†å°ºå¯¸å¤§ï¼Œæˆ–è€…ç”µè·¯é€Ÿåº¦éå¸¸å¿«ï¼Œå…‰é€Ÿçš„é™åˆ¶å°±ä¸èƒ½å¿½ç•¥
-   Noise and crosstalk: ç¯å¢ƒä¸­çš„å„ç§å¹²æ‰°ï¼Œä»¥åŠç›¸é‚»çº¿è·¯ä¹‹é—´çš„å¹²æ‰°
-   Manufacturing tolerances: å…ƒä»¶è¢«åˆ¶é€ å‡ºæ¥çš„æ—¶å€™å¯èƒ½æœ‰ç»†å¾®çš„å·®å¼‚

ä¸€èˆ¬æ¥è¯´ï¼Œè®¡ç®— propagation delay å¯ä»¥ä¸è€ƒè™‘è¿™ä¹ˆå¤šå› ç´ ï¼Œè€Œåªéœ€æ ¹æ®ç”Ÿäº§å•†æä¾›çš„å…ƒä»¶çš„ â€œmaximumâ€ â€œtypicalâ€ â€œminimumâ€ propagation delay æ¥è¿›è¡Œè®¡ç®—ã€‚

å¦‚æœç”µè·¯æœ‰å¤šä¸ªè¾“å…¥è¾“å‡ºï¼Œå°±ä¼šæœ‰å¾ˆå¤šæ¡è·¯å¾„éœ€è¦è®¡ç®— delayã€‚

<Card title="glitch ä¸ delay">

ç¬¬ä¸‰ç« ä¸­æåˆ°çš„ [glitch](/post/2023/01/ddpp-3#timing-hazards) æ˜¯å¦å®é™…å‘ç”Ÿï¼Œä¸ç”µè·¯çš„ delay å¯†åˆ‡ç›¸å…³ã€‚

</Card>

### Timing Specifications

ç”Ÿäº§å•†ä¸€èˆ¬ä¼šæä¾›å…ƒä»¶åœ¨æŸç§æ¡ä»¶ä¸‹æ¯ä¸ªè·¯å¾„ã€æ¯ç§ transition æ–¹å‘çš„ propagation delay çš„èŒƒå›´ï¼Œä¸€èˆ¬ä¼šæä¾› maximum delay å’Œ minimum delayï¼Œä¹Ÿå¯èƒ½æä¾›ä¸€ä¸ª â€œtypicalâ€ delayã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œmaximum delay æ˜¯æœ€é‡è¦çš„ï¼Œminimum delay åªåœ¨å°‘æ•°æƒ…å†µä¸‹éœ€è¦è€ƒè™‘ï¼Œè€Œä¾èµ–äº typical delay æ˜¯ä¸é è°±çš„ã€‚

### Timing Analysis Tools

åœ¨å¤æ‚çš„ç”µè·¯ä¸­ï¼Œå¾€å¾€éœ€è¦å€ŸåŠ© EDA tool æ¥è®¡ç®— timingã€‚æ¯”èµ·æ‰‹åŠ¨è®¡ç®—ï¼ŒEDA å¯èƒ½ä¼šåˆ©ç”¨å…ƒä»¶é™„å¸¦çš„æ¯” min/max delay æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯æ¥æ›´åŠ ç²¾ç¡®åœ°è®¡ç®— delayã€‚å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿå™¨ï¼Œæ‰‹åŠ¨è®¾è®¡è¾“å…¥ï¼Œæ¥è®¡ç®— delayã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ timing analysis programï¼Œæ¥è‡ªåŠ¨è®¡ç®—å‡ºæ‰€æœ‰å¯èƒ½çš„ delayã€‚

åœ¨è®¾è®¡çš„ä¸åŒé˜¶æ®µå¯èƒ½ä¼šå¯¹ timing è¿›è¡Œå¤šæ¬¡ä¼°è®¡å’Œè®¡ç®—ï¼Œåœ¨è®¾è®¡åŸºæœ¬å®Œæˆæ—¶å¦‚æœå‘ç° propagation delay ä¸ç¬¦åˆè®¾è®¡è¦æ±‚ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œä¾‹å¦‚é’ˆå¯¹ critical path è¿›è¡Œçº¿è·¯ä¼˜åŒ–ï¼Œå°† critical path ä¸Šçš„å…ƒä»¶å°½é‡æ”¾åœ¨ç›¸é‚»çš„ä½ç½®ï¼Œå°† high-fanout çš„ä¿¡å·å¤åˆ¶å‡ åˆ†æ¥å‡è½» output loadâ€¦â€¦è¿™æ ·å¯¹ timing è¿›è¡Œè°ƒæ•´çš„è¿‡ç¨‹å¯èƒ½ä¼šåå¤è¿›è¡Œå¾ˆå¤šéï¼Œè¢«ç§°ä½œ <dfn>timing closure</dfn>ã€‚

## HDL-Based Digital Design

### EDA Tool Suites for HDLs

text editor
:   åŒ…å«ä»£ç é«˜äº®ç­‰åŠŸèƒ½çš„ HDL source file ç¼–è¾‘å™¨ã€‚

compiler
:   æ£€æŸ¥ä»£ç ä¸­çš„è¯­æ³•é”™è¯¯ï¼Œå°† HDL ç¼–è¯‘ä¸º RTL ï¼ˆregister-transfer languageï¼‰ã€‚

synthesizer (synthesis tool)
:   å°† RTL design synthesis åˆ°æŸä¸ªå…·ä½“çš„ hardware technology ä¸Šï¼Œé€šå¸¸åˆ†ä¸ºè‹¥å¹²æ­¥éª¤ï¼š
    1.  mapping: å°† RTL design å¯¹åº”åˆ°å…·ä½“çš„ hardware element
    2.  placement: åœ¨ FPGA / CPLD è®¾è®¡ä¸­ï¼Œä¸ºæ¯ä¸ª element é€‰æ‹©å…·ä½“çš„ programmable resource instanceï¼›åœ¨ ASIC è®¾è®¡ä¸­ï¼Œä¸ºå„ç§ basic building block å®‰æ’ä½ç½®
    3.  routing: åœ¨ FPGA / ASIC è®¾è®¡ä¸­ï¼Œåœ¨ element ä¹‹é—´è¿çº¿ï¼ˆCPLD ä¸­è¿çº¿æ˜¯å›ºå®šçš„ï¼Œè¦æ ¹æ®è¿çº¿é€‰æ‹© programmable resourceï¼‰

simulator
:   å¯¹ç»™å®šçš„ HDL model å’Œéšæ—¶é—´å˜åŒ–çš„è¾“å…¥ï¼Œè®¡ç®—å‡ºéšæ—¶é—´å˜åŒ–çš„è¾“å‡ºã€‚è¾“å…¥å¯ä»¥æ˜¯æ‰‹åŠ¨ç¼–è¾‘çš„ï¼Œç”± *test bench* ç”Ÿæˆçš„ï¼Œæˆ–è€…é€šè¿‡ *waveform editor* ç¼–è¾‘çš„ã€‚è¾“å‡ºå¯ä»¥æ˜¯æ³¢å½¢å›¾æˆ–è€…åˆ—è¡¨ï¼Œè¿˜å¯èƒ½åŒ…å«è­¦å‘Šã€‚

template generator
:   ç”Ÿæˆå¸¸ç”¨çš„ä»£ç æ¨¡æ¿ã€‚

schematic viewer
:   ç”± HDL model ï¼ˆRTLï¼‰ æˆ– synthesized result ç”Ÿæˆ schematic diagramï¼Œsynthesis å‰åçš„ schematic diagram å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒï¼Œä½†åŠŸèƒ½æ˜¯ä¸€è‡´çš„ã€‚

chip viewer
:   æŸ¥çœ‹ synthesized result ä¸­çš„ç‰©ç†å¸ƒå±€å’Œè¿çº¿ã€‚

constraints editor
:   ç»™ synthesizer è°ƒå‚ï¼Œä¾‹å¦‚è®¾ç½® timing è¦æ±‚ï¼Œè°ƒæ•´ä¼˜åŒ–ç›®æ ‡ã€‚

timing analyzer
:   è®¡ç®—æŸäº›æˆ–å…¨éƒ¨è·¯å¾„çš„ delayã€‚

back annotator
:   å°† timing analyzer çš„è®¡ç®—ç»“æœæ’å…¥åˆ° HDL model ä¸­ï¼Œä»¥åœ¨ simulation ä¸­å±•ç°å‡º timingã€‚

### HDL-Based Design Flow

1.  specification / hierarchy / block diagram
2.  coding
3.  compilation
4.  simulation / functional verification / pre-fitting timing verification
5.  mapping
6.  fitting / place & route
7.  post-fitting timing verification

å…¶ä¸­ï¼Œå‰å››æ­¥è¢«ç§°ä½œ <dfn>front-end steps</dfn>ï¼Œåä¸‰æ­¥è¢«ç§°ä½œ <dfn>back-end steps</dfn>ã€‚

è®¾è®¡è¿‡ç¨‹ä¸€èˆ¬ä¸ä¼šæ˜¯ä¸€æ­¥ä¸€æ­¥é¡ºç€æ¥çš„ï¼Œè€Œæ˜¯ä¼šä¸æ–­åå¤ã€‚ä¸ºäº†å°‘æŠ˜è…¾ï¼Œç¬¬ä¸€æ­¥ä¸­æ€»ä½“è®¾è®¡çš„åˆç†æ€§ï¼Œä»¥åŠç¬¬å››æ­¥ä¸­è¿›å…¥ back-end steps å‰çš„æµ‹è¯•ï¼Œéƒ½éå¸¸é‡è¦ã€‚ç”±äºç²¾ç¡®çš„ timing è®¡ç®—ä¾èµ–äºå…·ä½“çš„ fittingï¼Œåœ¨ç¬¬ä¸ƒæ­¥å‘ç° timing ä¸ç¬¦åˆè¦æ±‚è€Œæ¨å€’é‡æ¥ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½çš„ã€‚
`},{title:_,tags:i,content:`[Digital Design Principles and Practices](https://wakerly.org/DDPP/) 5th edition çš„å­¦ä¹ ç¬”è®°ã€‚



---

ä¸‹å­¦æœŸè¦é€‰æ•°ç”µæˆ–æ•°è®¾ï¼Œå¬è¯´æ•°ç”µæ˜¯çº¯è€ƒè¯•ï¼Œæ•°è®¾æ˜¯è€ƒè¯• + å¤§ä½œä¸šï¼Œåˆå¬è¯´æ•°è®¾åŠ©æ•™å…¨æ˜¯ tuna ç¾¤å‹ï¼Œå°±é€‰äº†æ•°è®¾ï¼Œè¿˜å¥½æ²¡æ‰è¯¾ï¼ˆ

è™½ç„¶ä¸çŸ¥é“è®²è¯¾å†…å®¹å’Œ DDPP æœ‰å¤šå°‘æ˜¯æ­£äº¤çš„ï¼Œä½†çœ‹ä¸€çœ‹ ~~é™¤äº†æ²¡æ—¶é—´å­¦ç¼“è€ƒçš„è¯¾æœ‰æŒ‚ç§‘é£é™©~~ ä¹Ÿæ²¡å•¥åå¤„ã€‚

ä¸Šå­¦æœŸ [åœ¨ä¸Šè¯¾æœŸé—´å­¦ CS:APP](/post/2022/09/csapp) è¿˜æ˜¯æŒºç—›è‹¦çš„ï¼Œå¸Œæœ›è¿™æ¬¡å¯’å‡èƒ½å¤šå­¦ä¸€ç‚¹ã€‚æœ¬æ¥æƒ³å¯’å‡è¡¥å®Œä¸€ä¸‹ CS:APPï¼Œä½†å¤§æ¦‚æ˜¯æ²¡æ—¶é—´äº†ã€‚å…ˆå­¦ DDPP å¯èƒ½å¯¹ CS:APP çš„ç¬¬å››ç« ä¹Ÿä¼šæœ‰äº›å¸®åŠ© (?)ã€‚

çœ‹äº†ä¸‹ preface å’Œ chapter 1 å¼€å¤´ï¼Œæ„Ÿè§‰è¿™ä¸ªä½œè€…è¯´è¯æŒºæœ‰æ„æ€çš„ï¼Œjoke å«é‡å¾ˆé«˜ã€‚ä¸‹é¢è¿™å¥æ‘˜è‡ª chapter 1 å¼€å¤´ï¼Œä¸¤è¯ä¸‰ä¹‰ï¼Œ~~[<span class="text-aisan">çˆ±å§</span>](https://zh.moegirl.org.cn/å®«ä¸‹çˆ±)[<span class="text-mia">ç§€é…±</span>](https://zh.moegirl.org.cn/å†…ç”°ç§€)ç‹‚å–œ~~ï¼Œ~~åˆå¤šäº†ä¸€ä¸ªä¸è¯»ä¸­æ–‡ç¿»è¯‘çš„ç†ç”±~~ï¼Œ~~è®©æŠ€æœ¯ä¹¦ç±çš„ç¿»è¯‘ä¹Ÿæ¥ä½“éªŒä¸€ä¸‹<span class="text-nijigasaki">è™¹å’²</span>çƒ¤è‚‰ man çš„ç—›è‹¦å§~~ã€‚

> Or perhaps youâ€™re an electrical engineering student who already knows something about analog electronics and circuit design, but you wouldnâ€™t know a bit if it bit you.

P.S. ä¸ºä»€ä¹ˆä¸æ˜¯ â€œDD:PPâ€ å‘¢ ğŸ¤” ~~æ˜¯ä¸æ˜¯ä½œè€…å­¦ CS:APP çš„æ—¶å€™è§‰å¾—å†’å·æ‰“èµ·æ¥å¤ªéº»çƒ¦äº†ï¼Œå°±æƒ³ç€ä¸€å®šè¦ä¸ºè‡ªå·±çš„è¯»è€…çœå»è¿™ä¸ªéº»çƒ¦~~ã€‚

UPD: ç»ˆäºè¯»å®Œç¬¬ä¸€ç« äº†ã€‚drill problem ç¬¬ä¸€é¢˜æ˜¯ï¼Œâ€œGive three different definitions for the word â€˜bitâ€™ as used in this chapterâ€ï¼ˆ
`},{title:L,tags:"blog Web é¡¹ç›®å¼€å‘",content:`å½“ä½ çœ‹åˆ° [ä¸€ç§å¾ˆæ–°çš„ä¸­æ–‡å­—ä½“ç½‘é¡µåµŒå…¥æ–¹æ¡ˆ](https://ayu.land/webfont)ï¼Œä½†æ˜¯æ‡’å¾—ä¼˜åŒ– DPï¼Œä¹Ÿä¸ä¼šè¿›åŒ–ç®—æ³•ï¼Œä½ å¯ä»¥â€¦â€¦

æ•´ä¸€ä¸ª[<em>å¦</em>ä¸€ç§å¾ˆæ–°çš„ä¸­æ–‡å­—ä½“ç½‘é¡µåµŒå…¥æ–¹æ¡ˆ](https://github.com/ouuan/glyph-segregator)ï¼ˆ



~~è¿™å°±æ˜¯ä½  [å¼€å‘ DDPP](/post/2023/01/ddpp) ä¸å¡«çš„ç†ç”±å—~~

## èƒŒæ™¯

å‰ä¸ä¹…çœ‹åˆ° [ä¸€ç§å¾ˆæ–°çš„ä¸­æ–‡å­—ä½“ç½‘é¡µåµŒå…¥æ–¹æ¡ˆ](https://ayu.land/webfont)ï¼Œè¿˜æƒ³ç€æ²¡å¿…è¦åšè¿™ç§ä¼˜åŒ–ï¼Œæ¯•ç«ŸæŒ‰ Google Fonts è¿›è¡Œå­é›†åŒ–å°±å¯ä»¥åšåˆ°æ¯é¡µ 1MB å·¦å³ï¼ŒæŒ‰ç°ä»£çš„ç½‘é€Ÿä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜ï¼Œç”¨ devtools å¼€èŠ‚æµè¯•äº†ä¸‹çœ‹èµ·æ¥ä¹Ÿè¿˜è¡Œã€‚

ç„¶åæˆ‘å›å®¶äº†ï¼Œç¦»å¼€äº†æ ¡å›­ç½‘ã€‚è™½ç„¶è‡ªå®šä¹‰åŸŸåçš„ Cloudflare Pages è¿˜èƒ½è®¿é—®ï¼Œä½†é€Ÿåº¦æš‚ä¸”ä¸è®ºï¼Œä¸¢åŒ…ç‡å°±å¾ˆæœ‰ç‚¹ææ€–ï¼Œç»å¸¸é¡µé¢åŠ è½½ä¸€åŠå°±å¡ä½äº†ã€‚

å†ç„¶åï¼ŒGoogle Fonts é‡Œ Noto Serif SC çš„ unicode range ä¸å«å•å¼•å·ï¼ˆå’Œæ’‡å·æ˜¯åŒä¸€ä¸ªå­—ç¬¦ï¼‰ï¼Œå¯¼è‡´ [DDPP åº](/post/2023/01/ddpp) é‡Œå¼•ç”¨çš„é‚£æ®µè¯çš„æ’‡å·åœ¨æˆ‘çš„æ‰‹æœºä¸Šæ˜¾ç¤ºæˆäº†å¾ˆå®½çš„å¦ä¸€ç§å­—ä½“ï¼Œæ‰è®©æˆ‘[å‘ç°è¿™ä¸ªé—®é¢˜](https://github.com/ouuan/iles-blog/commit/080bd7112f88d2eae1e86594f8820c0c517e37ce)ã€‚ä¸ºäº†ä»¥åèƒ½åŠæ—¶å‘ç°è¿™ç§é—®é¢˜ï¼Œæˆ‘å°±è®¾ç½®äº†ä¸ä½¿ç”¨æœ¬åœ°å­—ä½“ç›´æ¥ä½¿ç”¨ web font çš„ Stylusã€‚

ææ€–çš„ä¸¢åŒ…ç‡ï¼ŒåŠ ä¸Šè‡ªå·±äº²èº«ä½“éªŒ web font åŠ è½½ï¼Œè®©æˆ‘æ„è¯†åˆ°äº†ï¼Œåœ¨å›½å†…æ™®é€šç½‘ç»œç¯å¢ƒä¸‹ï¼Œå¦‚æœä½ çš„è®¾å¤‡æ²¡æœ‰å®‰è£…æ€æºå®‹ä½“ï¼Œè®¿é—®æˆ‘çš„åšå®¢ä¼šæ˜¯å¤šä¹ˆéš¾å—ï¼ˆ

## ä¸»ä½“æ€è·¯

â€œå¦ä¸€ç§â€çš„ä¸»ä½“æ€è·¯[å’Œâ€œä¸€ç§â€æ˜¯ä¸€æ ·çš„](https://ayu.land/webfont#principle)ï¼Œå°±æ˜¯æŠŠå­—ä½“åˆ’åˆ†æˆå¸¸ç”¨å­—å’Œéå¸¸ç”¨å­—ã€‚ä½†æ˜¯â€œä¸€ç§â€åœ¨è¿™ä¹‹åé€‰æ‹©äº†ä½¿ç”¨åŠ¨æ€è§„åˆ’ + è¿›åŒ–ç®—æ³•æ¥å¯¹å¸¸ç”¨å­—è¿›è¡Œè¿›ä¸€æ­¥çš„æ‹†åˆ†ï¼Œâ€œå¦ä¸€ç§â€æ‰€åšçš„ä¼˜åŒ–åˆ™åŸºäºè¿™æ ·ä¸€ä¸ªè§‚å¯Ÿï¼šè™½ç„¶ä¸€ä¸ªåšå®¢æœ‰ä¸€å †é¡µé¢ï¼Œä½† 80% çš„äººåªä¼šè®¿é—® 20% çš„é¡µé¢ï¼ˆï¼Œä¸€ä¸ªå­—ä½“æ˜¯å¦å¸¸ç”¨ï¼Œä¸ä»…è¦çœ‹å‡ºç°åœ¨å‡ ä¸ªé¡µé¢ï¼Œè¿˜è¦çœ‹å‡ºç°åœ¨å“ªäº›é¡µé¢ã€‚

è¿™æ—¶å€™ï¼Œ~~ä¸€ç›´å……å½“[ä¸è’œå­](https://busuanzi.ibruce.info/)å¹³æ›¿ï¼ˆå“ªå¹³ä»·äº†å•Šï¼‰çš„~~ Plausible Analytics å°±å‘æŒ¥ä½œç”¨äº†ï¼šè¿‘æ®µæ—¶é—´çš„é¡µé¢è®¿é—®é‡å¯ä»¥ç”¨æ¥ä¼°è®¡æ¯ä¸ªé¡µé¢è¢«è®¿é—®çš„æ¦‚ç‡ï¼Œä¸ºå¸¸ç”¨å­—çš„åˆ’åˆ†æä¾›å¯é çš„æ•°æ®æ”¯æ’‘ã€‚

ä¸€æ—¦ä¼°è®¡å‡ºäº†æ¯ä¸ªé¡µé¢çš„è¢«è®¿é—®æ¦‚ç‡ï¼Œå°±å¯ä»¥å¯¹æ¯ä¸ª glyph åˆ†åˆ«è®¡ç®—å‡ºï¼Œå¦‚æœåœ¨æ¯ä¸€ä¸ªä½¿ç”¨äº†å®ƒçš„é¡µé¢ä¸Šéƒ½åŠ è½½ä¸€éï¼ŒæœŸæœ›ä»£ä»·æ˜¯å¤šå°‘ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†å®ƒçš„æ‰€æœ‰é¡µé¢çš„è¢«è®¿é—®æ¦‚ç‡ä¹‹å’Œã€‚å¦‚æœè¿™ä¸ªæ•°å¤§äº 1ï¼Œå°±è®¾ä¸ºå¸¸ç”¨ï¼Œå¦åˆ™è®¾ä¸ºä¸å¸¸ç”¨ã€‚

è¿™ä¸ªæ€è·¯è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼Œå¯ä»¥è¯´åªæ˜¯â€œç»“åˆå®é™…ï¼Œé‡‡å–å¯å‘å¼æ–¹æ³•â€ï¼Œä¹Ÿç§°ä¸ä¸Šæ˜¯ä¸€ç§æ–°çš„æ–¹æ¡ˆï¼ˆ

## å…·ä½“å®ç°

è™½ç„¶æ€è·¯ç®€å•ï¼Œä½†å®ç°èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„ï¼Œå‘æœ‰ç‚¹å¤šã€‚

### è·å–é¡µé¢ä½¿ç”¨çš„å­—ä½“

å¦‚æœæ•´ä¸ªé¡µé¢éƒ½ä½¿ç”¨ä¸€ç§å­—ä½“ï¼Œç›´æ¥çœ‹ HTML é‡Œæœ‰å“ªäº›ä¸­æ–‡å°±å·®ä¸å¤šäº†ï¼Œä½†æˆ‘ä¸ä»…<span class="font-sans">éæ­£æ–‡ç”¨çš„æ˜¯é»‘ä½“</span>ï¼Œ<span class="font-kai">å¼•ç”¨å—è¿˜æ˜¯æ¥·ä½“</span>ï¼Œè¯´ä¸å®šåœ¨å“ªå†’å‡ºæ¥ä¸ª\`ç­‰å®½\`æˆ–è€… $\\LaTeX\\text{å…¬å¼}$ï¼Œæœ‰æ—¶å€™è¿˜ä¼š**åŠ ç²—**ï¼Œæ›´åˆ«æå¿ƒæƒ…å¥½çš„æ—¶å€™ä¼šåƒè¿™æ®µä¸€æ ·ç›´æ¥å¡ \`<span class="">\` æ¥ä¿®æ”¹æ ·å¼ã€‚

ä¸€å¼€å§‹æˆ‘é€šè¿‡ [subfont](https://github.com/Munter/subfont) æ‰¾åˆ°äº† [assetgraph/font-tracer](https://github.com/assetgraph/font-tracer)ï¼Œä½†è¿™ä¸ª font-tracer å°±ä¸¤ä¸ª starï¼Œæ²¡æœ‰æ–‡æ¡£ï¼Œ[AssetGraph](https://github.com/assetgraph/assetgraph) åˆæ˜¯ä¸€ä¸ª 12 å¹´å‰çš„è€é¡¹ç›®ï¼Œè¿ Definitely Typed éƒ½æ²¡æœ‰ï¼Œè¯•äº†ä¸€ä¸‹å®Œå…¨ç”¨ä¸ä¼šã€‚

æƒ³äº†æƒ³ï¼Œæœ€é è°±çš„è¿˜æ˜¯ç›´æ¥äº¤ç»™æµè§ˆå™¨æ¥å¤„ç†ï¼Œæ‰€ä»¥å°±ç”¨ [puppeteer](https://github.com/puppeteer/puppeteer) äº†ã€‚ç›®å‰é‡‡ç”¨çš„ç®—æ³•æ˜¯ï¼šéå† \`<body>\`ï¼Œè·³è¿‡ \`<script>\` å’Œ \`<style>\` å­æ ‘ï¼Œæ‰¾åˆ°æ‰€æœ‰ [Text èŠ‚ç‚¹](https://developer.mozilla.org/docs/Web/API/Text)ï¼Œå†åŠ ä¸Šæ‰€æœ‰ \`<img>\` çš„ \`alt\` å±æ€§ã€‚æ‰¾åˆ°èŠ‚ç‚¹åï¼Œå¯ä»¥ç”¨ [\`getComputedStyle\`](https://developer.mozilla.org/docs/Web/API/Window/getComputedStyle) è·å– \`font-family\` å’Œ \`font-weight\` ç­‰ä¿¡æ¯ã€‚

å› ä¸ºè¦å¤„ç†å¾ˆå¤šé¡µé¢ï¼Œä¹Ÿè¦èŠ±ä¸€ç‚¹æ—¶é—´ï¼Œæ‰€ä»¥ç”¨äº† [puppeteer-cluster](https://github.com/thomasdondorf/puppeteer-cluster) æ¥å¹¶è¡Œå¤„ç†ã€‚ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œåœ¨ vitest å’Œ iles ä¸­è¿è¡Œæ—¶ï¼Œä¸åŠ å‚æ•°ä¼šæŠ¥é”™ï¼Œè€ŒåŠ äº† \`--no-sandbox --no-zygote\` ä¹‹åå¹¶è¡Œçš„ä¼˜åŒ–æ•ˆæœå°±å·®ä¸€äº›ã€‚ï¼‰

ä»£ç ï¼š[\`getPagesFontInfo.ts\`](https://github.com/ouuan/glyph-segregator/blob/master/src/getPagesFontInfo.ts)

### å­—ä½“åŒ¹é…

[å®Œæ•´çš„å­—ä½“åŒ¹é…](https://www.w3.org/TR/css-fonts-4/#font-style-matching)æ˜¯éå¸¸å¤æ‚çš„ï¼Œæˆ‘ä¹Ÿæ²¡æ‰¾åˆ°ç›¸å…³çš„åº“ï¼Œå°±è‡ªå·±å†™äº†ä¸€ä¸ªç®€é™‹çš„åªåŒ¹é…å®Œæ•´ \`font-family\` å’Œ \`font-weight\` çš„ç®—æ³•ã€‚

å…¶å®ä¸€èˆ¬ \`font-weight\` ä¹Ÿå°± 400 å’Œ 700ï¼Œä½†æˆ‘è¿˜æ˜¯å®ç°äº†ä¸€ä¸ª [å®Œæ•´çš„ \`font-weight\` fallback](https://developer.mozilla.org/docs/Web/CSS/font-weight#fallback_weights)ã€‚

ä»£ç ï¼š[\`matchFonts.ts\`](https://github.com/ouuan/glyph-segregator/blob/master/src/matchFonts.ts)

### å¸¸ç”¨å­—ä½“åˆ’åˆ†

æœ€å…³é”®çš„è¿™ä¸€æ­¥å®ç°èµ·æ¥æ˜¯æœ€ç®€å•çš„ï¼Œå› ä¸ºæ˜¯çº¯ç®—æ³•çš„ï¼Œä¸æ¶‰åŠåˆ°å¯æ€•çš„ Webï¼ˆ

ä»£ç ï¼š[\`getCommonGlyphs.ts\`](https://github.com/ouuan/glyph-segregator/blob/master/src/getCommonGlyphs.ts)

### ç”Ÿæˆå­—ä½“æ–‡ä»¶å’Œ @font-face

æˆ‘ä½¿ç”¨çš„æ˜¯ [subset-font](https://github.com/papandreou/subset-font) æ¥ç”Ÿæˆå­—ä½“å­é›†æ–‡ä»¶ã€‚

è¿™ä¸€æ­¥æœ€å¤§çš„å›°éš¾ï¼Œæ˜¯æ­£ç¡®åœ°å†™å‡º \`@font-face\`ã€‚

ä¸€å¼€å§‹æˆ‘æ˜¯ç»™å¸¸ç”¨å­— (common) å’Œéå¸¸ç”¨å­— (unique) ä¸åŒçš„ \`font-family\`ï¼Œç„¶åå‘ç°ï¼Œåœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼ˆå¹¸å¥½æˆ‘çš„åšå®¢æ–‡ç« åˆ—è¡¨å°±è§¦å‘äº†è¿™ä¸ªé—®é¢˜ï¼Œä¸ç„¶çœŸæ²¡æƒ³åˆ°ï¼‰ï¼ŒæŸä¸ªå­—çš„å¸¸è§„æ ·å¼å±äº common è€Œç²—ä½“å±äº uniqueï¼Œç”±äº \`font-family\` é‡Œ common æ’åœ¨ unique å‰é¢ï¼Œå°±ä¼šåŒ¹é…åˆ°å¸¸è§„æ ·å¼ï¼Œè€ŒåŠ è½½ä¸å‡ºç²—ä½“ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œcommon å’Œ unique éœ€è¦ä½¿ç”¨åŒä¸€ä¸ª \`font-family\`ã€‚å› ä¸ºç”¨è¿‡ Google Fonts å­é›†åˆ’åˆ†æ–¹æ¡ˆï¼Œæˆ‘çŸ¥é“æœ‰ä¸åŒ \`unicode-range\` çš„ \`@font-face\` æ˜¯å¯ä»¥ç»„åˆåœ¨ä¸€èµ·çš„ï¼Œéš¾é“æˆ‘éœ€è¦è®¡ç®—å‡ºç²¾ç¡®çš„ \`unicode-range\` å†™åœ¨ CSS é‡Œï¼Ÿ

ä¸ºæ­¤ï¼Œæˆ‘ç²—ç•¥åœ°è¯»äº†åŠå¤©ï¼ˆ~~è¿™ä¸¤ä¸ªè¯ä¸å†²çª~~ï¼‰[CSS Fonts Module Level 4 W3C Working Draft](https://www.w3.org/TR/css-fonts-4/)ï¼Œå‘ç°å®ƒè¯´ï¼Œ\`unicode-range\` å¯ä»¥æ¯”çœŸå®çš„ character map å¤§å¾ˆå¤šï¼Œè‹¥å¹² \`@font-face\` çš„ \`unicode-range\` ä¹Ÿå¯ä»¥ç›¸äº¤ã€‚ä½†æ˜¯ï¼Œå®ƒæ²¡è¯´ä¸¤ä¸ª \`@font-face\` èƒ½ä¸èƒ½é™¤äº† \`src\` å•¥éƒ½ä¸€æ ·ï¼Œ[è€Œåªè¯´äº†](https://www.w3.org/TR/css-fonts-4/#composite-fonts)ï¼š

> Multiple @font-face rules with different unicode ranges for the same family and style descriptor values can be used to create composite fonts that mix the glyphs from different fonts for different scripts.

æˆ‘ä¹Ÿä¸æ•¢ä¾èµ–äºå®éªŒç»“æœï¼Œå°±æ²¡åšå®éªŒï¼Œç›´æ¥åŠ ä¸Šäº†ç²—ç•¥ä½†æ˜¯ä¿è¯ common å’Œ unique ä¸ç›¸åŒçš„ \`unicode-range\`ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯ 0 åˆ°æœ€å¤§çš„ code pointã€‚

è¿™é‡Œä» 0 å¼€å§‹ä¹Ÿæ˜¯æœ‰ä¸€å®šåŸå› çš„ï¼šæˆ‘åœ¨çœ‹ specification çš„æ—¶å€™æ³¨æ„åˆ°ä¸€ä¸ªå¥‡æ€ªçš„ä¸œè¥¿å« [_first available font_](https://www.w3.org/TR/css-fonts-4/#first-available-font)ï¼Œè™½ç„¶æ²¡å¤ªçœ‹æ‡‚å…·ä½“æ˜¯ä»€ä¹ˆæ„æ€ï¼Œä½†å¤§è‡´ä¸Šæ„Ÿè§‰æœ€å¥½æ˜¯è®© \`unicode-range\` åŒ…å«ç©ºæ ¼ï¼Œä¸ºäº†ä¿é™©å°±ä» 0 å¼€å§‹äº†ã€‚

æœ€åè¿˜æœ‰ä¸€ä¸ªå‘ï¼šå¦‚æœ composite font ä¸­ä¸¤ä¸ª \`@font-face\` çš„ \`unicode-range\` ç›¸äº¤ï¼Œç»™äº¤é›†å†…çš„å­—ç¬¦åŒ¹é…å­—ä½“æ—¶ï¼Œä¼šæŒ‰å‡ºç°ä½ç½®çš„é€†åºè¿›è¡ŒåŒ¹é…ã€‚

è¿™èƒ½æœ‰ä»€ä¹ˆå‘å‘¢ï¼ˆï¼Œå¦‚æœä¸åŠ¨æ‰‹è¯•ä¸€è¯•çœŸçš„å¾ˆéš¾æƒ³åˆ°.. æŒ‰ç…§æ•´ä½“çš„è®¾è®¡ï¼Œè®¿é—®ä¸€ä¸ªé¡µé¢æ—¶å¾ˆæœ‰å¯èƒ½æ˜¯ common å­—ä½“å·²ç»ç¼“å­˜å¥½äº†ï¼Œéœ€è¦ä¸‹è½½ unique å­—ä½“ï¼Œå¦‚æœ unique çš„ \`@font-face\` æ”¾åœ¨ common çš„åé¢ï¼Œå°±ä¼šä¼˜å…ˆåŒ¹é…ï¼Œä»è€Œé˜»å¡ä½å·²ç»ç¼“å­˜çš„ common å­—ä½“ï¼Œæ•´ä¸ªé¡µé¢éƒ½è¦ç­‰ unique ä¸‹è½½å¥½æ‰åˆ‡æ¢å­—ä½“ï¼Œè€Œä¸æ˜¯å…ˆæ˜¾ç¤º common å†æ˜¾ç¤ºå‰©ä¸‹çš„ uniqueã€‚å½“ç„¶ï¼Œåè¿‡æ¥çš„è¯ï¼Œunique ä¹Ÿä¼šç­‰ commonï¼Œä½†è¿™æ ·ä¸€èˆ¬æ¥è¯´æ˜¯æ›´å¥½çš„ã€‚

è¿˜æœ‰ä¸€äº›ç»†èŠ‚ä¼˜åŒ–ï¼š

-   ç”Ÿæˆ unique å­—ä½“æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶åé‡Œæœ‰ hash å°±å¤Ÿäº†ï¼Œä¸è¦å†æ·»åŠ å’Œé¡µé¢æœ‰å…³çš„ä¿¡æ¯ï¼Œè¿™æ ·çš„è¯å¦‚æœä¸¤ä¸ªé¡µé¢åˆšå¥½ unique glyph é›†åˆç›¸åŒå°±å¯ä»¥å…±ç”¨ä¸€ä¸ªå­—ä½“æ–‡ä»¶ã€‚
-   å¦‚æœä¸€ä¸ªé¡µé¢ä¸€ä¸ª common glyph éƒ½æ²¡ç”¨ï¼Œå°±å¯ä»¥ä¸æ·»åŠ  common font çš„ \`@font-face\`ã€‚

ä»£ç ï¼š[\`generateFontFiles.ts\`](https://github.com/ouuan/glyph-segregator/blob/master/src/generateFontFiles.ts)

### å°† CSS å†™å…¥ HTML æ–‡ä»¶

è™½ç„¶ä¹Ÿæœ‰æƒ³è¿‡ç›´æ¥æ‰¾åˆ° \`</head>\` æ–‡æœ¬æ›¿æ¢ï¼Œä½†ä¸ºäº†é è°±è¿˜æ˜¯ç”¨çš„ [\`jsdom\`](https://github.com/jsdom/jsdom)ã€‚

è¿™éƒ¨åˆ†çš„ä»£ç æ˜¯æœ€çŸ­çš„ï¼š[\`injectCSS.ts\`](https://github.com/ouuan/glyph-segregator/blob/master/src/injectCSS.ts)

### ç»™é¡¹ç›®èµ·å

ä¸»ä½“æ€è·¯æ˜¯æŠŠ glyph åˆ†æˆä¸¤ç±»åˆ†åˆ«å¯¹å¾…ï¼Œå°±å¾ˆæœ‰ segregate çš„æ„Ÿè§‰ï¼ˆ

ä¸»è¦è¿˜æ˜¯å› ä¸ºåˆšå†™äº†ä¸€ä¸ª [segregated fit](/post/2022/11/csapp-9#segregated-fit) å°è±¡æ¯”è¾ƒæ·±åˆ»ï¼Œæ‰€ä»¥å°±å–äº†è¿™ä¹ˆä¸ªåå­—ã€‚

### åœ¨åšå®¢ä¸­ä½¿ç”¨

å°±æ˜¯ [ä» iles è·å–é¡µé¢ä¿¡æ¯](https://iles-docs.netlify.app/config#ssg-onsiterendered)ï¼Œä» [Plausible Stats API](https://plausible.io/docs/stats-api#get-apiv1statsbreakdown) è·å–è®¿é—®é‡ï¼Œè°ƒç”¨ [Vite API](https://vitejs.dev/guide/api-javascript.html#preview) è·‘ä¸€ä¸ª preview serverï¼Œç„¶åè°ƒç”¨ \`glyph-segregator\`ã€‚ç›´æ¥çœ‹[ä»£ç ](https://github.com/ouuan/iles-blog/commit/695f8b22ca3a791ceeb5440e81a6fa377b50bb3b#diff-ca899b3bf20a893bb3dfb058072a2b279953ce008f562727ad74a76d520be662)å§ã€‚

è®¿é—®æ¦‚ç‡çš„è®¡ç®—æ–¹å¼æ˜¯ï¼Œçœ‹æ¯ä¸ªé¡µé¢è¿‘ 90 å¤©çš„è®¿å®¢æ•°ï¼ŒåŠ ä¸€åé™¤ä»¥å…¶ä¸­æœ€é«˜çš„åŠ äºŒï¼ˆå…¶å®è¿™ä¸ªåŠ ä¸€åŠ äºŒåŸºæœ¬æ²¡å•¥ç”¨ï¼‰ã€‚ç”¨æœ€é«˜é¡µé¢è®¿å®¢æ•°è€Œéå®é™…æ€»è®¿å®¢æ•°ä½œåˆ†æ¯ï¼Œæ˜¯æƒ³åœ¨ç®—æ³•çš„åŸºç¡€ä¸Šæ›´åŠ åå‘äºåˆ’åˆ†åˆ°å¸¸ç”¨å­—ä¸€äº›ï¼Œç¨å¾®ä¼˜åŒ–ä¸€ç‚¹è®¿é—®é¡µé¢è¾ƒå¤šçš„è®¿å®¢çš„ä½“éªŒï¼Œä¹Ÿå¯ä»¥å°‘ä¸€æ¬¡ API æŸ¥è¯¢ã€‚

æ›´æ–°å¸¸ç”¨å­—é›†åˆç”¨çš„æ˜¯ [scheduled GitHub Actions](https://github.com/ouuan/iles-blog/blob/master/.github/workflows/update-fonts.yml)ï¼Œåœ¨ Docker é‡Œè·‘æ˜¯å› ä¸º [Connection refused for local server in github actions workflow](https://stackoverflow.com/questions/74332455/connection-refused-for-local-server-in-github-actions-workflow/74341376)ã€‚

## å®é™…æ•ˆæœ

æ•´ä¸ª \`glyphSegregator\` ç”¨æ—¶ 40s å·¦å³ï¼Œglyph æ•°é‡å’Œ common font file size (woff2) å¦‚è¡¨æ‰€ç¤ºï¼š

|                                               | Noto Serif SC Regular | Noto Serif SC Bold | LXGW WenKai Regular | LXGW WenKai Bold |
| :-------------------------------------------: | :-------------------: | :----------------: | :-----------------: | :--------------: |
| <span class="whitespace-nowrap">common</span> |    575 (162.7KiB)     |    25 (8.5KiB)     |     37 (5.2KiB)     |        0         |
|                    unique                     |         2311          |        1536        |         161         |        0         |

é¦–é¡µåªéœ€åŠ è½½ä¸¤ä¸ª Regular çš„ common fontï¼Œæ¯ä¸ªé¡µé¢éœ€è¦åŠ è½½çš„å­—ä½“æ–‡ä»¶æ€»å¤§å°ç¼©å‡åˆ°äº†åŸæ¥ä½¿ç”¨å­é›†åŒ–çš„ 1/4 å·¦å³ï¼Œå¹¶ä¸”åŠ è½½çš„å­—ä½“æ–‡ä»¶æ•°é‡ä» 10\\~30 ä¸ªç¼©å‡åˆ°äº† 2\\~6 ä¸ªã€‚

ä½œä¸ºå¯¹æ¯”ï¼Œå¦‚æœå‡ºç°åœ¨ä¸¤ä¸ªé¡µé¢å°±è®¾ä¸ºå¸¸ç”¨å­—ï¼ŒNoto Serif SC Regular çš„ common æœ‰ 299KiBï¼Œå‡ºç°åœ¨ä¸‰ä¸ªé¡µé¢åˆ™æ˜¯ 227KiBã€‚

## åè®°ï¼šfont subsetting ä¸ kerning

å› ä¸ºé€šè¿‡ Stylus è®¾ç½®äº†ä¸ä½¿ç”¨æœ¬åœ°å­—ä½“ï¼Œæˆ‘å¯ä»¥è½»æ¾åœ°åœ¨æœ¬åœ°å­—ä½“å’Œ web font ä¹‹é—´åˆ‡æ¢ã€‚ç„¶åæˆ‘å°±å¶ç„¶å‘ç°ï¼Œåˆ‡æ¢æ—¶ä¸€äº›æ ‡é¢˜å‘ç”Ÿäº†å­—ç¬¦çš„åç§»ã€‚åŸå› ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªå­—ç¬¦æœ¬æ¥æœ‰ kerning (å­—è·è°ƒæ•´)ï¼Œä½†å®ƒä»¬è¢«åˆ’åˆ†åˆ°äº†ä¸åŒçš„å­é›†ä¸­ï¼Œç”Ÿæˆå­—ä½“å­é›†æ—¶å°±ä¸¢å¤±äº† kerning ä¿¡æ¯ã€‚

æˆ‘åœ¨ glyph-segregator ä¸­ [æ·»åŠ äº† \`alwaysCommonGlyphs\` é€‰é¡¹](https://github.com/ouuan/glyph-segregator/commit/ae3ddd5cbb91f0eb6bbfec7071ee408c28b36dec)ï¼ˆASCII å­—ç¬¦æ€»æ˜¯è®¾ä¸º commonï¼Œå¦‚æœéœ€è¦å¤„ç†é ASCII å­—ç¬¦çš„ kerning ä¹Ÿå¯ä»¥ä¿®æ”¹è®¾ç½®ï¼Œä½†æˆ‘çš„åšå®¢å°±å‡è®¾åªæœ‰ ASCII å­—ç¬¦ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ï¼‰æ¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯çœŸçš„å»çœ‹ä¸€ä¸‹å­—ä½“é‡Œæœ‰å“ªäº› kerning ä¿¡æ¯ç„¶åç›¸åº”åœ°å¤„ç†ï¼Œä½†æ˜¯å·®ä¸å¤šå¾—äº†ï¼ˆ

<Card title="font kerning ç¤ºä¾‹">

-   æœ‰ kerning: <span style="font-kerning: normal; font-size: 2rem;">TAVeYoW</span>
-   æ²¡ kerning: <span style="font-kerning: none; font-size: 2rem;">TAVeYoW</span>

</Card>

åè®°çš„åè®°ï¼šè¿˜æ˜¯æ”¹æˆäº†[å³ä½¿æœªè¢«ä½¿ç”¨ä¹Ÿæ·»åŠ è¿› common glyph set](https://github.com/ouuan/glyph-segregator/commit/e955eb1c935d77adf0e4bcb5c870fee0614801b6)ï¼Œå¦åˆ™å¦‚æœæ–°åŠ ä¸€ä¸ª always common çš„ glyphï¼Œä¸ºäº†è®©å®ƒ commonï¼Œå°±ä¼šæ”¹å˜ common glyph setï¼Œå¯¼è‡´ cache å¤±æ•ˆã€‚è¿™é‡Œæœ‰ä¸€å®šçš„ trade-offï¼Œè¦åœ¨ cache å¤±æ•ˆ / å¤šå¡ä¸€äº›æœªè¢«ä½¿ç”¨çš„ glyph / kerning æŒ‚æ‰ä¹‹é—´è¿›è¡Œé€‰æ‹©ï¼Œæˆ‘è¿˜æ˜¯é€‰æ‹©äº†å¤šå¡ä¸€äº›æœªè¢«ä½¿ç”¨çš„ glyphï¼Œæ¯•ç«Ÿæ•´ä¸ª ASCII ä¹Ÿæ²¡å¤šå¤§ã€‚æœ€å¥½æ˜¯å€ŸåŠ©äººç±»æ™ºæ…§æ¥é¢„æµ‹ä¸€ä¸‹å“ªäº› glyph æ›´æœ‰å¯èƒ½åœ¨æœªæ¥è¢«æ·»åŠ è€Œæ”¾è¿› common glyph set é‡Œï¼Œå…¶ä»– glyph å°±åªæœ‰ä½¿ç”¨äº†æ‰æ”¾ï¼Œä½†æ˜¯å·®ä¸å¤šå¾—äº†ï¼ˆ
`},{title:$,tags:"JavaScript é—®é¢˜è§£å†³è®°å½•",content:`tl;dr: \`replace\` çš„ç¬¬äºŒä¸ªå‚æ•°åº”å½“ä½¿ç”¨å­—é¢é‡æˆ–å‡½æ•°ï¼Œä¸åº”ä½¿ç”¨å¸¦å˜é‡çš„å­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œå¦åˆ™å¯èƒ½å‘ç”Ÿæ„æƒ³ä¸åˆ°çš„é”™è¯¯æ›¿æ¢ã€‚



## String.prototype.replace çš„ç¬¬äºŒä¸ªå‚æ•°

(reference: [\`String.prototype.replace()\` - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#specifying_a_function_as_the_replacement))

\`\`\`javascript
replace(pattern, replacement);
\`\`\`

ç¬¬äºŒä¸ªå‚æ•° \`replacement\` å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–å‡½æ•°ï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œåˆ™ç”±åŒ¹é…ä¿¡æ¯ä½œä¸ºå‚æ•°è®¡ç®—å‡º replacementï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä¸€äº› special replacement patternï¼š

|                          Pattern                           |                                           Inserts                                            |
| :--------------------------------------------------------: | :------------------------------------------------------------------------------------------: |
|                            \`$$\`                            |                                       Inserts a \`"$"\`.                                       |
|                            \`$&\`                            |                                Inserts the matched substring.                                |
|                          \`\` $\` \`\`                          |            Inserts the portion of the string that precedes the matched substring.            |
|                            \`$'\`                            |            Inserts the portion of the string that follows the matched substring.             |
|                            \`$n\`                            | Inserts the \`n\`th (1-indexed) capturing group where \`n\` is a positive integer less than 100. |
| <code class="important-whitespace-nowrap">$\\<Name\\></code> |              Inserts the named capturing group where \`Name\` is the group name.               |

## ä½¿ç”¨å˜é‡ä½œä¸º replacement å¸¦æ¥çš„é—®é¢˜

æˆ‘å®é™…é‡åˆ°çš„é—®é¢˜æ˜¯ [iles#224](https://github.com/ElMassimo/iles/issues/224)ï¼Œç”±äºä½¿ç”¨äº†æ¨¡æ¿å­—ç¬¦ä¸²ä½œä¸º replacementï¼Œåœ¨å˜é‡ä¸­åŒ…å«ä¸Šé¢è¿™äº› special replacement pattern æ—¶ï¼Œå°±ä¼šé”™è¯¯åœ°æ›¿æ¢ã€‚

è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°†å«å˜é‡çš„è¡¨è¾¾å¼æ”¹æˆå‡½æ•°ï¼ˆå‰é¢åŠ ä¸Š \`() => \`ï¼‰å°±å¯ä»¥äº†ï¼š[regex - javascript - Better Way to Escape Dollar Signs in the String Used By \`String.prototype.replace\` - Stack Overflow](https://stackoverflow.com/questions/28102491/javascript-better-way-to-escape-dollar-signs-in-the-string-used-by-string-prot)ã€‚

å› ä¸ºè§£å†³çš„ä»£ä»·éå¸¸å°ï¼Œè™½ç„¶æœ‰çš„æ—¶å€™æ ¹æ®ä»£ç é€»è¾‘å¯ä»¥æ¨æ–­å‡º replacement ä¸å« \`$\`ï¼Œä¾ç„¶å¯ä»¥è®¤ä¸ºï¼Œå‡¡æ˜¯ replacement éœ€è¦ç”¨åˆ°å˜é‡çš„ï¼Œéƒ½åº”å½“æ›¿æ¢æˆå‡½æ•°ã€‚

## ä½¿ç”¨ ESLint æ£€æµ‹è¿™ä¸€é—®é¢˜

[å†™äº†ä¸ª](https://github.com/ouuan/eslint-config/commit/166e332dbdf8dc2ab9ff918302ada13fbd487ead) [\`no-restricted-syntax\`](https://eslint.org/docs/latest/rules/no-restricted-syntax) çš„é…ç½®ï¼š

\`\`\`javascript
{
  rules: {
    'no-restricted-syntax': [
      'error',
      {
        selector: "CallExpression[callee.property.name='replace'] > .arguments:nth-child(2):not(Literal):not(ArrowFunctionExpression):not(FunctionExpression)",
        message: 'Only literals and functions are permitted as the 2nd argument of String.prototype.replace. Use a function that returns the expression instead.',
      },
    ],
  },
}
\`\`\`

å› ä¸ºåªæ˜¯åˆ†æ ASTï¼Œæœ‰å¾ˆå¤šæƒ…å†µä¼šè¯¯æŠ¥ï¼Œä¾‹å¦‚ replacement æ˜¯ä¸€ä¸ªå‡½æ•°åï¼Œä½†å®é™…ä»£ç åº”è¯¥å¾ˆå°‘å‡ºç°è¿™æ ·çš„æƒ…å†µï¼ŒçœŸé‡åˆ°äº†çš„è¯å†å¥—ä¸€å±‚å‡½æ•°å°± ok äº†ï¼Œå®åœ¨ä¸è¡Œè¿˜èƒ½ç”¨æ³¨é‡Š disable æ‰ lintã€‚

æ²¡ç ”ç©¶è¿‡ï¼Œä¸çŸ¥é“å†™ ESLint plugin èƒ½ä¸èƒ½æ›´åŠ å‡†ç¡®åœ°æ£€æµ‹ï¼Œ~~ä½†æ˜¯å·®ä¸å¤šå¾—äº†~~ï¼ˆ
`},{title:I,tags:"blog CSS Web ç»éªŒåˆ†äº«",content:`æˆ‘çš„åšå®¢å¥½åƒè¿˜ç”¨äº†ä¸å°‘å¥‡æ€ªçš„å° trick æ¥ä¼˜åŒ– ï¼ˆ~~hopefully~~ï¼‰ æ’ç‰ˆï¼Œåœ¨è¿™æ•´ç†ä¸€ä¸‹ï¼Œåˆ†äº«å‡ºæ¥ï¼Œä¹Ÿæ˜¯æ€•å‡ å¹´ï¼ˆ~~å‡ å¤©~~ï¼‰åæƒ³ä¸èµ·æ¥è¿™äº›å¥‡æ€ªçš„ä¸œè¥¿æ˜¯åœ¨å¹²ä»€ä¹ˆã€‚

ä¸»è¦æ˜¯ text justify ç›¸å…³å’Œæ ‡ç‚¹æŒ¤å‹ç›¸å…³ã€‚



æˆ‘åšå®¢çš„ Markdown æ¸²æŸ“åŸºäº [unified](https://github.com/unifiedjs/unified)ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä¸€äº›ä¼˜åŒ–æ˜¯ä»¥ unified æ’ä»¶ï¼ˆremark / remark-rehype / rehype æ’ä»¶ï¼‰çš„å½¢å¼å®ç°çš„ã€‚

<Card type="warn">
ä¸ºäº†ç›´è§‚åœ°è¿›è¡Œæ¼”ç¤ºï¼Œæœ¬æ–‡å¯èƒ½ä¼šåœ¨æåˆ°ä¸€ä¸ªé—®é¢˜çš„æ®µè½é€šè¿‡è®¾ç½®æ–‡æœ¬å’Œ CSS ç‰¹æ„åˆ¶é€ å‡ºç›¸åº”çš„é—®é¢˜ï¼Œå¹¶ç¦ç”¨å¯¹è¿™ä¸ªé—®é¢˜çš„å¤„ç†æªæ–½ä»¥å°†é—®é¢˜å±•ç¤ºå‡ºæ¥ã€‚
</Card>

## text justify ç›¸å…³

åœ¨æ¯è¡Œçš„å®½åº¦ç•¥æœ‰å·®å¼‚æ—¶ï¼Œ[ä½¿ç”¨ä¸¤ç«¯å¯¹é½ä¼šè®©ä¸­æ–‡æ’ç‰ˆæ›´åŠ ç¾è§‚](https://www.w3.org/TR/2022/DNOTE-clreq-20221009/#line_adjustment)ï¼Œè¿™ä¸€èˆ¬é€šè¿‡ [\`text-align\` CSS å±æ€§](https://developer.mozilla.org/docs/Web/CSS/text-align) çš„ \`justify\` é€‰é¡¹å®ç°ã€‚ä½†ç”±äºç½‘é¡µæ’ç‰ˆçš„ä¸ç¡®å®šæ€§ï¼Œæ¯è¡Œçš„å®½åº¦å¯èƒ½ä¸æ˜¯ç•¥æœ‰å·®å¼‚è€Œæ˜¯æœ‰å¾ˆå¤§å·®å¼‚ï¼Œè¿™æ—¶ä½¿ç”¨ text justify å°±ä¼šé€ æˆè¿‡å¤§çš„ç©ºéš™ï¼Œæ‰€ä»¥éœ€è¦é¿å…å‡ºç°è¿‡çŸ­çš„è¡Œï¼Œæˆ–è€…åœ¨æœ‰å¿…è¦æ—¶ç¦ç”¨ text justifyã€‚

### lang="zh-CN" å¯¹ text justify çš„å½±å“

è¿™ä¸ªå¹¶ä¸æ˜¯ trickï¼Œæ˜¯åŸºæ“ï¼Œä½†æŒºé‡è¦çš„ï¼Œè¿˜æ˜¯å†™åœ¨è¿™ã€‚

å¦‚æœæ²¡æœ‰å°† HTML çš„ [\`lang\` å±æ€§](https://developer.mozilla.org/docs/Web/HTML/Global_attributes/lang) è®¾ä¸ºä¸­æ–‡ï¼Œåœ¨ Firefox 109ï¼ˆä»¥åŠå…¶ä»–ç‰ˆæœ¬ / å…¶ä»–æµè§ˆå™¨ï¼Œä½†ä¸åŒ…æ‹¬ Chrome 109ï¼‰ä¸­å°±ä¼šæŒ‰ç…§è‹±æ–‡çš„è§„åˆ™ï¼Œå°†è¿ç»­çš„æ±‰å­—è§†ä½œä¸€ä¸ªå•è¯ï¼Œè€Œåªåœ¨è¯ä¸è¯ä¹‹é—´å¢å¤§é—´è·ï¼Œä¸æ”¹å˜æ±‰å­—ä¹‹é—´çš„é—´è·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

<p lang="en" style="margin: auto; width: 12em; border: gray solid 1px;">è¿™æ˜¯ä¸€ä¸ªè®¾ç½®äº† \`lang="en"\` å’Œå›ºå®šå®½åº¦çš„æ®µè½ï¼Œè¿™æ˜¯ä¸€ä¸ª loooooooooooooooong wordã€‚</p>

![ä¸Šé¢çš„ lang è®¾ä¸º en çš„æ®µè½åœ¨ Firefox 109 ä¸­çš„æ¸²æŸ“æ•ˆæœ](firefox-text-justify-en.png)

å…¶ä¸­ï¼Œç¬¬ä¸€è¡Œæ²¡æœ‰ä¸¤ç«¯å¯¹é½ï¼Œè€Œç¬¬ä¸‰è¡Œåªåœ¨é€—å·åé¢å¢åŠ äº†é—´è·ã€‚

å¦‚æœè®¾ç½®äº† \`lang="zh-CN"\` åˆ™ä¼šåœ¨æ±‰å­—é—´æ·»åŠ é—´è·ï¼š

<p lang="zh-CN" style="margin: auto; width: 12em; border: gray solid 1px;">è¿™æ˜¯ä¸€ä¸ªè®¾ç½®äº† \`lang="zh-CN"\` å’Œå›ºå®šå®½åº¦çš„æ®µè½ï¼Œè¿™æ˜¯ä¸€ä¸ª loooooooooooooooong wordã€‚</p>

![ä¸Šé¢çš„ lang è®¾ä¸º zh-CN çš„æ®µè½åœ¨ Firefox 109 ä¸­çš„æ¸²æŸ“æ•ˆæœ](firefox-text-justify-zh-CN.png)

å½“ç„¶ï¼Œè®¾ç½® HTML çš„ \`lang\` å±æ€§è¿˜æœ‰å…¶ä»–ä½œç”¨ï¼Œä¸ç®¡æ€ä¹ˆæ ·æ€»æ˜¯å¾—è®¾ä¸€ä¸ªçš„ã€‚

### æ–­å¼€è¿‡é•¿çš„è¡Œå†…ä»£ç 

æœ‰æ—¶å€™ä¼šé‡åˆ°ä¸€äº› <code style="word-break: normal;">veryLoooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooongInlineCode</code>ï¼Œä¸ºäº†è®©å®ƒä¸æ–­å¼€ï¼Œå‰é¢çš„ä¸€è¡Œå°±ä¼šéå¸¸çŸ­ï¼Œjustify åé—´éš™å°±éå¸¸å¤§ã€‚å½“ç„¶ï¼Œè¿™æ ·çš„é—®é¢˜ä¸å±€é™äºè¡Œå†…ä»£ç ï¼Œä½†æ­£å¸¸çš„è‹±æ–‡å¾ˆå°‘ä¼šé‡åˆ°ç‰¹åˆ«é•¿çš„å•è¯ï¼Œä»£ç åˆ™ç»å¸¸é‡åˆ°ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å¯¹ä»£ç è¿›è¡Œå¤„ç†ï¼ˆä¸»è¦æ˜¯å› ä¸ºä¸éœ€è¦åˆ†è¯å¥— \`<span>\`ï¼‰ã€‚

æ€è·¯å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠè¿‡é•¿çš„ \`:not(pre) > code\` é€šè¿‡ [\`<wbr>\`](https://developer.mozilla.org/docs/Web/HTML/Element/wbr) æˆ–è€… [\`word-break: break-all\`](https://developer.mozilla.org/docs/Web/CSS/word-break) æ–­å¼€ï¼Œè®©å®ƒä¸å¯æ–­å¼€çš„éƒ¨åˆ†æ²¡é‚£ä¹ˆé•¿ã€‚ä¾‹å¦‚ï¼š\`<code>word<wbr>-<wbr>break<wbr>: <wbr>break<wbr>-<wbr>all</code>\`ã€\`<code>&lt;<wbr>code<wbr>&gt;<wbr>word<wbr>&lt;<wbr>wbr<wbr>&gt;-&lt;<wbr>wbr<wbr>&gt;<wbr>break<wbr>&lt;<wbr>wbr<wbr>&gt;: &lt;<wbr>wbr<wbr>&gt;<wbr>break<wbr>&lt;<wbr>wbr<wbr>&gt;-&lt;<wbr>wbr<wbr>&gt;<wbr>all<wbr>&lt;/<wbr>code<wbr>&gt;</code>\`â€¦â€¦ï¼ˆ~~ç¦æ­¢ç¦æ­¢å¥—å¨ƒ~~ï¼‰ã€‚

å…·ä½“å®ç°ï¼š[\`breakLongCode.ts\`](https://github.com/ouuan/iles-blog/blob/master/src/rehype/breakLongCode.ts)

1.  å¦‚æœæŒ‰ç©ºæ ¼åˆ†å¼€æ²¡æœ‰è¶…è¿‡ 10 ä¸ªå­—ç¬¦çš„éƒ¨åˆ†ï¼Œä¸è¿›è¡Œå¤„ç†ï¼›
2.  å¦‚æœæŒ‰æ­£åˆ™è¡¨è¾¾å¼çš„ \`\\b\` åˆ†å¼€æ²¡æœ‰è¶…è¿‡ 12 ä¸ªå­—ç¬¦çš„éƒ¨åˆ†ï¼Œåˆ™åœ¨ \`\\b\` å¤„æ’å…¥ \`<wbr>\`ï¼›
3.  å¦‚æœæŒ‰ \`\\b\` ä»¥åŠä¸‹åˆ’çº¿åˆ†å¼€æ²¡æœ‰è¶…è¿‡ 15 ä¸ªå­—ç¬¦çš„éƒ¨åˆ†ï¼Œåˆ™åœ¨ç›¸åº”ä½ç½®æ’å…¥ \`<wbr>\`ï¼›
4.  å¦åˆ™ï¼Œæ²¡æ•‘äº†ï¼Œç›´æ¥ \`word-break: break-all\`ã€‚

å½“ç„¶è¿™ä¸ªç²—ç³™çš„å¤„ç†æ–¹å¼è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ä»ä¸Šé¢çš„ç¤ºä¾‹å°±å¯ä»¥çœ‹å‡ºæ¥ï¼ŒæœŸæœ›ç»“æœå¯èƒ½æ˜¯ \`<wbr>\` / \`<code>\` ä¸è¢«æ–­å¼€ï¼Œä½†å®é™…ä¸Šä¼šåœ¨ \`<\` å / \`>\` å‰æ–­å¼€ã€‚

UPDï¼šé“¾æ¥ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚

### åœ¨å°å±å¹•ä¸Šå¯¹çª„çš„å…ƒç´ ç¦ç”¨ text justify

<p style="margin: auto; width: 7em; border: gray solid 1px;">æœ‰çš„æ—¶å€™å®¹å™¨å®½åº¦å¤ªå°ï¼Œå³ä½¿æ˜¯æ­£å¸¸çš„æ™®é€šæ–‡æœ¬ä¹Ÿä¸é€‚åˆè¿›è¡Œ text justifyã€‚</p>

æˆ‘é€‰æ‹©äº†ä¸€ä¸ªéå¸¸ç®€å•ç²—æš´çš„å¤„ç†æ–¹æ³•ï¼šè®¤ä¸ºçª„çš„å…ƒç´  = å°å±å¹•ä¸ŠåµŒå¥—äº†å¤šçº§çš„å…ƒç´ ã€‚

\`\`\`css
.article-style {
  text-align: justify;
}
.article-style > * > * {
  text-align: initial;
}
@media (min-width: 40em) {
  .article-style > * > * {
    text-align: inherit;
  }
}
\`\`\`

ï¼ˆä¸Šé¢æ”¾çš„æ˜¯ç¼–è¯‘å‡ºæ¥çš„ CSSï¼Œ[æºç ](https://github.com/ouuan/iles-blog/blob/master/src/styles/article.scss)æ˜¯ä½¿ç”¨ UnoCSS çš„ SCSSã€‚ï¼‰

ä¸€äº›ç»†èŠ‚ï¼š

-   ä½¿ç”¨ \`*\` é€‰æ‹©å™¨ï¼Œ[specificity](https://developer.mozilla.org/docs/Web/CSS/Specificity) å¾ˆä½ï¼Œä¾¿äº overrideã€‚
-   åªé€‰æ‹© \`> * > *\` è€Œé \` * *\`ï¼Œè¿™æ ·çš„è¯åµŒå¥—æ›´æ·±çš„å…ƒç´ ä¾ç„¶ä» parent ç»§æ‰¿ \`text-align\`ï¼Œå°±å¯ä»¥è®¾ç½® CSS override æ‰ä¸€æ•´ä¸ªå­æ ‘ã€‚ï¼ˆä¹‹å‰æˆ‘ä¸€åº¦ä»¥ä¸º katex ä¸è‡ªå¸¦è¡Œé—´å…¬å¼å±…ä¸­ï¼Œåæ¥å‘ç°æ˜¯è¢«æˆ‘çš„ CSS æ”¹æ‰äº† \`text-align\`ã€‚ï¼‰
-   ä½¿ç”¨ \`inherit\` è€Œé \`justify\` è¿›è¡Œæ’¤é”€ã€‚

### å¯¹åŒ…å«è¿‡é•¿è¡Œå†…å…¬å¼çš„å…ƒç´ ç¦ç”¨ text justify

é™¤äº† \`è¡Œå†…ä»£ç \`ï¼Œ$\\text{è¡Œå†…å…¬å¼}$ ä¹Ÿæ˜¯å¸¸è§çš„è¿‡é•¿çš„ä¸å¯æ–­å…ƒç´ ã€‚è¿™é‡Œæˆ‘é‡‡ç”¨äº†ä¸€ä¸ªæœ¬æ–‡æœ€ dirty çš„å¤„ç†æ–¹å¼ï¼šåœ¨å®¢æˆ·ç«¯é€šè¿‡ JavaScript æ£€æµ‹å®½åº¦è¿‡å¤§çš„è¡Œå†…å…¬å¼ã€‚

å…·ä½“å®ç°ï¼š[\`TextJustifyFix.vue\`](https://github.com/ouuan/iles-blog/blob/master/src/components/TextJustifyFix.vue)

-   åªä¿®æ”¹ \`text-align: justify\` çš„å…ƒç´ ï¼Œå¦‚æœå·²ç»è®¾ç½®ä¸ºå…¶ä»–å¯¹é½æ–¹å¼ï¼ˆä¾‹å¦‚è¡¨æ ¼ä¸­çš„å±…ä¸­å¯¹é½ï¼‰ï¼Œå°±ä¸åº”ä¿®æ”¹ã€‚
-   ä½¿ç”¨äº† [\`document.fonts.ready\`](https://developer.mozilla.org/docs/Web/API/FontFaceSet/ready) æ¥ç­‰å¾…å­—ä½“å…¨éƒ¨åŠ è½½å¥½å†æ£€æŸ¥å®½åº¦ã€‚

## æ ‡ç‚¹æŒ¤å‹

ä»£ç å®ç°ï¼š[\`mojikumi.ts\`](https://github.com/ouuan/iles-blog/blob/master/src/remark/mojikumi.ts)ã€[\`mojikumi.scss\`](https://github.com/ouuan/iles-blog/blob/master/src/styles/mojikumi.scss)ã€‚

### ç›¸é‚»æ ‡ç‚¹çš„æŒ¤å‹

ä¾‹å¦‚ï¼šã€Œ<span class="no-mojikumi">ï¼šâ€œã€‚â€ï¼ˆã€‚ï¼‰</span>ã€â†’ã€Œ<span>ï¼šâ€œã€‚â€ï¼ˆã€‚ï¼‰</span>ã€ã€‚å½“ç„¶æœ¬é¡µå…¶ä»–åœ°æ–¹ä¹Ÿæœ‰ä¸€äº›ä¾‹å­ã€‚

å…·ä½“è§„åˆ™ [clreq](https://www.w3.org/TR/2022/DNOTE-clreq-20221009/#compression_rules_for_consecutive_punctuation_marks) ä¸­è¯´çš„æ¯”è¾ƒæ¨¡ç³Šï¼Œå¯ä»¥å‚è€ƒ [jlreq](https://www.w3.org/TR/2020/NOTE-jlreq-20200811/#positioning_of_consecutive_opening_brackets_closing_brackets_comma_full_stops_and_middle_dots)ã€‚

### ä½¿ç”¨ CSS å»é™¤æ ‡ç‚¹çš„ä¸€åŠç©ºç™½

CSS å®ç°æ ‡ç‚¹æŒ¤å‹æœ‰ä¸¤ç§æ–¹å¼ï¼š

-   ä½¿ç”¨ [\`letter-spacing: -0.5em\`](https://developer.mozilla.org/docs/Web/CSS/letter-spacing) å»æ‰å³ä¾§ç©ºç™½ï¼Œ\`margin-left: -0.5em\` å»æ‰å·¦ä¾§ç©ºç™½ã€‚
-   ä½¿ç”¨ [\`font-feature-settings:\`](https://developer.mozilla.org/docs/Web/CSS/font-feature-settings) [\`"halt"\`](https://learn.microsoft.com/typography/opentype/spec/features_fj#halt) å°†æ”¯æŒ halt ç‰¹æ€§çš„å­—ä½“å˜ä¸ºåŠå®½ã€‚

ä½¿ç”¨ \`letter-spacing\` æ˜¯æœ‰è®²ç©¶çš„ï¼Œæ¯” \`margin-right\` é è°±ï¼Œå› ä¸ºå­—ç¬¦çœŸçš„ä¼šåªå åŠå®½ï¼Œè€Œä¸æ˜¯å å…¨å®½ä½†ä¸€åŠå’Œä¸‹ä¸€ä¸ªå­—ç¬¦é‡å ï¼Œç”šè‡³é€ æˆ overflowï¼Œå¯èƒ½å¯¼è‡´æ»šåŠ¨æ¡å‡ºç°ã€‚ä½† \`letter-spacing\` ä¸èƒ½å»æ‰å·¦ä¾§ç©ºç™½ï¼Œå°±åªèƒ½ä½¿ç”¨ \`margin-left\` äº†ã€‚

é€šè¿‡ halt ç‰¹æ€§å˜ä¸ºåŠå®½æ˜¯æ›´åŠ é è°±çš„åšæ³•ï¼Œä½†ä¸æ˜¯æ‰€æœ‰å­—ä½“éƒ½æ”¯æŒè¿™ä¸€ç‰¹æ€§ï¼Œæ€æºå®‹ä½“æ˜¯æ”¯æŒçš„ï¼Œ<span class="font-kai">éœé¹œæ–‡æ¥·</span> ä¸æ”¯æŒã€‚å¹¶ä¸”ï¼Œhalt åªèƒ½å˜ä¸ºåŠå®½ï¼Œä¸èƒ½å˜æˆå…¶ä»–å®½åº¦ã€‚

### è¡Œé¦–è¡Œå°¾æ ‡ç‚¹çš„æŒ¤å‹

è¿™é‡Œå‚è€ƒäº† [Han.css](https://github.com/ethantw/Han) çš„å®ç°ï¼Œå°±æ˜¯æŠŠå…¨å®½çš„æ ‡ç‚¹æ”¹æˆåŠå®½æ ‡ç‚¹å’Œä¸€ä¸ªé€šè¿‡ \`::before\` æˆ– \`::end\` æ·»åŠ çš„åŠå®½çš„ç©ºæ ¼ï¼š

-   å› ä¸ºæ˜¯ pseudo elementï¼Œæ‰€ä»¥ä¸å½±å“æ–‡æœ¬å†…å®¹ï¼ˆä¾‹å¦‚å¤åˆ¶å‡ºæ¥çš„æ–‡æœ¬ï¼‰ã€‚
-   å› ä¸ºæ˜¯ç©ºæ ¼ï¼Œæ‰€ä»¥ä½äºè¡Œé¦–æˆ–è¡Œå°¾æ—¶å°±ä¼šå‘ç”Ÿ[ç©ºæ ¼å¡Œé™·](https://www.w3.org/TR/2023/CRD-css-text-3-20230127/#white-space-phase-2)ã€‚

### è‹±æ–‡æ ‡ç‚¹çš„å¤„ç†

æˆ‘é‡‡ç”¨äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„åˆ¤æ–­è‹±æ–‡æ ‡ç‚¹çš„æ–¹æ³•ï¼š

-   ç©ºç™½ä¸€ä¾§ï¼ˆå·¦æ‹¬å·ã€å·¦å¼•å·ç­‰æ˜¯å·¦ä¾§ï¼Œå…¶ä»–ä¸€èˆ¬æ˜¯å³ä¾§ï¼‰æ˜¯ç©ºæ ¼æ—¶æ˜¯è‹±æ–‡æ ‡ç‚¹ï¼›
-   å³å•å¼•å·å³ä¾§æ˜¯å­—æ¯æ—¶æ˜¯æ’‡å·ã€‚

è‹±æ–‡æ ‡ç‚¹ä¸€èˆ¬è°ƒä¸ºåŠå®½å³å¯ï¼Œä½†æ’‡å·åŠå®½è¿˜æ˜¯æœ‰äº›å¤ªå®½äº†ï¼Œåº”è¯¥ï¼ˆæ ¹æ®å­—ä½“è€Œå®šï¼‰è°ƒæˆå¤§çº¦ä¸‰åˆ†ä¹‹ä¸€å®½ï¼Œå•å¼•å·ä¹Ÿå¯ä»¥è°ƒçª„ä¸€ç‚¹ï¼Œæ‰€ä»¥å¯ä»¥ç‰¹åˆ¤ä¸€ä¸‹å•å¼•å·ï¼Œä½¿ç”¨ \`letter-spacing\` å’Œ \`margin-left\`ã€‚

### ç»™éœé¹œæ–‡æ¥·æ·»åŠ  halt ç‰¹æ€§

å› ä¸º [æ·»åŠ  halt ç‰¹æ€§çš„ issue](https://github.com/lxgw/LxgwWenKai/issues/104) è¢«æ‹’äº†ï¼Œæˆ‘å°±è‡ªå·±æ”¹äº†ä¸€ä¸ª [æ ‡ç‚¹å­—ä½“](https://github.com/ouuan/XiaWu-Punctuations)ï¼Œé¡ºä¾¿æŠŠå¼•å·æ”¹æˆäº†å’Œæ€æºå®‹ä½“ä¸€è‡´çš„å…¨å®½ä»¥æ–¹ä¾¿ä¸€èµ·å¤„ç†ï¼ˆä¹Ÿå¯ä»¥ç†è§£ä¸ºæ”¹å¼•å·å®½åº¦é¡ºä¾¿æ·»åŠ  halt ç‰¹æ€§ï¼Œæ¯•ç«Ÿæ²¡æœ‰ halt ä¹Ÿå¯ä»¥ç”¨ \`letter-spacing\` å’Œ \`margin-left\` å‡‘åˆä¸€ä¸‹ï¼‰ï¼Œå…·ä½“å¯ä»¥çœ‹ä»“åº“é‡Œçš„ patch æ–‡ä»¶ã€‚

### å…³äº chws ç‰¹æ€§

[chws ç‰¹æ€§](https://learn.microsoft.com/typography/opentype/spec/features_ae#chws) å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡è‡ªåŠ¨æŒ¤å‹è¿ç»­æ ‡ç‚¹ï¼Œä¸€çœ¼çœ‹ä¸Šå»ä¼¼ä¹æ¯” halt æ›´å¥½ç”¨ã€‚

æ€æºå®‹ä½“ä¸æ”¯æŒè¿™ä¸€ç‰¹æ€§ï¼Œåªä¸è¿‡æœ‰ [chws_tool](https://github.com/googlefonts/chws_tool) å¯ä»¥ç”¨æ¥è½¬æ¢ã€‚

ä½†æ˜¯ï¼Œchws ä¸æ”¯æŒè¡Œé¦–è¡Œå°¾æ ‡ç‚¹æŒ¤å‹ï¼Œè€Œå¦‚æœè¦æ”¯æŒè¡Œé¦–è¡Œå°¾æŒ¤å‹ï¼Œå°±å¾—æŠŠæ”¯æŒè¿ç»­æ ‡ç‚¹æŒ¤å‹çš„å·¥ä½œåšä¸€éï¼ˆå› ä¸ºè¦çŸ¥é“å“ªäº›æ ‡ç‚¹å·²ç»è¢«æŒ¤æˆäº†åŠå®½å“ªäº›åªåœ¨è¡Œé¦–è¡Œå°¾æŒ¤æˆåŠå®½ï¼‰ï¼Œè¿™æ ·ä¸€æ¥ chws å°±æ²¡å¤šå¤§æ„ä¹‰äº†ã€‚

### Yet another mojikumiï¼Ÿ

æœ‰ä¸€äº›ç°æˆçš„æ”¯æŒæ ‡ç‚¹æŒ¤å‹çš„åº“ï¼Œä¾‹å¦‚ [heti](https://github.com/sivan/heti) å’Œ [Han.css](https://github.com/ethantw/Han)ã€‚ä½†æ˜¯æˆ‘æœ‰ä¸€äº›éœ€æ±‚ï¼š

-   è¦èƒ½ SSG ï¼ˆSSRï¼‰ï¼Œä¸èƒ½åœ¨å®¢æˆ·ç«¯è¿è¡Œã€‚æœ€å¥½æ˜¯èƒ½åœ¨ remark / rehype ä¸­è¿›è¡Œå¤„ç†ã€‚
-   æœ€å¥½æ˜¯å°½é‡ä½¿ç”¨ halt è€Œé \`letter-spacing\` å’Œ \`margin-left\`ã€‚
-   è¦èƒ½æ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œæ¯”å¦‚å¯¹å•å¼•å·ç‰¹æ®Šå¤„ç†ã€‚
-   æˆ‘åªéœ€è¦æ ‡ç‚¹æŒ¤å‹ï¼Œä¸æƒ³è¦ä¸€ä¸ª CSS å…¨å®¶æ¡¶ï¼Œæˆ–è€…å¸¦æœ‰å…¶ä»–åŠŸèƒ½çš„ JSã€‚

ç°æœ‰çš„åº“éš¾ä»¥åŒæ—¶æ»¡è¶³ä¸Šé¢è¿™äº›éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘å°±è‡ªå·±å†™äº†ã€‚

æœ¬æ¥æƒ³å†™ä¸€ä¸ªé€šç”¨çš„åº“ï¼Œä½†é€šç”¨çš„é€»è¾‘è²Œä¼¼æ²¡å¤šå°‘ä»£ç ï¼Œä¸å€¼å¾—å†™æˆä¸€ä¸ªåº“ã€‚è€Œæˆ‘çš„æ•´ä¸ª remark æ’ä»¶åˆæœ‰ç‚¹ opinionatedï¼Œå¯èƒ½ä¸å¤ªé€‚åˆåšæˆåº“ï¼ˆ~~æ‡’å¾—åšæˆåº“~~ï¼‰ï¼Œæƒ³ç”¨çš„è¯å¯ä»¥åœ¨éµå®ˆ [AGPL 3.0](https://github.com/ouuan/iles-blog/blob/master/LICENSE) çš„å‰æä¸‹ç›´æ¥å¤åˆ¶ï¼ˆæœ¬æ–‡æåˆ°çš„å…¶ä»–ä»£ç ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå½“ç„¶ï¼Œå¦‚æœæ˜¯ä¸¤ä¸‰è¡Œçš„ä»£ç ç‰‡æ®µå°±ä¸è‡³äº AGPL äº†ï¼Œç®€å•æ ‡ä¸€ä¸‹å‡ºå¤„å°± OKï¼‰ã€‚

## ä»£ç ä¸­çš„ Unicodeï¼ˆCJKï¼‰çš„å­—ä½“

~~ä¸ºä»€ä¹ˆé©¬ä¸Šè¦è€ƒæŠ½ä»£äº†ä½ åœ¨è¿™æ›´æ–°åšå®¢ï¼Œæˆ‘ä¹Ÿå¾ˆæƒ³çŸ¥é“ï¼ˆ~~ å…¶å®æ˜¯åœ¨ä¸€ä¸ªç¾¤é‡Œçœ‹åˆ°æœ‰äººåœ¨èŠåšå®¢çš„ç­‰å®½å­—ä½“ï¼Œç„¶åçœ‹äº†ä¸€çœ¼è‡ªå·±çš„ç­‰å®½å­—ä½“ï¼Œå·®ç‚¹æ²¡æƒ³èµ·æ¥è¿™ä¸ª trick åœ¨å¹²ä»€ä¹ˆã€‚

å¾ˆå¤šç­‰å®½å­—ä½“æ˜¯æ²¡æœ‰ CJK å­—å½¢çš„ï¼Œåœ¨ Windows çš„é»˜è®¤å­—ä½“ä¸‹ï¼Œfallback åˆ° \`monospace\` æ—¶ä¸­æ–‡ä¼šæ˜¾ç¤ºä¸º<code style="font-family: NSimSun, SimSun, serif;">å®‹ä½“</code>ï¼Œè€Œä¸€èˆ¬æ¥è¯´åº”å½“æ˜¯\`é»‘ä½“\`ã€‚æ‰€ä»¥å¯ä»¥ä¸º Unicode éƒ¨åˆ†ä¸“é—¨æŒ‡å®šä¸€ä¸ª fallback fontï¼Œé€šè¿‡æŒ‡å®š \`unicode-range\` æ¥è®© ASCII å­—ç¬¦ä¾ç„¶ fallback åˆ° \`monospace\`ã€‚

\`\`\`css
@font-face {
  font-family: "Monospace Unicode Fallback";
  src: local("Noto Sans Mono CJK SC"),
       local("Source Han Mono SC"),
       local("Noto Sans CJK SC"),
       local("Source Han Sans SC"),
       local("Microsoft YaHei");
  unicode-range: U+1000-fffff;
}

:root {
  --default-mono-font: ui-monospace, DejaVu Sans Mono, Noto Sans Mono, SFMono-Regular, Menlo, Monaco, Consolas, "Monospace Unicode Fallback", monospace, var(--default-emoji-font);
}
\`\`\`
`},{title:N,tags:"digital-design å­¦ä¹ è®°å½•",content:`è°ä¼šæ„¿æ„å¤©å¤©ç”¨ä¸€ä¸ªè¯¾å…­ä¸ªå­—çš„å…¨åæ¥å«å®ƒå‘¢ï¼Œä½†æ˜¯æ•°å­—é€»è¾‘ç”µè·¯æ˜¯æ•°ç”µï¼Œæ•°å­—é€»è¾‘è®¾è®¡æ˜¯æ•°è®¾ï¼Œæ•°å­—é€»è¾‘å®éªŒæ€»ä¸èƒ½æ˜¯ \`/æ•°[å­—é€»]?å®éªŒ?/\`ï¼Œä½†å«å®ƒæ•°ç”µå®éªŒæˆ–è€…æ•°è®¾å®éªŒå¥½åƒéƒ½ä¸å¤ªå¯¹ï¼Œè‰ï¼ˆ

ä¸Šè¯¾çš„æ—¶å€™ä¹Ÿæ˜¯ï¼Œè€å¸ˆä¸€ä¼šå„¿ä¸€ä¸ªâ€œå¦‚æœä½ æ˜¯æ•°è®¾çš„åŒå­¦â€ï¼Œä¸€ä¼šå„¿ä¸€ä¸ªâ€œå¦‚æœä½ æ²¡æŠ¥ä¸Šæ•°è®¾ä½†æƒ³æŠŠæ•°ç”µå­¦æˆæ•°è®¾â€ï¼Œè¿™è¯¾ä¹Ÿå¤ªä¹±äº†ï¼ˆ

æˆ‘å†™æ¸¸è®°éƒ½å¾—æŠŠä¸¤ä¸ªè¯¾æ”¾ä¸€èµ·å†™ï¼Œè¯¾å°±ä¸èƒ½åˆæˆä¸€ä¸ªå—ï¼ˆ



å†™äº†ä¸€ä¼šå„¿åå‘ç°ï¼Œè¿˜æ˜¯å¾—ä¸¤ä¸ªè¯¾åˆ†å¼€å†™ï¼Œdbqwclï¼ˆ

è¿™ç¯‡å°±æ˜¯ä¸ªæ¸¸è®°ï¼Œå…·ä½“å­¦çš„å†…å®¹å¦‚æœæˆ‘æœ‰æ—¶é—´çš„è¯ä¼šæ”¾åœ¨ [DDPP å­¦ä¹ ç¬”è®°](/tag/ddpp)ï¼Œæ²¡æ—¶é—´ï¼ˆæ²¡æ—¶é—´å†™ç¬”è®° or æ²¡æ—¶é—´å­¦ DDPP åªèƒ½è·Ÿç€ä¸Šè¯¾ï¼‰çš„è¯å¤§æ¦‚å°±ä¸ä¼šæ”¾ä¸Šæ¥äº†ï¼ˆ

~~æŸäº›äººå­¦éƒ½å­¦ä¸å®Œäº†ï¼Œè¿˜æœ‰ç©ºå†™æ¸¸è®°ï¼Ÿï¼ˆ~~

## æ•°å­—é€»è¾‘å®éªŒ

### sv ç­çš„å¼€è®¾

DDPP5 è®²çš„æ˜¯ Verilogï¼Œä»¥åé€ æœºåº”è¯¥ä¹Ÿæ˜¯ç”¨ Verilogï¼Œä½†æ•°å­—é€»è¾‘å®éªŒä¼¼ä¹æ˜¯ VHDLã€‚å°±åƒè½¯å·¥å¼ºè¿«æˆ‘æŠŠæŠ€æœ¯æ ˆå…¨æ¢ä¸€éä¸€æ ·ï¼Œå¤šå­¦ä¸€é—¨è¯­è¨€ä¹Ÿå¯ä»¥ç§°ä½œâ€œæŠ€å¤šä¸å‹èº«â€ï¼Œè€Œä¸”è¯´åˆ°åº•æˆ‘ä¹Ÿè¿˜æ²¡å­¦ Verilogï¼ˆï¼Œä½†ç»ˆç©¶æ˜¯æœ‰äº›éš¾å—çš„ã€‚æ‰€ä»¥çœ‹åˆ°ç¬¬ä¸€èŠ‚è¯¾çš„è¯¾ä»¶ä¸Šè¯´å¯ä»¥é€‰æ‹©æŠ¥ SystemVerilog å°ç­æˆ‘è¿˜æ˜¯å¾ˆå¼€å¿ƒçš„ï¼Œé¡¿æ—¶æ„Ÿè§‰è¿™ä¸ªè¯¾ç§‘å­¦äº†è®¸å¤šï¼ˆ

>   ä¼˜åŠ¿ï¼šå¯¹åç»­è¯¾ç¨‹æœ‰å¸®åŠ©
>
>   åŠ£åŠ¿ï¼šèŠ±æ—¶é—´ï¼Œè´¹ç²¾åŠ›ã€‚ã€‚ã€‚

è¯¾ä»¶ä¸Šæ˜¯è¿™ä¹ˆå†™çš„ï¼Œä½† Verilog æœ¬èº«åº”è¯¥ä¸ä¼šæ¯” VHDL è´¹ç²¾åŠ›ï¼Œè¯¾ç¨‹å†…å®¹çš„åŒºåˆ«æ˜¯å¤šäº†ä¸ªå†…å­˜å®éªŒï¼Œæˆ‘çŒœè¿™ä¸ª warning çš„ä¸»è¦æ„ä¹‰åœ¨äºï¼Œè¿™æ˜¯ä¸ªæ–°å¼€çš„è¯¾ï¼Œå¯èƒ½å„ç§å‡ºé”…ï¼Œè¦è®©å¤§å®¶åšå¥½å¿ƒç†å‡†å¤‡ï¼ˆåŒæ ·æ˜¯æ–°å¼€çš„ [Rust](/post/2022/08/learn-rust) å°±éå¸¸ç§‘å­¦ï¼ˆ~~èµ·ç å®Œå…¨è‡ªå­¦äººæ„Ÿè§‰å¾ˆç§‘å­¦~~ï¼‰ï¼Œæˆ‘ä¼¼ä¹åè€Œæ›´å¸Œæœ›è¯¾æ˜¯æ–°å¼€çš„ï¼Œè€Œä¸”è¿™ä¸ª sv ç­ä¼¼ä¹ä¹Ÿæ˜¯ tuna ç¾¤å‹å½“åŠ©æ•™ï¼ˆ

ä½†è¿™ä¸ª sv ç­çš„å¼€è®¾å®åœ¨æ˜¯æœ‰äº›åå·ï¼Œè¯´èµ·æ¥ä¹Ÿæœ‰äº›å†—é•¿ï¼Œå°±æŠ˜èµ·æ¥äº†ã€‚

<Card title="sv ç­åå·çš„å¼€è®¾è¿‡ç¨‹" fold>

ç®€å•æ¥è¯´ï¼Œæ•°å­—é€»è¾‘å®éªŒæœ‰ 5-1ã€5-3ã€5-4 ä¸‰ä¸ªç­ï¼Œå…¶ä¸­ 5-1ã€5-3 æœ‰å¼€è®¾ sv ç­çš„æœºä¼šï¼Œä½†è¦æ±‚æ˜¯ 5-1 æŠ¥åäººæ•°åœ¨ 25\\~28 ä¹‹é—´ï¼Œ5-3 æŠ¥åäººæ•°åœ¨ 27\\~28 ä¹‹é—´ï¼Œæ‰åˆ†åˆ«èƒ½å¼€ç­ã€‚

æ˜¯ä¸æ˜¯æ„Ÿè§‰éå¸¸ç¥ç§˜ï¼ˆï¼Œè¿™ç¡®å®å¾ˆç¥ç§˜ï¼Œä½†å®ƒèƒŒåç«Ÿç„¶çœŸçš„èƒ½æœ‰ç¡®åˆ‡çš„åŸå› ï¼ˆ

-   æ•°å­—é€»è¾‘å®éªŒçš„è¯¾å®¹é‡æ˜¯ 85ï¼Œ5-1ã€5-3ã€5-4 åˆ†åˆ«æœ‰ 85ã€87ï¼ˆè‰ï¼Œå¬è¯´å¯èƒ½æ˜¯å› ä¸ºé‡ä¿®ï¼Ÿï¼‰ã€69 äººï¼ˆå°è±¡ä¸­å½“æ—¶çš„æ•°æ®ï¼Œç°åœ¨æœ‰ç‚¹å°å˜åŒ–ï¼‰
-   å› ä¸ºè®¾å¤‡ã€å®éªŒå®¤ç­‰èµ„æºé™åˆ¶ï¼Œä¸€ä¸ªæ™®é€šç­åªèƒ½å®¹çº³ 30 äººï¼Œä¸€ä¸ª sv ç­åªèƒ½å®¹çº³ 28 äººï¼Œä¸€ä¸ªæ—¶é—´æ®µåªèƒ½æœ‰ä¸‰ä¸ªç­

è™½ç„¶è¯´åœ¨è¿™äº›é™åˆ¶ä¸‹ä¼¼ä¹ä¹Ÿèƒ½åœ¨ 5-4 å¼€ä¸€ä¸ªç­ï¼ˆ9\\~28 äººå³å¯ï¼Œæ»¡è¶³äººæ•°é™åˆ¶ä¸”ä¸å½±å“è¯¥æ—¶é—´æ®µåˆ†ç­æ•°é‡ï¼‰ï¼Œä½†ä¸çŸ¥é“æ˜¯ä¸æ˜¯æ‡’å¾—å†å¼€ä¸€ä¸ªç­è¿˜æ˜¯ä»€ä¹ˆåŸå› ï¼Œ5-4 æƒ³æŠ¥ sv ç­çš„åŒå­¦åªèƒ½é—æ†¾ç¦»åœºï¼ˆ

åŒå­¦ä»¬å½“ç„¶è§‰å¾—è¿™æ ·æå¾ˆæ¯’ç˜¤ï¼Œä½†è€å¸ˆä¼¼ä¹ä¹ŸçŸ¥é“è¿™æ ·å¾ˆæ¯’ç˜¤ï¼Œè¯´æ˜¯ä¹‹å‰ç”³è¯·è¿‡ææˆäºŒçº§é€‰è¯¾ï¼Œä½†æ²¡é€šè¿‡ã€‚

ä¸€å¼€å§‹æˆ‘æ‹…å¿ƒçš„æ˜¯å¾ˆå¿«æŠ¥æ»¡æŠ¥ä¸ä¸Šï¼Œåæ¥å‘ç°å®Œå…¨æ‹…å¿ƒé”™äº†ï¼ˆï¼ŒçœŸæ­£çš„é—®é¢˜åœ¨äºäººæ•°ä¸å¤Ÿï¼Œè€Œä¸”è¿™ä¸ªæ˜¯å…ˆæŠ¥å…ˆå¾—ï¼Œæˆ‘æ˜¯é€šçŸ¥å‘å‡ºæ¥ 7min å°±æŠ¥äº†ï¼Œ~~è™½ç„¶åœ¨é€‰è¯¾ç³»ç»Ÿé‡Œ 7s å¯èƒ½å°±æ…¢äº†ï¼Œä½†æ˜¯~~ æœ€åçœ‹åå•æˆ‘æ˜¯ç¬¬ä¸€ä¸ªæŠ¥çš„ï¼ˆ

å‰ä¸¤å¤©å¤§å®¶éƒ½ä¸å­å£°ï¼Œåˆ°äº†æŠ¥åçš„ ddl å½“å¤©ä¸‹åˆæˆ‘æ‰åœ¨ç¾¤é‡Œé—®äº†ä¸‹äººæ•°ï¼Œå½“æ—¶æ˜¯ 5-1 22 äºº 5-3 21 äººã€‚äºæ˜¯æˆ‘å¼€å§‹åœ¨ç­ç¾¤æ¨é”€ï¼Œä¹Ÿçœ‹åˆ°æœ‰äººåœ¨è¯¾ç¨‹ç¾¤æ¨é”€ï¼Œåæ­£ä¸»è¦å°±æ˜¯ä»¥åæ€»å¾—å­¦ Verilogï¼ŒæŠ¥ sv ç­å¯ä»¥å°‘å­¦ä¸€é—¨è¯­è¨€ï¼ˆ

æ™šä¸Š 6 ç‚¹ 5-1 å°±å¼€ç­äº†ï¼Œä½† 5-3 åªæœ‰ 24 ä¸ªäººæŠ¥ã€‚åˆ°äº† 23:44 è¿˜æ˜¯ 24ï¼ˆå®é™…ä¸Šæ˜¯ 25ï¼Œæˆ‘å®¤å‹æŠ¥äº†ç»“æœå› æœªçŸ¥åŸå› è¢«æ¼æ‰äº†ï¼Œè‰ï¼‰ï¼Œå°±å¾ˆå´©æºƒã€‚

å½“æ—¶æˆ‘æƒ³äº†ä¸¤ä¸ªå¤‡é€‰æ–¹æ¡ˆï¼š

-   æ”¹æˆ 5-4 å¼€ sv ç­ï¼Œä½†æˆ‘æå‡ºåè¢«å¦äº†ï¼Œè¯´æ˜¯ä¸æ–¹ä¾¿å†è°ƒæ•´ã€‚
-   å» 5-1 çš„ sv ç­ï¼Œç»“æœå¾—çŸ¥ 5-1 å·²ç»æŠ¥äº† 31 äººã€‚~~æ—©çŸ¥é“ä¸æ¨é”€äº†~~

å¥½åœ¨ç¬¬äºŒå¤©åˆè¯´æŠ¥å ddl å»¶é•¿åŠå¤©ï¼Œç„¶åä¸­åˆçš„æ—¶å€™ç«Ÿç„¶å°±æŠ¥æ»¡äº†ã€‚5-3 çš„ 28 äººæœ‰ 10 ä¸ªæ˜¯ä¿¡è®¡çš„ï¼Œ~~ç®€å•ä¼°è®¡ä¸€ä¸‹ï¼Œä¿¡è®¡æœ‰ 28/30 æƒ³æŠ¥ sv~~ï¼Œå®é™…ä¸Š 5-1 çš„ sv ç­åªæœ‰ä¸¤ä¸ªä¿¡è®¡ï¼Œåªä¸è¿‡ç¾¤é‡Œ 5-4 æ±‚æ¢è¯¾çš„è¿˜æœ‰å¥½å‡ ä¸ªä¿¡è®¡ï¼Œå¯æƒœéƒ½æ²¡æ¢ä¸Šï¼Œ~~å†ç®€å•ä¼°è®¡ä¸€ä¸‹ï¼Œsv ç­ 12/56 æ˜¯ä¿¡è®¡ï¼Œä¿¡è®¡åº”è¯¥ä¸€å…±æœ‰ 52 äºº~~ï¼ˆ

</Card>

### sv ç­è¯¾ç¨‹æ–‡æ¡£

#### æœ¬è¯¾ç¨‹åªæœ‰ä¸€å­¦åˆ†ï¼ï¼

![æœ¬è¯¾ç¨‹åªæœ‰ä¸€å­¦åˆ†ï¼ï¼](1-credit.png)

å¼€å¤´ç¬¬ä¸€å¥ï¼Œç»·ä¸ä½äº†ï¼ˆ

#### æŒ‰é’®è¯¦ç»†åŠŸèƒ½

ä¸€èˆ¬æ¥è¯´ admonition ç»å¸¸æ˜¯æ¯”è¾ƒé•¿çš„ä¼šæŠ˜å èµ·æ¥é˜²æ­¢åˆ·å±ï¼Œä½†åœ¨ç¤ºæ³¢å™¨çš„â€œæŒ‰é’®è¯¦ç»†åŠŸèƒ½â€ä¸€èŠ‚ï¼Œè¢«æŠ˜å çš„éƒ½æ˜¯æœ€çŸ­çš„é‚£äº›ï¼Œæ¯”å¦‚ï¼š

> <Card title="ç”µæºå¼€å…³" fold>
> æŒ‰ä¸€æ¬¡æ‰“å¼€ç”µæºï¼Œå†æŒ‰ä¸€æ¬¡å…³é—­ç”µæºã€‚
> </Card>

éå¸¸åœ°ç†æ‰€å½“ç„¶ï¼Œä½†æ„Ÿè§‰è¿™ä¸ªäº‹å®è«ååœ°å¾ˆæœ‰æ„æ€ï¼ˆ~~è€Œä¸”æŠŠç”µæºå¼€å…³å†™å‡ºæ¥å†æŠ˜èµ·æ¥å°±è«åå–œæ„Ÿï¼ˆæŒ‰ä¸€æ¬¡æ‰“å¼€ \`<details>\`ï¼Œå†æŒ‰ä¸€æ¬¡å…³é—­ \`<details>\`~~

#### git conflict

è™½è¯´æ˜¯æ•æ·å¼€å‘è¯¾ç¨‹æ–‡æ¡£ï¼Œä½†è¿™ä¸ª git conflict ä¹Ÿå¤ªï¼ˆ

![è¯¾ç¨‹æ–‡æ¡£ä¸­å‡ºç°äº† git conflict æ ‡è®°](git-conflict-in-doc.png)

### ~~æŠŠäººå¿½æ‚ è¿›æ¥ä¹‹å~~

ä¸‹é¢æ˜¯ä¸¤ä¸ªè¯¾ä»¶çš„ diffï¼Œè™½ç„¶è¿™ä¸ªä¼˜åŠ¿çš„æ„æ€å®é™…ä¸Šæ²¡å˜ï¼Œä» sv ç­è‹›åˆ»çš„å¼€è®¾æ¡ä»¶åŸºæœ¬ä¸Šå°±èƒ½çŒœåˆ°æ²¡æ³•éšæ—¶é€€å‡ºï¼Œä½†æ˜¯ï¼ˆ

>   -   SystemVerilog
>   -   ä¸ºåç»­è¯¾ç¨‹å®éªŒæä¾›æ”¯æ’‘
>       -   å¢åŠ å†…å­˜å®éªŒ<del>ï¼Œå…¶ä»–å®éªŒä¸å˜</del>
>       -   è¯¾ç¨‹æˆç»©ä¸ä¸æ™®é€šè¯¾å ‚åŒºåˆ†ï¼Œè¯„åˆ†æ ‡å‡†ï¼Œæ¯”ä¾‹ä¸æ™®é€šè¯¾å ‚ä¸€è‡´
>   -   ä¼˜åŠ¿ï¼š<del>å¯¹åç»­è¯¾ç¨‹æœ‰å¸®åŠ©</del><ins>å½“å‰å­¦æœŸæ— </ins>
>   -   åŠ£åŠ¿ï¼šèŠ±æ—¶é—´ï¼Œè´¹ç²¾åŠ›ã€‚<del>ã€‚ã€‚</del>
>   -   å¯éšæ—¶é€€å‡º<ins>ï¼Ÿ</ins>

### ç¤ºæ³¢å™¨å®éªŒ

ä¸Šå­¦æœŸç‰©ç†å®éªŒç”¨è¿‡ç¤ºæ³¢å™¨ï¼Œæ„Ÿåˆ°äº†è¿™ä¸ªè¯¾é™¤äº† [å­¦ä¹  TeX å’Œ R](/post/2022/10/basic-tex-and-r-for-physics-lab) ä¹‹å¤–ç«Ÿç„¶è¿˜ç¨å¾®æœ‰ç‚¹ç”¨ï¼Œè™½ç„¶ä¹Ÿåªæœ‰é‚£ä¹ˆä¸€ç‚¹ç‚¹ç”¨ï¼Œä¸çŸ¥é“å’Œç”µå­å­¦åŸºç¡€ç›¸æ¯”å“ªä¸ªçš„ä¸€ç‚¹ç‚¹å¤§ä¸€äº›ï¼ˆ

æ•´ä¸ªå®éªŒä¸­å¡å£³æœ€ä¹…çš„ä¸€æ­¥æ˜¯ï¼Œä»ä¸€å¨ç»‘å¾—ååˆ†æ•´é½çš„å¯¼çº¿ä¸­æŠ½å‡ºä¸€æ ¹ï¼Œè‰ï¼ˆ

### ä¸éé—¨ç”µè·¯æµ‹è¯•å®éªŒ

é¢„ä¹ çš„æ—¶å€™å¯¹ç€æ–‡æ¡£é‡Œçš„ç”µè·¯å›¾å’ŒèŠ¯ç‰‡å¼•è„šå›¾æŠŠæ€ä¹ˆæ¥çº¿ã€æ€ä¹ˆæ¥åœ°å†™æ¸…æ¥šï¼Œå°±å¾ˆå®¹æ˜“äº†ã€‚

æœ¬æ¥æƒ³åŠå°æ—¶é€Ÿé€šï¼Œå¤±è´¥äº†ï¼Œæ„Ÿè§‰æœ€å¤§çš„é—®é¢˜è¿˜æ˜¯æŠ½ä¸å‡ºå¯¼çº¿ï¼ˆ

### ç®€å•ç»„åˆé€»è¾‘ç”µè·¯å®éªŒ

ä¸Šåˆåç‚¹åŠæ‰å¼€å§‹é¢„ä¹ ï¼Œä¸¤å°æ—¶æŠŠ 2 ä½å…¨åŠ å™¨å’Œè¡¥ç å‡æ³•å™¨æ¥å¥½äº†ï¼Œåœ¨è¯¾ä¸ŠåŠä¸ªå°æ—¶æŠŠåŸç å‡æ³•å™¨æ¥å¥½ï¼Œä½†æ˜¯åŠ ä¸Šæ’é˜Ÿç­‰å¾…éªŒæ”¶å’Œæ”¶æ‹¾ä¸œè¥¿è¿˜æ˜¯å¿« 3 ç‚¹æ‰èµ°ã€‚

-   ä¸‰ä¸ªè¿ç®—å™¨æ”¾åœ¨åŒä¸€ä¸ªç”µè·¯é‡Œæ˜¯éå¸¸å®¹æ˜“çš„ã€‚è¡¥ç å‡æ³•å™¨å°±æ˜¯å…¨åŠ å™¨çš„åŸºç¡€ä¸Šæœ‰å‡ ä¸ªä¸œè¥¿è¦å–åï¼Œåªè¦æŠŠä¸€ä¸ªå¼€å…³å’Œè¿™äº›ä¸œè¥¿å¼‚æˆ–åœ¨ä¸€èµ·å°±å¯ä»¥æ§åˆ¶æ˜¯å¦å–åäº†ã€‚åŸç æ˜¯åœ¨è¡¥ç çš„åŸºç¡€ä¸Šè¿›è¡Œè½¬æ¢ï¼Œç”¨å¼€å…³æ§åˆ¶ä¼šç¨å¾®éº»çƒ¦ä¸€äº›ï¼Œä½†å¦‚æœæ˜¯ç”¨ä¸¤ä¸ªæ•°ç ç®¡åˆ†åˆ«æ˜¾ç¤ºè¡¥ç å’ŒåŸç å°±éå¸¸å®¹æ˜“ã€‚
-   æ–‡æ¡£ä¸Šç»™çš„è¡¥ç è½¬åŸç ä¸çŸ¥é“ä¸ºä»€ä¹ˆç”¨äº†äº”ä¸ªé—¨ï¼Œå®é™…ä¸Šåªè¦ $F_2' = \\overline{\\overline{C_2 F_1}} \\oplus F_2$ å°±å¥½äº†ã€‚ï¼ˆä¸€å¼€å§‹æˆ‘è¿˜å¯¹ç€å¡è¯ºå›¾å‘å‘†ï¼Œåæ¥çœ‹äº†ä¸€çœ¼çœŸå€¼è¡¨ï¼Œå‘ç°è¿™ä¸ªä¸œè¥¿ç”¨äººç±»æ™ºæ…§ä¸€ä¸‹å°±åŒ–ç®€å‡ºæ¥äº†ã€‚ï¼‰æœ€åä¸‰åˆä¸€çš„ç”µè·¯æˆ‘åªç”¨äº† 8 ä¸ªä¸éé—¨å’Œ 9 ä¸ªå¼‚æˆ–é—¨ï¼Œå°±ä¸éœ€è¦ç”¨ 16 pin çš„æ¨¡å—äº†ã€‚
-   å¦‚æœæ˜¯åˆ†æ­¥éª¤ï¼ˆæ¨¡å—ï¼‰æ¥çº¿ï¼ˆæ¯”å¦‚å…ˆæ¥å…¨åŠ å™¨ï¼Œå†æ”¹æˆå‡æ³•å™¨ï¼‰ï¼Œè¿‡ç¨‹ä¸­éœ€è¦æ”¹çº¿ï¼Œåœ¨ä¸¤æ ¹çº¿å åœ¨ä¸€èµ·æ—¶ï¼Œæœ€å¥½æ˜¯æŠŠâ€œæ¨¡å—å†…éƒ¨â€çš„çº¿æ”¾åœ¨ä¸‹é¢ï¼Œå’Œâ€œå¤–éƒ¨â€è¿æ¥çš„çº¿æ”¾åœ¨ä¸Šé¢ï¼Œè¿™æ ·çš„è¯ä¿®æ”¹å’Œå¤–éƒ¨çš„è¿æ¥æ—¶ä¸ç”¨æŠŠä¸¤æ ¹çº¿ä¸€èµ·æ‹”æ‰ã€‚
-   æŠŠæ¥å¥½çš„çº¿å¸¦åˆ°å®éªŒå®¤æ˜¯æœ‰ä¸€å®šéš¾åº¦çš„ï¼Œå¯ä»¥å…ˆåªæ¥ 6 ä¸ªæ¨¡å—ï¼Œå°±èƒ½æ”¾è¿›å®éªŒç®±äº†ï¼Œè¯¾ä¸Šæ¥å‰©ä¸‹çš„ä¸¤ä¸ªæ¨¡å—ã€‚æ¥ä¸Šçº¿ä¹‹åä½“ç§¯ä¼šå˜å¤§ï¼Œå¯ä»¥æŠŠç”¨ä¸åˆ°çš„æ¨¡å—ç•™åœ¨å¯å®¤ã€‚ï¼ˆè¿™èŠ‚è¯¾ä¸Šè¿˜å‘äº† FPGA æ¨¡å—ï¼Œä¸ºäº†èƒ½è£…ä¸‹ï¼Œå¤§å®¶éƒ½ä¸Šäº¤äº†ä¸€äº›å¤šä½™çš„æ¨¡å—ï¼Œæˆ‘è£…å¾—ä¸‹è€Œä¸”æœ¬æ¥å°±æ˜¯æŠŠå¤šä½™çš„æ”¾åœ¨å¯å®¤äº†ï¼Œå°±æ²¡ä¸Šäº¤ï¼›ä½†æ˜¯è¿™æ ·ä¸€æ¥æˆ‘å°±é•¿æœŸæœ‰å‡ ä¸ªæ¨¡å—æ”¾ä¸è¿›å®éªŒç®±äº† ğŸŒšï¼‰

~~å¦‚æœä½ ä¸çŸ¥é“æ€ä¹ˆæ¥çº¿çš„è¯å¯ä»¥å°è¯•å¯¹ç€ä¸‹é¢è¿™å¼ å›¾å¤åˆ»~~

![ç”µè·¯è¿æ¥å®ç‰©å›¾](adder-circuit.jpg)

åæ¥çœ‹åˆ°æœ‰åŒå­¦ä¸Šé¢çš„çº¿ç»Ÿä¸€æœä¸Šï¼Œä¸‹é¢çš„çº¿ç»Ÿä¸€æœä¸‹ï¼Œå°±æ•´é½ä¸€äº›ã€‚

æœ€åæ”¶æ‹¾ä¸œè¥¿çš„æ—¶å€™åˆ†ä¸‰æ¬¡å‘ç°åœ°ä¸Šæ‰äº† 5 æ ¹çº¿ï¼Œé™¤æ­¤ä¹‹å¤–å‰åä¸¤æ’ä¹Ÿèƒ½çœ‹åˆ°å¥½å¤šæ ¹çº¿ï¼Œä¸çŸ¥é“å“ªäº›æ˜¯æˆ‘çš„ï¼Œå“ªäº›æ˜¯éš”å£çš„ï¼Œå“ªäº›æ˜¯ä¸Šåˆçš„ï¼ˆ

è¿˜å¬åˆ°åŠ©æ•™åæ§½åŒå­¦ï¼Œç„¶åè€å¸ˆè¯´ï¼Œè¿™éƒ½æ˜¯æ­£å¸¸çš„ï¼Œç°åœ¨æˆ‘ä»¬å»æå¤§æ¨¡å‹å°±å¯ä»¥äº†ï¼Œä¸ç”¨åœ¨æ„æ•°ç”µï¼ˆ

### ç‚¹äº®æ•°ç ç®¡å®éªŒ

æœ¬æ¥æƒ³åœ¨å¯å®¤æå®Œç›´æ¥å»éªŒæ”¶ï¼Œç»“æœå»ææ™ºèƒ½ä½“äº†ï¼ˆ

ç°åœºæ‰å¼€å§‹åšï¼Œä¸€ç›´è¿ä¸ä¸ŠèŠ¯ç‰‡ï¼Œè¿˜ä»¥ä¸ºæ˜¯å› ä¸ºæˆ‘ç”¨çš„ Arch æ‰€ä»¥é©±åŠ¨æœ‰ä»€ä¹ˆç¥ç§˜é—®é¢˜ï¼Œåˆ°å¤„æŸ¥äº†åŠå¤©ï¼Œæœ€åé—®è€å¸ˆæ‰çŸ¥é“æ˜¯æˆ‘ USB Type C çš„çº¿æ²¡æ’ç´§ï¼Œç»·ä¸ä½äº†ã€‚å®ƒè¿™ä¸ªæ¥å£æ¯”ä¸€èˆ¬çš„æ‰‹æœºå……ç”µçº¿è¦ç´§ä¸€äº›ï¼ˆæ’ä¸Šä¸€æ¬¡ä¹‹åå¤ç°ä¸å‡ºæ¥äº†ï¼Œä½†åœ¨æˆ‘å°è±¡ä¸­æ’ä¸Šç¬¬ä¸€æ¬¡ä¹‹å‰ä¸æ˜¯ç´§ä¸€ç‚¹è€Œæ˜¯ç´§ ~~super å¤š~~ï¼‰ï¼Œæ’è¿›å»ä¸€åŠç¯å°±äº®äº†ï¼Œæ‰€ä»¥æˆ‘è¿˜ä»¥ä¸ºæ¥å¥½äº†ã€‚åæ¥æƒ³èµ·æ¥æ•°è®¾è¯¾ä¸Šè¿˜æåˆ°è¿‡ï¼ŒUSB ä¸ºäº†æ”¯æŒçƒ­æ’æ‹”ï¼Œç”µæºæ¥å£æ¯”æ•°æ®æ¥å£ç•¥é•¿ä¸€äº›ï¼Œæˆ‘çœ‹åˆ°çš„ç¯å¤§æ¦‚æ˜¯ç”µæºçº¿è¿ä¸Šäº†çš„ç¯ï¼Œè€Œæ•°æ®çº¿è¿˜æ²¡è¿ä¸Šã€‚

æœ€åé€Ÿé€šå½»åº•å¤±è´¥äº†ï¼Œè¿˜æ˜¯ç¬¬ä¸€æ¬¡åšåˆ°åªå‰©å‡ ä¸ªäººäº†æ‰èµ°ã€‚

### å››ä½å…¨åŠ å™¨å®éªŒ

è¿™æ¬¡çœŸçš„åœ¨å¯å®¤ 1.5h æå®Œç›´æ¥å»éªŒæ”¶ï¼ŒæˆåŠŸåœ¨ä¸Šè¯¾ä¹‹å‰éªŒæ”¶å®Œäº†ï¼Œä½†è¿˜æ˜¯å¾—å¬å®Œè¯¾æ‰èƒ½èµ°ï¼ˆ

äºæ˜¯å¹²è„†å†™å®Œäº†å®éªŒæŠ¥å‘Šæ‰èµ°ï¼Œå®é™…ä¸Šåªæ˜¯æŠŠä»£ç å¤åˆ¶å‡ºæ¥ï¼Œå†æˆªå‡ å¼ å›¾ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆæ²¡èƒ½åœ¨è®²å®Œè¯¾ä¹‹å‰å†™å®Œï¼ˆ

### è®¡æ•°å™¨å®éªŒ

è¿™æ¬¡æœ‰å¥½å‡ ä¸ªäººè¯¾å‰æŸ¥ï¼ŒåŠ©æ•™è¡¨ç¤ºæˆ‘ä»¬å¤ªæ€¥äº†ï¼ˆ

ä¹‹å‰æ„Ÿè§‰ DDPP ç¬¬äº”ç« å­¦äº†å‡ å¹´éƒ½æ²¡å­¦å®Œï¼ˆï¼Œä½†æœ‰ç‚¹åƒå½“æ—¶ CS:APP ç¬¬ä¸‰ç« ï¼Œå­¦ä¸€å‘¨èƒ½é¡¶ä¸Šè¯¾è®²å¥½å‡ å‘¨ï¼ˆ

### ä¸²è¡Œå¯†ç é”å®éªŒ

æ„Ÿè§‰ undefined behavior éå¸¸å¤šï¼Œè€Œä¸”ä½œä¸ºä¸€ä¸ªå¯†ç é”ç«Ÿç„¶èƒ½åœ¨æ²¡å¼€é”æ—¶æ”¹å¯†ç ï¼Œéå¸¸ç¥ç§˜ï¼Œä½†å®ƒæ¯•ç«Ÿåªæ˜¯ä¸ªå°å®éªŒè€Œä¸æ˜¯æ•°è®¾ï¼ˆ

ä¸Šè¯¾å‰åŒå­¦èŠåˆ°äº†æ¸¸æ³³è¯¾ï¼Œè€å¸ˆä¸€è¿›æ¥å¬åˆ°äº†ï¼Œè¯´å½“å¹´ä»–æœ‰ä¸ªåŒå­¦å› ä¸ºæ¸¸æ³³æ²¡è¿‡æ²¡èƒ½ä¿ç ”ï¼Œä½†æ˜¯ç°åœ¨å¼€å…¬å¸ï¼Œè¿‡å¾—æ¯”ä»–çˆ½ï¼Œç»·ä¸ä½äº†ï¼ˆ

å¬è¯´åŠ©æ•™å› ä¸ºæ˜¨æ™šç­”ç–‘åˆ°å¤ªæ™šï¼Œä»Šå¤©æ²¡åƒæ—©é¥­ï¼Œæ—©å…«è¿˜ä¸€ç›´æåˆ° 11:30ï¼Œè¿˜è›®æƒ¨çš„ã€‚ä¸‹åˆåŠ©æ•™æ˜¯å‡†ç‚¹åˆ°çš„æ•™å®¤ï¼Œäºæ˜¯æ²¡èƒ½åœ¨è¯¾å‰æŸ¥å®Œï¼Œä½†å…¶å®ä¸€è®²å®Œè¯¾å°±æŸ¥ä¹Ÿæ²¡å·®å¤ªå¤šã€‚

è€å¸ˆï¼šä½ ä»¬æ˜¯ä¸æ˜¯è§‰å¾—æé«˜è¦æ±‚å°±æ˜¯å¿…åšçš„ï¼Ÿæ˜å¹´å¹²è„†æŠŠæé«˜è¦æ±‚å–æ¶ˆäº†ï¼Œè§£å†³ä¸äº†é—®é¢˜å¯ä»¥è®©é—®é¢˜æ¶ˆå¤±ï¼ˆ

### ~~è€³æœºçº¿æ”¶çº³æµ‹éªŒ~~

40min é€Ÿé€šäº†è€ƒè¯•ï¼Œä½†è€ƒå®Œä¸Šäº¤å®éªŒç®±ï¼Œæ”¶æ‹¾äº†åŠå°æ—¶å¯¼çº¿ï¼Œæˆäº†æœ€åå‡ ä¸ªèµ°çš„ï¼ˆ

~~çœŸä¸æ‡‚çº¿ä¸ºå•¥è¦æ†èµ·æ¥ï¼Œç™½è´¹åŠ›æ°”ï¼Œåˆ°æ—¶å€™æŠ½å‡ºæ¥ä¹Ÿéº»çƒ¦ï¼ˆ~~

## æ•°è®¾

### æ•°è®¾ç¬¬äºŒæ¬¡è¯¾

è¿™èŠ‚è¯¾è®²äº†ä¸€å †æ•°ç”µèƒŒåçš„æ¨¡ç”µåŸç†ï¼Œè€Œä¸”è¿˜æ˜¯ TTL ç”µè·¯ï¼Œä¸æ˜¯ DDPP5 æ”¾åœ¨ç¬¬ 14 ç« çš„ CMOSã€‚æ„Ÿè§‰å®Œå…¨æ²¡å¬æ‡‚ï¼Œåªä¸è¿‡è¯´åˆ°åº•è¿™ä¸€èŠ‚æ˜¯ç‰©ç†è¯¾ä¸æ˜¯è®¡ç®—æœºè¯¾ï¼ˆï¼Œåé¢åˆè¯´è®²çš„å¤§éƒ¨åˆ†ä¸œè¥¿ä¸è€ƒï¼Œè®²è¿™äº›æ˜¯ä¸ºäº†è¡¥å……ä¸€äº›æ•°å­—ç”µè·¯å‘å±•çš„å†å²ï¼Œå¼¥è¡¥æ€ç»´ä¸Šçš„è·³è·ƒã€‚

æˆ‘æ˜¯å®Œå…¨æ²¡å¬æ‡‚ï¼Œå…¶ä»–åŒå­¦å¤§æ¦‚ä¹Ÿæ˜¯æ²¡å®Œå…¨å¬æ‡‚ã€‚è€å¸ˆåæ§½è¯´ï¼Œç°åœ¨æˆ‘ä»¬åŸ¹å…»æ–¹æ¡ˆé‡Œç”µè·¯çŸ¥è¯†å‡ ä¹ä¸ºé›¶ï¼Œæ•°è®¾è¦ä»å¤´å¼€å§‹è®²ï¼Œä¸åƒä»–ä»¬é‚£æ—¶å€™ï¼Œæœ¬ç§‘ä¸Šäº”å¹´ï¼Œä»€ä¹ˆç‰©ç†éƒ½å­¦äº†ã€‚æœ¬æ¥æˆ‘è¿˜åœ¨æƒ³ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬åªèƒ½ä¸Šå››å¹´ç”šè‡³ä¸‰å¹´ï¼Œè¦å­¦è¿™ä¹ˆå¤šä¸œè¥¿ï¼Œç»“æœè€å¸ˆè¯´ä»–äº”å¹´ä¿®äº†åŒå­¦ä½ 600+ å­¦åˆ†ï¼Œè€Œä¸”å­¦åˆ†æ˜¯å’Œç°åœ¨ä¸€æ ·çš„å­¦æ—¶ï¼Œéœ‡æ’¼å…¨ç­ã€‚

### æ•°è®¾ä¸æ•°ç”µ

åœ¨è½¯å·¥è¯¾ä¸Šè¢«æ•°ç”µåŒå­¦é—®äº†ä½œä¸šï¼Œå…ˆæ˜¯è¢«é—®äº†æ²¡å­¦æ¸…æ¥šçš„ï¼Œåé¢åˆè¢«é—®äº†æ•°è®¾æ²¡è®²çš„å†…å®¹ã€‚æ²¡æƒ³åˆ°è¿™ä¹ˆæ—©å°±ä½“éªŒåˆ°äº†è¢«æ•°ç”µåŒå­¦é—®æ‡µï¼ˆ

### å…³äº DDPP

å…¶å®æˆ‘å¼€å­¦åæœ‰çœ‹ä¸€ç‚¹ DDPPï¼Œæ„Ÿè§‰è¿˜æ˜¯æ¯”ä¸Šè¯¾è®²çš„ç§‘å­¦è®¸å¤šï¼ˆ~~æ¯”å¦‚è¯´ä¸Šè¯¾çš„æ—¶å€™å»å†™è½¯å·¥äº†ï¼Œè¯¾åçœ‹ä¸€ä¸‹ DDPP ä¼šæ„Ÿè§‰æ¯”ä¸Šè¯¾è®²çš„æ˜“æ‡‚å¾ˆå¤šï¼Œæ¯”ä¸­æ–‡æ•™ææ˜“æ‡‚ [super å¤š](https://mp.weixin.qq.com/s/8qZ2bEIVyUGQYmNt6kCicg)~~ï¼‰ï¼Œä½†æ²¡æœ‰ä»å¤´åˆ°å°¾çœ‹å…¨ï¼Œä¹Ÿæ²¡å†™ç¬”è®°ã€‚ä¸€æ–¹é¢æ˜¯æ—¶é—´éƒ½è¢«è½¯å·¥å äº†ï¼ˆï¼Œè¿˜æœ‰å°±æ˜¯ DDPP å’Œä¸Šè¯¾è®²çš„å†…å®¹å¤šå°‘æœ‰ä¸€äº›å·®å¼‚ï¼Œè¦æ˜¯å­¦å¤šäº†æ„Ÿè§‰ä¼šææ··ï¼ˆ

### è€ƒå‰

ã€Šæˆ‘æ€•ä½ ä»¬éƒ½è€ƒ 100 åˆ†å­¦æ ¡æ‰¾æˆ‘éº»çƒ¦ã€‹

ã€Šå®éªŒåšçš„æœ€å¥½çš„ä¸¤ä¸ªç»„ç›´æ¥ A+ï¼Œå°±ç®—è€ƒè¯•äº¤ç™½å·éƒ½è¿˜æœ‰æ‹¿ A+ çš„æœºä¼šã€‹

ã€Šä¸è¦ 15min å°±åšå®Œäº†ã€‹

### è€ƒè¯•

éš¾åº¦è¿˜å¥½ï¼Œæœ‰ä¸€é¢˜çš„é¢˜æ„ç†è§£æœ‰ç‚¹ç¥ç§˜ï¼Œä½†è€å¸ˆè¯´åªè¦èƒ½è¯´å¾—é€šéƒ½ç®—å¯¹ ğŸ¤” è€ƒå®Œå¤§å®¶éƒ½åœ¨åæ§½ä¸€ä¸ªè€ƒè¯¾ä»¶ç»†èŠ‚çš„å¡«ç©ºé¢˜ï¼ˆåˆ†ä¸å¤šï¼‰ï¼Œå¹¸å¥½æˆ‘æ˜¯ä¸Šåˆåˆšçœ‹çš„è¯¾ä»¶ï¼Œè¦æ˜¯å‰ä¸€å¤©çœ‹çš„ä¼°è®¡å°±ä¸ä¼šåšäº†ï¼ˆ

### ç¬¬ä¸€æ¬¡å®éªŒè¯¾

è¿™æ¬¡åˆåœ¨è¿ä¸Šæ¿å­è¿™ä¸€æ­¥å‡ºäº†é—®é¢˜ï¼Œåˆæ˜¯çº¿çš„é—®é¢˜ï¼Œä½†å¹¸å¥½ä¸æ˜¯æ²¡æ’å¥½ï¼Œè€Œæ˜¯çº¿çœŸçš„åäº†ï¼ˆ

æˆåŠŸæŠŠ VGA æ˜¾ç¤ºçš„æ ·ä¾‹è·‘èµ·æ¥ä¹‹åå°±å¼€å§‹å•¥éƒ½ä¸æ‡‚ä½†æ˜¯é­”æ”¹å‚æ•°ï¼Œå¾ˆéš¾ä¸æƒ³èµ·å°å­¦ç¬¬ä¸€æ¬¡å»ä¸Šæœºå™¨äººè¯¾çš„æ—¶å€™ä¹Ÿæ˜¯è¿™æ ·ï¼ˆ

ä¸èƒ½æŠŠæ¿å­å¸¦å›å¯å®¤ï¼Œè¦åœ¨æ¿å­ä¸Šè°ƒéƒ½å¾—è·‘æ¥ä¸œä¸»æ¥¼ï¼Œç¨å¾®æœ‰ç‚¹éš¾é¡¶ï¼ˆ

ã€Šä¸è¦åœ¨å®éªŒå®¤è¿‡å¤œã€‹ï¼Œç»·ä¸ä½äº†ï¼ˆ

### æŠ˜è…¾å¤–è®¾

backgroundï¼šæˆ‘ä»¬ç»„æƒ³åšçš„æ˜¯è…¿éƒ¨åŠ¨ä½œæ§åˆ¶ï¼ˆç±»ä¼¼å¥èº«ç¯ï¼‰çš„ Chrome å°æé¾™ã€‚

å¤–è®¾å¤ªéš¾äº†ï¼Œä¸‹æ¬¡è®©æˆ‘é€‰ä¸€å®šåªç”¨é”®ç›˜ï¼ˆ

ä¸€å¼€å§‹å…ˆæ˜¯æ’é’ˆæ²¡ç„Šæ¥ï¼Œæ¥è§¦éå¸¸ä¸è‰¯ï¼ˆå‡ ä¹æ²¡æœ‰ï¼‰ï¼Œç­‰åˆ°äº”ä¸€ç»“æŸè€å¸ˆå›å­¦æ ¡äº†æ‰ç„Šã€‚è€å¸ˆå¸®å¿™ç„Šäº†ä¸€ä¸ªï¼Œè®©æˆ‘è‡ªå·±ç„Šäº†å‰©ä¸‹ä¸¤ä¸ªï¼Œç»“æœç„Šäº†ä¸‰å› ~~å•Šä¸‰å›~~ æ‰ç„Šå¥½ã€‚yysy è¦æ˜¯èƒ½æœ‰ä¸€äº›ç”µå­åƒåœ¾ç”¨æ¥ç»ƒæ‰‹çš„è¯ï¼Œè¿˜æŒºç®€å•çš„ï¼Œä½†ç›´æ¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šç»ƒä¹ å®åœ¨æ˜¯æœ‰ç‚¹å¯æ€•ï¼ˆ

ç„¶åæ˜¯ USB è½¬ TTL æ¨¡å—å¿˜æ¥åœ°äº†ï¼Œæ¯•ç«Ÿå®ƒä¸ç”¨è¿ç”µæºï¼Œäºæ˜¯å°±å¿˜äº†ï¼ˆ

æœ€åæ˜¯çº½æ‰£ç”µæ± ç”µæµå¤ªå°ï¼Œå¸¦ä¸åŠ¨ä¼ æ„Ÿå™¨å’Œæ— çº¿æ¨¡å—ï¼Œè¿˜æ˜¯åªèƒ½æ¢æˆå……ç”µå®ä¾›ç”µï¼Œçº½æ‰£ç”µæ± ã€ç”µæ± ç›’ã€ç¨³å‹æ¨¡å—é€šé€šç™½ä¹°äº†ï¼ˆ

è¯´èµ·æ¥è¿˜æŒºç®€å•çš„ï¼Œä½†è¦å‘ç°é—®é¢˜åœ¨å“ªçœŸçš„å¥½éš¾ï¼Œä¸€ä¼šå„¿æ€€ç–‘æ¨¡å—çƒ§äº†ï¼Œä¸€ä¼šå„¿æ€€ç–‘æ˜¯é¢åŒ…æ¿ä¸è¡Œï¼Œä¸€ä¼šå„¿æ€€ç–‘æ˜¯çº¿ä¸è¡Œï¼Œå‘ç°æ˜¯å¸¦ä¸åŠ¨äº†è¿˜ä»¥ä¸ºæ˜¯ç”µå‹æ²¡åˆ° 3.2Vï¼Œè¿˜å¾—æŸ¥å„ä¸ªæ¨¡å—çš„è§„æ ¼ï¼Œä»¥åŠæƒ³åˆ°å»æŸ¥çº½æ‰£ç”µæ± çš„è§„æ ¼ã€‚

æœ€åç»ˆäºè°ƒé€šäº†ï¼Œè¯•ç€ç»‘åœ¨è…¿ä¸Šè·‘è·‘è·³è·³ï¼Œçœ‹ç€å‡Œä¹±çš„æ•°æ®å›¾ï¼Œè¿˜æ˜¯å†³å®šæ”¾å¼ƒè·‘åŠ¨çš„æ£€æµ‹ä»¥åŠè·³è·ƒé«˜åº¦çš„è®¡ç®—ï¼Œåªä¿ç•™å›ºå®šé«˜åº¦çš„è·³ä»¥åŠä¸‹è¹²ï¼Œæœ‰æ—¶é—´å†è¯´ï¼ˆ

è¿åˆ°æ¿å­ä¸Šæ—¶è¿˜é‡åˆ°ä¸€ä¸ªç¥ç§˜çš„å‘ï¼ŒPmod æ¥å£æœ‰ç¼–å·ä¸º 1~12 çš„æ¥å£ï¼Œå…¶ä¸­ 5ã€6ã€11ã€12 æ˜¯ç”µæºå’Œåœ°ï¼Œ1ã€2ã€3ã€4ã€7ã€8ã€9ã€10 åˆ†åˆ«æ˜¯ IO0\\~IO7ï¼Œç»“æœæˆ‘ä»¥ä¸º 1 æ˜¯ IO1ï¼Œè°ƒäº†åŠå¤©ï¼Œç»·ä¸ä½äº†ï¼ˆ

æ¥å¼ å›¾ï¼šï¼ˆ~~ç”µæºçš„å››æ ¹çº¿çš„é¢œè‰²è¯·ä¸è¦åœ¨æ„~~ï¼‰

![å¤–è®¾æ•ˆæœå›¾](dino-peripheral.jpg)

è¿™ä¸ªè¿æ¥å°±éå¸¸ä¸ç¨³å®šï¼Œè·³å‡ ä¸‹å°±ä¼šæ¾ï¼Œ~~æŠšæ‘¸~~ ä¸€ä¸‹è¿™äº›çº¿å°±åˆå¥½äº†ï¼Œè¿‡æ®µæ—¶é—´è¿˜å¾—æŒ‰ä¸€ä¸‹å……ç”µå®å¼€å…³ï¼Œä¹‹åå†çœ‹æ€ä¹ˆè§£å†³ã€‚

UPDï¼š~~æ¯æ¬¡éƒ½è¦æŠšæ‘¸å®åœ¨æ˜¯å¤ªä¸ä¹–äº†ï¼Œç»™å®ƒæ†ç»‘äº†ä¸€ä¸‹å°±è€å®å¤šäº†ï¼ˆï¼ˆ~~ <span class="heimu">è™½ç„¶è¿™ä¹ˆå¼€ç©ç¬‘ï¼Œæˆ‘å…¶å®æŒºè®¨åŒæ†ç»‘çš„ï¼Œå“ªæ€•æ˜¯äºŒæ¬¡å…ƒæ†ç»‘å›¾ä¹Ÿç”Ÿç†ä¸Šå°±æ„Ÿåˆ°åŒæ¶ï¼Œ~~è¿™æ˜¯å¯ä»¥è¯´çš„å—~~</span>

![å¤–è®¾ç»‘èƒ¶å¸¦](dino-peripheral-with-tape.jpg)

UPD2ï¼šåˆšç»‘ä¸Šçš„æ—¶å€™è¿˜æŒºå¥½çš„ï¼Œè¿‡äº†å‡ å¤©åˆå¯„äº†ã€‚

UPD3ï¼šæœ€åè¿˜æ˜¯ç„Šä¸Šäº†ï¼Œæ°¸è¿œä¸è¦ç›¸ä¿¡æ²¡æœ‰ç„Šä¸Šçš„è¿çº¿ï¼ˆ

### è°ƒæ•™ VGA

æ—¶åºå¥½éš¾è°ƒï¼ˆ

Quartus æŠ¥çš„æ—¶åºé”™è¯¯ä¸è¦æ— è§†ã€‚

æ—¶é’Ÿé¢‘ç‡å¤ªé«˜å®¹æ˜“å¯„ï¼Œå¯ä»¥è°ƒä½ç‚¹ã€‚

ä¿¡å·è·¨åŸŸè¦å¤„ç†å¥½ã€‚

å¦‚æœä¿¡å·åäº†ä¸¤ä¸‰ä¸ªå‘¨æœŸï¼Œä¸ç”¨ç®¡å®ƒä¸ºä»€ä¹ˆä¼šåï¼ŒæŠŠå®ƒåå›æ¥å°±è¡Œï¼ˆ

å°½é‡ä¸è¦ç”¨ç»„åˆé€»è¾‘è¾“å‡ºï¼Œå¯ä»¥åŠ ä¸ª bufferã€‚

### å±•ç¤º

æœ€åä¸€å¤©æ”¹ slide çš„æ—¶å€™ä¸€å¤§åŠçš„æ—¶é—´èŠ±åœ¨äº† p è¿™ä¸ªå›¾æ ‡ï¼Œå¥½æƒ³ç”¨ StyleDropï¼ˆ

ï¼ˆè¿™æ˜¯ä¸ª \`<iframe>\`ï¼Œå¯ä»¥ç¿»é¡µï¼‰

<iframe class="w-full aspect-video" style="color-scheme: light;" src="/static/digital-design/index.html" />

### è§†é¢‘

https://www.bilibili.com/video/av230053693
`},{title:M,tags:"Web å­¦ä¹ è®°å½•",content:`å¾ˆå¥½ï¼Œä½ å·²ç»å­¦ä¼šäº† Vueã€Rustã€Actixã€GitHub Actionsã€pnpmã€Vitestã€Caddy

ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ Reactã€Pythonã€Djangoã€GitLab CIã€yarnã€Jestã€Nginx æ¥å®Œæˆè½¯å·¥ä½œä¸šäº†ï¼ˆ



![æŠ€æœ¯æ ˆäº¤é›†ä¸ºç©ºçš„ meme](tech-stack.jpg)

ï¼ˆå…¶å®è¿™é‡Œé¢æ¯”è¾ƒæœ‰é—®é¢˜çš„å°±åªæœ‰ Reactï¼Œå…¶ä»–éƒ½è¿˜å¥½ï¼Œ~~åªæ˜¯æ•°é‡å¤šå‡‘ä¸€ç‚¹ meme æ•ˆæœæ›´å¥½~~ï¼‰

## å°ä½œä¸š

### Django åç«¯å°ä½œä¸š

æ¯ä¸€å¤„éœ€è¦ä¿®æ”¹çš„ä»£ç éƒ½åˆ—å‡ºæ¥äº†ï¼Œè¿˜æœ‰è¯¦ç»†çš„æ³¨é‡Šå‘Šè¯‰ä½ è¦å¹²ä»€ä¹ˆã€‚Django å®Œå…¨æ²¡å­¦ï¼Œå°±æ ¹æ®æç¤ºæŸ¥äº†ä¸€å¤„æ–‡æ¡£ï¼Œä»£ç çš„æ•´ä½“é€»è¾‘ä¹Ÿæ²¡ææ¸…æ¥šã€‚

æ„Ÿè§‰å†™å®Œä¹‹åç†è§£äº† ChatGPTï¼Œçœ‹ç€æ³¨é‡Šå’Œç¤ºä¾‹è¡¥å…¨ä»£ç æ ¹æœ¬å°±ä¸éœ€è¦å­¦ä¼šå¦‚ä½•å†™ä»£ç å˜›ï¼ˆ

### å­¦ React

å°ä½œä¸šåº”è¯¥ä¸éœ€è¦æ€ä¹ˆå­¦ Reactï¼Œä½†è¿˜æ˜¯æŠŠ [Learn React (Beta)](https://beta.reactjs.org/learn) å®Œæ•´è¿‡äº†ä¸€éã€‚

ä¹‹å‰éƒ½åœ¨ Twitter ä¸Šäº‘ Reactï¼Œå­¦äº†ä¹‹åç»ˆäºæœ‰å–œæ¬¢ Vue çš„è‡ªä¿¡äº†ï¼ˆ~~æ‰€ä»¥è¯´ X è‡ªä¿¡å°±æ˜¯è¦å…è®¸ Y æ‰èƒ½æœ‰ï¼Œä»¥ X è‡ªä¿¡ä¸ºåæ‰“å‹ Y åˆ°åº•æ˜¯ä»€ä¹ˆæ“ä½œ~~

<Card title="Vue ç”¨æˆ·åˆå­¦ React æ„Ÿåˆ°ä¸é€‚çš„ä¸€äº›ç‚¹" fold>

-   æˆ‘å¸Œæœ› HTML æ”¾åœ¨ç»Ÿä¸€ã€ç‹¬ç«‹çš„ä½ç½®ï¼Œä¸åˆ†æ•£åœ¨å¤šå¤„ï¼Œä¸å’Œ JS ä»£ç åœ¨ç»“æ„ä¸Šæ··åœ¨ä¸€èµ·ã€‚
-   \`v-if\` è¦ç”¨ if-else / \`?:\` / \`&&\` å®ç°ï¼šæˆ‘ä¸å¸Œæœ›åœ¨ JSX å¤–éƒ¨å†™ if-elseï¼›è¡¨è¾¾å¼çš„æ‹¬å·å¯èƒ½å¼•å…¥é¢å¤–çš„ç¼©è¿›ï¼›\`?:\` å®ç°å¤šçº§ else if å¯èƒ½çœ‹ä¸æ¸…ï¼›ä¿®æ”¹ä»£ç æ—¶ä¸åƒ \`v-if\` åªéœ€è¦æ·»åŠ ä¸€è¡Œä¸å½±å“å…¶ä»–è¡Œã€‚æ€»ä¹‹å°±æ˜¯æ„Ÿè§‰å¾ˆä¸‘ï¼ˆ
-   \`v-for\` è¦è‡ªå·±ä½¿ç”¨ JS è®¡ç®—å¾—åˆ°ã€‚
-   ä¸æ”¯æŒ named slotï¼ˆå¯ä»¥ç”¨ prop æ›¿ä»£ä½†æ„Ÿè§‰ä¸æ˜¯å¾ˆä¼˜é›…ï¼‰ã€‚
-   event handler ä¸èƒ½ \`count += 1\` å¿…é¡» \`() => count += 1\`ã€‚
-   è™½ç„¶åªæ˜¯ä¸ªè¯­æ³•ç³–ï¼Œä½†ä¼¼ä¹æ²¡æœ‰ \`v-model\` ç­‰ä»·ç‰©ã€‚
-   æ²¡æœ‰ event modifier (\`@click.stop\`)ï¼Œéœ€è¦æ‰‹åŠ¨ \`e.stopPropagation()\`ã€‚
-   éœ€è¦ç”¨ setter function æ¥ä¿®æ”¹ stateï¼Œ\`useState\` è¿”å›ä¸¤ä¸ªå˜é‡ã€‚
-   state æ˜¯ snapshotï¼Œåç›´è§‰ã€‚æ•™ç¨‹é‡Œè¯´è¿™æ ·å¯ä»¥é¿å…ä¸€äº› timing mistakeï¼Œä½†æˆ‘æ„Ÿè§‰åœ¨ Vue é‡Œä¸€èˆ¬åªè¦ä¼ å€¼è€Œä¸æ˜¯ ref å°±è¡Œï¼Ÿç¡®å®æœ‰ä¸€å®šæ„ä¹‰ä½†æˆ‘è¿˜æ˜¯æ›´å¸Œæœ›ç¬¦åˆç›´è§‰ã€‚
-   ä¿®æ”¹ object / array state å¾ˆéº»çƒ¦ï¼Œä½¿ç”¨ Immer çš„è¯ä¼¼ä¹å°±å’Œ Vue å·®ä¸å¤šäº†ã€‚
-   state ç»‘å®šåœ¨æ ‘çš„æ¯ä¸ªä½ç½®ä¸Šï¼Œè€Œéå­˜åœ¨ component é‡Œã€‚
-   \`useMemo\` éœ€è¦æ‰‹åŠ¨æŒ‡å®šä¾èµ–ï¼Œ\`computed\` ä¸éœ€è¦ã€‚

æœ¬æ¥æƒ³æŠŠ \`useEffect\` ä¹Ÿåˆ—å‡ºæ¥ï¼Œä½† React çš„ [è¿™ç§è®¾è®¡æ€è·¯](https://beta.reactjs.org/learn/lifecycle-of-reactive-effects#thinking-from-the-effects-perspective) ä¼¼ä¹ä¹Ÿæœ‰ä¸€å®šé“ç†ã€‚

ä½†å½“æˆ‘å†™å‡º \`useEffect(() => () => clearInterval(timerRef.current), [])\` çš„æ—¶å€™æˆ‘è¿˜æ˜¯ä¸æ˜ç™½äº†ï¼Œè¿™ä¹Ÿèƒ½â€œä» Effect çš„è§’åº¦æ€è€ƒâ€å—ï¼Œç»™ä¸ª \`onUnmounted\` ä¸å¥½å—ã€‚

</Card>

<Card title="é«˜æƒ…å•†ä¸ä½æƒ…å•†" fold>

æˆ‘åœ¨ç¾¤é‡Œé—®äº†ä¸ªé—®é¢˜ï¼Œç»“æœåŠ©æ•™å…¨éƒ½è·‘æ¥åŠ æˆ‘å¥½å‹ï¼Œè‰ï¼ˆ

é‚£æˆ‘ä¹Ÿä¸å®¢æ°”äº†ï¼Œä¸Šæ¥å°±é—®ä¸ºä»€ä¹ˆæ¢æˆ Reactï¼Œbkswï¼ˆ

![å’ŒåŠ©æ•™çš„æ¶ˆæ¯è®°å½•](eq.png)

~~ä¸éš¾çœ‹å‡ºï¼Œè¿™é‡Œé¢æƒ…å•†æœ€ä½çš„æ˜¯æˆ‘~~

</Card>

### React (Next.js) å‰ç«¯å°ä½œä¸š

ä¸Šæ¥å°±çœ‹åˆ° ESLint æ˜¯ 4 ç©ºæ ¼ç¼©è¿›ã€ä¼˜å…ˆåŒå¼•å·ï¼Œè¿™èƒ½å¿å—ï¼ˆã€‚ç‰¹æ„å»ç¡®è®¤äº†ä¸€ä¸‹ï¼Œé™¤äº†å‰ç«¯åŠ©æ•™å‚ä¸çš„å‡ ä¸ªé¡¹ç›®ï¼Œéšä¾¿æ‰¾ä¸€ä¸ªé¡¹ç›®éƒ½æ˜¯ 2 ç©ºæ ¼ç¼©è¿›ã€ä¼˜å…ˆå•å¼•å·ï¼ˆ

å†ä¸€å†™ä»£ç ï¼Œå‘ç°ä¸å¯¹åŠ²ï¼Œè¿™ä¸ª ESLint æœ‰å•¥ rule å•Šï¼Œæ€ä¹ˆæ€ä¹ˆå†™éƒ½æ²¡ lint errorï¼Œç»™æˆ‘æ•´ä¸ä¼šäº†ï¼ˆ

äºæ˜¯ç›´æ¥ä¸Šäº† [\`@ouuan/eslint-config-ts\`](https://github.com/ouuan/eslint-config)ï¼Œç†è®ºä¸Šæ¥è¯´æˆ‘åº”è¯¥æ•´ä¸€ä¸ªç»™ tsx ç”¨çš„ configï¼Œä½† ts çš„ config é…åˆä¸Šå°ä½œä¸šæ¨¡æ¿åŸæœ‰çš„åº”è¯¥ä¹Ÿå‡‘åˆç€èƒ½ç”¨å§ï¼ˆ

å†™å®Œåçš„æ„Ÿè§‰å’Œ Django å°ä½œä¸šå·®ä¸å¤šï¼ŒReact éƒ½ç™½å­¦äº†ï¼Œå•¥éƒ½ä¸ä¼šå°±èƒ½å†™å®Œï¼ˆ

> è¿™æ˜¯ä½ å‰ç«¯å°ä½œä¸šçš„æœ€åä¸€ä¸ª Step äº†ï¼Œå¦‚æœä½ å·²ç»å®Œæˆäº†ï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»å……åˆ†æŒæ¡äº† Next.js çš„å…¥é—¨çŸ¥è¯†ã€‚
> 
> äº‹å®ä¸Šè¿™ä»½å‰ç«¯å°ä½œä¸šå‡ ä¹å¯ä»¥ä½œä¸ºå¤§ä½œä¸šçš„èµ·å§‹æ¡†æ¶ã€‚é™¤äº† Next.js æ¡†æ¶æœ¬èº«ï¼Œå…¶åŒ…å«äº†ï¼š
>
> - ä»£ç é£æ ¼æ£€æŸ¥ä¸ä¿®æ­£æ’ä»¶ ESLintï¼Œé…ç½®æ–‡ä»¶ä¸º \`.eslintrc.json\`
> - å•å…ƒæµ‹è¯•æ¡†æ¶ Jest

ä¸æ˜¯ï¼Œä½ æ˜¯è®¤çœŸçš„å—ï¼Œå…ˆä¸è°ˆå­¦ä¼šå¤šå°‘èƒ½ç®—æ˜¯ã€Šå……åˆ†æŒæ¡äº†å…¥é—¨çŸ¥è¯†ã€‹ï¼Œè¿™ä¸ª eslintrc çœŸçš„èƒ½ç”¨å—ï¼ˆ

ç¬¬äºŒå¤©æ—©ä¸Šèµ·æ¥å†çœ‹äº†ä¸‹ä»£ç ï¼Œå‘ç°ç»„ä»¶ unmount æ—¶æ²¡æœ‰ \`clearInterval\`ï¼Œè€Œè¿™éœ€è¦åœ¨å…è®¸ï¼ˆæ¨èï¼‰çš„ä»£ç èŒƒå›´ä¹‹å¤–è¿›è¡Œä¿®æ”¹ï¼Œæ€ä¹ˆå›äº‹ï¼ˆ

ç½‘ç»œè¯·æ±‚ä¹Ÿæ˜¯ï¼Œunmount æ—¶æ²¡æœ‰ abort / ignoreï¼Œä½†è¦æ”¹çš„è¯äº¤äº’é€»è¾‘ä¹Ÿä¼šæœ‰äº›å˜åŒ–ï¼Œå°±æ‡’å¾—ä¿®äº†ï¼Œä¸€ä¸ªç®€é™‹çš„å°ä½œä¸šè€Œå·²ï¼ˆ

### CI/CD å°ä½œä¸š

[å‰ä¸€å¤©çš„ Power TUNA](https://tuna.moe/event/2023/welcome-and-ipsec/) ä¸Šè¿˜æœ‰äººé—®ä¸ºä»€ä¹ˆ TUNA æœ‰å¾ˆå¤šæµ·å¤–æµé‡ï¼Œç¬¬äºŒå¤©å°±çœ‹åˆ°äº†åœ¨ Dockerfile é‡Œç¡¬ç¼–ç  TUNAï¼ˆ

### ä¸ºå­ç›®å½•è®¾ç½® commit é‚®ç®±

ä½œä¸šç»å¸¸ä¼šéœ€è¦ï¼ˆæˆ–è€…è¯´æœ€å¥½éœ€è¦ï¼‰ä½¿ç”¨ä¸€äº›ä¸å¹³æ—¶ä¸åŒçš„ commit é‚®ç®±ï¼Œè€Œ SECoder çš„é‚®ç®±éªŒè¯ä¼¼ä¹è¿˜åäº†ï¼Œå°±æ›´éœ€è¦äº†ã€‚

ä»¥å‰ç¢°åˆ°è¿™ç§éœ€æ±‚æˆ‘éƒ½åœ¨æ¯ä¸ª repo è®¾ local git configï¼Œä½†åœ¨è½¯å·¥å¯èƒ½æœ‰å¥½å‡ ä¸ª repoï¼Œä¸ä»…éº»çƒ¦è€Œä¸”å¯èƒ½å¿˜è®°ï¼Œå°±éœ€è¦æ›´å¥½çš„è§£å†³æ–¹æ¡ˆã€‚

å…¶å®ç®€å•æœä¸€ä¸‹å°±å¾ˆå®¹æ˜“æœåˆ°ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼š

-   åœ¨ \`~/.gitconfig\` ä¸­æ·»åŠ 

    \`\`\`
    [includeIf "gitdir:~/some/path/**"]
        path = ~/some/path/.gitconfig
    \`\`\`

-   åœ¨ \`~/some/path/.gitconfig\` ä¸­æ·»åŠ 

    \`\`\`
    [user]
        email = 2021000000@secoder.net
    \`\`\`

### å°ä½œä¸šçš„ä¸€äº›é”…

deploy ä¹‹åå‘ç°ä¸€å †é”…ï¼Œå®ƒä»¬ä¸å½±å“æˆ‘çš„å°ä½œä¸šå¾—åˆ†ï¼Œåªä¼šå½±å“æˆ‘èƒ½ä¸èƒ½äº¤ä¸Šæ•°å­¦è¯¾ä½œä¸šï¼Œä½†æˆ‘è¿˜æ˜¯ä¿®äº†ï¼Œæ•°å­¦è¯¾ä½œä¸šåˆ™æ˜¯æ²¡å†™å®Œå°±äº¤äº†ï¼ˆ

è¯´åˆ°è¿™å°±å¾—æ€€å¿µç¨‹è®¾è®­ç»ƒäº†ï¼Œè¿˜æœ‰ 5 åˆ†çš„â€œè¯¾å ‚å‚ä¸â€ï¼Œé¢å¤–åŠ åœ¨ 100 åˆ†ä¹‹å¤–ï¼Œå›ç­”å‡ ä¸ªåŒå­¦çš„æé—®ã€å¼€ä¸€äº› issue å¸®å¿™ä¿®é”…å°±æ‹¿æ»¡äº†ï¼Œ~~è™½ç„¶æœ€åè¿™ 5 åˆ†å¯¹ A+ æ¯«æ— å¸®åŠ©ï¼Œè¦æ˜¯èƒ½ç§»åˆ°è½¯å·¥å°±å¥½äº†~~ã€‚

#### Next.js static HTML export æœ‰ dynamic route æ—¶æŠ¥é”™

åœ¨ Next.js 13.0.7 ä¹‹å‰ï¼Œå…·ä½“æ¥è¯´æ˜¯ [13.0.7-canary.5](https://github.com/vercel/next.js/releases/tag/v13.0.7-canary.5) ä¹‹å‰ï¼Œé€šè¿‡ \`next export\` å¾—åˆ° static HTML export åï¼Œå¦‚æœè®¿é—®ä¸€ä¸ªèƒ½åŒ¹é…ä¸Š dynamic route çš„ static routeï¼Œä¼šæŠ¥â€œApplication error: a client-side exception has occurredâ€ã€‚ä¾‹å¦‚ï¼Œæœ‰ \`pages/[id].tsx\` å’Œ \`pages/list.tsx\` æ—¶ï¼Œè®¿é—® \`/list.html\` å°±ä¼šæŠ¥é”™ã€‚

ç®€å•çœ‹äº†ä¸€ä¸‹è¿™ä¸ªç‰ˆæœ¬çš„ changelogï¼Œæœ‰å‡ ä¸ªç–‘ä¼¼å’Œè¿™ä¸ª bug ç›¸å…³çš„ï¼Œä½†æˆ‘æ²¡èƒ½ç¡®è®¤å…·ä½“æ˜¯å“ªä¸ªã€‚æœ¬æ¥æƒ³åœ¨æœ¬åœ° build Next.js æ¥è¿›ä¸€æ­¥ç¡®è®¤ï¼Œä½†æˆ‘ä¸€ build å°±æŠ¥ä¸€ä¸‡ä¸ªç±»å‹é”™è¯¯ï¼Œæäº†åŠå¤©ä¹Ÿæ²¡æå¥½ï¼Œå°±æ”¾å¼ƒäº†ã€‚åæ­£ bump ä¸€ä¸‹å°±ä¿®å¥½äº†ï¼Œ~~å¼€è¯¾å‰ä¸ºå•¥ä¸ bump ä¸€ä¸‹å•Š~~ã€‚

#### Next.js static HTML export çš„ Nginx è·¯ç”±é…ç½®

æ„Ÿè§‰ç½‘ä¸Šæœåˆ°çš„ä¸€äº› Nginx è·¯ç”±é…ç½®éƒ½å¾ˆè¿·æƒ‘ï¼š\`$uri\` æ˜¯åŒ¹é…ä¸åˆ° HTML æ–‡ä»¶çš„ï¼Œéœ€è¦ \`$uri.html\`ï¼›\`$uri/\` åˆ™å¯èƒ½åŒ¹é…åˆ°ç›®å½•ï¼Œå¯¼è‡´ 403ï¼›åŠ¨æ€è·¯ç”±å¦‚æœä¸ä¸“é—¨å†™è·¯ç”±é…ç½®çš„è¯ï¼Œå°±ä¸èƒ½ç›´æ¥è®¿é—®åˆ°æ­£ç¡®çš„ HTMLï¼Œstatic HTML export çš„ä½œç”¨å°±æ²¡æœ‰äº†ï¼Œè€Œä¸”ï¼Œfallback åˆ° \`/index.html\` å¯èƒ½å¯¼è‡´åŠ è½½ä¸€äº›ä¸éœ€è¦çš„é¡µé¢å†…å®¹å’Œ JSï¼Œå®é™…ä¸Šæ¯”ç›´æ¥ SPA æ›´åŠ£ã€‚

#### ç”¨æˆ·åæ ¼å¼æ£€æŸ¥

è¯´æ¥æƒ­æ„§ï¼Œæˆ‘ä¸€å¼€å§‹ä¹Ÿæ²¡æ„è¯†åˆ°ç”¨æˆ·åæ²¡æ ¡éªŒæ ¼å¼çš„é—®é¢˜ï¼Œè¿˜æ˜¯é…è·¯ç”±çš„æ—¶å€™æ‰æƒ³åˆ°ç”¨æˆ·åé‡Œä¼šä¸ä¼šæœ‰ slashã€‚

ç°åœ¨è¦ä¿®çš„è¯ç¡®å®éº»çƒ¦ï¼Œæ‰€ä»¥åªè¦å½’ç»“ä¸ºã€Šç”±äºå°ä½œä¸šçš„ç®€åŒ–ã€‹å°±å¥½äº†ï¼ˆ

#### ~~å¿˜è®°å…³æµ‹è¯•ç”¨ Docker container~~

ç¬¬äºŒå¤©æ—©ä¸Šèµ·æ¥ä¸€çœ‹ï¼ŒPlausible ç‰¹åˆ«å¡ï¼Œå†ä¸€çœ‹ï¼Œload avg éƒ½å¿«ä¸¤ä½æ•°äº†ï¼ŒåŸæ¥æ˜¯åœ¨ VPS ä¸Šæµ‹è¯•åç«¯éƒ¨ç½²å¿˜å…³äº† ğŸŒš ä¸è¦éšä¾¿åœ¨ç”Ÿäº§ç¯å¢ƒé¡ºä¾¿æµ‹å°ä½œä¸šï¼ˆ

### ç©å°ä½œä¸š

æŠŠ game of life å½“æˆå†¬æ—¥ç»˜æ¿ç”»ç”»ï¼ŒåŠ¨æ€æ›´æ–°æ—¶é’Ÿï¼Œä» LifeWiki è·å–éšæœº patternï¼Œè¿™æ˜¯ä¸€ä¸ªä½œä¸šå†™ä¸å®Œçš„äººèƒ½å¹²çš„å‡ºæ¥çš„å—ï¼Œå…±äº«åç«¯æ˜¯è¿™æ ·ç”¨çš„å—ï¼ˆ

ç¬¬äºŒå¤©æ—©ä¸Šèµ·æ¥ä¸€çœ‹ï¼ˆ~~æ€ä¹ˆæ¯æ®µéƒ½æœ‰ä¸ªç¬¬äºŒå¤©æ—©ä¸Šèµ·æ¥~~ï¼‰ï¼Œå¤§å®¶éƒ½åœ¨ç”»äº›å•¥ï¼Œæˆ‘è¿˜æ˜¯å¤ªä¿å®ˆäº†ï¼ˆ

### å›ç­”åŒå­¦æé—®

è½¯å·¥çš„å…¬å¼€æé—®è²Œä¼¼åªèƒ½åœ¨å¾®ä¿¡ç¾¤ï¼Œè€Œä¸”åŠ©æ•™æœ‰åå‡ ä¸ªï¼Œå›å¤é€Ÿåº¦å®åœ¨æ˜¯å¤ªå¿«äº†ã€‚ç¨‹è®¾è®­ç»ƒçš„æ—¶å€™æˆ‘è¿˜èƒ½å¶å°”æŠ¢åœ¨åŠ©æ•™ä¹‹å‰å›ç­”é—®é¢˜ï¼Œç°åœ¨æ ¹æœ¬åšä¸åˆ°ï¼ˆ

### å·çª¥åŒå­¦ä»£ç 

å¶ç„¶é—´å‘ç° SonarQube ä¸Šå¯ä»¥çœ‹åˆ°åŒå­¦çš„ä»£ç ï¼Œå› ä¸ºæˆ‘çš„å°ä½œä¸šå·²ç»äº¤äº†è€Œä¸”åˆ†éƒ½ç»™äº†ï¼Œæ‰€ä»¥æˆ‘å°±æ”¾å¿ƒå¤§èƒ†åœ°å·çª¥äº†ï¼ˆ

æœ¬æ¥æƒ³ç»™åŠ©æ•™æŠ¥å‘Šä¸€ä¸‹é—®é¢˜ç­‰æƒé™ä¿®å¤ï¼Œç»“æœè¯´æ˜¯æ‡’å¾—ä¿®äº†ï¼Œã€Šå¸Œæœ›æ²¡å¤šå°‘äººå‘ç°ã€‹ï¼Œ~~å¯¼è‡´æˆ‘ç”šè‡³ä¸èƒ½åœ¨è¿Ÿäº¤ ddl ä¹‹å‰åœ¨åšå®¢åæ§½~~ï¼ˆè¦æ˜¯ä¸‹å­¦æœŸè¿˜ä¸ä¿®ï¼Œå¤§å®¶éƒ½å­¦ä¼šäº†è¿™ä¸ªæ“ä½œï¼Œé‚£åªèƒ½è¯´ä¸æ˜¯æˆ‘çš„é”…äº†ï¼‰ï¼Œé‚£æˆ‘åªå¥½è¶æœºæ¥è®¤çœŸçœ‹ä¸€çœ‹åŒå­¦ä»¬éƒ½å†™äº†ä¸€äº›ä»€ä¹ˆå¥‡å¦™ä»£ç ï¼ˆ

-   å†—ä½™çš„ç±»å‹æ ‡æ³¨ï¼ˆçœ‹åˆ°æ–‡æ¡£é‡Œè®² TS çš„æ—¶å€™ä¸¾ä¾‹å…¨æ˜¯å†—ä½™ç±»å‹æ ‡æ³¨æ—¶ï¼Œæˆ‘å°±çŸ¥é“åŒå­¦ä»¬è‚¯å®šä¼šå†™ä¸€ä¸‡ä¸ª \`let count: number = 0\`ï¼‰

-   åªéœ€æ¡ä»¶ä¿®æ”¹ prop æ—¶ï¼Œæ¡ä»¶æ¸²æŸ“ prop ä¸åŒçš„ä¸¤ä¸ªç»„ä»¶

-   æ‰‹å†™å…«éè€Œä¸æ˜¯ä½¿ç”¨ \`for\` æ¥éå†ç½‘æ ¼çš„é‚»å±…

-   æ›´æ–° React state æ—¶å³ä½¿ç»“æœæ˜¯å¸¸é‡ä¾ç„¶ä½¿ç”¨å›è°ƒå‡½æ•°

-   å›è°ƒå‡½æ•°å†™æˆ \`() => { foo(); }\` è€Œä¸æ˜¯ \`foo\`

-   å†—ä½™çš„ \`flex-direction: row\`

-   å¤åˆ¶äºŒç»´æ•°ç»„ï¼Œæœ‰çœ‹åˆ°ç”¨ \`for\` ä¸€ä¸ªä¸ª \`push\` çš„ï¼Œä¹Ÿæœ‰çœ‹åˆ°ç›´æ¥ \`JSON.parse(JSON.stringify)\` çš„ï¼›æ­£ç¡®å†™æ³•åº”è¯¥æ˜¯ \`old.map((row) => row.slice())\`ã€‚æ•°ç»„å¤§å°ä¸º 1000x1000 æ—¶ï¼Œåœ¨ Firefox ä¸­ï¼Œè¿™ä¸¤ç§å†™æ³•çš„ç”¨æ—¶éƒ½å¤§çº¦æ˜¯ \`map\` & \`slice\` çš„ 10 å€ï¼Œåœ¨ Chrome ä¸­ï¼Œä¸€ä¸ªä¸ª \`push\` çš„ç”¨æ—¶æ˜¯ \`map\` & \`slice\` çš„ 3 å€ï¼Œ\`JSON.parse(JSON.stringify)\` çš„ç”¨æ—¶æ˜¯ 40 å€ã€‚è€Œä¸”ï¼Œç”±äºå°ä½œä¸šä¸­éœ€è¦çš„æ˜¯å¤åˆ¶å…¶ä»–æ‰€æœ‰ï¼Œä½†ä¿®æ”¹ä¸€ä¸ªï¼Œå¾ˆå¤šåŒå­¦åœ¨ \`for\` é‡Œé¢å†™ \`if\`ï¼Œè¿™æ ·æ•ˆç‡æ›´ä½ï¼Œåº”è¯¥æŠŠ \`if\` å†™åœ¨ \`for\` å¤–é¢ã€‚

    ä½†æ˜¯è¿˜çœ‹åˆ°ä¸€ç§å†™æ³•ï¼Œåªæ·±å¤åˆ¶ä¿®æ”¹äº†çš„é‚£ä¸€è¡Œï¼Œå…¶ä»–è¡Œæµ…å¤åˆ¶ã€‚è‰ï¼Œè¿™æ ·ç¡®å®æ€§èƒ½æ›´å¥½ã€‚

-   ä¾èµ–äºæ•ˆæœä¸º toggle çš„æŒ‰é’®ä¸ä¼šåœ¨ toggle å®Œæˆå‰è¢«ç‚¹å‡»ä¸¤æ¬¡ï¼š
    
    -   é—®é¢˜èƒŒæ™¯ï¼šä¸€ä¸ª start æŒ‰é’®å’Œä¸€ä¸ª stop æŒ‰é’®ï¼Œä¿®æ”¹ä¸€ä¸ª \`playing\` çš„ stateï¼Œå¤„äº playing çŠ¶æ€æ—¶éœ€è¦ä¸€ä¸ª \`setInterval\`
    -   é—®é¢˜ 1ï¼šåœ¨ start / stop æ—¶å°† \`playing\` ä¿®æ”¹ä¸º \`!playing\` è€Œé \`true\`/\`false\`
    -   é—®é¢˜ 2ï¼šåªåœ¨ stop æ—¶ \`clearInterval\`ï¼Œæ²¡æœ‰åœ¨ start æ—¶ \`clearInterval\`
    
    æ­£å¸¸çš„äº¤äº’å¾ˆéš¾åšåˆ° toggle å®Œæˆå‰è¢«ç‚¹å‡»ä¸¤æ¬¡ï¼ŒåŸºæœ¬ä¸Šåªèƒ½é€šè¿‡åœ¨ console è¿ç»­è°ƒç”¨ä¸¤æ¬¡ \`click\` å®ç°ï¼Œä½†æœ€å¥½è¿˜æ˜¯ä¸è¦ä¾èµ–äºè¿™ä¸€ç‚¹ã€‚

### Node.js å’Œæµè§ˆå™¨çš„ä¸åŒ timer

é˜Ÿå‹é—®äº†ä¸€ä¸ªç¥å¥‡çš„ bugï¼Œè¯´æ˜¯ \`clearInterval\` clear ä¸æ‰ï¼Œæˆ‘çœ‹äº†åŠå¤©éƒ½æ²¡å‘ç°é—®é¢˜ï¼Œæœ€åå‘ç°å¼€å¤´æœ‰ä¸ª \`import { setInterval } from 'timers'\`ã€‚

ä¹‹å‰è¿˜çœŸæ²¡æ³¨æ„è¿‡ï¼Œtimer æœ‰ Node.js å’Œæµè§ˆå™¨ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒNode.js çš„ \`setInterval\` è¿”å›çš„æ˜¯ä¸€ä¸ª objectï¼Œæµè§ˆå™¨è¿”å›çš„æ˜¯ä¸€ä¸ª \`number\`ã€‚

-   ç›´æ¥å†™ \`setInterval\` æ—¶ï¼Œåœ¨ TypeScript ä¸­ä¼šè¢«è®¤ä¸ºè¿”å› \`NodeJS.Timer\`ï¼Œè€Œå®é™…è¿è¡Œæ—¶åœ¨å“ªè¿è¡Œå°±ç”¨å“ªä¸ªç‰ˆæœ¬çš„å‡½æ•°ã€‚
-   å¦‚æœå†™çš„æ˜¯ \`window.setInterval\`ï¼Œåœ¨ TypeScript ä¸­ä¼šè¢«è®¤ä¸ºè¿”å› \`number\`ï¼Œåœ¨ Node.js ä¸­è¿è¡Œä¼šæŠ¥é”™ã€‚
-   å¦‚æœæ˜¯ \`import { setInterval } from 'timers'\`ï¼Œå³ä½¿æ˜¯åœ¨æµè§ˆå™¨ä¸­è¿è¡Œä¹Ÿä¼šä½¿ç”¨ Node.js ç‰ˆæœ¬çš„å‡½æ•°ã€‚

è¿™é‡Œæ¯”è¾ƒé‡è¦çš„æ˜¯ \`setInterval\` å’Œ \`clearInterval\` è¦é…å¥—ï¼Œä¸èƒ½ä¸€ä¸ªç”¨ Node.js çš„ä¸€ä¸ªç”¨æµè§ˆå™¨çš„ï¼Œå¦åˆ™ä¼š clear ä¸æ‰ç”šè‡³æŠ¥é”™ã€‚

ä¸€èˆ¬æ¥è¯´ç›´æ¥å†™ï¼ˆä¸ \`window.\` ä¹Ÿä¸ \`import from 'timers'\`ï¼‰å°±æ˜¯æœ€å¥½çš„ï¼Œè™½ç„¶çœ‹èµ·æ¥ TypeScript ä¼šå°† \`number\` è¯¯è®¤ä¸ºæ˜¯ \`NodeJS.Timer\`ï¼Œä½†è¿™ä¸ª \`number\` æœ¬æ¥å°±ä¸è¯¥è¢«å½“ä½œä¸€ä¸ª \`number\` æ¥ä½¿ç”¨ï¼Œè¿™æ ·çš„ typing åè€Œæ˜¯å¥½çš„ã€‚

è¿™é‡Œå¦‚æœå†ä»”ç»†ç ”ç©¶ä¸€ä¸‹å¯ä»¥å•ç‹¬å†™ä¸€ç¯‡åšå®¢äº†ï¼Œä½†è¿˜æ˜¯ç®—äº†å§ï¼ˆ

### å°ä½œä¸šå³å°†æˆªæ­¢

> å°ä½œä¸š å°†äº 3 æœˆ 16 æ—¥ï¼ˆå‘¨å››ï¼‰23:59 æˆªæ­¢ã€‚
>
> è¯·æ³¨æ„æˆªæ­¢æ—¶é—´ä¸æ˜¯ 21:55ã€‚
>
> â€¦â€¦

åé¢çœç•¥çš„å‡ å¥ä¹Ÿæ˜¯æ¨¡ä»¿çš„ DSAï¼Œ~~DNS~~ <span class="heimu">å‰å‡ å¤©æŸä½åŠ©æ•™ç­”ç–‘çš„æ—¶å€™æŠŠ dns typo æˆäº† dna</span> DNA åŠ¨äº†ï¼Œå¥½è¯„ï¼Œä½†å¼€å¤´è¿™ä¸ªå¯¹å¶çš„ ddl ç»·ä¸ä½äº†ï¼ˆ

## å¤§ä½œä¸š

### ç»„é˜Ÿ

åœ¨å¦å¤–ä¸€ä¸ªé€šè¯†è¯¾ä¸Šä½“éªŒäº†ä¸€ä¸‹å·®ç‚¹æ²¡ç»„ä¸Šé˜Ÿï¼ˆè™½ç„¶åæ¥å¾—çŸ¥è¿˜æœ‰ä¸å°‘äººæ¯”æˆ‘æ›´æ™šç»„ä¸Šé˜Ÿï¼‰ï¼Œæœ€åå®Œå…¨ rand ç»„é˜Ÿã€‚æ‰€ä»¥çœŸçš„å¾ˆæ„Ÿè°¢ä¸Šå­¦æœŸå°±æ‰¾æˆ‘æ¥ç»„é˜Ÿçš„é˜Ÿå‹ã€‚

### èµ·é˜Ÿå

> HardToName / èµ·ä¸ªåå¥½éš¾é˜Ÿ

~~è¿™æ˜¯ä»€ä¹ˆå¼•ç”¨å•Š~~

é˜Ÿå‹æå‡ºäº†ä¸‰ä¸ªé˜Ÿåï¼šå•Šå¯¹å¯¹é˜Ÿã€BUG å…¨è°ƒé˜Ÿã€\\[redacted\\] é˜Ÿã€‚å‰ä¸¤ä¸ªéƒ½è¢«å äº†ï¼Œåä¸€ä¸ªå¤ªé­”å¹»äº†ï¼Œäºæ˜¯æœ€åè¿˜æ˜¯ç”¨çš„æˆ‘æå‡ºçš„é˜Ÿåï¼šlazy / è¿™ä¸ªé˜Ÿç‰¹åˆ«æ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹~

ï¼ˆè¿™ SECoder æ€ä¹ˆè¿˜åœ¨ç”¨è¿™ä¸ªå¾ˆæœ‰å¹´ä»£æ„Ÿçš„ä¸ªäººæè¿° placeholder å•Šã€‚ï¼‰

![å­¦ç”Ÿåˆ—è¡¨ï¼Œæ»¡å±éƒ½æ˜¯â€œè¿™ä¸ªäººç‰¹åˆ«æ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹~â€](lazy-placeholder.png)

ä¿—è¯è¯´å¾—å¥½ï¼Œè´±åå¥½å…»æ´»ï¼Œ~~å–åå« lazy ä¸€å®šæ‘†ä¸èµ·æ¥ï¼ˆ~~

å…¶å®æœ¬æ¥è¿˜æƒ³è¿‡åˆ©ç”¨äº”ä¸ªäººçš„åå­—ç¼©å†™ä¹‹ç±»çš„ç»„ä¸€ä¸ªé˜Ÿåï¼Œä½†äººè„‘å»æƒ³ä¸€ä¸ªç¬¦åˆè¦æ±‚ä¸”æœ‰æ„æ€çš„é˜Ÿåå¤ªéš¾äº†ï¼Œè¾“å…¥æ³•ç»™å‡ºçš„å€™é€‰è¯ä¹Ÿæ²¡å•¥æ„æ€ï¼Œæ‰€ä»¥æˆ‘è¿˜å°è¯•äº†ç”¨ ChatGPT æ¥ç”Ÿæˆï¼Œæœ¬æ¥åªæ˜¯ä»¥ä¸ºå®ƒä¼šç”Ÿæˆä¸€äº›æ²¡æ„æ€çš„é˜Ÿåï¼Œæ²¡æƒ³åˆ°å®ƒç”Ÿæˆå‡ºæ¥çš„é˜Ÿåä¸ä»…æ²¡æ„æ€ï¼Œè€Œä¸”æ‹¼éŸ³é¦–å­—æ¯ç”šè‡³å­—æ•°éƒ½å®Œå…¨ä¸ç¬¦åˆè¦æ±‚ï¼Œæ— è®ºæ€ä¹ˆæ‹·æ‰“éƒ½è®¤é”™ä¸æ”¹ ğŸŒš

### åˆ†å·¥ & æŠ€æœ¯æ ˆ

å¬è¯´ä»£ç å¯èƒ½è¦æ±‚æœ‰é˜Ÿå‹å®¡æ ¸ï¼Œæ‰€ä»¥æ”¾å¼ƒäº†ä¸€ä¸ªäººå†™å‰ç«¯ï¼ˆå¯èƒ½æ¥ä¸ªäººå†™æµ‹è¯•ï¼‰çš„æƒ³æ³•ï¼ˆ

å‡ ä¹æ˜¯ç†æ‰€å½“ç„¶åœ°å°±å†³å®šäº†ç”¨ Vueï¼Œæ²¡æœ‰ä¸€ç‚¹åå¯¹ï¼Œæ„Ÿè§‰è¿™ä¸ªä¸éœ€è¦å­¦ React çš„ React å°ä½œä¸š~~æ²¡æœ‰ä¹åˆ†ä¹Ÿæœ‰ååˆ†çš„åŠŸåŠ³~~ã€‚

ç»™é˜Ÿå‹å¸ƒç½®å­¦ä¹ ä»»åŠ¡çš„æ—¶å€™æ„Ÿè§‰ï¼Œæˆ‘å¥½åƒä¹Ÿä¸ä¼šå¤šå°‘ä¸œè¥¿ï¼Œåƒæ˜¯å‰ç«¯çš„æµ‹è¯•ä»¥åŠ Nuxt éƒ½è¿˜å¾—å­¦ï¼ŒJS/TS/Vue è¯´åˆ°åº•ä¹Ÿå°±é‚£ä¹ˆç‚¹ä¸œè¥¿ï¼Œæˆ‘çš„ä¼˜åŠ¿å¯èƒ½ä¸»è¦è¿˜æ˜¯åœ¨ç»éªŒæ–¹é¢ï¼Œä½†å…¶å®ä¹Ÿæ²¡å†™è¿‡ä»€ä¹ˆå¤æ‚çš„å‰åç«¯äº¤äº’ï¼Œå¤§ä½œä¸šå’Œåšå®¢ / Codle è¿™ç§ä¸œè¥¿è¿˜æ˜¯å·®åˆ«æŒºå¤§ï¼Œå†™è¿™ä¸ªåšå®¢çš„æ—¶å€™å¾ˆå¤šæ—¶é—´ä¹Ÿæ˜¯èŠ±åœ¨ä¸€äº› blog-specific çš„ä¸é‡è¦çš„ç»†èŠ‚ä¸Šã€‚~~è¯´çš„æˆ‘éƒ½æœ‰ç‚¹æ…Œäº†ï¼ˆ~~

[å’•äº†ä¸€å‘¨](https://archive.ph/6o0gs)çš„ Nuxt 3.3 ç»ˆäºåœ¨å¤§ä½œä¸šå¼€å§‹å‰å‘å‡ºæ¥äº†ï¼Œé¿å…äº†åˆšå¼€å§‹å†™ä¸ä¹…å°±è¦ bump minor versionã€‚yysy æˆ‘é€‰çš„è¿™äº›æŠ€æœ¯æ ˆè¿˜æ˜¯æŒºæœ€æ–°æœ€çƒ­çš„ï¼Œ~~è¦æ˜¯çœŸçš„å‡ºé”…äº†éƒ½ä¸çŸ¥é“æ€ä¹ˆå‘é˜Ÿå‹äº¤ä»£ï¼ˆ~~

ç´§æ¥ç€å°±çœ‹åˆ° TypeScript 5.0 ä¹Ÿå‘äº†ï¼Œæ›´æ–°æ›´çƒ­äº†ï¼Œå®³æ€•ï¼ˆ

### æ‘‡å·

> 3æœˆ14æ—¥24:00åè¿›è¡Œé¡¹ç›®å¿—æ„¿çš„æ‘‡å·

ç»“æœè¿˜çœŸæ˜¯â€œ24:00**å**â€ï¼Œæ‰‹åŠ¨ ddl ğŸŒš

æœ¬æ¥æ™šä¸Š 11 ç‚¹è¿˜çœ‹åˆ°æˆ‘ä»¬é˜Ÿçš„ä¸€å¿—æ„¿çš„ä¸€å¿—æ„¿æ•°é‡ä» 7 å˜æˆäº† 6ï¼Œå°±æ˜¯ 2/3 çš„æ¦‚ç‡æŠ½ä¸Šï¼Œç»“æœæ—©ä¸Šèµ·æ¥ä¸€çœ‹è¿˜æ˜¯æ‰äº†ï¼Œå¯„ã€‚è¿™ä¸‹å’Œä¸æ˜¯é˜Ÿå‹çš„å®¤å‹ä¸€ä¸ªé€‰é¢˜äº†ã€‚å¥½åœ¨ä¾‹ä¼šè¿˜æ˜¯ 4-3ï¼Œè¦æ˜¯ 4-4 çš„è¯æ•´ä¸ªä¸‹åˆå°±æ¶ˆå¤±äº†ï¼ˆ

### å¤§ä¾‹ä¼š 1

ç¬¬ä¸€æ¬¡ä¾‹ä¼šç«Ÿç„¶å°±è¦å†™åˆ†å·¥ä»¥åŠå®Œæ•´çš„è¿›åº¦å®‰æ’ï¼Œè™½ç„¶è¯´æ˜¯éšä¾¿ç”»é¥¼ä¹Ÿæ²¡äº‹ï¼Œä½†è¿˜æ˜¯æ„Ÿè§‰ä¸å¤ªæ•æ·ï¼ˆ

é¡ºä¾¿ç»ƒä¹ äº†ä¸€ä¸‹ [Slidev](https://sli.dev/)ï¼Œåœ¨æœ¬æœºè«å export å¤±è´¥äº†ï¼Œç»“æœæ‰”åˆ° VPS ä¸Šå°±æˆåŠŸäº†ï¼Œç¥ç§˜ã€‚ä½†åœ¨ VPS ä¸Šè¿˜å¾—è£…ä¸Šä¸­æ–‡å­—ä½“ï¼Œå¹¶ä¸”é…å­—ä½“è®¾ç½®ã€‚

æ— å¥–ç«çŒœï¼Œä¸‹é¢è¿™äº›é˜Ÿåéƒ½æ˜¯å•¥ï¼šï¼ˆ

> ä¸‹åˆçš„å±•ç¤ºé¡ºåºæ˜¯
> 
> 0. æˆ‘
> 1. è›‹ç™½è´¨
> 2. è¿·
> 3. å¯¹å¯¹å¯¹
> 4. æ‡’

<Card type="info" title="ç­”æ¡ˆ" fold>

<Card type="info" title="<s>ç»™ä½ ä¸€æ¬¡å†æƒ³ä¸€æƒ³çš„æœºä¼š</s>" fold>

1.  é’è›™è¡¥å……è›‹ç™½è´¨
2.  è¿·å¤±åˆ†æLAS
3.  é˜¿å¯¹å¯¹é˜Ÿ
4.  è¿™ä¸ªé˜Ÿç‰¹åˆ«æ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡ç•™ä¸‹~

</Card>

</Card>

æ„Ÿè§‰è¿™ä¸ªç¬¬ä¸€æ¬¡ä¾‹ä¼šæ€»ä½“ä¸Šä¼ è¾¾çš„æ„æ€å°±æ˜¯ï¼Œçœ‹èµ·æ¥éš¾çš„åŠŸèƒ½è¦æƒ³ç®€å•ç‚¹ï¼Œå·®ä¸å¤šå¾—äº†ï¼ˆ

### å¤§ä½œä¸šç¬¬ä¸€å‘¨

#### éœ€æ±‚ç»†åŒ–

ç¬¬ä¸€æ¬¡ä¾‹ä¼šä¸Šæ˜¯æˆ‘æçš„é—®é¢˜æœ€å¤šï¼Œä¹‹åä¹ŸåŸºæœ¬ä¸Šåªæœ‰æˆ‘åœ¨ç¾¤é‡Œé—®éœ€æ±‚ç»†èŠ‚é—®é¢˜ã€‚å›ç­”å¤§éƒ¨åˆ†éƒ½æ˜¯ä¸¤ç§ä¹‹ä¸€ï¼Œè¦ä¹ˆæ˜¯â€œè¿™æ ·ä¹Ÿå¯ä»¥ï¼Œä½†é‚£æ ·ä¹Ÿå¯ä»¥â€ï¼Œè¦ä¹ˆæ˜¯â€œè¿™æ ·æ›´å¥½ï¼Œä½†æ²¡åˆ†â€ã€‚ç¨‹è®¾è®­ç»ƒçš„æ—¶å€™ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¼¼ä¹æ˜¯æˆ‘çš„é—®é¢˜ï¼ˆï¼Œæ­£å¸¸çš„æƒ³æ³•æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯åªè¦ä¸è¯´æ¸…æ¥šå°±å¯ä»¥æ··è¿‡å»ï¼Œè€Œä¸æ˜¯å®³æ€•æ²¡ææ¸…æ¥šè€Œå†™é”™ï¼ˆ

#### å››ä¸ªé˜¶æ®µ

ç¬¬ä¸€å‘¨æ€»ä½“ä¸Šåˆ†æˆå››ä¸ªé˜¶æ®µï¼š

1.  è®¾è®¡ä»»åŠ¡è®¡åˆ’ï¼Œç¼–å†™è®©é˜Ÿå‹çŸ¥é“è¦å¹²ä»€ä¹ˆçš„æ–‡æ¡£å’Œ issue
2.  ping & push é˜Ÿå‹
3.  å›ç­”é˜Ÿå‹æé—® & æŒ‡å‡ºé˜Ÿå‹ä»£ç é‡Œçš„é—®é¢˜
4.  é©¬ä¸Šå°±è¦ä¾‹ä¼šäº†ï¼Œæ”¾å¼ƒæŒ‡å¯¼é˜Ÿå‹ï¼Œä¸Šæ‰‹è‡ªå·±å†™ï¼ˆ

æ„Ÿè§‰æœ€åæ€»çš„å·¥ä½œé‡è¿˜æ˜¯è¶…è¿‡äº†è‡ªå·±ä¸€ä¸ªäººæŠŠæ‰€æœ‰æ´»å¹²å®Œï¼ˆï¼Œå¸Œæœ›ä»¥åèƒ½å¥½ä¸€ç‚¹ï¼Œè¦ä¸€ç›´æ˜¯è¿™æ ·å…¶ä»–è¯¾çœŸå¯„äº†ã€‚è€Œä¸”æˆ‘æœ¬æ¥å°±æ²¡æ‰“ç®—ç®¡åç«¯ï¼Œå°±æ²¡å­¦ Djangoï¼Œç»“æœä¸ä»…è¦æä¸€ç‚¹åç«¯çš„è§„åˆ’è®¾è®¡ï¼Œå›ç­”é˜Ÿå‹æé—®ï¼Œè¿˜å¾—èµ¶ç€ ddl ç¡¬ä¸Šå†™ä»£ç ï¼Œå¼€å‘ç¯å¢ƒéƒ½æ²¡é…å¥½ã€‚

#### æ•°æ®åº“é…ç½®

ä½ è§è¿‡åªèƒ½æŒ‚è½½ç›®å½•ï¼Œä¸èƒ½è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¹Ÿä¸èƒ½æŒ‚è½½å•ä¸ªæ–‡ä»¶çš„ Docker å®¹å™¨ç®¡ç†å—ï¼ˆ

è¿™ä¸ª SECoder å®åœ¨æ˜¯æœ‰äº›è¿‡äºç¦»è°±ï¼Œæœ€ååªèƒ½æŠŠç¯å¢ƒå˜é‡å†™åœ¨ Dockerfile é‡Œï¼Œç”¨ build å‡ºæ¥çš„æ•°æ®åº“é•œåƒã€‚

#### å°ä¾‹ä¼š 1

ä¸»è¦å°±æ˜¯èŠäº†ä¸€ä¸‹æ•°æ®åº“å’Œ API çš„è®¾è®¡ï¼Œä¹Ÿæ²¡æ£€æŸ¥ CI/CDï¼Œç»“æŸä¹‹åæ‰æƒ³èµ·æ¥æ¶æ„è®¾è®¡ä¹Ÿæ²¡è¯´ã€‚æ¯•ç«Ÿæ˜¯å°ä¾‹ä¼šï¼Œç¡®å®æ¯”è¾ƒè½»æ¾ï¼Œæ„Ÿè§‰ä¸Šåˆç™½ç€æ€¥æŠŠæ•°æ®åº“è·‘èµ·æ¥äº†ï¼ˆ

### å¤§ä½œä¸šç¬¬äºŒå‘¨

#### SECoder SSH å¡ä½

ä¹‹å‰å°±å¶å°”ç¢°åˆ° SECoder SSH å¡ä½çš„æƒ…å†µï¼Œä»Šå¤©å‘ç°æ˜¯å›äº†å¯å®¤è¿æœ‰çº¿ç½‘å°±å¡ä½ï¼Œæ¢æˆ Tsinghua Secure å°±ä¸å¡äº†ï¼Œæ€€ç–‘å’Œ IP åˆ‡æ¢æœ‰å…³ï¼Œä¸æ˜¯å¾ˆæ‡‚ã€‚

#### Nuxt ä¸ TypeScript 5.0

ä¹‹å‰è¿˜è¯´æœ‰ç‚¹å¤ªæ–°å¤ªçƒ­äº†ï¼Œæœç„¶ä¸€å †é”…ã€‚

ä¹‹å‰ä¸€ç›´éšæœºæŠ¥é”™ \`The "path" argument must be of type string. Received an instance of Array\`ï¼Œåæ¥å‘ç°æ˜¯æˆ‘ç›´æ¥ç”¨äº†æœ€æ–°æœ€çƒ­çš„ [tsconfig é‡Œ \`extends\` å†™æ•°ç»„](https://devblogs.microsoft.com/typescript/announcing-typescript-5-0/#supporting-multiple-configuration-files-in-extends)ï¼Œç„¶å Nuxt è¯»å– tsconfig çš„æ—¶å€™å¯„äº†ã€‚æ”¹æˆå•ä¸ª \`extends\` æˆ–è€…æŠŠ Nuxt æ›´æ–°åˆ° edge channel å°± ok äº†ã€‚

å¦å¤–è¿˜ç¢°åˆ° [ä¸€ä¸ª bug](https://github.com/nuxt/nuxt/issues/15113)ï¼Œåªèƒ½æŠŠè·¯å¾„æ”¹æˆè‹±æ–‡ã€‚

#### npmmirror æ›´æ–°ä¸åŠæ—¶

CI æŒ‚åœ¨äº†å¥‡æ€ªçš„åœ°æ–¹ï¼Œæ˜¯ npmmirror æ›´æ–°ä¸åŠæ—¶ï¼Œä¸€ä¸ªåˆšæ›´æ–°å‡ åˆ†é’Ÿçš„åŒ…ä¸‹ä¸ä¸‹æ¥ã€‚npmmirror çš„é¦–é¡µå†™çš„æ˜¯æ¯ 10min æ›´æ–°ä¸€æ¬¡ï¼Œä½†æˆ‘ç­‰äº†å®ƒåŠå°æ—¶è¿˜æ²¡æ›´æ–°ã€‚ç„¶åçœ‹åˆ° npmmirror ä¸Šæ¯ä¸ªåŒ…çš„é¡µé¢ä¸Šæœ‰ä¸€ä¸ªâ€œSYNCâ€æŒ‰é’®ï¼Œç‚¹ä¸€ä¸‹å°±å¯ä»¥æ›´æ–°ï¼Œè‰ï¼ˆ

#### pnpm v8

æ„Ÿè§‰è¿™ä¸ªè½¯å·¥å°±å’Œæœ€æ–°æœ€çƒ­æ‰¯ä¸å¼€å…³ç³»äº†ï¼ˆ

ç¢°åˆ°ä¸€ä¸ªéå¸¸ç¥ç§˜çš„ï¼Œä¸€ä¸ª up-to-date with master çš„ MR åœ¨åˆå¹¶ä¹‹åæŒ‚ CIï¼Œè¯´æ˜¯ lock file æœ‰é—®é¢˜ã€‚æœ¬æ¥æˆ‘éƒ½æ²¡æƒ³ç®¡äº†ï¼Œç»“æœæ™šä¸Šå‘ç°åšå®¢ä¹ŸæŒ‚ CI äº†ï¼Œå†ä¸€çœ‹ï¼ŒåŸæ¥æ˜¯ pnpm å‘å¸ƒ v8 äº†ï¼Œè‰ã€‚

#### nuxt dev æŠ¥é”™ â€œBody is unusableâ€

[Body is unusable (undici) Â· Issue #19245 Â· nuxt/nuxt](https://github.com/nuxt/nuxt/issues/19245) æ˜¯ä¸€ä¸ªéå¸¸ç„å­¦çš„ issueï¼Œæˆ‘åœ¨éƒ¨ç½²åˆ° SECoder çš„æ—¶å€™é‡åˆ°äº†ï¼Œé˜Ÿå‹åœ¨ WSL2 ä¸Šé‡åˆ°äº†ï¼Œä½†æˆ‘åœ¨æœ¬åœ°ï¼ˆArch Linuxï¼‰æ²¡é‡åˆ°è¿‡ã€‚æˆ‘è®©é˜Ÿå‹è¯•ç€åœ¨ Docker é‡Œè·‘ devï¼Œä¼¼ä¹å’Œ issue é‡Œæè¿°çš„ä¸€æ ·ï¼Œå¶å°”ä¼šé‡åˆ°ï¼Œä½†é‡è¯•ä¸€ä¸‹å°±å¥½äº†ï¼›è€Œä¸” WSL2 é‡ŒåŠ è½½éå¸¸æ…¢ï¼Œç›´æ¥åœ¨ Windows ä¸Šè¿è¡Œ Docker ä¼šå¿«å¾ˆå¤šã€‚

HMR éœ€è¦ WebSocketï¼Œäºæ˜¯åœ¨ Docker é‡Œè·‘ dev çš„æ—¶å€™å‘ç° Vite é»˜è®¤çš„ ws ç«¯å£æ˜¯ 24678ï¼Œå”¤é†’äº†ä¸€äº›è¿œå¤çš„å›å¿†ï¼ˆï¼›ç»“æœå»æœç´¢å¼•æ“ç¡®è®¤ ~~è‡ªå·±çš„ DNA æ²¡æœ‰åˆ»é”™~~ çš„æ—¶å€™æœåˆ°çš„å…¨æ˜¯â€œåŸç¥â€˜æ¸¯å£é©¶è¿‡å‡ è‰˜èˆ¹ï¼ŒäºŒå››å…­ä¸ƒå…«â€™ä»»åŠ¡æ”»ç•¥â€ï¼Œç»·ä¸ä½äº†ï¼ˆ

#### å¤§ä¾‹ä¼š 2

ä¾‹ä¼šå‰ CI ä¸€ç›´åœ¨æ’é•¿é˜Ÿï¼Œä¸€å¼€å§‹è¿˜åªç”¨å¤šç­‰ä¸€ä¼šå„¿ï¼Œåæ¥ç”šè‡³ä¼šç­‰å¾…è¶…æ—¶è€Œç›´æ¥æŒ‚æ‰ï¼Œå·®ç‚¹æ²¡éƒ¨ç½²ä¸Šï¼ˆ

æœ€åå‘ç°æˆ‘ä»¬éƒ¨ç½²çš„ dev ç¯å¢ƒå¯ç”¨ prod ç¯å¢ƒä¸å¯ç”¨ï¼Œç›´æ¥ç”¨çš„ dev ç¯å¢ƒåšæ¼”ç¤ºï¼Œæ²¡äººé—®ä¸ºä»€ä¹ˆåœ°å€é‡Œæœ‰ä¸ª devï¼ˆï¼›åæ¥å‘ç°ç¡®å®æ˜¯æš´åŠ›æ”¹æ‰ migration åæ•°æ®åº“æ²¡é‡å¯çš„é—®é¢˜ï¼Œä½†æˆ‘æ˜¯ä¸€å¼€å§‹è¯•å›¾é‡å¯äº†ä½†è¿˜æ˜¯æŒ‚ï¼Œä»¥ä¸ºæ˜¯å…¶ä»–é—®é¢˜ï¼Œä½†å®é™…ä¸Šæ˜¯ SECoder çš„å®¹å™¨é‡å¯éœ€è¦ç­‰å¾…ï¼Œè€Œä¸”ä¸çŸ¥é“ä¸ºä»€ä¹ˆæœ‰æ—¶å€™ç­‰å¥½ä¹…ä¹Ÿæ²¡é‡å¯æˆåŠŸï¼Œéå¸¸ç„å­¦ã€‚

å…¶ä»–é˜Ÿéƒ½çœ‹ä¸Šå»åšäº†å¾ˆå¤šåŠŸèƒ½ï¼Œæˆ‘ä»¬èƒ½æ¼”ç¤ºçš„åªæœ‰æ³¨å†Œç™»å½•ã€‚è™½ç„¶æˆ‘ä»¬çš„æ³¨å†Œç™»å½•ç¡®å®ç›¸å¯¹æ¥è¯´æ›´åŠ å®Œå–„ï¼Œè€Œå…¶ä»–é˜Ÿçš„å…¶ä»–åŠŸèƒ½ä¹Ÿä¸€å †é—®é¢˜ï¼Œä½†æ„Ÿè§‰åœ¨å·®ä¸å¤šå¾—äº†çš„æ°›å›´ä¸‹ï¼Œä¼¼ä¹è¿˜æ˜¯èµ¶ä¸Šè¿›åº¦æ›´é‡è¦ã€‚

### å¤§ä½œä¸šç¬¬ä¸‰å‘¨

#### Nitro proxy ä¸ set-cookie

è¯´æ¥å®åœ¨æ˜¯ç»·ä¸ä½ã€‚

æˆ‘åœ¨ä¸€ä¸ªæœªç™»å½•æ—¶è¿”å› 403 çš„ API è®¾ç½® CSRF cookieï¼Œåœ¨å‰åç«¯å¯¹æ¥æµ‹è¯•æ—¶å‘ç°è¿™ä¸ª \`set-cookie\` åœ¨ç»è¿‡å‰ç«¯ proxy ä¹‹åå°±æ²¡äº†ï¼Œäºæ˜¯æˆ‘ä»¥ä¸ºæ˜¯ Nitro çš„ proxy ä¸è½¬å‘ \`set-cookie\`ï¼Œåˆé©¬ä¸Šè¦ä¾‹ä¼šäº†ï¼Œå°±èµ¶ç´§æ¢æˆäº† Nginx åä»£ã€‚

ä¾‹ä¼šç»“æŸåï¼Œæˆ‘ä» Nitro æºç ç¿»åˆ° h3 æºç ï¼Œå†ç¿»åˆ° undici çš„ issueï¼Œå‘ç° [Undici strips out set-cookie headers, even when "credentials: 'include'" is set](https://github.com/nodejs/undici/issues/1262)ï¼Œåˆç”¨ https://httpbin.org/cookies/set/cookie/test è¿›è¡Œæµ‹è¯•å‘ç°çœŸçš„æ²¡æœ‰ \`set-cookie\`ï¼Œè¿˜ä»¥ä¸ºæ‰¾åˆ°åŸå› äº†ã€‚ä½†åˆå‘ç° [feat: remove headers filtering](https://github.com/nodejs/undici/pull/1469)ï¼Œæ„Ÿè§‰å¾ˆå¥‡æ€ªã€‚

äºæ˜¯æˆ‘å†ä»”ç»†çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç° https://httpbin.org/cookies/set/cookie/test è¿”å›çš„æ˜¯ 302ï¼Œè€Œé‡å®šå‘ä¹‹åå°±æ²¡æœ‰ \`set-cookie\` äº†ã€‚è€Œä¸€å¼€å§‹é‚£ä¸ª API æ²¡æœ‰è¿”å› \`set-cookie\` åˆ™æ˜¯å› ä¸ºå®ƒè¿”å›çš„ä¸æ˜¯ 200ï¼Œæ”¹æˆ 200 å°±æ­£å¸¸äº†ã€‚ä½†å‡¡æˆ‘æµ‹è¯•äº†ä¸€ä¸ªè¿”å› 200 çš„ä¹Ÿä¸è‡³äº..

ä¸Šåˆå› ä¸ºè¿™ä¸ªé—®é¢˜å·®ç‚¹æ²¡åœ¨ä¾‹ä¼šå‰éƒ¨ç½²å¥½ï¼Œä¾‹ä¼šåä¸€ç›´ç ”ç©¶åˆ°æ™šä¸Šï¼Œå‡ ä¹æ˜¯æäº†ä¸€æ•´å¤©ï¼Œç ´é˜²äº†ï¼ˆ

#### ~~å§“æ¸¸å°±è¦ç”¨å°¤å¤§çš„ Vueï¼ŒyÃ³u ã ã‘ã«ã£ï¼~~

çªç„¶å‘ç°å¦ä¸€ä¸ªé˜Ÿé•¿å§“æ¸¸çš„é˜Ÿä¹Ÿç”¨çš„ Vueï¼Œè€Œå…¶ä»–é˜Ÿæš‚æ—¶æ²¡å‘ç°æœ‰ç”¨ Vue çš„ï¼ˆæˆ‘æš‚æ—¶åªæ‰¾åˆ°äº† 1/4 é˜Ÿä¼çš„åŸŸåï¼Œå‰©ä¸‹æœ‰æ‰¾ä¸åˆ°çš„ä¹Ÿæœ‰æ‡’å¾—æ‰¾çš„ï¼‰ã€‚~~éš¾é“æ˜¯å› ä¸ºå’Œå°¤å¤§ä¸€æ ·å§“ yÃ³u å—ï¼Œè¿™ä¸‹[<span class="text-aisan">çˆ±å§</span>](https://zh.moegirl.org.cn/å®«ä¸‹çˆ±)ç‹‚å–œäº†ï¼ˆ~~

#### undici å‘é€å¸¦ \`Content-Length: 0\` çš„ DELETE è¯·æ±‚

è¿™æ˜¯ç¬¬ 114514 æ¬¡è¢« undici èƒŒåˆºäº†ï¼Œå…·ä½“è¯·çœ‹ [Sending a DELETE request with "Content-Length: 0" fails with a RequestContentLengthMismatchError Â· Issue #2046 Â· nodejs/undici](https://github.com/nodejs/undici/issues/2046)ã€‚

è€Œè¿™ä¸ª \`Content-Length: 0\` æ˜¯ç”±å·²ç»æ²¡åœ¨ç»´æŠ¤çš„ [\`http-proxy\`](https://github.com/http-party/node-http-proxy) åŠ ä¸Šçš„ã€‚ä¸çŸ¥ä¸ºä½•ï¼Œç”šè‡³ä¸æ˜¯ç»™å…¶ä»– method åŠ  Content-Length çš„æ—¶å€™å¿˜è®°æ’é™¤ DELETE äº†ï¼Œè€Œæ˜¯ä¸“é—¨ç»™ DELETE åŠ çš„ã€‚æ›´ç¥ç§˜çš„æ˜¯ï¼Œè¿™æ®µä»£ç æ˜¯åœ¨åå¹´å‰åªæœ‰ä¸€ç™¾å¤šè¡Œçš„ [initial commit](https://github.com/http-party/node-http-proxy/commit/4d131567211bcefc6ef0b0592d374fef7bd5abd8#diff-0855adca187963032d89850159dc18eacfb9f206c036887e19b1877e69cc0ac1R20) å°±åŠ ä¸Šäº†ã€‚åæ­£ç»™è¿™æ®µæ‰“ä¸ª patch å°±å¥½äº†ã€‚

#### SECoder commit ç»Ÿè®¡

ä¹‹å‰è¿˜åœ¨æƒ³ SECoder çš„æ•°æ®ç»Ÿè®¡ä»€ä¹ˆæ—¶å€™å¼€ï¼Œæ²¡æƒ³åˆ°ä¸€å¼€å“ä¸€è·³ï¼ˆ

å®ƒä¼¼ä¹æ˜¯ç»Ÿè®¡äº†æ‰€æœ‰ commitï¼ŒåŒ…æ‹¬æ²¡ merge åˆ° master çš„ä»¥åŠè¢« force-push è¦†ç›–æ‰çš„ï¼Œç»“æœæˆ‘å·®ä¸å¤šåˆ°äº† rk2 çš„ä¸¤å€ï¼ˆï¼Œä½†è¦æ˜¯åªç®— master çš„è¯å…¶å®è¿› top10 éƒ½è¿˜å·®ä¸€ç‚¹ã€‚åº”è¯¥ä¸»è¦æ˜¯æ­å‰ç«¯ä»£ç æ¡†æ¶çš„æ—¶å€™ï¼Œæœ‰ 20 å¤šä¸ª commit rebase äº†å¥½å‡ æ¬¡ï¼Œåæ¥ä¹Ÿç»å¸¸ force-push ä¿®å°çš„ typoã€‚è¿™ä¹ˆè¯´æ¥ GitHub åªç»Ÿè®¡ master è¿˜æ˜¯æŒºå¥½çš„ï¼Œè™½ç„¶æˆ‘ä¸ªäººé¡¹ç›®ä¹Ÿç»å¸¸ä¼šåœ¨ master ä¸Šç–¯ç‹‚ force-pushï¼ˆ

ä½†æ˜¯ SECoder æ²¡æœ‰ MR è¯„è®ºæ•°é‡çš„ç»Ÿè®¡ï¼Œå…¶å®æˆ‘è§‰å¾—è¿™ä¸ªæ‰æ˜¯æˆ‘åº”è¯¥éœ¸æ¦œçš„åœ°æ–¹ï¼ˆ

### å¤§ä½œä¸šç¬¬å››å‘¨

æœŸä¸­å‘¨äº‹æ¯”è¾ƒå¤šï¼Œç¨å¾®æœ‰ç‚¹æ‹–ï¼Œäºæ˜¯å¯„äº†ã€‚

> æ•´ä½“å¼€å‘è¿‡ç¨‹ä¸­å­˜åœ¨å¤§é‡å¼€å‘è¿›åº¦ä¸åè°ƒçš„é—®é¢˜ï¼šå‰åç«¯å¯¹æ¥ä¸åè°ƒï¼Œå¼€å‘æ–°åŠŸèƒ½ä¸å®¡æ ¸ã€æµ‹è¯•ä¹‹é—´ä¸åè°ƒï¼Œæ²¡æœ‰æŒ‰æµ‹è¯•éœ€è¦çš„æ‹“æ‰‘é¡ºåºè¿›è¡Œå¼€å‘å¯¼è‡´å…ˆå¼€å‘çš„åŠŸèƒ½è¦ç­‰ç€åé¢çš„åŠŸèƒ½æ‰èƒ½æµ‹è¯•ï¼Œå¯¹å¼€å‘è®¡åˆ’è®¤è¯†ä¸ç»Ÿä¸€ï¼Œè¿˜æ²¡ä¿®å®Œå½“å‘¨è®¡åˆ’çš„é”…å°±å¼€å§‹å†™ä¹‹åçš„åŠŸèƒ½â€¦â€¦

æˆ‘æœ¬æ¥ä»¥ä¸ºåç«¯æ­èµ·åŸºæœ¬æ¡†æ¶ä¹‹åæˆ‘å°±ä¸ç”¨ç®¡äº†ï¼Œå¯ä»¥è®©é˜Ÿå‹è‡ªå·±æï¼Œç»“æœåˆ°äº†æœ€åæ‰å‘ç°å…¨æ˜¯é”…ã€‚è™½ç„¶é˜Ÿå‹æœ‰å„ç§å¥‡å¦™æ“ä½œï¼Œä½†ä¸å¾—ä¸è¯´å¾ˆå¤šéƒ½æ˜¯æˆ‘å¯ä»¥ææ—©å‘ç°æ¥é¿å…çš„ï¼Œè¿˜æœ‰å¾ˆå¤šæ˜¯æ²Ÿé€šä¸Šå‡ºäº†é—®é¢˜ï¼Œå¹¶ä¸”æˆ‘è‡ªå·±çš„æ´»ä¹Ÿå¹²å¾—æœ‰ç‚¹æ™šã€‚è¿™æ¯•ç«Ÿæ˜¯è½¯å·¥è€Œä¸æ˜¯å¤§å·ç¨‹è®¾è®­ç»ƒï¼Œåªèƒ½æ‰¿è®¤ï¼Œæˆ‘è½¯å·¥æ˜¯çœŸçš„èœï¼Œåšå¥½è§„åˆ’å®‰æ’ä»¥åŠä¸äººæ²Ÿé€šåä½œçš„åŸºæœ¬èƒ½åŠ›éå¸¸æ¬ ç¼ºã€‚

~~è¦æ˜¯æœ‰ä¸‡èƒ½çš„[å–µæ£®](https://zh.moegirl.org.cn/å®«æ£®è‘µ)æ¥åè°ƒå¤§å®¶çš„å¼€å‘è¿›åº¦å°±å¥½äº†~~ï¼›<span class="heimu">è½¯å·¥ä¸­çš„æ€»é›†ç¯‡ï¼šè¦æ˜¯éƒ¨ç½²æŒ‚äº†èµ¶ç´§æ¢ä¸€ä¸ªæ—§ç‰ˆé•œåƒï¼Œå¯ä»¥è¯´æ˜¯æ²¡å†™å®Œè€Œä¸æ˜¯éƒ¨ç½²æŒ‚äº†ï¼Œå°±å¯ä»¥åªæ‰£ 1 åˆ†è€Œä¸æ˜¯ 2 åˆ†äº†ã€‚</span> çªç„¶æƒ³åˆ°çš„ï¼Œä½†è¿™ä¹ˆä¸€æƒ³ï¼Œå¥½æƒ³åœ¨è½¯å·¥ç»“æŸåçš„æš‘å‡äºŒå‘¨ç›®ä¸€ä¸‹ç™½ç®±ï¼Œ~~ç°åœ¨å…ˆæ‹œä¸€æ‹œå–µæ£®å§ï¼ˆ~~

åªä¸è¿‡è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒPython å®åœ¨æ˜¯ï¼ŒçœŸçš„èƒ½æ¯” Rust å†™çš„å¿«å—ï¼ˆï¼Œè™½ç„¶çœ‹é˜Ÿå‹å†™äº†å¾ˆå¤šå¥‡å¦™é”™è¯¯ï¼Œä½†è¦æ˜¯æ²¡æœ‰ç±»å‹æ£€æŸ¥ä¹‹ç±»çš„ï¼ˆPython å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ£€æŸ¥ï¼Œä½†çœ‹èµ·æ¥é˜Ÿå‹å¹¶æ²¡æœ‰åšï¼‰æˆ‘å¤§æ¦‚ä¹Ÿèƒ½å†™å‡ºä¸å°‘ ğŸŒš

### å¤§ä½œä¸šç¬¬äº”å‘¨

#### Nuxt v3.3.3 èµ· nuxt-vitest æŠ¥é”™

[Nuxt v3.3.3 causes tests to fail (Unhandled Errors) Â· Issue #122 Â· danielroe/nuxt-vitest](https://github.com/danielroe/nuxt-vitest/issues/122)

æƒ³ç€å¤§ä¾‹ä¼šç»“æŸåæ˜¯å‡çº§ä¾èµ–çš„å¥½æ—¶æœºï¼Œç»“æœä¸€ bump æµ‹è¯•æŒ‚äº†ã€‚å» git bisect äº†ä¸€ä¸‹ Nuxtï¼ŒNuxt çš„æ„å»ºæ¯” Next è½»æ¾å¤šäº†ï¼Œåˆå¿«åˆä¸æŠ¥é”™ã€‚bisect å‡ºæ¥ä¹‹åæœ¬æ¥è¿˜åœ¨æƒ³æ²¡æ—¶é—´ä¹Ÿæ²¡å¤´ç»ªç»§ç»­ç ”ç©¶ä¸‹å»äº†ï¼Œè¿™ä¸ª issue ä¹Ÿå·²ç»ä¸€å‘¨äº†ï¼Œä¸çŸ¥é“ä½œè€…ä¼šä¸ä¼šç»§ç»­å’•ç€ã€‚ç»“æœæ™šä¸Šä¸€çœ‹ï¼Œè¢«ç‚¹äº†ä¸ªå¿ƒï¼Œå¼€äº†ä¸ª PRï¼Œå†ä¸€çœ‹ï¼ŒåŸæ¥ bisect å‡ºæ¥çš„é‚£ä¸ª PR å°±æ˜¯ nuxt-vitest çš„ä½œè€…å†™çš„ï¼Œæˆ‘éƒ½æ²¡å‘ç°ï¼ˆ

#### NSpace å†… key ä¼šå¤±æ•ˆ

[\`<n-space>\`](https://www.naiveui.com/zh-CN/os-theme/components/space) ä¼šç»™æ¯ä¸ª child å¥—ä¸€ä¸ª \`<div>\`ï¼Œäºæ˜¯ \`key\` éƒ½å¤±æ•ˆäº†ï¼Œå¦‚æœåœ¨ \`<n-space>\` é‡Œé¢ç”¨ \`v-for\` å°±å¯èƒ½ä¸åœåœ° remountï¼Œè°ƒäº†ä¸€æ™šä¸Šï¼ˆ

è¿™ä¸œè¥¿æ˜¯çœŸä¸å¦‚æ‰‹å†™ flexã€‚

#### å°ä¾‹ä¼š 3

æ¯”è¾ƒæ°´ï¼Œåªä¸è¿‡åŠ©æ•™è¯´ä»–å½“å¹´æäº†ä¸ªäº‘æœåŠ¡å™¨ï¼Œå‡ºé—®é¢˜äº†å°±æŠŠåä»£æ¢æˆäº‘æœåŠ¡å™¨ï¼Œæ„Ÿè§‰å¾ˆæœ‰é“ç†ï¼ˆ

### å¤§ä½œä¸šç¬¬å…­å‘¨

å¤§å®¶è¿™å‘¨éƒ½æ¯”è¾ƒæ‘†ï¼Œæˆ‘è¿˜å»ä¿®äº†ä¸å°‘åç«¯çš„é”…ã€‚å¤ªä¹…æ²¡ç®¡åç«¯ï¼Œå¯¹ä»£ç å¤ç”¨ã€æµ‹è¯•çš„å®Œå–„ç¨‹åº¦ã€QuerySet çš„ç¼–å†™ã€è¯·æ±‚å‚æ•°çš„æ ¡éªŒç­‰é—®é¢˜æ„Ÿåˆ°äº†ä¸€äº›éœ‡æƒŠï¼ˆï¼Œä½†ç¡®å®æ˜¯æ²¡åŠ›æ°”å»ä¿®ï¼ˆ

å“åº”å¼è®¾è®¡è¿˜ä½œä¸ºè‡ªé€‰éœ€æ±‚è¢«æäº†å‡ºæ¥ï¼Œè¦æ˜¯æ‰“ç®—åŠ è¿™ä¸ªéœ€æ±‚ä¸€å¼€å§‹ä¸å°±åº”è¯¥æœ‰å—ï¼Œè¿™ä¹Ÿä¸æ˜¯ä»€ä¹ˆéœ€è¦ç”±åŒå­¦æƒ³åˆ°çš„åŠŸèƒ½ï¼Œæˆ‘çœ‹éœ€æ±‚åˆ—è¡¨æ²¡æœ‰å°±é»˜è®¤ä¹Ÿä¸ä¼šä½œä¸ºè‡ªé€‰éœ€æ±‚äº†ï¼Œåˆšå¼€è¯¾çš„æ—¶å€™è¿˜æ‰¾åŠ©æ•™åæ§½æ²¡æœ‰å“åº”å¼åˆ†æ•°ã€‚å“åº”å¼è®¾è®¡è¦ mobile firstï¼Œèƒ½è¿™ä¹ˆæ™šåŠ å—ã€‚

åŠå¤§å®¶è¿˜æ˜¯åˆ«å¤ªä¿¡éœ€æ±‚åˆ—è¡¨ï¼Œè¯¥å·è¿˜å¾—å·ï¼Œè‡ªå·±æè‡ªé€‰éœ€æ±‚æ€»æ¯”å¿«ç»“æŸäº†è¢«åˆ«äººæå¼ºå¤ªå¤šã€‚

### å¤§ä½œä¸šç¬¬ 7\\~9 å‘¨

è‰ï¼Œæˆ‘æœ‰è½¯å·¥ï¼Œæ²¡æœ‰èƒ½åŠ åˆ†çš„è¯¾ï¼Œä¸ºä»€ä¹ˆè¦æ‰“æ™ºèƒ½ä½“ï¼ˆ

#### ã€ŠGIF å›¾ç‰‡æœç´¢ç½‘ç«™ã€‹

æ¥ç‚¹ PRJ2 ç¬‘è¯ï¼šGIF å›¾ç‰‡æœç´¢ç½‘ç«™ï¼Œæ¯ä¸ªé˜Ÿéƒ½æ˜¯æœ€åä¸¤ä¸‰å‘¨æ‰å¼€å§‹å†™æœç´¢åŠŸèƒ½ï¼ˆ

### å¤§ä½œä¸šåé¢å‡ å‘¨

æ²¡åŠ›æ°”å†™æ¸¸è®°äº†ï¼Œè¿™ä¸ªè¯¾å¿«ä»ä¸–ç•Œä¸Šæ¶ˆå¤±å§ï¼ˆ
`},{title:R,tags:i,content:`[DDPP5](https://wakerly.org/DDPP/) ç¬¬äº”ç«  â€œVerilog Hardware Description Languageâ€ çš„å­¦ä¹ ç¬”è®°ã€‚

ä¹Ÿå°±æ˜¯åˆå­¦ (System)Verilog çš„ç¬”è®°ã€‚



æœ¬æ¥æƒ³å¯’å‡å­¦ï¼Œç»“æœè¿˜æ˜¯æ‹–åˆ°äº†æ•°å­—é€»è¾‘å®éªŒå¼€å§‹ç”¨ FPGAï¼Œåªä¸è¿‡æ‰‹ä¸Šæœ‰æ¨¡å—äº†å†æ¥å­¦ä¹ŸæŒºå¥½çš„ã€‚

è™½ç„¶ä»åˆ›å»ºåˆ°å‘å¸ƒæ‹–äº†å¾ˆä¹…ï¼Œä½†å…¶å®å¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯æ–°å»ºæ–‡ä»¶åä¸€å‘¨å†…å†™çš„ï¼Œåªæ˜¯åæ¥æ„Ÿè§‰å­¦çš„ä¸œè¥¿å·²ç»å·®ä¸å¤šèƒ½åº”ä»˜ä¸Šè¯¾äº†ï¼Œå°±ä¸€ç›´å’•ç€æ²¡æŠŠæœ€åä¸€ç‚¹å­¦å®Œ & å†™å®Œï¼ˆ

<Card title="SystemVerilog" type="info">

DDPP5 ä¸­è®²çš„æ˜¯ Verilog è€Œä¸æ˜¯ SystemVerilogï¼Œæˆ‘æ ¹æ®åœ¨å…¶ä»–åœ°æ–¹æ‰¾åˆ°çš„ä¸€äº›èµ„æ–™è¡¥å……äº†å°‘é‡ SystemVerilog çš„å†…å®¹ã€‚

</Card>

## neovim é…ç½®

ç”¨çš„æ˜¯è€å¸ˆæ¨èçš„ Vivado 2019.2 WebPackï¼Œè€Œå®ƒè‡ªå¸¦çš„æ–‡æœ¬ç¼–è¾‘å™¨å¤šå°‘æœ‰ç‚¹æ‹‰èƒ¯ï¼Œæ‰€ä»¥ç ”ç©¶äº†ä¸€ä¸‹é… neovimã€‚

æœ€åé€‰æ‹©çš„æ˜¯ [veridian](https://github.com/vivekmalneedi/veridian) + é€šè¿‡ [null-ls](https://github.com/jose-elias-alvarez/null-ls.nvim) ä½¿ç”¨ Vivado çš„ \`xvlog\`ã€‚ä¸€å¼€å§‹æˆ‘è¿˜çœ‹ veridian æ²¡åœ¨ç»´æŠ¤è€Œä¸” star å°‘ï¼ˆ~~ä½†å®ƒå¥½æ­¹æœ€åæ›´æ–°æ˜¯åœ¨ 2021ï¼ŒVivado è¿˜åœ¨ç”¨ 2019~~ï¼‰ï¼Œå…ˆè¯•äº†å¦å¤–å‡ ä¸ªï¼Œåæ¥å‘ç°ï¼Œä¸è¯´åˆ«çš„ï¼Œåªæœ‰ veridian æ”¯æŒ hoverã€‚åŒæ—¶ä½¿ç”¨ \`xvlog\` æ˜¯è§‰å¾—è¿˜æ˜¯ Vivado è‡ªå¸¦çš„ lint æ¯”è¾ƒé è°±ã€‚

veridian å°±æ˜¯ç”¨ [lspconfig](https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#veridian)ï¼Œè®°å¾—åŒæ—¶è£… [verible](https://github.com/chipsalliance/verible) æ‰èƒ½ä½¿ç”¨æŸäº› featureï¼ˆåœ¨ lspconfig é‡Œåªéœ€å¯ç”¨ veridianï¼‰ã€‚å¯ä»¥æŠŠ \`root_dir\` è®¾ä¸º \`util.root_pattern('*.xpr', '.git')\` æ¥æ£€æµ‹ Vivado é¡¹ç›®çš„æ ¹ç›®å½•ã€‚

null-ls çš„é…ç½®å¦‚ä¸‹ï¼Œå› ä¸º \`xvlog\` å®é™…ä¸Šæ˜¯ä¸€ä¸ªä¸èƒ½ç¦ç”¨æ–‡ä»¶è¾“å‡ºçš„ simulatorï¼Œé‡‡å–äº†ä¸€äº›æªæ–½æ¥é˜²æ­¢å®ƒåˆ°å¤„å€’åƒåœ¾ã€‚

\`\`\`lua
local null_ls = require "null-ls"
local utils = require "null-ls.utils"
local helpers = require "null-ls.helpers"

local xvlog_sv = {
  name = "xvlog",
  method = null_ls.methods.DIAGNOSTICS,
  filetypes = { "systemverilog" },
  generator = null_ls.generator {
    command = "bwrap", -- only permit writing in /tmp
    args = {
      "--ro-bind", "/", "/",
      "--bind", "/tmp/xvlog", "/tmp/xvlog",
      "--dev", "/dev",
      "/home/ouuan/Xilinx/Vivado/2019.2/bin/xvlog",
      "--sv", "$FILENAME",
    },
    cwd = function(params)
      -- output in /tmp
      local dir = '/tmp/xvlog/' .. params.bufnr
      vim.fn.mkdir(dir, 'p')
      return dir
    end,
    to_temp_file = true,
    format = "line",
    check_exit_code = { 0, 1 },
    on_output = helpers.diagnostics.from_patterns {
      {
        pattern = '(.+): %[.+%] (.+) %[.+:(%d+)%]',
        groups = { "severity", "message", "row" },
        overrides = {
          severities = {
            ["ERROR"] = 1,
            ["WARNING"] = 2,
            ["INFO"] = 3,
          },
        },
      },
    },
  },
}

null_ls.setup {
  sources = {
    xvlog_sv,
  },
  root_dir = utils.root_pattern("*.xpr", ".git")
}
\`\`\`

å¦å¤–å¯ä»¥ç”¨ [vim-xdc-syntax](https://github.com/amal-khailtash/vim-xdc-syntax) æ·»åŠ ç®¡è„šçº¦æŸæ–‡ä»¶çš„é«˜äº®ã€‚

Vivado çš„ custom text editor ä½¿ç”¨ä¸‹é¢çš„è„šæœ¬ã€‚æ˜¯é’ˆå¯¹ [i3](https://i3wm.org/) é…çš„ï¼Œç»™ konsole è®¾äº† name å‚æ•°ï¼Œi3 è®¾æˆ \`assign [instance="konsole"]\`ï¼ˆ\`instance\` è€Œé \`class\`ï¼‰å°±å¯ä»¥ä¸æŠŠè¿™ä¸ª konsole æŒªåˆ°å…¶ä»– konsole æ‰€åœ¨çš„ workspaceï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ‰“å¼€æ–°æ–‡ä»¶æ—¶ focus è¿‡å»ã€‚

\`\`\`bash
#!/bin/bash

# vivado-nvim.sh "[file name]" [line number]

set -euo pipefail

unset LD_LIBRARY_PATH

NVIM_LISTEN_ADDRESS=/tmp/vivado-nvim.pipe

if [[ ! -e $NVIM_LISTEN_ADDRESS ]]; then
    exec konsole --name "vivado-nvim" -e nvim --listen $NVIM_LISTEN_ADDRESS "$1" "+$2"
else
    nvim --server $NVIM_LISTEN_ADDRESS --remote "$1"
    nvim --server $NVIM_LISTEN_ADDRESS --remote-send ":$2<CR>"
    i3-msg '[instance="vivado-nvim"] focus'
fi
\`\`\`

## åŸºç¡€è¯­æ³•

### module

Verilog ä»¥ module ä¸ºåŸºæœ¬å•ä½ï¼ˆå’Œå‰ç«¯çš„ component æœ‰ç‚¹ç±»ä¼¼ï¼‰ã€‚

ä¾‹å­ï¼š

\`\`\`system-verilog
module inhibit (
    input  in,
    input  invin,
    output out
);
  assign out = in & ~invin;
endmodule
\`\`\`

convention æ˜¯æ¯ä¸ªæ–‡ä»¶åªå†™ä¸€ä¸ª moduleã€‚

### signal (net & variable)

ä¸€ä¸ª 1-bit çš„ signal æœ‰å››ç§å–å€¼ï¼š0ã€1ã€xï¼ˆæœªçŸ¥ï¼‰ã€zï¼ˆé«˜é˜»æŠ—ï¼‰ã€‚

ä½è¿ç®—ï¼š\`&\`ã€\`|\`ã€\`~\`ã€\`^\`ã€\`~^\`/\`^~\`ã€‚

signal æœ‰ä¸¤å¤§ç±»ï¼š*net* å’Œ *variable*ï¼š

-   net è¡¨ç¤ºçº¿è·¯ï¼Œä¸€èˆ¬æ˜¯ \`wire\`ï¼Œè¿˜å¯ä»¥æ˜¯ \`supply0\`ã€\`supply1\` ç­‰ï¼ˆæˆ‘ç”¨ \`supply1\` çš„æ—¶å€™å‡ºç°äº†ç¥ç§˜çš„é—®é¢˜ï¼Œæ²¡ç»†ç©¶ï¼Œåæ­£ç”¨æ’ä¸º 1 çš„ \`logic\` ä¹Ÿå·®ä¸å¤šï¼‰ã€‚
-   variable ç”¨äº procedural statement ä¸­ï¼Œä¸ä¸€å®šå¯¹åº”åˆ°ç‰©ç†ä¸Šçš„çº¿è·¯ï¼Œå¯ä»¥æ˜¯ \`reg\` æˆ–è€… \`integer\`ã€‚å…¶ä¸­ \`reg\` å°±æ˜¯å˜é‡çš„æ„æ€ï¼ˆåå­—å–å¾—ä¸å¤ªå¥½ï¼‰ï¼Œè¡¨ç¤ºå•ä¸ª bit æˆ–è€… vectorï¼Œä¸åŸºäº flip-flop çš„å¯„å­˜å™¨æ— å…³ã€‚\`integer\` æ˜¯æœ‰ç¬¦å·æ•´å‹ï¼Œä¸€èˆ¬ä¸ç”¨æ¥å­˜å‚¨æ•°æ®æˆ–ä¿¡å·ï¼Œè€Œæ˜¯ç”¨äº for å¾ªç¯ä¹‹ç±»çš„åœ°æ–¹ã€‚

input åªèƒ½æ˜¯ netï¼Œè€Œ output å¯ä»¥æ˜¯ net æˆ– \`reg\`ã€‚ä¸å†™ \`wire\` / \`reg\` æ—¶é»˜è®¤æ˜¯ \`wire\`ã€‚

åœ¨ SystemVerilog ä¸­æ¨èç”¨ \`logic\` æ¥ä»£æ›¿ \`reg\`ã€‚

### æ•°å­—å­—é¢é‡ & parameter

ç›´æ¥å†™åè¿›åˆ¶æ•°ä¼šå¾—åˆ°ä¸€ä¸ª signed numberã€‚

å¯ä»¥æŒ‡å®šä½æ•°å’Œè¿›åˆ¶ï¼š\`1'b0\` æ˜¯ 1 bit çš„ 0ï¼Œ\`4'ha\` æ˜¯ 4 bit çš„ 10ï¼ˆåå…­è¿›åˆ¶çš„ Aï¼‰ï¼Œ\`8'b01x0z1x1\` çš„ä¸€äº› bit æ˜¯æœªçŸ¥ / é«˜é˜»æŠ—ã€‚å¦‚æœåé¢å†™çš„å€¼çš„ä½æ•°è¶…è¿‡å‰é¢æŒ‡å®šçš„ä½æ•°ï¼Œé«˜ä½ä¼šè¢«æ‰”æ‰ï¼Œå¦‚æœå°‘äº†åˆ™ä¼šé«˜ä½è¡¥é›¶ï¼ˆæˆ–è€…è¡¥ \`x\` æˆ– \`z\`ï¼Œå¦‚æœæœ€é«˜ä½æ˜¯ \`x\` æˆ– \`z\`ï¼‰ã€‚è¿™æ ·å¾—åˆ°çš„ä¼šæ˜¯ä¸€ä¸ª unsigned vectorï¼Œå¯ä»¥åŠ ä¸Š \`s\` å¾—åˆ° signed vectorï¼š\`4'sb1101\`ã€‚

\`parameter\` ç”¨æ¥è®¾ç½®å¸¦é»˜è®¤å€¼çš„å‚æ•°ï¼š\`parameter SIZE = 32, MSB = SIZE - 1, LSB = 0\`ï¼Œ\`parameter ESC = 7'h1b\`ã€‚ \`parameter\` ä¸€èˆ¬ç”¨ä½œå¸¸é‡ï¼Œè€Œåœ¨ [instance statement](#structural-model) ä¸­å¯ä»¥è¢«ä¿®æ”¹ã€‚

### vector & ç®—æœ¯è¿ç®—

å¤šä¸ª bit å¯ä»¥ç»„æˆä¸€ä¸ª vectorï¼Œnetã€\`reg\`ã€\`parameter\` éƒ½å¯ä»¥æ˜¯ vectorã€‚

vector çš„ä¸‹æ ‡å¯ä»¥æ˜¯å·¦è¾¹ï¼ˆMSBï¼‰å¤§ï¼ˆ\`reg [7:0] byte1, byte2\`ï¼‰ä¹Ÿå¯ä»¥æ˜¯å³è¾¹ï¼ˆLSBï¼‰å¤§ï¼ˆ\`reg [1:16] bus\`ï¼‰ï¼Œèµ·æ­¢çš„ä¸‹æ ‡éƒ½å¯ä»¥æŒ‡å®šã€‚å·¦è¾¹çš„ä¸‹æ ‡å¯¹åº”å­—é¢é‡ä¸­å·¦è¾¹çš„ bitã€‚\`byte1[7]\` æ˜¯ \`byte1\` æœ€å·¦è¾¹çš„ bitï¼Œ\`bus[16]\` æ˜¯ \`bus\` æœ€å³è¾¹çš„ bitã€‚\`bus[1:8]\` å’Œ \`bus[9:16]\` æ˜¯ \`bus\` çš„å·¦å³ä¸¤è¾¹ã€‚è¯»å–è¶Šç•Œä¼šè¯»åˆ° \`x\`ï¼Œå†™å…¥ä¼šå¿½ç•¥è¶Šç•Œçš„éƒ¨åˆ†ã€‚

\`{}\` ç”¨æ¥è¿æ¥ vectorï¼Œä¾‹å¦‚ \`{2'b10, 2'b01}\` ç­‰äº \`4'b1001\`ï¼Œ\`{2{byte1}, 2{byte2}}\` ç­‰äº \`{byte1, byte1, byte2, byte2}\`ã€‚

vector å¯ä»¥æŒ‰ä½è¿›è¡Œä½è¿ç®—ï¼Œåœ¨äºŒå…ƒè¿ç®—ä¸­çŸ­çš„ä¼šé«˜ä½è¡¥é›¶åè¿›è¡Œè¿ç®—ã€‚

äºŒå…ƒä½è¿ç®—ç¬¦ä¹Ÿæœ‰ä¸€å…ƒçš„ç‰ˆæœ¬ï¼Œè¡¨ç¤ºå°† vector å†…æ‰€æœ‰ bit è¿ç®—åœ¨ä¸€èµ·å¾—åˆ° 1-bit çš„ç»“æœï¼Œä¾‹å¦‚ \`&byte1\` æ˜¯ \`1'b1\` è¡¨ç¤º \`byte1\` çš„æ‰€æœ‰ bit éƒ½æ˜¯ 1ã€‚

vector ä¹‹é—´è¿›è¡Œèµ‹å€¼æ—¶ä¼šæˆªä½ä½æˆ–é«˜ä½è¡¥é›¶ã€‚

vector ä¹‹é—´å¯ä»¥è¿›è¡Œç®—æœ¯ï¼š\`+\`ã€\`-\`ã€\`*\`ã€\`/\`ã€\`%\`ã€\`**\`ã€\`<<\`ã€\`>>\`ã€\`<<<\`ï¼ˆç®—æœ¯å·¦ç§»ï¼‰ã€\`>>>\`ï¼ˆç®—æœ¯å³ç§»ï¼‰ã€‚

ç®—æœ¯çš„é«˜ä½å’Œä½ä½åŸºäºå·¦å³è€Œä¸ä¸‹æ ‡å¤§å°æ— å…³ã€‚

é™¤æ³•å’Œå–æ¨¡åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸ synthesizableï¼Œé™¤éé™¤æ•°æ˜¯ 2 çš„æ¬¡å¹‚ã€‚synthesizable æ—¶ä¹Ÿå¯èƒ½ä¼šç”Ÿæˆé™¤æ³•å™¨çš„ç”µè·¯è€Œéå¸¸æ˜‚è´µã€‚

é€»è¾‘ç§»ä½å¾—åˆ° unsignedï¼Œç®—æœ¯ç§»ä½ä¿æŒåŸæ¥çš„ signed/unsignedï¼Œç®—æœ¯å³ç§»é«˜ä½è¡¥ç¬¦å·ä½ã€‚äºŒå…ƒç®—æœ¯ä¸­åªè¦æœ‰ä¸€ä¸ªæ˜¯ unsigned å°±ä¼šå°†å¦ä¸€ä¸ªè½¬æˆ unsigned å†è®¡ç®—ã€‚signal å¯ä»¥å£°æ˜ä¸º signedï¼š\`reg signed [15:0] a\`ã€‚

### array

array æ˜¯ç›¸åŒç±»å‹çš„ä¸€åˆ—ä¸œè¥¿ï¼ˆä¸€åˆ— \`reg\`ã€\`integer\`ã€\`wire\` ç­‰ï¼‰ã€‚array ä¹Ÿå¯ä»¥æŒ‡å®šä¸‹æ ‡èŒƒå›´ï¼Œè€Œä¸ vector ç›¸åï¼Œå£°æ˜ array æ—¶æ¡†æ”¾åœ¨å³è¾¹ï¼Œä¾‹å¦‚ \`reg [7:0] byte1, mem1[0:255]\` è¡¨ç¤ºä¸€ä¸ª 8-bit \`reg\` å’Œä¸€ä¸ªç”± 256 ä¸ª 8-bit \`reg\` ç»„æˆçš„ arrayã€‚

array å¯ä»¥åµŒå¥—ä¸ºé«˜ç»´æ•°ç»„ï¼Œè€Œè®¿é—®åªèƒ½è®¿é—®å•ä¸ªä¸‹æ ‡ï¼Œä¸èƒ½åƒ vector ä¸€æ ·ä¸€ä¸‹è®¿é—®ä¸€ä¸ªåŒºé—´ã€‚æ€»ä¹‹é™¤äº†èƒ½æŒ‡å®šä¸‹æ ‡èŒƒå›´éƒ½å’Œ C çš„æ•°ç»„å·®ä¸å¤šã€‚

### é€»è¾‘è¿ç®—

å« \`x\` / \`z\` æˆ–è€…å…¨ 0 çš„ vectorï¼ˆæˆ–è€… \`1'b0\`ï¼‰æ˜¯ falseï¼Œä¸å« \`x\` / \`z\` ä¸”å« 1 çš„ vectorï¼ˆæˆ–è€… \`1'b1\`ï¼‰æ˜¯ trueã€‚false çš„å€¼æ˜¯ \`1'b0\`ï¼Œtrue çš„å€¼æ˜¯ \`1'b1\`ã€‚

é€»è¾‘è¿ç®—ç¬¦å’Œæ¯”è¾ƒè¿ç®—ç¬¦å’Œ C æ˜¯ä¸€æ ·çš„ã€‚æ¯”è¾ƒæ—¶å¦‚æœä¸€ä¾§æ˜¯ unsigned åˆ™ä¼šæŒ‰ unsigned æ¯”è¾ƒã€‚æ¯”è¾ƒè¿ç®—åœ¨ç”µè·¯ä¸­å¯èƒ½éœ€è¦æ¯”è¾ƒå™¨ï¼ˆå°¤å…¶æ˜¯ä¸¤ä¾§éƒ½ä¸æ˜¯å¸¸é‡æ—¶ï¼‰ï¼Œæ‰€ä»¥å¯èƒ½æ˜¯æ˜‚è´µçš„ã€‚

ä¸‰ç›®è¿ç®—ç¬¦ \`?:\` å’Œ C æ˜¯ä¸€æ ·çš„ã€‚

åœ¨ test bench ä¸­ï¼Œå¸¦ \`x\` / \`z\` çš„å€¼åœ¨æ¯”è¾ƒæ—¶ç»“æœä¸º \`x\`ï¼ˆç”¨åœ¨æ¡ä»¶åˆ¤æ–­æ—¶å³ä¸º falseï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ \`===\` / \`!==\` æ¥é€ä½æ¯”è¾ƒï¼ˆ\`x === x\`, \`z === z\`ï¼‰ï¼Œä½†å®ƒä»¬ä¸èƒ½ç”¨åœ¨ synthesizable module ä¸­ã€‚

### compiler directives

\`\`\` \`include \`\`\` å’Œ \`\`\` \`define \`\`\`ï¼Œå’Œ C æ˜¯ä¸€æ ·çš„ã€‚

## model

### structural model

å¯ä»¥ä½¿ç”¨ *instance statement* æ¥å†™ structural modelï¼Œè¯´ç™½äº†å°±æ˜¯å°†å…¶ä»– module å®ä¾‹åŒ–å¹¶è¿çº¿ã€‚

built-in gate æœ‰ï¼š

-   \`and\`ã€\`nand\`ã€\`or\`ã€\`nor\`ã€\`xor\`ã€\`xnor\`ï¼Œæ¥å—ä»»æ„ä¸ªè¾“å…¥
-   \`buf\`ã€\`not\`ï¼Œæ¥å—å•ä¸ªè¾“å…¥
-   \`bufif0\`ã€\`bufif1\`ã€\`notif0\`ã€\`notif1\`ï¼Œä¸‰æ€é—¨ï¼Œæ¥å—ä¸€ä¸ª data input å’Œä¸€ä¸ª enable inputï¼ˆdata input åœ¨å‰ï¼Œenable input åœ¨åï¼‰ï¼Œif è¡¨ç¤º enable çš„ active level

ä½¿ç”¨ built-in gate çš„ä¾‹å­ï¼šï¼ˆbuilt-in gate çš„ port æ²¡æœ‰åå­—ï¼Œåªèƒ½é€šè¿‡é¡ºåºæŒ‡å®šï¼Œoutput åœ¨å‰ï¼‰

\`\`\`system-verilog
module inhibit (
    input  in,
    input  invin,
    output out
);
  wire notinvin;
  not U1 (notinvin, invin);
  and U2 (out, in, notinvin);
endmodule
\`\`\`

ä½¿ç”¨å…¶ä»– module çš„ä¾‹å­ï¼šï¼ˆå¯ä»¥æŒ‡å®šæ¯ä¸ª port çš„åå­—ä»è€Œä¸ä¾èµ–äºé¡ºåºï¼‰

\`\`\`system-verilog
module silly_xor (
    input  in1,
    input in2,
    output out
);
  wire inh1, inh2, notinh2, notout;
  inhibit U1 (
      .out(inh1),
      .in(in1),
      .invin(in2)
  );
  inhibit U2 (
      .out(inh2),
      .in(in2),
      .invin(in1)
  );
  not U3 (notinh2, inh2);
  inhibit U4 (
      .out(notout),
      .in(notinh2),
      .invin(inh1)
  );
  not U5 (out, notout);
endmodule
\`\`\`

ä¿®æ”¹ \`parameter\` çš„ä¾‹å­ï¼š

\`\`\`system-verilog
module maj #(
    WID = 1
) (
    output [WID-1:0] out,
    input  [WID-1:0] i0,
    input  [WID-1:0] i1,
    input  [WID-1:0] i2
);
  assign out = i0 & i1 | i0 & i2 | i1 & i2;
endmodule
\`\`\`

ç„¶åå°±å¯ä»¥ \`maj #(8) U1 (.out(W), .i0(X), .i1(Y), .i2(Z))\` æˆ–è€… \`maj #(.WID(8)) U1 (.out(W), .i0(X), .i1(Y), .i2(Z))\` äº†ã€‚

ä¸æŒ‡å®š \`parameter\` æ—¶ä¼šä½¿ç”¨å…¶é»˜è®¤å€¼ï¼Œ\`parameter\` åªèƒ½åœ¨ instance statement ä¹Ÿå°±æ˜¯ structural model ä¸­è¢«ä¿®æ”¹ï¼Œåœ¨å…¶ä»–ç±»å‹çš„ model ä¸­åªèƒ½ä½¿ç”¨é»˜è®¤å€¼ã€‚

å¯ä»¥ä½¿ç”¨ \`generate\` blockï¼Œä½œç”¨ç±»ä¼¼äº \`v-for\`ã€\`v-if\`ï¼Œé‡Œé¢å¯ä»¥ç”¨ \`for\`ï¼ˆå¾ªç¯å˜é‡éœ€è¦æ˜¯ \`genvar\`ï¼‰ã€\`if\`ã€\`case\`ï¼ˆè¢«åˆ¤æ–­çš„è¦æ˜¯ parameterï¼‰ï¼Œä¾‹å¦‚ï¼š

\`\`\`system-verilog
genvar i;
generate
  for (i = 0; i < N; i = i + 1) begin
    half_adder u0 (a[i], b[i], sum[i], cout[i]);
  end
endgenerate
\`\`\`

### dataflow model

å¯ä»¥ä½¿ç”¨ *continuous-assignment statement* æ¥å†™ dataflow modelï¼Œä¹Ÿå°±æ˜¯ \`assign\`ï¼Œä¾‹å¦‚ï¼š

\`\`\`system-verilog
module is_prime (
    input [3:0] N,
    output F
);
  assign F = N[3] ? (N[0] & (N[1] ^ N[2])) : (N[0] | (~N[2] & N[1]));
endmodule
\`\`\`

### behavioral model

#### \`always\` & \`begin\`-\`end\` block

\`always\` statement ç”¨æ¥æ‰§è¡Œä¸€å¥ procedural statementï¼Œbegin-end block ç”¨æ¥å°†è‹¥å¹² procedural statement åˆæˆä¸€å¥ã€‚begin-end block é‡Œçš„è¯­å¥æ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œè€Œ \`always\` æ˜¯å’Œ module ä¸­çš„å…¶ä»–è¯­å¥ä¸€èµ·å¹¶è¡Œæ‰§è¡Œçš„ã€‚

åœ¨ SystemVerilog ä¸­ï¼Œæ¨èä½¿ç”¨ \`always_comb\`ã€\`always_ff\`ã€\`always_latch\` æ¥ä»£æ›¿ \`always\`ï¼Œåˆ†åˆ«ç”¨äºç»„åˆé€»è¾‘ã€ff å’Œ latchï¼ˆä½†ä¸€èˆ¬ä¸ä¼šç‰¹æ„å»å†™ latchï¼‰ã€‚\`always_comb\` ä¼šæ£€æŸ¥æ¡ä»¶åˆ¤æ–­è¯­å¥æ²¡æœ‰æ¼æƒ…å†µï¼Œé¿å…æ„å¤–ç”Ÿæˆ latchã€‚\`always_ff\` éœ€è¦åŠ å½¢å¦‚ \`always_ff @(posedge clk)\` çš„ sensitivity listã€‚

å¦‚æœ begin-end é‡Œæœ‰ local \`logic\` åˆ™éœ€è¦ç»™ block èµ·åå­—ï¼ˆåœ¨ \`begin\` çš„åé¢å†™ä¸Š \`: name\`ï¼‰æ‰èƒ½åœ¨ simulation ä¹‹ç±»çš„åœ°æ–¹çœ‹åˆ°å¯è¯»çš„å˜é‡åã€‚

\`\`\`system-verilog
module alarm_circuit (
    input panic,
    input enable,
    input exiting,
    input window,
    input door,
    input garage,
    output logic alarm
);
  always_comb begin : blk
    logic secure;
    secure = window & door & garage;
    alarm  = panic | (enable & ~exiting & ~secure);
  end
endmodule
\`\`\`

#### èµ‹å€¼

procedural statement ä¸­æœ‰ä¸¤ç§èµ‹å€¼ï¼Œblocking çš„ \`=\` å’Œ non-blocking çš„ \`<=\`ã€‚\`=\` è¡¨ç¤ºç«‹å³èµ‹å€¼ï¼Œè€Œ \`<=\` ä¼šå°†èµ‹å€¼æ¨è¿Ÿè‡³æ•´ä¸ª \`always\` çš„ç»“å°¾ï¼ˆå³ä¾§è¡¨è¾¾å¼çš„è®¡ç®—æ˜¯ç«‹åˆ»è¿›è¡Œçš„ï¼‰ï¼Œä»è€Œåœ¨ \`always\` å‰©ä¸‹çš„éƒ¨åˆ†ä¸­å·¦ä¾§å˜é‡çš„å€¼ä¾ç„¶æ˜¯èµ‹å€¼å‰çš„ã€‚

èµ‹å€¼æœ€å¥½éµå¾ªä¸‹é¢çš„è§„åˆ™ï¼š

-   åœ¨ç»„åˆé€»è¾‘ä¸­ï¼Œåªä½¿ç”¨ \`=\`
-   åœ¨æ—¶åºé€»è¾‘ä¸­ï¼Œåªä½¿ç”¨ \`<=\`
-   ä¸è¦åœ¨åŒä¸€ä¸ª block ä¸­æ··åˆä½¿ç”¨ä¸¤ç§èµ‹å€¼
-   ä¸è¦åœ¨ä¸åŒçš„ \`always\` ä¸­å¯¹åŒä¸€ä¸ªå˜é‡èµ‹å€¼

#### \`if\`-\`else\` è¯­å¥

å’Œ C çš„è¯­æ³•æ˜¯ä¸€æ ·çš„ï¼Œå”¯ä¸€çš„ä¸åŒå°±æ˜¯å¤§æ‹¬å·å˜æˆ \`begin\` - \`end\`ã€‚

#### \`case\` è¯­å¥

\`\`\`system-verilog
module prime (
    input [3:0] n,
    output logic f
);
  always_comb
    case (n)
      4'd2, 4'd3, 4'd5, 4'd7, 4'd11, 4'd13: f = 1;
      default: f = 0;
    endcase
endmodule
\`\`\`

è™½ç„¶å¹¶éå¿…é¡»ï¼Œä½†ä¸€èˆ¬æ¥è¯´ï¼Œé€‰é¡¹åº”å½“æ˜¯ä¸é‡å¤ä¸”æŒ‡å®šäº†å®½åº¦çš„å­—é¢é‡ã€‚

å³ä½¿é€‰é¡¹è¦†ç›–äº†æ‰€æœ‰å¯èƒ½ï¼ŒåŠ ä¸Šä¸€ä¸ª \`default\` å¯ä»¥åœ¨ simulation ä¸­æ­£ç¡®å¤„ç†å¸¦ \`x\` çš„å€¼ã€‚

\`casez\` æ˜¯å…è®¸ä½¿ç”¨é€šé…ç¬¦ \`?\` çš„åŒ¹é…ï¼Œä¾‹å¦‚é€‰é¡¹å¯ä»¥æ˜¯ \`4'b10??\`ã€‚

#### å¾ªç¯è¯­å¥

æœ‰å¾ˆå¤šç§å¾ªç¯è¯­å¥ï¼Œä½†æ¨èä½¿ç”¨çš„åªæœ‰ä¸€ç§ï¼Œå°±æ˜¯ \`for (integer i = 0; i <= 7; i = i + 1)\`ã€‚

#### function å’Œ task

function å’Œ task æ˜¯ä¸€æ®µå¯å¤ç”¨çš„ procedural statementï¼Œå†™èµ·æ¥å’Œ module å·®ä¸å¤šï¼Œéœ€è¦å®šä¹‰åœ¨ module å†…éƒ¨ï¼ˆå¯ä»¥é€šè¿‡ \`\`\` \`include \`\`\` æ¥åœ¨ä¸åŒ module ä¸­å¤ç”¨ï¼‰ã€‚

function æœ‰å•ä¸ªè¿”å›å€¼ï¼ˆå¯ä»¥åœ¨å‡½æ•°åçš„å‰é¢ç»™è¿”å›å€¼è®¾ç½®ç±»å‹ï¼Œä¹Ÿå¯ä»¥çœç•¥ï¼Œé»˜è®¤ç±»å‹æ˜¯ 1-bitï¼‰ï¼Œä½†ä¸èƒ½æœ‰ \`output\` / \`inout\` portï¼Œè€Œæ˜¯ä»¥ function è‡ªèº«çš„åå­—ä½œä¸ºè¿”å›å€¼çš„åå­—ï¼Œä»£ç ä¸­éœ€è¦å¯¹è¿™ä¸ªå‡½æ•°åè¿›è¡Œèµ‹å€¼ã€‚function ä¸­ä¸èƒ½è®¾ç½®å»¶æ—¶ã€‚

\`\`\`system-verilog
module sillier_xor (
    input in1,
    input in2,
    output logic out
);
  function inhibit(input in, input inv_in);
    inhibit = in & ~inv_in;
  endfunction

  always_comb begin
    logic inh1, inh2;
    inh1 = inhibit(in1, in2);
    inh2 = inhibit(in2, in1);
    out  = ~inhibit(~inh2, inh1);
  end
endmodule
\`\`\`

task æ²¡æœ‰è¿”å›å€¼ï¼Œä½†å¯ä»¥æœ‰ \`output\` / \`inout\` portï¼Œï¼ˆç”¨äº simulation æ—¶ï¼‰å¯ä»¥è®¾ç½®å»¶æ—¶ã€‚

\`\`\`system-verilog
module lock_sim;

  ...

  task clock();
    #500;
    clk = 1;
    #500;
    clk = 0;
  endtask

  ...

endmodule
\`\`\`

æœ‰ä¸€äº›å†…ç½®çš„ task å’Œ functionï¼Œç”¨äº simulationï¼š

-   \`$write\`ï¼šå’Œ \`printf\` å·®ä¸å¤šã€‚
-   \`$display\`ï¼šåœ¨ \`$write\` çš„åŸºç¡€ä¸Šå¤šä¸ªæ¢è¡Œã€‚
-   \`$monitor\`ï¼šæ¯æ¬¡ä¿¡å·å‘ç”Ÿæ”¹å˜æ—¶éƒ½è¾“å‡ºï¼ŒåæŒ‡å®šçš„ monitor ä¼šè¦†ç›–ä¹‹å‰çš„ã€‚
-   \`$monitoroff\` / \`$monitoron\`
-   \`$fflush\`ï¼šflush è¾“å‡ºã€‚
-   \`$time\`ï¼šè¾“å‡ºå½“å‰çš„ simulated timeã€‚
-   \`$random\`ï¼šè¿”å›ä¸€ä¸ªéšæœºæ•°ï¼Œæ¥å—ç§å­ä½œä¸ºå‚æ•°ï¼Œä¸æŒ‡å®šç§å­çš„è¯åˆæ¬¡è¿è¡Œçš„ç§å­æ˜¯å›ºå®šçš„ã€‚
-   \`$stop\`ï¼šåœæ­¢æ¨¡æ‹Ÿï¼Œå¦‚æœä¼ å‚ \`(1)\` åˆ™ä¼šæ˜¾ç¤ºå½“å‰çš„ simulated time å’Œä»£ç ä½ç½®ã€‚

## timescale & æŒ‡å®šå»¶è¿Ÿ

\`\`\` \`timescale 1ns / 10ps \`\`\` æŒ‡å®šä»¥ 1ns ä½œä¸ºå»¶æ—¶çš„å•ä½ï¼Œä»¥ 10ps ä½œä¸ºæ¨¡æ‹Ÿçš„ç²¾åº¦ã€‚

\`assign\` æ—¶å¯ä»¥æŒ‡å®šå»¶è¿Ÿï¼š\`assign #5 a = b & c;\`

procedural model ä¸­å¯ä»¥ç”¨ delay statement (\`#500;\`) æ¥æš‚åœã€‚

## simulation (test bench)

è¯­æ³•ä¸Šå’Œ synthesizable module æ²¡æœ‰åŒºåˆ«ï¼ˆåªä¸è¿‡æœ‰ä¸ª \`initial\`ï¼Œå°±æ˜¯åªæ‰§è¡Œä¸€éçš„ \`always\`ï¼Œä¸€èˆ¬ä¸ç”¨äº synthesizable moduleï¼‰ã€‚å†™èµ·æ¥ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ²¡æœ‰è¾“å…¥è¾“å‡ºã€æœ‰ä¸€ä¸ªè¢«æµ‹è¯• module çš„å®ä¾‹ã€æœ‰ä¸€ä¸ª \`initial\` block çš„ moduleï¼Œçœ‹çœ‹ä¾‹å­å°±è¡Œã€‚

æ‡’å¾—æ”¹ DDPP ä¸Šçš„ä»£ç äº†ï¼Œç›´æ¥å¤åˆ¶ä¸€ä»½æ•°å­—é€»è¾‘å®éªŒçš„ä»£ç ï¼ˆ

\`\`\`system-verilog
\`timescale 1ns / 1ps

module lock_sim;
  logic clk = 0;
  logic rst = 0;
  logic mode = 1;
  logic [3:0] digit_input = 0;
  wire unlocked, incorrect, alert;

  lock #(
      .ADMIN_PASSWORD(16'ha73f)
  ) lock_inst (
      .clk(clk),
      .rst(rst),
      .mode(mode),
      .digit_input(digit_input),
      .unlocked(unlocked),
      .incorrect(incorrect),
      .alert(alert)
  );

  task clock();
    #500;
    clk = 1;
    #500;
    clk = 0;
  endtask

  task reset();
    rst = 1;
    #500;
    rst = 0;
    #500;
  endtask

  task input_password(input [15:0] password);
    reset();
    digit_input = password[15:12];
    clock();
    digit_input = password[11:8];
    clock();
    digit_input = password[7:4];
    clock();
    digit_input = password[3:0];
    clock();
  endtask

  initial begin
    input_password(16'ha73f);  // admin password
    input_password(16'h1234);  // incorrect

    mode = 0;
    input_password(16'h1234);  // set password

    mode = 1;
    input_password(16'h4321);  // incorrect
    input_password(16'h1234);  // correct
    input_password(16'ha73f);  // admin password

    // incorrect three times
    input_password(16'h4321);
    input_password(16'h4321);
    input_password(16'h4321);

    input_password(16'h1234);  // locked

    mode = 0;
    input_password(16'h4321);  // cannot set password

    mode = 1;
    input_password(16'h1234);  // locked
    input_password(16'h4321);  // incorrect
    input_password(16'ha73f);  // admin password
    input_password(16'h1234);  // correct
    input_password(16'h4321);  // incorrect
  end
endmodule
\`\`\`

é€šè¿‡ä½¿ç”¨ \`$display\`ï¼Œå¯ä»¥æ›´ç›´è§‚åœ°è¾“å‡ºç»“æœï¼Œä»è€Œä¸éœ€è¦å¯¹ç€æ³¢å½¢å›¾çœ‹ï¼›æˆ–è€…è‡ªåŠ¨æ£€æŸ¥ç»“æœæ˜¯å¦æ­£ç¡®ï¼Œåœ¨å‡ºé”™æ—¶è¾“å‡ºã€‚

æœ‰æ—¶å¯ä»¥é€šè¿‡æ–‡ä»¶è¯»å†™æ¥æ›´æ–¹ä¾¿åœ°ç¼–å†™æµ‹è¯•æ•°æ®ã€æ£€æŸ¥è¾“å‡ºç»“æœã€‚

## æœ‰å…³ synthesize çš„ä¸€äº›æ³¨æ„äº‹é¡¹

-   é•¿ä¸²çš„ \`if\`ã€\`else if\`ã€\`else if\`â€¦â€¦å¯èƒ½å¯¼è‡´ç”µè·¯ä¹Ÿæœ‰ä¸€é•¿ä¸²ï¼Œä½¿ç”¨ \`case\` å¯èƒ½ä¼šæ›´ä¼˜ã€‚
-   ç»„åˆé€»è¾‘ä¸­çš„å¾ªç¯å¯èƒ½ä¼šåˆ›å»ºåŒä¸€å¥—ç”µè·¯çš„å¤šä¸ªå‰¯æœ¬ï¼Œå¦‚æœè¦ç”¨åŒä¸€ä¸ªç”µè·¯ï¼Œå¯èƒ½éœ€è¦æ”¹å†™æˆæ—¶åºé€»è¾‘ã€‚
-   æ ¹æ®å…·ä½“ä½¿ç”¨çš„ toolï¼Œæœ‰äº› language feature æ˜¯ä¸èƒ½è¢« synthesize çš„ã€‚
-   ä¸ºäº†æ›´å¥½çš„ synthesize ç»“æœè€Œéœ€è¦æŠŠä»£ç å†™æˆä»€ä¹ˆæ ·ï¼Œéœ€è¦ä¾å…·ä½“ä½¿ç”¨çš„ tool è€Œå®šã€‚
`},{title:z,tags:"cnatda å­¦ä¹ ç¬”è®°",content:`ã€ŠComputer Networking: A Top-Down Approach (8th Edition)ã€‹ç¬¬äºŒç«  â€œApplication Layerâ€ çš„å­¦ä¹ ç¬”è®°ã€‚



## Principles of Network Applications

application architecture ä¸»è¦åˆ†ä¸º client-server å’Œ P2P ä¸¤ç§ã€‚

*process* å³åœ¨æŸä¸ª end system ä¸Šè¿è¡Œçš„ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰ï¼Œä¸åŒ end system ä¸Šçš„ process åœ¨ç½‘ç»œä¸Šäº’ç›¸å‘é€ message ä»¥è¿›è¡Œé€šä¿¡ï¼ˆæ³¨ï¼šmessage å³ application-layer packetï¼‰ã€‚

åœ¨ä¸€æ¬¡é€šä¿¡ä¸­ï¼Œå‘èµ·é€šä¿¡çš„ä¸€æ–¹è¢«ç§°ä½œ *client*ï¼Œç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ä¸€æ–¹è¢«ç§°ä½œ *server*ã€‚ï¼ˆæ³¨ï¼šåœ¨ P2P ä¸­ï¼Œclient å’Œ server çš„èº«ä»½ä¸æ˜¯å›ºå®šçš„ã€‚ï¼‰

process å’Œç½‘ç»œï¼Œæˆ–è€…è¯´å’Œ transport layer ä¹‹é—´ä»¥ *socket* ä½œä¸º APIã€‚

host ç”± IP åœ°å€è¯†åˆ«ï¼Œè€Œ process ç”± IP åœ°å€ + ç«¯å£è¯†åˆ«ã€‚

ä¸€ä¸ª application å¯ä»¥é€‰æ‹© TCP æˆ–è€… UDP æ¥æä¾› transport serviceã€‚TCP æä¾› connection-oriented serviceï¼ˆéœ€è¦é€šè¿‡ handshaking å»ºç«‹ TCP connectionï¼‰å’Œ reliable data transfer serviceï¼ˆä¿è¯æ¥æ”¶åˆ° & ä¿åºï¼‰ï¼Œä»¥åŠ congestion controlã€‚UDP åˆ™è¿™äº›éƒ½ä¸æä¾›ã€‚ä¸€èˆ¬ä¼šæ ¹æ®æ˜¯å¦ loss-tolerantï¼ˆæ˜¯å¦å…è®¸ä¸¢å¤±éƒ¨åˆ†æ•°æ®ï¼‰ä»¥åŠå¯¹å»¶æ—¶çš„æ•æ„Ÿåº¦æ¥è¿›è¡Œé€‰æ‹©ã€‚

TLS (Transport Layer Security) å¯ä»¥åœ¨ TCP çš„åŸºç¡€ä¸Šæä¾› encryptionã€data integrityã€end-point authenticationã€‚å®ƒè‡ªèº«ä½äº application layerï¼ˆæˆ–è€…å¯ä»¥è¯´æ˜¯ application ä¸ transport layer ä¹‹é—´ ğŸ¤”ï¼‰ï¼Œä¸ä¸ TCPã€UDP å¹¶åˆ—ã€‚

application-layer protocol å†³å®šäº† message çš„ç»“æ„ä»¥åŠç›¸åº”çš„è¡Œä¸ºã€‚å¸¸è§çš„ application-layer protocol åŒ…æ‹¬ HTTPã€SMTPã€Telnetã€FTPã€SIPã€RTPã€DASH ç­‰ã€‚æœ‰çš„ application ä¼šä½¿ç”¨ä¸“æœ‰è€Œé public domain çš„ application-layer protocolã€‚

## The Web and HTTP

HTTP (HyperText Transfer Protocol) æ˜¯ Web çš„ application-layer protocolï¼Œå®šä¹‰äº† client (browser) å¦‚ä½•å‘ server è¯·æ±‚æ–‡ä»¶ï¼ˆweb pageï¼‰ã€server å¦‚ä½•å°†æ–‡ä»¶ä¼ è¾“ç»™ clientã€‚

HTTP çš„é»˜è®¤ç«¯å£æ˜¯ 80ã€‚

HTTP ä¸å­˜å‚¨ client çš„ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ª *stateless protocol*ã€‚

HTTPï¼ˆ1.0ã€1.1ã€2ï¼‰åŸºäº TCPï¼Œæœ‰ persistent connection å’Œ non-persistent connection ä¸¤ç§å·¥ä½œæ–¹å¼ï¼š

-   non-persistent connectionï¼šæ¯æ¬¡ request-response éƒ½ä¼šå»ºç«‹ä¸€ä¸ªæ–°çš„ TCP connectionï¼Œæ”¶åˆ° response åç«‹åˆ»å…³é—­ TCP connectionã€‚
-   persistent connectionï¼šåŒä¸€å¯¹ client-server çš„å¤šæ¬¡ request-responseï¼ˆä¾‹å¦‚ä¸€ä¸ªé¡µé¢å¼•ç”¨çš„å¤šä¸ªèµ„æºï¼‰å¯ä»¥å…±ç”¨åŒä¸€ä¸ª TCP connectionï¼ˆåœ¨é—²ç½®ä¸€æ®µæ—¶é—´åè‡ªåŠ¨å…³é—­ï¼‰ï¼Œå¹¶ä¸”æ— éœ€ç­‰å¾… response å°±å¯ä»¥è¿ç»­å‘é€å¤šä¸ª requestï¼ˆè¢«ç§°ä½œ *pipelining*ï¼‰ï¼Œä»è€Œçœä¸‹æ¯æ¬¡å»ºç«‹ TCP connection è€—è´¹çš„ RTT (round-trip time)ã€‚

HTTP message æ˜¯çº¯æ–‡æœ¬ï¼Œæ ¼å¼å¦‚ä¸‹ã€‚

HTTP request:[^fig2.8]

[^fig2.8]: p103, Figure 2.8: General format of an HTTP request message

![General format of an HTTP request message](cnatda-fig-2.8.png)

\`\`\`http
GET /wireshark-labs/INTRO-wireshark-file1.html HTTP/1.1
Host: gaia.cs.umass.edu
User-Agent: curl/8.1.2
Accept: */*
\`\`\`

HTTP response:[^fig2.9]

[^fig2.9]: p104, Figure 2.9: General format of an HTTP response message

![General format of an HTTP response message](cnatda-fig-2.9.png)

\`\`\`http
HTTP/1.1 200 OK
Date: Tue, 13 Jun 2023 11:14:57 GMT
Server: Apache/2.4.6 (CentOS) OpenSSL/1.0.2k-fips PHP/7.4.33 mod_perl/2.0.11 Perl/v5.16.3
Last-Modified: Tue, 13 Jun 2023 05:59:01 GMT
ETag: "51-5fdfc882a3e6f"
Accept-Ranges: bytes
Content-Length: 81
Content-Type: text/html; charset=UTF-8

<html>
Congratulations!  You've downloaded the first Wireshark lab file!
</html>
\`\`\`

server å¯ä»¥é€šè¿‡ Cookie è¯†åˆ«ç”¨æˆ·ï¼Œcookie é€šè¿‡ response ä¸­çš„ \`Set-Cookie\` header è®¾ç½®ï¼Œåœ¨ä¹‹åçš„æ¯æ¬¡ request ä¸­é€šè¿‡ \`Cookie\` header å‘ç»™ serverã€‚

æœºæ„å¯ä»¥è®¾ç½® Web cacheï¼Œä½¿ç”¨æˆ·å…ˆå‘ Web cache å‘é€è¯·æ±‚ï¼Œè‹¥ cache hit åˆ™ç›´æ¥ç”± Web cache å‘ç»™ç”¨æˆ·ï¼Œè‹¥ cache miss åˆ™ Web cache å‘ origin server å‘é€è¯·æ±‚å†è¿”å›ç»™ç”¨æˆ·ã€‚Web cache å¯ä»¥å‡å°å»¶è¿Ÿï¼Œé™ä½å¸¦å®½å‹åŠ›ã€‚ï¼ˆä¸ä¹‹ç±»ä¼¼çš„ CDN åˆ™åœ¨[åæ–‡](#content-distribution-networks)æœ‰è¯¦ç»†è®²è§£ã€‚ï¼‰

å¯ä»¥é€šè¿‡ \`If-Modified-Since\` header è¿›è¡Œ *conditional GET*ï¼Œè‹¥æ²¡æœ‰ä¿®æ”¹åˆ™ä¼šè¿”å› body ä¸ºç©ºçš„ 304 Not Modifiedã€‚

HTTP/2 æä¾›äº† request and response multiplexingã€prioritizationã€server push æ¥ä¼˜åŒ–æ€§èƒ½ï¼š

-   multiplexingï¼špersistent connection å‡å°‘äº†å»ºç«‹ TCP connection å¸¦æ¥çš„ RTTï¼Œä½†åˆå¼•å…¥äº† Head of Line (HOL) blockingï¼Œå³å…±ç”¨ä¸€ä¸ª TCP connection æ—¶è¾ƒå°çš„èµ„æºéœ€è¦ç­‰å¾…è¾ƒå¤§çš„èµ„æºåŠ è½½å®Œæ¯•ï¼Œæ‰€ä»¥åœ¨ HTTP/1.1 ä¸­æµè§ˆå™¨ç»å¸¸è¿˜æ˜¯ä¼šå»ºç«‹å¤šä¸ª TCP è¿æ¥ï¼Œé™¤äº†è§£å†³ HOL blockingï¼Œä¹Ÿå¯ä»¥åœ¨ TCP çš„ congestion control ä¸­å–å¾—æ›´å¤šå¸¦å®½ã€‚HTTP/2 åˆ™å°†æ¯ä¸ª message åˆ’åˆ†æˆäº†å¤šä¸ªå°çš„ frameï¼Œå¹¶äº¤æ›¿å‘é€ä¸åŒ message çš„ frameï¼ˆframe interleavingï¼‰ï¼Œä»è€Œå°çš„èµ„æºæ— éœ€ç­‰å¾…å¤§çš„èµ„æºå‘é€å®Œæ¯•ã€‚
-   prioritizationï¼šåŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æ—¶ï¼Œå¯ä»¥ä¸ºæ¯ä¸ª response è®¾ç½®ä¼˜å…ˆçº§ï¼Œè®© server ä¼˜å…ˆå‘é€é«˜ä¼˜å…ˆçº§çš„ responseã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½® response ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚
-   server pushï¼šä¸€ä¸ª request å¯ä»¥æœ‰å¤šä¸ª responseï¼Œå³é™¤äº†å¯¹åº”äº request çš„ responseï¼Œserver è¿˜å¯ä»¥é¢å¤– *push*ï¼Œä¾‹å¦‚åœ¨è¿”å›ä¸€ä¸ª HTML é¡µé¢æ—¶å¯ä»¥ push è¿™ä¸ªé¡µé¢å¼•ç”¨çš„å…¶ä»–èµ„æºã€‚

HTTP/3 ä½¿ç”¨åŸºäº UDP çš„ QUIC ä»£æ›¿äº† TCPã€‚

## Electronic Mail in the Internet

e-mail ç³»ç»Ÿæœ‰ä¸‰ä¸ªä¸»è¦ç»„ä»¶ï¼šuser agentã€mail server å’Œ SMTP (Simple Mail Transfer Protocol)ã€‚

å‘é€é‚®ä»¶æ—¶ï¼ŒAlice å†™å®Œé‚®ä»¶åç”±å¥¹çš„ user agent å‘é€åˆ°å¥¹çš„ mail serverï¼Œå¥¹çš„ mail server å†å‘åˆ° Bob çš„ mail server ä¸­å±äº Bob çš„ mailboxï¼Œä¹‹å Bob å†é€šè¿‡ä»–çš„ user agent ä»ä»–çš„ mail server è·å–ä»–çš„ mailbox ä¸­çš„é‚®ä»¶å¹¶é˜…è¯»ã€‚

å‘é€æ–¹çš„ mail server ä¼šç»´æŠ¤ä¸€ä¸ªå¾…å‘é€é‚®ä»¶åˆ—è¡¨ï¼Œå¦‚æœæ¥æ”¶æ–¹çš„ mail server åœ¨å½“æ—¶ä¸å¯ç”¨ï¼Œåˆ™ä¼šç­‰å¾…ä¸€æ®µæ—¶é—´åå†æ¬¡å°è¯•ï¼Œå¤šæ¬¡å¤±è´¥åˆ™ä¼šé€€å›ã€‚

mail server ä½¿ç”¨ SMTP å‘å…¶ä»– mail server å‘é€é‚®ä»¶ï¼Œå‘é€æ–¹ä½œä¸º SMTP clientï¼Œæ¥æ”¶æ–¹ä½œä¸º SMTP serverã€‚

SMTP çš„é»˜è®¤ç«¯å£æ˜¯ 25ã€‚

SMTP æ˜¯ä¸€ä¸ªæ¯” HTTP è¿˜å¤è€çš„åè®®ï¼Œå¸¦æ¥çš„åæœä¹‹ä¸€æ˜¯å®ƒæ•´ä¸ª message éƒ½åªèƒ½åŒ…å« ASCIIã€‚

ä¸€æ¬¡ SMTP é€šä¿¡å¦‚ä¸‹æ‰€ç¤ºï¼š[^smtp-example]

[^smtp-example]: [SMTP transport example - Simple Mail Transfer Protocol - Wikipedia](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol#SMTP_transport_example)

\`\`\`plain
S: 220 smtp.example.com ESMTP Postfix
C: HELO relay.example.org
S: 250 Hello relay.example.org, I am glad to meet you
C: MAIL FROM:<bob@example.org>
S: 250 Ok
C: RCPT TO:<alice@example.com>
S: 250 Ok
C: RCPT TO:<theboss@example.com>
S: 250 Ok
C: DATA
S: 354 End data with <CR><LF>.<CR><LF>
C: From: "Bob Example" <bob@example.org>
C: To: "Alice Example" <alice@example.com>
C: Cc: theboss@example.com
C: Date: Tue, 15 Jan 2008 16:02:43 -0500
C: Subject: Test message
C:
C: Hello Alice.
C: This is a test message with 5 header fields and 4 lines in the message body.
C: Your friend,
C: Bob
C: .
S: 250 Ok: queued as 12345
C: QUIT
S: 221 Bye
\`\`\`

å…¶ä¸­ \`HELO\`ã€\`MAIL FROM\`ã€\`RCPT TO\`ã€\`DATA\`ã€\`QUIT\` ç­‰æ˜¯ *command*ï¼Œç”¨æ¥è¿›è¡Œ handshake ç­‰æ“ä½œã€‚å¦‚æœè¦å‘åŒä¸€ä¸ª mail server è¿ç»­å‘é€å¤šå°é‚®ä»¶ï¼Œå¯ä»¥åª \`HELO\`ã€\`QUIT\` ä¸€æ¬¡ï¼ˆä½†è¦ \`MAIL FROM\`ã€\`RCPT TO\` å¤šæ¬¡ï¼‰ä»è€Œå…±ç”¨ä¸€ä¸ª TCP è¿æ¥ã€‚\`DATA\` åæ˜¯é‚®ä»¶çš„å†…å®¹ï¼Œè¿™ä¸€å†…å®¹çš„å¼€å¤´æ˜¯é‚®ä»¶çš„ headerï¼Œç»“å°¾æ˜¯ä»…åŒ…å« \`.\` çš„ä¸€è¡Œã€‚

email æ˜¯ user agent â†’ mail server â†’ mail server â†’ user agent è€Œé user agent â†’ user agentï¼Œä¸€å¤§åŸå› æ˜¯å¦‚æœ user agent ç»å¸¸ä¸åœ¨çº¿åˆ™ç›´æ¥å‘å¾ˆå¯èƒ½æ”¶ä¸åˆ°é‚®ä»¶ï¼Œéœ€è¦ç”¨ mail server æ¥æé«˜åœ¨çº¿ç‡ä»¥åŠæä¾›å¯¹æ–¹ä¸åœ¨çº¿æ—¶é‡è¯•çš„æœºåˆ¶ã€‚

ä» user agent å‘åˆ° mail server æ—¶å¯ä»¥ä½¿ç”¨ SMTP æˆ– HTTPï¼Œä» mail server æ‹‰å–åˆ° user agent æ—¶å¯ä»¥ä½¿ç”¨ HTTP æˆ– IMAP (Internet Mail Access Protocol)ï¼ˆä¸èƒ½ç”¨ SMTPï¼Œå› ä¸º SMTP æ˜¯ push protocolï¼Œä¸èƒ½ç”¨æ¥ pullï¼‰ã€‚

## DNSâ€”The Internetâ€™s Directory Service

### Services Provided by DNS

host ç”± hostname æˆ– IP åœ°å€è¯†åˆ«ï¼Œhostname å¯¹äººç±»æ›´å‹å¥½ï¼Œè€Œ IP åœ°å€å¯¹è·¯ç”±å™¨æ›´å‹å¥½ã€‚

å°† hostname ç¿»è¯‘ä¸º IP åœ°å€æ˜¯ DNS çš„ä¸»è¦ä»»åŠ¡ã€‚DNS æ˜¯ç”±å¤šä¸ªå±‚çº§çš„ DNS server å…±åŒæ„æˆçš„ distributed databaseï¼Œä¹Ÿæ˜¯ä½¿å¾— application èƒ½å¤ŸæŸ¥è¯¢è¿™ä¸ª distributed database çš„ application-layer protocolã€‚

DNS è¢«å¾ˆå¤šå…¶ä»– application-layer protocol æ‰€ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ HTTP/SMTP ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ hostname æ¥è®¿é—®ç½‘ç«™ / mail serverï¼Œè¿™æ—¶å°±ä¼šè°ƒç”¨ DNSã€‚

DNS åœ¨æä¾› hostname åˆ° IP åœ°å€çš„ç¿»è¯‘çš„åŒæ—¶ï¼Œè¿˜æä¾›äº†ä¸‹åˆ—åŠŸèƒ½ï¼š

-   host aliasing: å¯ä»¥è®©ä¸€ä¸ª host åœ¨æœ‰ canonical hostname çš„åŒæ—¶è¿˜æœ‰å…¶ä»– aliasã€‚
-   mail server aliasing: å¯ä»¥è®©åŒä¸€ä¸ª hostname åœ¨ä½œä¸º Web server å’Œä½œä¸º mail server æ—¶æŒ‡å‘ä¸åŒçš„ hostã€‚
-   load distribution: å¯ä»¥è®©åŒä¸€ä¸ª hostname æŒ‡å‘å¤šä¸ª hostï¼Œåœ¨è¿”å›æŸ¥è¯¢ç»“æœæ—¶è¿›è¡Œ rotateï¼ˆå³æ”¹å˜ä½äºé¦–ä½çš„ IP åœ°å€ï¼‰ã€‚

### Overview of How DNS Works

ç”±äºä¸‹åˆ—åŸå› ï¼ŒDNS å¿…é¡»æ˜¯åˆ†å¸ƒå¼çš„ï¼Œå•ç‚¹å¼çš„ DNS æ— æ³• scaleï¼š

-   single point of failure
-   traffic volume è¿‡å¤§
-   ç¦»éƒ¨åˆ†ç”¨æˆ·è·ç¦»è¿‡è¿œï¼Œå¸¦æ¥è¾ƒå¤§çš„å»¶æ—¶
-   éš¾ä»¥ç»´æŠ¤ï¼ˆæ•°æ®æ€»é‡å¤§ï¼Œæ›´æ–°é¢‘ç¹ï¼‰

ä¸€èˆ¬æ¥è¯´ï¼ŒDNS åˆ†ä¸ºä»¥ä¸‹å‡ å±‚ï¼š

1.  root DNS server: åˆ†æ•£åœ¨ä¸–ç•Œå„åœ°çš„ 13 ä¸ªä¸åŒ root server å„è‡ªçš„å…±ä¸Šåƒä¸ª copyï¼Œç”¨æ¥æŸ¥è¯¢ TLD server
2.  top-level domain (TLD) server: æ¯ä¸ª TLD æœ‰è‡ªå·±çš„ TLD server (or server cluster)ï¼Œç”¨æ¥æŸ¥è¯¢ authoritative DNS server
3.  authoritative DNS server: æ¯ä¸ª subdomain æœ‰è‡ªå·±çš„ authoritative DNS serverï¼Œå¯ä»¥æ˜¯ç»„ç»‡è‡ªå·±ç»´æŠ¤çš„æˆ–è€…ç”±æœåŠ¡å•†æä¾›çš„ï¼Œç”¨æ¥æŸ¥è¯¢ hostname åˆ° IP åœ°å€çš„æ˜ å°„

é™¤æ­¤ä¹‹å¤–ï¼ŒTLD server å’Œ authoritative DNS server ä¹‹é—´è¿˜å¯èƒ½æœ‰ intermediate DNS serverã€‚

åœ¨ä¸Šè¿° DNS server çš„ hierarchy ä¹‹å¤–ï¼Œè¿˜æœ‰ local DNS serverï¼ˆå°±æ˜¯ç”µè„‘çš„ç½‘ç»œè®¾ç½®é‡Œè®¾çš„ DNS æœåŠ¡å™¨ï¼‰ï¼Œä½œä¸º proxy æ¥ä»£æ›¿ requesting host å‘ DNS server è¿›è¡ŒæŸ¥è¯¢ã€‚

ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œå‘ä¸€ä¸ª DNS server è¿›è¡ŒæŸ¥è¯¢æ—¶ï¼Œå¦‚æœå®ƒè‡ªå·±ä¸çŸ¥é“æœ€ç»ˆçš„ answer (IP åœ°å€)ï¼Œå®ƒå¯ä»¥è®©ä½ æ¢ä¸€ä¸ª DNS server ç»§ç»­æŸ¥ (iterative query)ï¼Œæˆ–è€…å¸®ä½ å‘å…¶ä»– DNS server å‘é€æŸ¥è¯¢ (recursive query) ç„¶åè¿”å›æœ€ç»ˆçš„ç»“æœã€‚è€Œåœ¨å®é™…ä¸­ï¼Œå¦‚ä¸Šæ–‡æ‰€è¿°ï¼Œä¸€èˆ¬æ˜¯å‘ local DNS server æŸ¥è¯¢æ—¶ä¼šè¿›è¡Œ recursive queryï¼Œè€Œ local DNS server å†ä» root DNS server å‘ä¸‹ç›´åˆ° authoritative DNS server è¿›è¡Œ iterative queryã€‚

ä¸ºäº†å‡å°‘æŸ¥è¯¢çš„æ•°é‡ï¼ŒDNS è®¾æœ‰ cachingã€‚æ¯ä¸ªæŸ¥è¯¢çš„å‘èµ·è€…ï¼ˆrequesting host æˆ–è€… local DNS serverï¼‰ä¼šå°†æ”¶åˆ°çš„æŸ¥è¯¢ç»“æœä¿å­˜ä¸€æ®µæ—¶é—´ï¼Œcache miss æ‰ä¼šå‘å…¶ä»– DNS server å‘èµ·æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œå¸¸ç”¨çš„ TLD server çš„ IP åœ°å€å¾€å¾€éƒ½åœ¨ cache ä¸­ï¼Œå¤§å¤§å‡å°‘äº† root DNS server æ”¶åˆ°çš„è¯·æ±‚æ•°é‡ã€‚

### DNS Records

DNS distributed database å­˜å‚¨çš„ä¿¡æ¯å•å…ƒæ˜¯ *resource record* (RR)ã€‚

æ¯ä¸ª RR åŒ…å« typeã€nameã€valueã€TTL å››é¡¹ä¿¡æ¯ï¼Œå…¶ä¸­ TTL è¡¨ç¤º cache å¤šä¹…è¿‡æœŸã€‚å¸¸è§çš„ type åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªï¼š

-   A: name æ˜¯ hostnameï¼Œvalue æ˜¯ IP åœ°å€ï¼Œè¡¨ç¤ºä¸€ä¸ª hostname åˆ° IP åœ°å€çš„æ˜ å°„ã€‚
-   NS: name æ˜¯ domainï¼Œvalue æ˜¯å…¶ name server çš„ hostnameï¼Œè¡¨ç¤ºå¯ä»¥åœ¨è¿™ä¸ª name server è¿›è¡Œè¿™ä¸ª domain çš„è¿›ä¸€æ­¥æŸ¥è¯¢ã€‚
-   CNAME: name æ˜¯ alias hostnameï¼Œvalue æ˜¯ canonical hostnameï¼Œç”¨æ¥æä¾› host aliasingã€‚
-   MX: name æ˜¯ alias hostnameï¼Œvalue æ˜¯ canonical hostnameï¼Œç”¨æ¥æä¾› mail server aliasingã€‚

å¯¹ä¸€ä¸ª hostname æ¥è¯´ authoritative çš„ DNS server ä¼šåŒ…å«è¢«æŸ¥è¯¢çš„ host çš„ A recordã€‚ä¸ authoritative çš„ DNS server åˆ™ä¼šåŒ…å«ç›¸åº”çš„ NS recordï¼Œä»¥åŠè¿™ä¸ª name server çš„ A recordã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š

| type |           name            |           value           |
| :--: | :-----------------------: | :-----------------------: |
|  NS  |            \`.\`            |   \`a.root-servers.net.\`   |
|  A   |   \`a.root-servers.net.\`   |       \`198.41.0.4\`        |
|  NS  |          \`moe.\`           |    \`ns1.dns.nic.moe.\`     |
|  A   |    \`ns1.dns.nic.moe.\`     |     \`156.154.144.114\`     |
|  NS  |       \`ouuan.moe.\`        | \`amos.ns.cloudflare.com.\` |
|  A   | \`amos.ns.cloudflare.com.\` |      \`172.64.35.120\`      |
|  A   |       \`ouuan.moe.\`        |     \`172.67.181.123\`      |

åœ¨ registar è´­ä¹°åŸŸåæ—¶å¯ä»¥å¡«å†™ name server çš„ä¿¡æ¯ï¼Œç”± registar è´Ÿè´£å°†ç›¸åº”çš„ NS ä»¥åŠ A record æ·»åŠ åˆ° TLD serverã€‚å¯ä»¥ä½¿ç”¨åŸŸåå•†çš„ DNS serverã€å…¶ä»–æœåŠ¡å•†ï¼ˆä¾‹å¦‚ Cloudflareï¼‰çš„ DNS server æˆ–è€…è‡ªå·±æ­å»ºçš„ DNS server ä½œä¸º authoritative DNS serverã€‚

DNS æœ€åˆåªèƒ½é™æ€æ›´æ–°ï¼ˆé€šè¿‡é…ç½®æ–‡ä»¶ç­‰æ–¹å¼ï¼‰ï¼Œåæ¥æœ‰äº† DDNS æ¥é€šè¿‡ DNS message åŠ¨æ€æ›´æ–°ã€‚

### DNS Messages

DNS message é€šè¿‡ UDP å‘é€åˆ° port 53ã€‚

DNS message çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š[^fig-2.21]

[^fig-2.21]: p133, Figure 2.21: DNS message format

![DNS message format](cnatda-fig-2.21.png)

identification ç”± client è®¾ç½®ï¼Œå³ç”¨æ¥è¯†åˆ« query å’Œ reply å¯¹åº”å…³ç³»çš„ IDã€‚

flags åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªï¼š

-   query or reply: è¿™æ¡ message æ˜¯ query è¿˜æ˜¯ reply
-   authoritative or not: è¿”å›çš„ç»“æœæ˜¯å¦æ˜¯æœ€ç»ˆçš„ç­”æ¡ˆ
-   recursion desired: client æ˜¯å¦å¸Œæœ› server è¿›è¡Œ recursive query
-   recursion available: server æ˜¯å¦å¯ä»¥è¿›è¡Œ recursive query

4 ä¸ª section ä¸­éƒ½åŒ…å«è‹¥å¹² RRã€‚

åœ¨ query ä¸­ï¼Œquestion section é‡Œä¼šåŒ…å« name å’Œ typeã€‚

å¯¹äº type A çš„æŸ¥è¯¢ï¼š

-   å¦‚æœ reply æ˜¯ authoritative çš„ï¼ˆå‘ authoritative DNS server æŸ¥è¯¢ï¼Œæˆ–è€…è¿›è¡Œäº† recursive queryï¼‰ï¼Œåˆ™ä¼šåœ¨ answer section ä¸­åˆ—å‡ºæ‰€æŸ¥è¯¢çš„ A recordã€‚
-   å¦‚æœä¸æ˜¯ authoritative çš„ï¼Œåˆ™ä¼šåœ¨ authority section ä¸­åˆ—å‡º NS recordï¼Œåœ¨ additional section ä¸­åˆ—å‡ºè¿™äº› name server çš„ A recordã€‚

åœ¨ additional section ä¸­ï¼Œè¿˜å¯èƒ½åˆ—å‡º canonical hostname çš„ A record ä¹‹ç±»çš„ã€‚

## Peer-to-Peer File Distribution

åœ¨ä¼ è¾“å¤§æ–‡ä»¶æ—¶ï¼Œclient-server çš„æ¶æ„åœ¨ç”¨æˆ·æ•°é‡å¢å¤šæ—¶éœ€è¦æ›´å¤§çš„ server bandwidth æ‰èƒ½ä¿è¯ç”¨æˆ·çš„ä¸‹è½½é€Ÿåº¦ï¼Œè€Œ P2P çš„æ¶æ„åˆ™æ˜¯ self-scalable çš„ã€‚ï¼ˆä¹¦ä¸­æœ‰ç®€åŒ–æ¨¡å‹çš„å®šé‡è®¡ç®—ã€‚ï¼‰

BitTorrent æ˜¯è¾ƒä¸ºæµè¡Œçš„ P2P file distribution protocolã€‚åœ¨ BitTorrent ä¸­ï¼Œä»¥ chunk ä¸ºä¸‹è½½æ–‡ä»¶çš„åŸºæœ¬å•ä½ã€‚ä¸€ä¸ª peer åˆšåŠ å…¥ torrent æ—¶æ²¡æœ‰ trunk æ‰€ä»¥åªèƒ½ä¸‹è½½ï¼Œåœ¨è·å–åˆ°ä¸€äº› trunk åå°±ä¼šå¼€å§‹ä¸Šä¼ ç»™å…¶ä»– peerï¼Œä¸‹è½½å®Œæˆåå¯ä»¥è‡ªç§åœ°ç¦»å¼€æˆ–è€…æ— ç§åœ°ä¿ç§ã€‚

æ¯ä¸ª torrent ä¼šæœ‰ï¼ˆè‡³å°‘ï¼‰ä¸€ä¸ª trackerï¼Œpeer åœ¨åŠ å…¥/ç¦»å¼€æ—¶ä¼šé€šçŸ¥ trackerï¼Œå¹¶åœ¨è¿‡ç¨‹ä¸­å®šæœŸå‘ŠçŸ¥ tracker è‡ªå·±ä»åœ¨æ´»åŠ¨ã€‚tracker ä¼šç»™æ¯ä¸ª peer æä¾›ä¸€äº›å…¶ä»– peer çš„ IP åœ°å€å’Œç«¯å£ã€‚

åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª peer æ‹¥æœ‰ä¸€éƒ¨åˆ† chunkï¼Œå¹¶å‘å…¶ä»– peer è¯·æ±‚ chunkã€‚æ¯ä¸ª peer éœ€è¦å†³å®šä¼˜å…ˆä¸‹è½½å“ªä¸ª trunk ä»¥åŠä¸Šä¼ ç»™è°ã€‚

ä¼˜å…ˆä¸‹è½½çš„ trunk å¯ä»¥é‡‡ç”¨ *rarest first* çš„ç­–ç•¥ï¼Œå³ä¼˜å…ˆä¸‹è½½å·²çŸ¥çš„ peer ä¸­æ‹¥æœ‰äººæ•°æœ€å°‘çš„ chunkï¼Œè¿™æ ·çš„è¯å°±èƒ½ä½¿å¾—å„ä¸ª trunk è¾ƒä¸ºå‡åŒ€åœ°åœ¨ peer é—´åˆ†å¸ƒã€‚

åœ¨ä¸‹è½½è¿‡ç¨‹ä¸­ï¼Œä¼šé‡‡ç”¨è¢«ç§°ä½œâ€œtit-for-tatâ€çš„ç­–ç•¥å†³å®šä¸Šä¼ ç»™è°ï¼šä¸Šä¼ ç»™è‡ªå·±ï¼ˆå³ä»ä»–é‚£ä¸‹è½½ï¼‰çš„é€Ÿåº¦æœ€å¿«çš„å‡ ä¸ª peer è¢«ç§°ä½œâ€œunchokedâ€ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜ä¼šæ¯éš”ä¸€æ®µæ—¶é—´éšæœºé€‰æ‹©ä¸€ä¸ª peer è¢«ç§°ä½œâ€œoptimistically unchokedâ€ï¼Œæœ€ååšå‡ºçš„é€‰æ‹©å°±æ˜¯ä¸Šä¼ ç»™â€œunchokedâ€å’Œâ€œoptimistically unchokedâ€çš„è¿™äº› peerã€‚è¿™ä¸ªç­–ç•¥å®é™…ä¸Šå¯ä»¥è¢«ç»•è¿‡ï¼Œä½†ä¸è¢«ç»•è¿‡æ—¶å®ƒæä¾›äº†ä¸€ä¸ªæ¿€åŠ±å¤§å®¶ä¸Šä¼ çš„æœºåˆ¶ã€‚ï¼ˆæ³¨ï¼šåœ¨ä¸‹è½½å®Œæ¯•åä¿ç§æ—¶ï¼Œä¼šä½¿ç”¨å¦å¤–çš„ç­–ç•¥ã€‚[^seed-choking]ï¼‰

[^seed-choking]: [seed_choking_algorithm - libtorrent](https://www.libtorrent.org/reference-Settings.html#seed_choking_algorithm_t)

é™¤äº†é€šè¿‡ trackerï¼Œè¿˜å¯ä»¥é€šè¿‡ Distributed Hash Table (DHTï¼Œä¸€ç§ P2P æ¶æ„çš„ distributed database) æ¥è·å– peerã€‚

## Video Streaming and Content Distribution Networks

### HTTP Streaming and DASH

è§†é¢‘éœ€è¦è€—è´¹å¤§é‡çš„æµé‡ï¼ˆä»¥åŠå­˜å‚¨ç©ºé—´ï¼‰ï¼Œè€Œ streaming æ—¶éœ€è¦ä¿è¯è‡³å°‘æœ‰è§†é¢‘ bitrate è¿™ä¹ˆå¤šçš„å¸¦å®½æ‰èƒ½é¿å…å¡é¡¿ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¼šæ ¹æ®å¯ç”¨çš„å¸¦å®½é€‰æ‹©ä¸åŒè´¨é‡çš„è§†é¢‘ç‰ˆæœ¬ã€‚

æœ€åŸºç¡€çš„ streaming æ–¹å¼æ˜¯ HTTP streamingï¼Œå³é€šè¿‡ HTTP GET è·å–è§†é¢‘æ–‡ä»¶è‡³ç¼“å†²åŒºå¹¶æ’­æ”¾ï¼Œä½†è¿™æ ·æ— æ³•é€‚åº”ä¸åŒç”¨æˆ·çš„ä¸åŒå¸¦å®½ï¼Œæ›´æ— æ³•é€‚åº”åŒä¸€ä¸ªç”¨æˆ·éšæ—¶é—´å˜åŒ–çš„å¸¦å®½ã€‚

åœ¨ Dynamic Adaptive Streaming over HTTP (DASH) ä¸­ï¼Œè§†é¢‘è¢«ç¼–ç ä¸ºå¤šä¸ªä¸åŒè´¨é‡çš„ç‰ˆæœ¬ï¼Œclient æ¯æ¬¡è·å–ä¸€ä¸ªå‡ ç§’çš„è§†é¢‘ç‰‡æ®µï¼Œå¹¶æ ¹æ®å¯ç”¨å¸¦å®½åŠ¨æ€è°ƒæ•´é€‰æ‹©çš„ç‰ˆæœ¬ã€‚

åœ¨å¼€å§‹æ’­æ”¾ä¹‹å‰ï¼Œclient é¦–å…ˆä¼šè·å– manifest file æ¥å¾—åˆ°å„ä¸ªè§†é¢‘ç‰ˆæœ¬çš„ URL ä»¥åŠ bitrateã€‚åœ¨æ’­æ”¾è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ HTTP GET è¯·æ±‚ä»¥åŠ byte range header è·å–è§†é¢‘ç‰‡æ®µï¼ŒåŒæ—¶è®¡ç®—å¯ç”¨å¸¦å®½ï¼Œå†³å®šæ¥ä¸‹æ¥é€‰æ‹©çš„è§†é¢‘ç‰ˆæœ¬ã€‚

### Content Distribution Networks

å’Œ DNS ç±»ä¼¼ï¼Œvideo streaming å¾€å¾€ä¹Ÿä¸èƒ½ä»…é€šè¿‡å•ä¸ª data center å®ç°ï¼Œå› ä¸ºï¼š

-   ç¦»éƒ¨åˆ†ç”¨æˆ·è¿‡è¿œï¼Œè™½ç„¶ streaming å¯¹å»¶æ—¶è¦æ±‚ä¸é«˜ï¼Œä½†æ›´å¤šçš„ communication link å¾ˆå¯èƒ½æ„å‘³ç€æ›´ä½çš„ bottleneck bandwidthã€‚
-   åŒä¸€ä¸ªè§†é¢‘ä¼šåœ¨åŒä¸€ä¸ª communication link ä¸Šè¢«ä¼ è¾“å¤šæ¬¡ï¼Œé€ æˆç½‘ç»œèµ„æºä»¥åŠèµ„è´¹çš„æµªè´¹ã€‚
-   single point of failure

ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œvideo-streaming company å¾€å¾€ä¼šä½¿ç”¨ Content Distribution Networks (CDN) æ¥åˆ†å‘è§†é¢‘ã€‚

CDN ä¼šåœ¨å…¨çƒå„åœ°æ”¾ç½® server (cluster)ï¼Œåœ¨æ¯ä¸ªèŠ‚ç‚¹å­˜æ”¾ä¸€ä»½ content çš„ copyï¼Œåœ¨å¤„ç† user request æ—¶å°½é‡ç”±æœ€å¥½ï¼ˆæœ€è¿‘ï¼‰çš„èŠ‚ç‚¹è´Ÿè´£å“åº”ã€‚

CDN å¯ä»¥æ˜¯ private CDNï¼ˆä¾‹å¦‚ Google çš„ CDNï¼‰æˆ–è€… third-party CDNï¼ˆä¾‹å¦‚ Akamaiã€Limelightã€Level-3ï¼Œ~~ä¹¦ä¸­ç«Ÿç„¶æ²¡æåˆ° Cloudflare~~ï¼‰ã€‚

CDN é€šå¸¸æœ‰ä¸¤ç§æ”¾ç½®ç­–ç•¥ï¼š

-   Enter Deep: æ”¾åœ¨ access ISPï¼Œcluster æ•°é‡å¤šï¼Œæ€§èƒ½æ›´å¥½ï¼Œç»´æŠ¤æˆæœ¬æ›´é«˜ã€‚
-   Bring Home: æ”¾åœ¨ IXPï¼Œcluster æ•°é‡å°‘ï¼Œç»´æŠ¤æˆæœ¬æ›´ä½ï¼Œæ€§èƒ½ç›¸å¯¹å·®ã€‚

CDN çš„æ›´æ–°æœ‰ push å’Œ pull ä¸¤ç§æ–¹å¼ï¼Œpush å°±æ˜¯å†…å®¹æ›´æ–°æ—¶ push åˆ°å„ä¸ª clusterï¼Œpull åˆ™ä¸ cache ç±»ä¼¼ï¼Œåœ¨ cache miss æ—¶å†ä»ä¸Šæ¸¸è·å–å¹¶ï¼ˆåœ¨ stream ç»™ç”¨æˆ·çš„åŒæ—¶ï¼‰ä¿å­˜ä¸‹æ¥ã€‚

å°†ç”¨æˆ·é‡å®šå‘åˆ° CDN èŠ‚ç‚¹çš„ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ DNSï¼šauthoritative DNS server è¿”å› CDN çš„ DNS server çš„ NS recordï¼Œç„¶åå†ç”± CDN çš„ DNS server è¿›è¡ŒèŠ‚ç‚¹é€‰æ‹©å¹¶è¿”å›èŠ‚ç‚¹çš„ IP åœ°å€ã€‚

ï¼ˆåŸºäº DNS è¿›è¡Œ CDN é‡å®šå‘æ—¶ï¼‰ï¼Œé€‰æ‹©èŠ‚ç‚¹çš„ä¸¤ç§æ–¹å¼æ˜¯ï¼š

-   geographically closest: ç”± local DNS server çš„ IP ç¡®å®šåœ°ç†ä½ç½®ï¼Œç„¶åé€‰æ‹©æœ€è¿‘çš„èŠ‚ç‚¹ã€‚è¿™æ ·åšçš„ä¸»è¦é—®é¢˜åœ¨äºï¼Œåœ°ç†ä½ç½®è¿‘ä¸ä¸€å®šæ„å‘³ç€ç½‘ç»œè·ç¦»è¿‘/å¸¦å®½é«˜ï¼Œå¹¶ä¸” local DNS server æœ‰å¯èƒ½ç¦»ç”¨æˆ·å¾ˆè¿œã€‚

-   real-time measurements: å¯ä»¥æ¯éš”ä¸€æ®µæ—¶é—´å‘å„ä¸ª local DNS server å‘é€æ¢æµ‹ä¿¡å·æ¥æ£€æµ‹ç½‘ç»œæ€§èƒ½ï¼Œè¿™æ ·åšçš„ä¸»è¦é—®é¢˜åœ¨äº DNS server å¯èƒ½ä¼šæ‹’ç»å“åº”è¿™æ ·çš„æ¢æµ‹ã€‚

### Case Studies: Netflix and YouTube

Netflix å’Œ YouTube éƒ½æ˜¯å¤§å‹ video streaming æœåŠ¡å•†ï¼Œä½†å®ƒä»¬çš„æ¶æ„æœ‰å¾ˆå¤§ä¸åŒï¼Œè¿™å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”±äºå®ƒä»¬è§†é¢‘ç±»å‹çš„ä¸åŒï¼ˆå‰§ vs UGCï¼‰ã€‚

#### Netflix

Netflix ä½¿ç”¨ Amazon cloud è¿è¡Œ Web server ä»¥åŠè§†é¢‘å¤„ç†ï¼Œè€Œä½¿ç”¨ç§æœ‰çš„ CDN åˆ†å‘è§†é¢‘ã€‚

Netflix çš„ç§æœ‰ CDN cluster å®‰è£…åœ¨ ISP å’Œ IXP ä¸­ï¼Œå…¶ä¸­ IXP çš„ cluster å¾€å¾€å®¹é‡è¾ƒå¤§ï¼Œå¯ä»¥è£…ä¸‹æ•´ä¸ª Netflix çš„æ‰€æœ‰è§†é¢‘çš„å„ä¸ªç‰ˆæœ¬ï¼Œè€Œ ISP çš„ cluster å¾€å¾€å®¹é‡è¾ƒå°ï¼Œåªå­˜æ”¾æœ€çƒ­é—¨çš„è§†é¢‘ã€‚

Netflix ä¸ä½¿ç”¨ pull-cachingï¼Œè€Œæ˜¯åœ¨æ¯å¤©çš„ä½å³°æœŸé‡‡ç”¨ push è¿›è¡Œæ›´æ–°ã€‚

å› ä¸º Netflix çš„ç§æœ‰ CDN åªè´Ÿè´£åˆ†å‘è§†é¢‘ï¼Œå®ƒä¸éœ€è¦ä½¿ç”¨ DNS redirectï¼Œç›´æ¥ç”± Web server å‘Šè¯‰ client IP åœ°å€å³å¯ã€‚

#### YouTube

<Card title="Google çš„ network infrastructure">

Google éƒ¨ç½²äº†ä¸€ä¸ªåºå¤§çš„ private network and CDN infrastructureï¼ŒåŒ…å«ä»¥ä¸‹ä¸‰çº§ server clustersï¼š

1.  çº¦ 20 ä¸ªâ€œmega data centerâ€ï¼Œåˆ†å¸ƒåœ¨åŒ—ç¾ã€æ¬§æ´²å’Œäºšæ´²ï¼Œæ¯ä¸ª cluster æœ‰æ•°åä¸‡æœåŠ¡å™¨ï¼Œç”¨æ¥ serve dynamic contentã€‚
2.  çº¦ 90 ä¸ªéƒ¨ç½²åœ¨ IXP çš„ clusterï¼Œæ¯ä¸ª cluster æœ‰æ•°ç™¾ä¸ªæœåŠ¡å™¨ï¼Œç”¨æ¥ serve åŒ…æ‹¬ YouTube è§†é¢‘åœ¨å†…çš„ static contentã€‚
3.  æ•°ç™¾ä¸ªéƒ¨ç½²åœ¨ access ISP çš„ clusterï¼Œæ¯ä¸ª cluster æœ‰æ•°åä¸ªæœåŠ¡å™¨ï¼Œç”¨æ¥è¿›è¡Œ TCP splitting ä»¥åŠ server static contentï¼Œä¾‹å¦‚ç½‘é¡µä¸Šçš„é™æ€èµ„æºã€‚

åœ¨è®¿é—® Google çš„æœåŠ¡æ—¶ï¼Œä¸åŒå†…å®¹å¾€å¾€ä¼šæ¥è‡ªä¸åŒå±‚çº§çš„ clusterã€‚

è¿™äº› cluster é€šè¿‡ Google çš„ private network è¿æ¥ï¼Œä½¿å¾—å®ƒä»¬ä¹‹é—´çš„å¾ˆå¤šé€šä¿¡éƒ½ä¸ä¾èµ–äº public Internetï¼Œä¸ç”¨æˆ·çš„é€šä¿¡ä¹Ÿå¾€å¾€åªæ¶‰åŠåˆ° access ISP è¿™ä¸€å±‚ã€‚

</Card>

YouTube ä½¿ç”¨ Google çš„ç§æœ‰ CDN åˆ†å‘è§†é¢‘ï¼Œå¹¶ä¸”ä½¿ç”¨ pull-caching å’Œ DNS redirectã€‚åœ¨é€‰æ‹©èŠ‚ç‚¹æ—¶ï¼Œä¼šç»¼åˆè€ƒè™‘ client åˆ° cluster çš„ RTT ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚

åœ¨ç”¨æˆ·ä¸Šä¼ è§†é¢‘æ—¶ï¼Œä¼šåœ¨ Google çš„ data center è¿›è¡Œå¤„ç†ã€‚

## Socket Programming: Creating Network Applications

ä¸€èˆ¬æ¥è¯´ï¼Œç¼–å†™ network application éœ€è¦ç¼–å†™ client program å’Œ server programã€‚

### Socket Programming with UDP

ä½¿ç”¨ UDP æ—¶ï¼Œæ¯æ¬¡å‘é€ datagram[^datagram] éƒ½éœ€è¦æŒ‡å®š addressï¼ˆIP åœ°å€ & ç«¯å£ï¼‰ï¼Œæ¥æ”¶ datagram æ—¶ä¹Ÿä¼šæ”¶åˆ°å¯¹æ–¹çš„ addressã€‚

[^datagram]: åœ¨ä¹¦ä¸­ 1.5 èŠ‚ï¼Œtransport-layer packet è¢«ç§°ä½œ â€œsegmentâ€ï¼Œnetwork-layer packet è¢«ç§°ä½œ â€œdatagramâ€ï¼Œä½†å®é™…ä¸Š UDP çš„ â€œDâ€ å°±æ˜¯ â€œdatagramâ€ï¼Œè€Œ TCP çš„ packet æ‰å« â€œsegmentâ€ã€‚ref: [networking - Definition of Network Units: Fragment, Segment, Packet, Frame, Datagram - Stack Overflow](https://stackoverflow.com/questions/11636405/definition-of-network-units-fragment-segment-packet-frame-datagram)

~~ä¸€çœ‹å°±æ‡‚ä½†ä¹¦ä¸Šè§£é‡Šäº†åŠå¤©çš„~~ ä¾‹å­ï¼š

\`\`\`python
from socket import *
serverName = 'hostname'
serverPort = 12000
clientSocket = socket(AF_INET, SOCK_DGRAM) # AF_INET è¡¨ç¤º IPv4 åœ°å€ï¼ŒSOCK_DGRAM è¡¨ç¤º UDP
message = input('Input lowercase sentence:')
clientSocket.sendto(message.encode(), (serverName, serverPort))
modifiedMessage, serverAddress = clientSocket.recvfrom(2048) # 2048 æ˜¯ buffer size
print(modifiedMessage.decode())
clientSocket.close()
\`\`\`

\`\`\`python
from socket import *
serverPort = 12000
serverSocket = socket(AF_INET, SOCK_DGRAM)
serverSocket.bind(('', serverPort))
print('The server is ready to receive')
while True:
    message, clientAddress = serverSocket.recvfrom(2048)
    modifiedMessage = message.decode().upper()
    serverSocket.sendto(modifiedMessage.encode(), clientAddress)
\`\`\`

### Socket Programming with TCP

TCP æ˜¯ä¸€ä¸ª connection-oriented protocolï¼Œåœ¨ server ä¸Šåˆ†ä¸º welcoming socket å’Œ connection socketï¼Œä¸€å¼€å§‹éœ€è¦é€šè¿‡ welcoming socket å»ºç«‹ connection å¹¶å¾—åˆ° connection socketï¼Œè€Œåœ¨å»ºç«‹äº† connection ä¹‹åå°±æ— éœ€å†æŒ‡å®šå¯¹æ–¹çš„ addressã€‚

ï¼ˆä¸‹é¢çš„ä»£ç é™¤äº†æ¢æˆ TCP è¿˜å¯¹ä¸Šé¢çš„ UDP ä»£ç æœ‰è‹¥å¹²æ²¡æœ‰æœ¬è´¨åŒºåˆ«çš„ä¿®æ”¹ï¼Œè¦æ˜¯æˆ‘å†™è‚¯å®šä¼šé¿å…ï¼Œä½†æ˜¯ä»ä¹¦ä¸Šå¤åˆ¶å°±æ‡’å¾—æ”¹äº†ã€‚ï¼‰

\`\`\`python
from socket import *
serverName = 'servername'
serverPort = 12000
clientSocket = socket(AF_INET, SOCK_STREAM) # SOCK_STREAM æ˜¯ TCP
clientSocket.connect((serverName, serverPort))
sentence = input('Input lowercase sentence:')
clientSocket.send(sentence.encode())
modifiedSentence = clientSocket.recv(1024)
print('From Server: ', modifiedSentence.decode())
clientSocket.close()
\`\`\`

\`\`\`python
from socket import *
serverPort = 12000
serverSocket = socket(AF_INET, SOCK_STREAM)
serverSocket.bind(('', serverPort))
serverSocket.listen(1) # 1 æ˜¯ connection queue çš„æœ€å¤§é•¿åº¦
print('The server is ready to receive')
while True:
    connectionSocket, addr = serverSocket.accept()
    sentence = connectionSocket.recv(1024).decode()
    capitalizedSentence = sentence.upper()
    connectionSocket.send(capitalizedSentence.encode())
    connectionSocket.close()
\`\`\`
`}],meta:[{frontmatter:{title:l,date:new Date(1543988421e3),tags:j,lastUpdated:new Date(1685374454e3),published:new Date(1658482129e3),visitor:2692},href:"/about",filename:"src/pages/about.mdx"},{frontmatter:{title:m,date:new Date(165966831e4),image:"/images/2022/08/busuanzi-and-live2d.png",tags:["busuanzi","live2d",O,o,a],lastUpdated:new Date(1659678915e3),published:new Date(1659678915e3),visitor:r},href:"/post/2022/08/busuanzi-and-live2d",filename:"src/pages/post/2022/08/busuanzi-and-live2d.mdx"},{frontmatter:{title:d,date:new Date(1660492135e3),image:"https://www.rust-lang.org/static/images/rust-social-wide.jpg",tags:["Rust",c],lastUpdated:new Date(1662783413e3),published:new Date(1660576305e3),visitor:266},href:"/post/2022/08/learn-rust",filename:"src/pages/post/2022/08/learn-rust.mdx"},{frontmatter:{title:p,date:new Date(1658549297e3),tags:["btrfs","Arch Linux",a],image:"/images/2022/07/btrfs-quota-timeshift-message-screenshot.png",lastUpdated:new Date(1658586466e3),published:new Date(1658552603e3),visitor:r},href:"/post/2022/07/btrfs-quota-timeshift-freeze",filename:"src/pages/post/2022/07/btrfs-quota-timeshift-freeze.mdx"},{frontmatter:{title:F,date:new Date(1658582944e3),image:"/images/2022/07/comments-loading-light.png",tags:[q,o,a],lastUpdated:new Date(1659536455e3),published:new Date(1658587665e3),visitor:86},href:"/post/2022/07/display-none-and-lazy-load",filename:"src/pages/post/2022/07/display-none-and-lazy-load.mdx"},{frontmatter:{title:g,date:new Date(1658728987e3),image:"/images/2022/07/all-in-wl.png",tags:["é€‰è¯¾","THU",s],lastUpdated:new Date(1685025943e3),published:new Date(1658754332e3),visitor:766},href:"/post/2022/07/thu-course-selection-tips",filename:"src/pages/post/2022/07/thu-course-selection-tips.mdx"},{frontmatter:{title:b,date:new Date(1659161767e3),image:"/images/2022/07/uptime-kuma-list.png",tags:["caddy-security","uptime-kuma","caddy","server",a],lastUpdated:new Date(1659165466e3),published:new Date(1659165466e3),visitor:78},href:"/post/2022/07/uptime-monitoring-under-caddy-security",filename:"src/pages/post/2022/07/uptime-monitoring-under-caddy-security.mdx"},{frontmatter:{title:h,date:new Date(1663478897e3),image:"/images/2022/09/csapp-2.png",tags:[e,n],lastUpdated:new Date(166399937e4),published:new Date(166351913e4),visitor:114},href:"/post/2022/09/csapp-2",filename:"src/pages/post/2022/09/csapp-2.mdx"},{frontmatter:{title:f,date:new Date(1663553588e3),image:"/images/2022/09/csapp-3.png",tags:[e,n],lastUpdated:new Date(1673269583e3),published:new Date(166399937e4),visitor:r},href:"/post/2022/09/csapp-3",filename:"src/pages/post/2022/09/csapp-3.mdx"},{frontmatter:{title:v,date:new Date(1663478888e3),image:"https://csapp.cs.cmu.edu/3e/images/csapp3e-cover.jpg",tags:[e,n],lastUpdated:new Date(1665973845e3),published:new Date(166351913e4),visitor:149},href:"/post/2022/09/csapp",filename:"src/pages/post/2022/09/csapp.mdx"},{frontmatter:{title:C,date:new Date(1667202147e3),tags:["TeX","R","ç‰©ç†å®éªŒ",s],lastUpdated:new Date(1679113234e3),published:new Date(1667211348e3),visitor:257},href:"/post/2022/10/basic-tex-and-r-for-physics-lab",filename:"src/pages/post/2022/10/basic-tex-and-R-for-physics-lab.mdx"},{frontmatter:{title:y,date:new Date(1664805493e3),image:"/images/2022/10/csapp-4.png",copyrightNotice:"æœ¬æ–‡åŒ…å«æˆªè‡ª CS:APP ä¸­çš„å›¾ç‰‡ï¼Œæ–‡ç« ä½œè€…å¯¹å…¶ä¸æ‹¥æœ‰ç‰ˆæƒã€‚",tags:[e,n,"WIP"],lastUpdated:new Date(1673710372e3),published:new Date(1665973845e3),visitor:79},href:"/post/2022/10/csapp-4",filename:"src/pages/post/2022/10/csapp-4.mdx"},{frontmatter:{title:x,date:new Date(1665975415e3),image:"/images/2022/10/csapp-7.png",copyrightNotice:"æœ¬æ–‡åŒ…å«å°‘é‡ç›´æ¥ä» CS:APP ä¸­å¤åˆ¶çš„ä»£ç ã€å›¾ç‰‡ï¼Œæœ¬æ–‡ä½œè€…å¯¹å…¶ä¸æ‹¥æœ‰ç‰ˆæƒã€‚",tags:[e,n],lastUpdated:new Date(1671291937e3),published:new Date(1667212746e3),visitor:96},href:"/post/2022/10/csapp-7",filename:"src/pages/post/2022/10/csapp-7.mdx"},{frontmatter:{title:w,date:new Date(1666077048e3),image:"/images/2022/10/use_vector_fp_converts-test-results.png",tags:["gcc","æ€§èƒ½ä¼˜åŒ–",a],lastUpdated:new Date(166625156e4),published:new Date(1666197777e3),visitor:U},href:"/post/2022/10/gcc-use_vector_fp_converts",filename:"src/pages/post/2022/10/gcc-use_vector_fp_converts.mdx"},{frontmatter:{title:E,date:new Date(1668736861e3),image:"/images/2022/11/csapp-8.png",tags:[e,n],lastUpdated:new Date(1671350958e3),published:new Date(1671258446e3),visitor:34},href:"/post/2022/11/csapp-8",filename:"src/pages/post/2022/11/csapp-8.mdx"},{frontmatter:{title:S,date:new Date(1669198242e3),image:"/images/2022/11/csapp-9.png",copyrightNotice:G,tags:[e,n],lastUpdated:new Date(1686757177e3),published:new Date(1672037059e3),visitor:69},href:"/post/2022/11/csapp-9",filename:"src/pages/post/2022/11/csapp-9.mdx"},{frontmatter:{title:k,date:new Date(1668050758e3),image:"/images/2022/11/swim.jpg",tags:["æ¸¸æ³³",s],lastUpdated:new Date(1668053703e3),published:new Date(1668053703e3),visitor:183},href:"/post/2022/11/pitfalls-of-breaststroke-breathing",filename:"src/pages/post/2022/11/pitfalls-of-breaststroke-breathing.mdx"},{frontmatter:{title:P,date:new Date(1670046303e3),image:"/images/2022/12/csapp-6.png",copyrightNotice:G,tags:[e,n],lastUpdated:new Date(1670226463e3),published:new Date(1670226463e3),visitor:148},href:"/post/2022/12/csapp-6",filename:"src/pages/post/2022/12/csapp-6.mdx"},{frontmatter:{title:D,date:new Date(1674304358e3),image:"/images/2023/01/ddpp-2.png",copyrightNotice:"æœ¬æ–‡åŒ…å«è‹¥å¹²æˆªè‡ª DDPP çš„å›¾ç‰‡ï¼Œæœ¬æ–‡ä½œè€…å¯¹å…¶ä¸æ‹¥æœ‰ç‰ˆæƒã€‚",tags:[u,n],lastUpdated:new Date(1674571032e3),published:new Date(1674571032e3),visitor:52},href:"/post/2023/01/ddpp-2",filename:"src/pages/post/2023/01/ddpp-2.mdx"},{frontmatter:{title:A,date:new Date(167461137e4),image:"/images/2023/01/ddpp-3.png",tags:[u,n],lastUpdated:new Date(1674978752e3),published:new Date(1674978752e3),visitor:54},href:"/post/2023/01/ddpp-3",filename:"src/pages/post/2023/01/ddpp-3.mdx"},{frontmatter:{title:T,date:new Date(167513277e4),copyrightNotice:"æœ¬æ–‡åŒ…å«è‹¥å¹²æˆªè‡ª DDPP çš„å›¾ç‰‡ï¼Œæœ¬æ–‡ä½œè€…å¯¹å®ƒä»¬ä¸æ‹¥æœ‰ç‰ˆæƒã€‚",image:"/images/2023/01/ddpp-4.png",tags:[u,n],lastUpdated:new Date(1675756712e3),published:new Date(1675756712e3),visitor:104},href:"/post/2023/01/ddpp-4",filename:"src/pages/post/2023/01/ddpp-4.mdx"},{frontmatter:{title:_,date:new Date(1673779818e3),image:"/images/2023/01/ddpp-cover.png",tags:[u,n],lastUpdated:new Date(1674297595e3),published:new Date(1673783362e3),visitor:U},href:"/post/2023/01/ddpp",filename:"src/pages/post/2023/01/ddpp.mdx"},{frontmatter:{title:L,date:new Date(1674119026e3),image:"/images/2023/01/glyph-segregator.png",tags:[X,o,"é¡¹ç›®å¼€å‘"],lastUpdated:new Date(1675319173e3),published:new Date(1674134105e3),visitor:247},href:"/post/2023/01/glyph-segregator",filename:"src/pages/post/2023/01/glyph-segregator.mdx"},{frontmatter:{title:$,date:new Date(1674981968e3),image:j,tags:[O,a],lastUpdated:new Date(1674994592e3),published:new Date(1674994592e3),visitor:60},href:"/post/2023/01/string-prototype-replace",filename:"src/pages/post/2023/01/string-prototype-replace.mdx"},{frontmatter:{title:I,date:new Date(1675942597e3),image:"/images/2023/02/css-is-awesome.jpeg",tags:[X,q,o,s],lastUpdated:new Date(1686240934e3),published:new Date(1675955985e3),visitor:219},href:"/post/2023/02/typography-tricks",filename:"src/pages/post/2023/02/typography-tricks.mdx"},{frontmatter:{title:N,date:new Date(1677723446e3),image:"/images/2023/03/dd-dc.jpg",tags:["digital-design",c],lastUpdated:new Date(1687442019e3),published:new Date(1677728814e3),visitor:261},href:"/post/2023/03/digital-logic",filename:"src/pages/post/2023/03/digital-logic.mdx"},{frontmatter:{title:M,date:new Date(1677762549e3),image:"/images/2023/03/tech-stack.jpg",tags:[o,c],lastUpdated:new Date(1685286644e3),published:new Date(1677901349e3),visitor:528},href:"/post/2023/03/thuse",filename:"src/pages/post/2023/03/thuse.mdx"},{frontmatter:{title:R,date:new Date(1680771173e3),image:"/images/2023/04/ddpp-5.png",tags:[u,n],lastUpdated:new Date(1682785476e3),published:new Date(1682785476e3),visitor:101},href:"/post/2023/04/ddpp-5",filename:"src/pages/post/2023/04/ddpp-5.mdx"},{frontmatter:{title:z,date:new Date(1686573752e3),image:"/images/2023/06/cnatda-2.png",tags:["cnatda",n],lastUpdated:new Date(1687100673e3),published:new Date(1686929074e3),visitor:16},href:"/post/2023/06/cnatda-2",filename:"src/pages/post/2023/06/cnatda-2.mdx"}]}}("å­¦ä¹ ç¬”è®°","csapp","csapp å­¦ä¹ ç¬”è®°","é—®é¢˜è§£å†³è®°å½•","ddpp å­¦ä¹ ç¬”è®°","Web","ddpp","ç»éªŒåˆ†äº«",167,"å­¦ä¹ è®°å½•","å…³äº","busuanzi è®¿é—®é‡ç»Ÿè®¡ä¸ live2d æ’ä»¶åŒæ—¶ä½¿ç”¨å¯¼è‡´ busuanzi ä¸æ˜¾ç¤ºçš„æ ¹æœ¬åŸå› ä»¥åŠè§£å†³æ–¹æ³•","åˆå­¦ Rust","Btrfs Quota ä»¥åŠ Timeshift å¯¼è‡´çš„ç³»ç»Ÿæ— å“åº”é—®é¢˜è§£å†³è¿‡ç¨‹è®°å½•",'display: none ä¸ loading="lazy"',"æœ‰å…³ THU é€‰è¯¾çš„ä¸€äº›å¸¸è§é—®é¢˜ä¸æ³¨æ„äº‹é¡¹","ä½¿ç”¨ Caddy Security æ—¶çš„ Uptime ç›‘æ§","CS:APP ç¬¬äºŒç« å­¦ä¹ ç¬”è®°","CS:APP ç¬¬ä¸‰ç« å­¦ä¹ ç¬”è®°","CS:APP å­¦ä¹ ç¬”è®°ç³»åˆ— åº","æ™®ç‰©å®éªŒ TeX & R æ€¥æ•‘æŒ‡åŒ—","CS:APP ç¬¬å››ç« å­¦ä¹ ç¬”è®°","CS:APP ç¬¬ä¸ƒç« å­¦ä¹ ç¬”è®°","æ¢ç©¶ gcc æµ®ç‚¹æ•°ç²¾åº¦è½¬æ¢æ‰€ä½¿ç”¨çš„æŒ‡ä»¤ â€”â€” use_vector_fp_converts ä¼˜åŒ–","CS:APP ç¬¬å…«ç« å­¦ä¹ ç¬”è®°","CS:APP ç¬¬ä¹ç« å­¦ä¹ ç¬”è®°","è›™æ³³æ¢æ°”è¸©å‘è®°å½•","CS:APP ç¬¬å…­ç« å­¦ä¹ ç¬”è®°","DDPP ç¬¬äºŒç« å­¦ä¹ ç¬”è®°","DDPP ç¬¬ä¸‰ç« å­¦ä¹ ç¬”è®°","DDPP ç¬¬å››ç« å­¦ä¹ ç¬”è®°","DDPP å­¦ä¹ ç¬”è®°ç³»åˆ— åº","å¦ä¸€ç§å¾ˆæ–°çš„ä¸­æ–‡å­—ä½“ç½‘é¡µåµŒå…¥æ–¹æ¡ˆ","String.prototype.replace ä¸éšè—çš„â€œ$â€","ä¸€äº›åšå®¢æ’ç‰ˆä¼˜åŒ–å° trick","æ•°å­—é€»è¾‘å®éªŒåˆ°åº•æ˜¯æ•°ç”µå®éªŒè¿˜æ˜¯æ•°è®¾å®éªŒï¼ˆx","å½“ä½ çš„æŠ€æœ¯æ ˆä¸è½¯å·¥äº¤é›†ä¸ºç©ºï¼ˆx","DDPP ç¬¬äº”ç« å­¦ä¹ ç¬”è®°","CNATDA ç¬¬äºŒç« å­¦ä¹ ç¬”è®°",null,"JavaScript","CSS",116,"æœ¬æ–‡åŒ…å«è‹¥å¹²æˆªè‡ª CS:APP ä¸­çš„å›¾ç‰‡ï¼Œæœ¬æ–‡ä½œè€…å¯¹å…¶ä¸æ‹¥æœ‰ç‰ˆæƒã€‚","blog"),{});
</script></main><footer class="flex flex-col gap-1 bg-card p-6 text-footer" itemprop="hasPart" itemscope="" itemtype="https://schema.org/WPFooter"><div class="flex flex-wrap items-center justify-center gap-x-1"><span>Copyright Â©</span><span>2022 - 2023</span><a class="flex items-center" href="/sponsor" title="èµèµæ”¯æŒ"><span class="i-mdi-heart text-red dark:text-red-7"></span></a><span>ouuan</span><span class="i-mdi-circle-small"></span><span title="å®é™…ä¸Šï¼Œä¸ºäº†ä¿æŠ¤ç”¨æˆ·éšç§ï¼ŒåŒä¸€ç”¨æˆ·çš„å¤šæ¬¡è®¿é—®åªæœ‰åœ¨åŒä¸€å¤©å†…ä½¿ç”¨åŒä¸€æµè§ˆå™¨åœ¨åŒä¸€ipä¸‹æ‰ä¼šè¢«ç®—ä½œåŒä¸€äºº"> å…±æœ‰ <ile-root id="ile-3"><span><span class="i-mdi-loading motion-safe:animate-spin"></span><span class="sr-only">åŠ è½½ä¸­</span></span></ile-root><script></script><script type="module" async="">var p=(o,a)=>()=>(a||o((a={exports:{}}).exports,a),a.exports);var r=(o,a,_)=>new Promise((c,n)=>{var f=t=>{try{e(_.next(t))}catch(i){n(i)}},l=t=>{try{e(_.throw(t))}catch(i){n(i)}},e=t=>t.done?c(t.value):Promise.resolve(t.value).then(f,l);e((_=_.apply(o,a)).next())});import{_ as d}from"/assets/vite.5ce4fca4.js";import{a as s}from"/assets/iles.711ac573.js";import"/assets/vendor-vue.d1fa473f.js";var E=p(m=>{const u=()=>r(m,null,function*(){return(yield d(()=>import("/assets/iles.711ac573.js").then(o=>o.v),["assets/iles.711ac573.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).default}),v=()=>r(m,null,function*(){return(yield d(()=>import("/assets/VisitorCount.1a9c969d.js"),["assets/VisitorCount.1a9c969d.js","assets/VisitorCount.068d91fc.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).default});s(u,v,"ile-3",{},{})});export default E();
</script> äººåˆ°è®¿è¿‡è¿™é‡Œ </span></div><div class="flex flex-wrap items-center justify-center gap-x-1"> åŸºäº <a class="underline" href="https://github.com/ElMassimo/iles">Ã®les</a> åŠ <a class="underline" href="https://github.com/ouuan/iles-blog/blob/master/package.json">å¾ˆå¤šå…¶ä»–é¡¹ç›®</a><span class="i-mdi-circle-small"></span><span>ç”± ouuan è®¾è®¡/åˆ¶ä½œ</span><span class="i-mdi-circle-small"></span><a class="underline" href="https://github.com/ouuan/iles-blog">æºä»£ç </a><span class="i-mdi-circle-small"></span><a class="underline" href="https://github.com/ouuan/iles-blog/discussions">Discussions</a></div></footer><meta itemprop="copyrightYear" content="2022 - 2023"><div class="hidden" itemscope="" itemtype="https://schema.org/Person" itemprop="copyrightHolder"><meta itemprop="name" content="ouuan"><meta itemprop="givenName" content="Yufan"><meta itemprop="familyName" content="You"><meta itemprop="url" content="https://github.com/ouuan"><link itemprop="gender" href="https://schema.org/Male"><meta itemprop="image" content="/android-chrome-512x512.png"></div><ile-root id="ile-4"><button class="group bottom-10 flex-col floating-button" title="å‰å¾€åº•éƒ¨"><div aria-hidden="true" class="flex justify-center"><span class="i-mdi-chevron-double-up motion-safe:transition-font-size text-0"></span></div><div aria-hidden="true" class="text-0 group-hover:text-3.5 motion-safe:transition-font-size"></div><div aria-hidden="false" class="flex justify-center"><span class="i-mdi-chevron-double-down motion-safe:transition-font-size text-5 group-hover:text-3"></span></div></button></ile-root><script></script><script type="module" async="">var p=(o,a)=>()=>(a||o((a={exports:{}}).exports,a),a.exports);var r=(o,a,_)=>new Promise((c,n)=>{var f=t=>{try{e(_.next(t))}catch(i){n(i)}},l=t=>{try{e(_.throw(t))}catch(i){n(i)}},e=t=>t.done?c(t.value):Promise.resolve(t.value).then(f,l);e((_=_.apply(o,a)).next())});import{_ as d}from"/assets/vite.5ce4fca4.js";import{a as s}from"/assets/iles.711ac573.js";import"/assets/vendor-vue.d1fa473f.js";var E=p(m=>{const u=()=>r(m,null,function*(){return(yield d(()=>import("/assets/iles.711ac573.js").then(o=>o.v),["assets/iles.711ac573.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).default}),v=()=>r(m,null,function*(){return(yield d(()=>import("/assets/BackToTop.b0336ef3.js"),["assets/BackToTop.b0336ef3.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).default});s(u,v,"ile-4",{},{})});export default E();
</script><div class="hidden"></div><ile-root id="ile-5"></ile-root><script></script><script type="module" async="">var p=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports);var e=(t,a,_)=>new Promise((c,n)=>{var f=o=>{try{i(_.next(o))}catch(r){n(r)}},l=o=>{try{i(_.throw(o))}catch(r){n(r)}},i=o=>o.done?c(o.value):Promise.resolve(o.value).then(f,l);i((_=_.apply(t,a)).next())});import{_ as d}from"/assets/vite.5ce4fca4.js";import{a as s}from"/assets/iles.711ac573.js";import"/assets/vendor-vue.d1fa473f.js";var u=p(m=>{const E=()=>e(m,null,function*(){return(yield d(()=>import("/assets/iles.711ac573.js").then(t=>t.d),["assets/iles.711ac573.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).default}),h=()=>e(m,null,function*(){return(yield d(()=>import("/assets/PlausibleTrigger.ee0b10be.js"),["assets/PlausibleTrigger.ee0b10be.js","assets/plausible.f054cf89.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).onLoad});s(E,h,"ile-5",{},{})});export default u();
</script><div></div><ile-root id="ile-6"></ile-root><script></script><script type="module" async="">var p=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports);var e=(t,a,_)=>new Promise((c,n)=>{var f=o=>{try{i(_.next(o))}catch(r){n(r)}},l=o=>{try{i(_.throw(o))}catch(r){n(r)}},i=o=>o.done?c(o.value):Promise.resolve(o.value).then(f,l);i((_=_.apply(t,a)).next())});import{_ as d}from"/assets/vite.5ce4fca4.js";import{a as s}from"/assets/iles.711ac573.js";import"/assets/vendor-vue.d1fa473f.js";var u=p(m=>{const E=()=>e(m,null,function*(){return(yield d(()=>import("/assets/iles.711ac573.js").then(t=>t.d),["assets/iles.711ac573.js","assets/vendor-vue.d1fa473f.js","assets/vite.5ce4fca4.js"])).default}),h=()=>e(m,null,function*(){return(yield d(()=>import("/assets/TextJustifyFix.4fa5e997.js"),[])).onLoad});s(E,h,"ile-6",{},{})});export default u();
</script><meta itemprop="inLanguage" content="zh-CN"></div>
  
</body></html>