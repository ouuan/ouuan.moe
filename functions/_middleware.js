function s(t,e){var a=x(t,e,"get");return E(t,a)}function v(t,e,a){var n=x(t,e,"set");return P(t,n,a),a}function x(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}function E(t,e){return e.get?e.get.call(t):e.value}function P(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}function d(t,e,a){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return a}function k(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(t,e,a){k(t,e),e.set(t,a)}function b(t,e){k(t,e),e.add(t)}var j=[" daum[ /]"," deusu/"," yadirectfetcher","(?:^| )site","(?:^|[^g])news","@[a-z]","\\(at\\)[a-z]","\\(github\\.com/","\\[at\\][a-z]","^12345","^<","^[\\w \\.\\-\\(\\)]+(/v?\\d+(\\.\\d+)?(\\.\\d{1,10})?)?$","^[^ ]{50,}$","^active","^ad muncher","^amaya","^anglesharp/","^anonymous","^avsdevicesdk/","^axios/","^bidtellect/","^biglotron","^btwebclient/","^castro","^clamav[ /]","^client/","^cobweb/","^coccoc","^custom","^ddg[_-]android","^discourse","^dispatch/\\d","^downcast/","^duckduckgo","^facebook","^fdm[ /]\\d","^getright/","^gozilla/","^hatena","^hobbit","^hotzonu","^hwcdn/","^jeode/","^jetty/","^jigsaw","^linkdex","^lwp[-: ]","^metauri","^microsoft bits","^movabletype","^mozilla/\\d\\.\\d \\(compatible;?\\)$","^mozilla/\\d\\.\\d \\w*$","^navermailapp","^netsurf","^offline explorer","^php","^postman","^postrank","^python","^read","^reed","^restsharp/","^snapchat","^space bison","^svn","^swcd ","^taringa","^test certificate info","^thumbor/","^tumblr/","^user-agent:mozilla","^valid","^venus/fedoraplanet","^w3c","^webbandit/","^webcopier","^wget","^whatsapp","^xenu link sleuth","^yahoo","^yandex","^zdm/\\d","^zoom marketplace/","^{{.*}}$","adbeat\\.com","appinsights","archive","ask jeeves/teoma","bit\\.ly/","bluecoat drtr","bot","browsex","burpcollaborator","capture","catch","check","chrome-lighthouse","chromeframe","cloud","crawl","cryptoapi","dareboost","datanyze","dataprovider","dejaclick","dmbrowser","download","evc-batch/","feed","firephp","freesafeip","ghost","gomezagent","google","headlesschrome/","http","httrack","hubspot marketing grader","hydra","ibisbrowser","images","iplabel","ips-agent","java","library","mail\\.ru/","manager","monitor","morningscore/","neustar wpm","nutch","offbyone","optimize","pageburst","pagespeed","perl","phantom","pingdom","powermarks","preview","proxy","ptst[ /]\\d","reader","rexx;","rigor","rss","scan","scrape","search","serp ?reputation ?management","server","sogou","sparkler/","speedcurve","spider","statuscake","stumbleupon\\.com","supercleaner","synapse","synthetic","taginspector/","torrent","tracemyfile","transcoder","trendsmapresolver","twingly recon","url","virtuoso","wappalyzer","webglance","webkit2png","websitemetadataretriever","whatcms/","wordpress","zgrab"];function A(t){try{new RegExp("(?<! cu)bot").test("dangerbot")}catch{return t}return[["bot","(?<! cu)bot"],["google","(?<! (?:channel/|google/))google(?!(app|/google| pixel))"],["http","(?<!(?:lib))http"],["java","java(?!;)"],["search","(?<! ya(?:yandex)?)search"]].forEach(e=>{let[a,n]=e,i=t.lastIndexOf(a);~i&&t.splice(i,1,n)}),t}A(j);var z="i",o=new WeakMap,h=new WeakMap,p=new WeakSet,u=new WeakSet,m=class t{constructor(e){return b(this,u),b(this,p),w(this,o,{writable:!0,value:void 0}),w(this,h,{writable:!0,value:void 0}),v(this,o,e||j.slice()),d(this,p,g).call(this),Object.defineProperties(n=>this.test(n),Object.entries(Object.getOwnPropertyDescriptors(t.prototype)).reduce((n,i)=>{let[r,c]=i;return typeof c.value=="function"&&Object.assign(n,{[r]:{value:this[r].bind(this)}}),typeof c.get=="function"&&Object.assign(n,{[r]:{get:()=>this[r]}}),n},{}))}get pattern(){return new RegExp(s(this,h))}test(e){return!!e&&s(this,h).test(e)}find(){let a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").match(s(this,h));return a&&a[0]}matches(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return s(this,o).filter(a=>new RegExp(a,z).test(e))}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this.exclude(this.matches(e))}extend(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];[].push.apply(s(this,o),e.filter(a=>d(this,u,y).call(this,a)===-1).map(a=>a.toLowerCase())),d(this,p,g).call(this)}exclude(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],{length:a}=e;for(;a--;){let n=d(this,u,y).call(this,e[a]);n>-1&&s(this,o).splice(n,1)}d(this,p,g).call(this)}spawn(e){return new t(e||s(this,o))}};function g(){v(this,h,new RegExp(s(this,o).join("|"),z))}function y(t){return s(this,o).indexOf(t.toLowerCase())}var _=new m;var O="feed.ouuan.moe",S="https://plausible.ouuan.moe";async function U(t){let e=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(a)).map(r=>r.toString(16).padStart(2,"0")).join("")}async function F(t){let e=t.headers.get("Referer"),a=t.headers.get("User-Agent")||"Unknown UA",n=t.headers.get("CF-Connecting-IP")||"Unknown IP",i=await U(`${a}-${n}`),r=_.find(a);async function c($,f){try{let l=await fetch(`${S}/api/event`,{method:"POST",headers:{"User-Agent":`${r?"Mozilla/5.0 (X11; Linux x86_64; rv:107.0) Gecko/20100101 Firefox/107.0":a} (${i})`,"Content-Type":"application/json"},body:JSON.stringify({domain:O,name:$,url:t.url,...e&&{referer:e},...f&&{props:JSON.stringify(f)}})});l.ok||console.log(`${l.status}: ${await l.text()}`)}catch(l){console.log(l)}}await c("pageview"),await c("Feed",{bot:r||"Not A Bot"})}var C=t=>{let{request:e}=t;return/\/feed\.(xml|atom|json)\/*$/.test(new URL(e.url).pathname)&&t.waitUntil(F(e)),t.next()};export{C as onRequestGet};
