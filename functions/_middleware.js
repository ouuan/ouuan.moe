function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function $(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function x(e,t){return T(e)||I(e,t)||U(e,t)||R()}function T(e){if(Array.isArray(e))return e}function I(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r=[],a=!0,i=!1,c,o;try{for(n=n.call(e);!(a=(c=n.next()).done)&&(r.push(c.value),!(t&&r.length===t));a=!0);}catch(u){i=!0,o=u}finally{try{!a&&n.return!=null&&n.return()}finally{if(i)throw o}}return r}}function U(e,t){if(e){if(typeof e=="string")return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}}function v(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function R(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s(e,t){var n=j(e,t,"get");return F(e,n)}function A(e,t,n){var r=j(e,t,"set");return C(e,r,n),n}function j(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function F(e,t){return t.get?t.get.call(e):t.value}function C(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}function h(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function z(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(e,t,n){z(e,t),t.set(e,n)}function k(e,t){z(e,t),t.add(e)}var O=[" daum[ /]"," deusu/","(?:^| )site","@[a-z]","\\(at\\)[a-z]","\\(github\\.com/","\\[at\\][a-z]","^12345","^<","^[\\w \\.\\-\\(\\)]+(/v?\\d+(\\.\\d+)?(\\.\\d{1,10})?)?$","^[^ ]{50,}$","^active","^ad muncher","^anglesharp/","^anonymous","^avsdevicesdk/","^axios/","^bidtellect/","^biglotron","^castro","^clamav[ /]","^cobweb/","^coccoc","^custom","^ddg[_-]android","^discourse","^dispatch/\\d","^downcast/","^duckduckgo","^facebook","^fdm[ /]\\d","^getright/","^gozilla/","^hatena","^hobbit","^hotzonu","^hwcdn/","^jeode/","^jetty/","^jigsaw","^linkdex","^lwp[-: ]","^metauri","^microsoft bits","^movabletype","^mozilla/\\d\\.\\d \\(compatible;?\\)$","^mozilla/\\d\\.\\d \\w*$","^navermailapp","^netsurf","^offline explorer","^phantom","^php","^postman","^postrank","^python","^read","^reed","^restsharp/","^snapchat","^space bison","^svn","^swcd ","^taringa","^test certificate info","^thumbor/","^tumblr/","^user-agent:mozilla","^valid","^venus/fedoraplanet","^w3c","^webbandit/","^webcopier","^wget","^whatsapp","^xenu link sleuth","^yahoo","^yandex","^zdm/\\d","^zoom marketplace/","^{{.*}}$","adbeat\\.com","appinsights","archive","ask jeeves/teoma","bit\\.ly/","bluecoat drtr","bot","browsex","burpcollaborator","capture","catch","check","chrome-lighthouse","chromeframe","client","cloud","crawl","dareboost","datanyze","dataprovider","dejaclick","dmbrowser","download","evc-batch/","feed","firephp","freesafeip","ghost","gomezagent","google","headlesschrome/","http","httrack","hubspot marketing grader","hydra","ibisbrowser","images","iplabel","ips-agent","java","library","mail\\.ru/","manager","monitor","morningscore/","neustar wpm","news","nutch","offbyone","optimize","pageburst","pagespeed","perl","pingdom","powermarks","preview","proxy","ptst[ /]\\d","reader","rexx;","rigor","rss","scan","scrape","search","serp ?reputation ?management","server","sogou","sparkler/","spider","statuscake","stumbleupon\\.com","supercleaner","synapse","synthetic","taginspector/","torrent","tracemyfile","transcoder","trendsmapresolver","twingly recon","url","virtuoso","wappalyzer","webglance","webkit2png","websitemetadataretriever","whatcms/","wordpress","zgrab"];function G(e){try{new RegExp("(?<! cu)bot").test("dangerbot")}catch{return e}return[["bot","(?<! cu)bot"],["google","(?<! (?:channel/|google/))google(?!(app|/google| pixel))"],["http","(?<!(?:lib))http"],["java","java(?!;)"],["search","(?<! ya(?:yandex)?)search"]].forEach(function(t){var n=x(t,2),r=n[0],a=n[1],i=e.lastIndexOf(r);~i&&e.splice(i,1,a)}),e}G(O);var S="i",l=new WeakMap,d=new WeakMap,p=new WeakSet,g=new WeakSet,L=function(){function e(t){var n=this;E(this,e),k(this,g),k(this,p),w(this,l,{writable:!0,value:void 0}),w(this,d,{writable:!0,value:void 0}),A(this,l,t||O.slice()),h(this,p,m).call(this);var r=function(i){return n.test(i)};return Object.defineProperties(r,Object.entries(Object.getOwnPropertyDescriptors(e.prototype)).reduce(function(a,i){var c=x(i,2),o=c[0],u=c[1];return typeof u.value=="function"&&Object.assign(a,y({},o,{value:n[o].bind(n)})),typeof u.get=="function"&&Object.assign(a,y({},o,{get:function(){return n[o]}})),a},{}))}return $(e,[{key:"pattern",get:function(){return new RegExp(s(this,d))}},{key:"test",value:function(n){return Boolean(n)&&s(this,d).test(n)}},{key:"find",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",r=n.match(s(this,d));return r&&r[0]}},{key:"matches",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return s(this,l).filter(function(r){return new RegExp(r,S).test(n)})}},{key:"clear",value:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this.exclude(this.matches(n))}},{key:"extend",value:function(){var n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];[].push.apply(s(this,l),r.filter(function(a){return h(n,g,_).call(n,a)===-1}).map(function(a){return a.toLowerCase()})),h(this,p,m).call(this)}},{key:"exclude",value:function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=n.length;r--;){var a=h(this,g,_).call(this,n[r]);a>-1&&s(this,l).splice(a,1)}h(this,p,m).call(this)}},{key:"spawn",value:function(n){return new e(n||s(this,l))}}]),e}();function m(){A(this,d,new RegExp(s(this,l).join("|"),S))}function _(e){return s(this,l).indexOf(e.toLowerCase())}var P=new L;var W="feed.ouuan.moe",D="https://plausible.ouuan.moe";async function H(e){let t=new TextEncoder().encode(e),n=await crypto.subtle.digest("SHA-1",t);return Array.from(new Uint8Array(n)).map(i=>i.toString(16).padStart(2,"0")).join("")}async function M(e){let t=e.headers.get("Referer"),n=e.headers.get("User-Agent")||"Unknown UA",r=e.headers.get("CF-Connecting-IP")||"Unknown IP",a=await H(`${n}-${r}`),i=P.find(n);async function c(o,u){try{let f=await fetch(`${D}/api/event`,{method:"POST",headers:{"User-Agent":`${i?"Mozilla/5.0 (X11; Linux x86_64; rv:107.0) Gecko/20100101 Firefox/107.0":n} (${a})`,"Content-Type":"application/json"},body:JSON.stringify({domain:W,name:o,url:e.url,...t&&{referer:t},...u&&{props:JSON.stringify(u)}})});f.ok||console.log(`${f.status}: ${await f.text()}`)}catch(f){console.log(f)}}await c("pageview"),await c("Feed",{bot:i||"Not A Bot"})}var J=e=>{let{request:t}=e;return/\/feed\.(xml|atom|json)\/*$/.test(new URL(t.url).pathname)&&e.waitUntil(M(t)),e.next()};export{J as onRequestGet};
