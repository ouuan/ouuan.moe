function s(t,e){var a=x(t,e,"get");return E(t,a)}function v(t,e,a){var n=x(t,e,"set");return P(t,n,a),a}function x(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}function E(t,e){return e.get?e.get.call(t):e.value}function P(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}function h(t,e,a){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return a}function k(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(t,e,a){k(t,e),e.set(t,a)}function b(t,e){k(t,e),e.add(t)}var j=[" daum[ /]"," deusu/","(?:^| )site","@[a-z]","\\(at\\)[a-z]","\\(github\\.com/","\\[at\\][a-z]","^12345","^<","^[\\w \\.\\-\\(\\)]+(/v?\\d+(\\.\\d+)?(\\.\\d{1,10})?)?$","^[^ ]{50,}$","^active","^ad muncher","^anglesharp/","^anonymous","^avsdevicesdk/","^axios/","^bidtellect/","^biglotron","^btwebclient/","^castro","^clamav[ /]","^client/","^cobweb/","^coccoc","^custom","^ddg[_-]android","^discourse","^dispatch/\\d","^downcast/","^duckduckgo","^facebook","^fdm[ /]\\d","^getright/","^gozilla/","^hatena","^hobbit","^hotzonu","^hwcdn/","^jeode/","^jetty/","^jigsaw","^linkdex","^lwp[-: ]","^metauri","^microsoft bits","^movabletype","^mozilla/\\d\\.\\d \\(compatible;?\\)$","^mozilla/\\d\\.\\d \\w*$","^navermailapp","^netsurf","^offline explorer","^php","^postman","^postrank","^python","^read","^reed","^restsharp/","^snapchat","^space bison","^svn","^swcd ","^taringa","^test certificate info","^thumbor/","^tumblr/","^user-agent:mozilla","^valid","^venus/fedoraplanet","^w3c","^webbandit/","^webcopier","^wget","^whatsapp","^xenu link sleuth","^yahoo","^yandex","^zdm/\\d","^zoom marketplace/","^{{.*}}$","adbeat\\.com","appinsights","archive","ask jeeves/teoma","bit\\.ly/","bluecoat drtr","bot","browsex","burpcollaborator","capture","catch","check","chrome-lighthouse","chromeframe","cloud","crawl","cryptoapi","dareboost","datanyze","dataprovider","dejaclick","dmbrowser","download","evc-batch/","feed","firephp","freesafeip","ghost","gomezagent","google","headlesschrome/","http","httrack","hubspot marketing grader","hydra","ibisbrowser","images","iplabel","ips-agent","java","library","mail\\.ru/","manager","monitor","morningscore/","neustar wpm","news","nutch","offbyone","optimize","pageburst","pagespeed","perl","phantom","pingdom","powermarks","preview","proxy","ptst[ /]\\d","reader","rexx;","rigor","rss","scan","scrape","search","serp ?reputation ?management","server","sogou","sparkler/","speedcurve","spider","statuscake","stumbleupon\\.com","supercleaner","synapse","synthetic","taginspector/","torrent","tracemyfile","transcoder","trendsmapresolver","twingly recon","url","virtuoso","wappalyzer","webglance","webkit2png","websitemetadataretriever","whatcms/","wordpress","zgrab"];function A(t){try{new RegExp("(?<! cu)bot").test("dangerbot")}catch{return t}return[["bot","(?<! cu)bot"],["google","(?<! (?:channel/|google/))google(?!(app|/google| pixel))"],["http","(?<!(?:lib))http"],["java","java(?!;)"],["search","(?<! ya(?:yandex)?)search"]].forEach(e=>{let[a,n]=e,o=t.lastIndexOf(a);~o&&t.splice(o,1,n)}),t}A(j);var z="i",i=new WeakMap,p=new WeakMap,u=new WeakSet,g=new WeakSet,c=class{constructor(e){return b(this,g),b(this,u),w(this,i,{writable:!0,value:void 0}),w(this,p,{writable:!0,value:void 0}),v(this,i,e||j.slice()),h(this,u,m).call(this),Object.defineProperties(n=>this.test(n),Object.entries(Object.getOwnPropertyDescriptors(c.prototype)).reduce((n,o)=>{let[r,l]=o;return typeof l.value=="function"&&Object.assign(n,{[r]:{value:this[r].bind(this)}}),typeof l.get=="function"&&Object.assign(n,{[r]:{get:()=>this[r]}}),n},{}))}get pattern(){return new RegExp(s(this,p))}test(e){return Boolean(e)&&s(this,p).test(e)}find(){let a=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:"").match(s(this,p));return a&&a[0]}matches(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return s(this,i).filter(a=>new RegExp(a,z).test(e))}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";this.exclude(this.matches(e))}extend(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];[].push.apply(s(this,i),e.filter(a=>h(this,g,y).call(this,a)===-1).map(a=>a.toLowerCase())),h(this,u,m).call(this)}exclude(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],{length:a}=e;for(;a--;){let n=h(this,g,y).call(this,e[a]);n>-1&&s(this,i).splice(n,1)}h(this,u,m).call(this)}spawn(e){return new c(e||s(this,i))}};function m(){v(this,p,new RegExp(s(this,i).join("|"),z))}function y(t){return s(this,i).indexOf(t.toLowerCase())}var _=new c;var O="feed.ouuan.moe",S="https://plausible.ouuan.moe";async function U(t){let e=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-1",e);return Array.from(new Uint8Array(a)).map(r=>r.toString(16).padStart(2,"0")).join("")}async function F(t){let e=t.headers.get("Referer"),a=t.headers.get("User-Agent")||"Unknown UA",n=t.headers.get("CF-Connecting-IP")||"Unknown IP",o=await U(`${a}-${n}`),r=_.find(a);async function l($,f){try{let d=await fetch(`${S}/api/event`,{method:"POST",headers:{"User-Agent":`${r?"Mozilla/5.0 (X11; Linux x86_64; rv:107.0) Gecko/20100101 Firefox/107.0":a} (${o})`,"Content-Type":"application/json"},body:JSON.stringify({domain:O,name:$,url:t.url,...e&&{referer:e},...f&&{props:JSON.stringify(f)}})});d.ok||console.log(`${d.status}: ${await d.text()}`)}catch(d){console.log(d)}}await l("pageview"),await l("Feed",{bot:r||"Not A Bot"})}var C=t=>{let{request:e}=t;return/\/feed\.(xml|atom|json)\/*$/.test(new URL(e.url).pathname)&&t.waitUntil(F(e)),t.next()};export{C as onRequestGet};
